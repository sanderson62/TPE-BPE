* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page   1
* ELDATCV.cbl
* Options: int("ELDATCV.int") anim csi verbose NOBOUND LINKCHECK
*          PARAMCOUNTCHECK directives(cobopt.bth) endp list("ELDATCV.lst")
* Setting: NOACCEPTREFRESH NOADV ALIGN"8" ALPHASTART"1" NOALTER NOAMODE ANIM
*          NOANIMPREP ANS85 APOST NOAREACHECK ARITHMETIC"OSVS" ASSIGN
*          "EXTERNAL" NOASSIGN-PRINTER NOAUTOLOCK NOBELL NOBOUND NOBRIEF
*          NOBS2000 BWZSTAR NOBYTEMODEMOVE CALLFH"EXTFH" NOCALLMCS
*          NOCALLRECOVERY CALLSORT"EXTSM" CANCEL CANCELLBR NOCHANGEMESSAGE
*          CHARSET"ASCII" CHECKDIV"ANSI" NOCHECKREFMOD NOCICS CICS-CPY
*          NOCICSOPTIMIZE NOCMPR2 NOCOBFSTATCONV NOCOBIDY NOCOBOL370 COBOLDIR
*          NOCOMP COMP-5"2" COMP-6"2" NOCOMS85 CONFIRM NOCONVERTRET CONVSPACE
*          COPYEXT",cbl,cpy" NOCOPYLBR COPYLIST COPYLISTCOMMENT"1" CSI
*          CURRENCY-SIGN"36" CURRENT-DATE"MMDDYY" NODATA DATACOMPRESS"0"
*          NODATA-CONTEXT DATE DBCHECK DBCS"2" NODBCSSOSI DBSPACE DE-EDIT"2"
*          DEFAULTBYTE"0" NODEFAULTCALLS DETECTLOCK NODG DIALECT"MF"
*          NODIRECTIVES-IN-COMMENTS NODOSVS NODPCINSUBSCRIPT DYNAM
*          NOEARLY-RELEASE ECHO NOECHOALL NOEDITOR ENSUITE"0" NOENTCOBOL
*          ERRFORMAT"1" ERRLIST"EMBED" NOERRQ FASTSORT NOFCD3 NOFCDREG
*          NOFDCLEAR NOFILESHARE FILETYPE"0" NOFLAG NOFLAGAS NOFLAGCD
*          NOFLAGEUC NOFLAGMIG NOFLAGQ FLAGSINEDIT NOFLAGSTD NOFOLDCALLNAME
*          NOFOLDCOPYNAME FORM"60" NOFP-ROUNDING NOHOSTARITHMETIC
*          NOHOSTCONTZERO NOHOST-NUMCOMPARE NOHOST-NUMMOVE NOHOSTFD NOHOSTRW
*          NOIBM-MS IBMCOMP IDXFORMAT"0" NOILGEN IMPLICITSCOPE NOINDD
*          INFORETURN"0" NOINITCALL INITPTR INT"ELDATCV.int" INTDATE"ANSI"
*          INTLEVEL"2" IOCONV NOISO2002 NOIXNLSKEY NOIXNUMKEY KEEP-INT
*          KEYCHECK KEYCOMPRESS"0" LIBRARIAN"2" NOLINE-COUNT LIST"ELDATCV.lst"
*          LISTPATH"" LISTWIDTH"80" LITVAL-SIZE"4" LOCKTYPE"0" NOMAPNAME
*          NOMAXERROR METHODDEFAULT"REFERENCE" MF"15" MFCOMMENT NOMOVELENCHECK
*          NOMS NOMVS NATIVE"ASCII" NONATIVEFLOATINGPOINT NONCHAR
*          NONEWBASENAME NONLS NSYMBOL"DBCS" NOODOOSVS NOODOSLIDE
*          NOOLDBLANKLINE NOOLDCOPY NOOLDINDEX NOOLDNEXTSENTENCE NOOLDREADINTO
*          NOOLDSTRMIX OOCTRL"-C-E-G-P+Q+R-S+W" OPTIONAL-FILE NOOS390 OSEXT""
*          NOOSVS NOOUTDD NOP64 NOPANVALET PERFORM-TYPE"OSVS" NOPREPLIST
*          NOPREPROCESS NOPRINT-EXT NOPROFILE NOPROGID-COMMENT
*          NOPROGID-INT-NAME NOPROTECT-LINKAGE PROTOTYPE"RELAXED" QUAL
*          QUALPROC NOQUERY NOQUOTE NORAWLIST NORDW RECMODE"F" NOREENTRANT
*          NOREF NOREFNO REMAINDER"1" REPORT-LINE"256" RESEQ NORETRYLOCK
*          REWRITE-LS NORM RTNCODE-SIZE"4" NORWHARDPAGE NOSAA SEG NOSEQCHK
*          SEQUENTIAL"RECORD" NOSERIAL SETTING"LINE" NOSHAREOUTDD NOSHOW-DIR
*          SIGN"ASCII" NOSIGNDISCARD NOSIGNFIXUP SORTTYPE"DFSORT" SOURCEFORMAT
*          "FIXED" SOURCETABSTOP"8" NOSPZERO NOSSRANGE STDERR STICKY-LINKAGE
*          "2" NOSTICKY-PERFORM SUPFF SWITCHTYPE"1" SYMBSTART"1" SYSPUNCH"132"
*          TERMPAGE TIME NOTRACE NOTRUNC NOTRUNCCALLNAME NOTRUNCCOPY TRUNCINC
*          "10" UNICODE"NATIVE" VERBOSE VSC2"4" WARNING"1" NOWB NOWB2 NOWB3
*          WEBSERVER"CGI" NOWRITELOCK NOWRITETHRU NOXOPEN NOXREF
*          NOZEROLENGTHFALSE NOZEROSEQ NOZWB
     1 IDENTIFICATION DIVISION.
     2
     3 PROGRAM-ID.                 ELDATCV.
     4*              PROGRAM CONVERTED BY
     5*              COBOL CONVERSION AID PO 5785-ABJ
     6*              CONVERSION DATE 03/05/96 14:47:01.
     7*            PROGRAM REVIEWED FOR YEAR 2000 COMPLIANCE
     8*                            VMOD=2.007
     9
    10*AUTHOR.     LOGIC, INC.
    11*            DALLAS, TEXAS.
    12
    13*DATE-COMPILED.
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page   2
* ELDATCV.cbl
    14
    15*SECURITY.   *****************************************************
    16*            *                                                   *
    17*            *   THIS PROGRAM IS THE PROPERTY OF LOGIC, INC.     *
    18*            *                                                   *
    19*            *   USE OF THIS PROGRAM BY OTHER THAN THE EMPLOYEES *
    20*            *   OF LOGIC, INC. IS EXPRESSLY PROHIBITED WITHOUT  *
    21*            *   THE PRIOR WRITTEN PERMISSION OF LOGIC INC.      *
    22*            *                                                   *
    23*            *****************************************************
    24
    25*REMARKS.    *****************************************************
    26*            *                                                   *
    27*            *    THIS 'SUBROUTINE' WILL, DEPENDING UPON THE     *
    28*            *    OPTION SPECIFIED, CONVERT A GIVEN DATE TO      *
    29*            *    THE FOLLOWING:  I. EDITED GREGORIAN (MM/DD/YY) *
    30*            *                   II. Y-M-D GREGORIAN  (YYMMDD)   *
    31*            *                  III. M-D-Y GREGORIAN  (MMDDYY)   *
    32*            *                   IV. ALPHA GREG  (MMM DD, YYYY)  *
    33*            *                    V. JULIAN  (YYDDD)             *
    34*            *                   VI. TOTAL DAYS SINCE 1900.      *
    35*            *    ADDITIONALLY, IF TWO DATES (EXPRESSED AS DAYS) *
    36*            *    ARE GIVEN, THE ELAPSED MONTHS AND DAYS CAN BE  *
    37*            *    CALCULATED.                                    *
    38*            *                                                   *
    39*            *****************************************************
    40 ENVIRONMENT DIVISION.
    41
    42 DATA DIVISION.
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page   3
* ELDATCV.cbl
    44 WORKING-STORAGE SECTION.
    45 01  DFH-START PIC X(04).
    46 77  FILLER   PIC X(32) VALUE '********************************'.
    47 77  FILLER   PIC X(32) VALUE '*   ELDATCV WORKING STORAGE    *'.
    48 77  FILLER   PIC X(32) VALUE '********* VMOD 2.007 ***********'.
    49
    50 01 WKS-IN.
    51    10  FILLER    PIC X(6) VALUE 'DATEIN'.
    52    10  WKS-IN-TN PIC 9(10).
    53
    54 01 WKS-OT.
    55    10  FILLER    PIC X(6) VALUE 'DATEOT'.
    56    10  WKS-OT-TN PIC 9(10).
    57
    58 01  W-PROGRAM-WORK-AREA.
    59     12  W-CURRENT-DATE              PIC  9(07).
    60     12  FILLER REDEFINES W-CURRENT-DATE.
    61         16  FILLER                  PIC  9.
    62         16  W-CD-CCYY               PIC  999.
    63         16  W-CD-CCYY-R  REDEFINES W-CD-CCYY.
    64             20  W-CD-YEAR-CD        PIC  9.
    65             20  W-CURRENT-YEAR-YY   PIC  99.
    66         16  W-CURRENT-DAYS          PIC  999.
    67     12  W-FLOAT-YEAR                PIC  999.
    68     12  W-FLOAT-YY REDEFINES W-FLOAT-YEAR.
    69         16  W-FLOAT-YEAR-CD         PIC  9.
    70         16  W-FLOAT-YEAR-YY         PIC  99.
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page   4
* ELDATCV.cbl
    72*                            COPY ELCDATW1.
    73******************************************************************
    74*                                                                *
    75*                                                                *
    76*                            ELCDATW1.                           *
    77*           COPYBOOK REVIEWED FOR YEAR 2000 COMPLIANCE
    78*                            VMOD=2.003                          *
    79*                                                                *
    80*   DESCRIPTION:  WORKING STORAGE AREA FOR DATE CONVERSION RTN.  *
    81*
    82******************************************************************
    83
    84 01  WS-DATE-WORK-AREA.
    85     05  WS-BINARY-DATE-1             PIC S9(9)      VALUE ZERO.
    86     05  WS-BINARY-DATE-2             PIC S9(9)      VALUE ZERO.
    87     05  WS-ELAPSED-DAYS              PIC S9(5)      VALUE ZERO.
    88     05  WS-ELAPSED-MONTHS            PIC S9(5)      VALUE ZERO.
    89     05  DAYS-REMAINING               PIC S999       VALUE ZERO.
    90     05  CHECK-YEAR                   PIC S999       VALUE ZERO.
    91     05  DAYS-ELAPSED                 PIC S9(5)      VALUE ZERO.
    92     05  DAYS-NEEDED                  PIC S9(5)      VALUE ZERO.
    93     05  WS-DAY-OF-CENTURY            PIC S9(5)      VALUE ZERO.
    94     05  DAY-OF-WEEK-X                PIC S9         VALUE ZERO.
    95     05  WORK-JULIAN.
    96         10  JULIAN-YEAR              PIC S9(3)      VALUE ZERO.
    97         10  JULIAN-DAY               PIC S9(3)      VALUE ZERO.
    98     05  WORK-JULIAN-1.
    99         10  JULIAN-YEAR1             PIC S9(3)      VALUE ZERO.
   100         10  JULIAN-DAY1              PIC S9(3)      VALUE ZERO.
   101     05  WORK-JULIAN-2.
   102         10  JULIAN-YEAR2             PIC S9(3)      VALUE ZERO.
   103         10  JULIAN-DAY2              PIC S9(3)      VALUE ZERO.
   104
   105 01  LEAP-YEAR-FIELDS.
   106     05  DIVIDE-LEAP-YEAR             PIC 999V99     VALUE ZERO.
   107     05  DIVIDE-LEAP-YEAR-R REDEFINES DIVIDE-LEAP-YEAR.
   108         10  DIVIDE-RESULT            PIC 999.
   109         10  DIVIDE-REMAINDER         PIC V99.
   110             88  A-LEAP-YEAR                         VALUE ZERO.
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page   5
* ELDATCV.cbl
   111/
   112 01  FILLER.
   113     05  BIN-DATE            COMP    PIC S9(9)       VALUE ZERO.
   114
   115     05  FILLER                      REDEFINES
   116         BIN-DATE.
   117         10  FILLER                  PIC XX.
   118         10  BIN-DATE-WORK           PIC XX.
   119
   120     05  BIN-DATE-3                  REDEFINES
   121         BIN-DATE.
   122         10  FILLER                  PIC X.
   123         10  BIN-DATE-3-WORK         PIC XXX.
   124
   125      05  GREG-ALPHA-MASK         PIC X(18)
   126                        VALUE '            , 0000'.
   127
   128      05  WORK-DATE-1.
   129          10  YEAR1                   PIC S9(3)     VALUE ZERO.
   130          10  MONTH1                  PIC S9(3)     VALUE ZERO.
   131          10  DAY1                    PIC S9(3)     VALUE ZERO.
   132
   133     05  WORK-DATE-2.
   134         10  YEAR2                    PIC S9(3)     VALUE ZERO.
   135         10  MONTH2                   PIC S9(3)     VALUE ZERO.
   136         10  DAY2                     PIC S9(3)     VALUE ZERO.
   137
   138 01  YR-2                        PIC 9(3).
   139 01  YR-2-R REDEFINES YR-2.
   140     05  YEAR2-CEN-CD            PIC 9.
   141     05  YEAR2-YR                PIC 99.
   142
   143 01  MONTH-AND-DAYS-TABLE.
   144     05  FILLER             PIC X(10)  VALUE ' JANUARY  '.
   145     05  FILLER             PIC 9(3)   VALUE ZERO.
   146     05  FILLER             PIC 9(3)   VALUE ZERO.
   147     05  FILLER             PIC 9(3)   VALUE 31.
   148     05  FILLER             PIC X(10)  VALUE 'FEBRUARY  '.
   149     05  FILLER             PIC 9(3)   VALUE 31.
   150     05  FILLER             PIC 9(3)   VALUE 31.
   151     05  FILLER             PIC 9(3)   VALUE 28.
   152     05  FILLER             PIC X(10)  VALUE '  MARCH   '.
   153     05  FILLER             PIC 9(3)   VALUE 59.
   154     05  FILLER             PIC 9(3)   VALUE 60.
   155     05  FILLER             PIC 9(3)   VALUE 31.
   156     05  FILLER             PIC X(10)  VALUE '  APRIL   '.
   157     05  FILLER             PIC 9(3)   VALUE 90.
   158     05  FILLER             PIC 9(3)   VALUE 91.
   159     05  FILLER             PIC 9(3)   VALUE 30.
   160     05  FILLER             PIC X(10)  VALUE '   MAY    '.
   161     05  FILLER             PIC 9(3)   VALUE 120.
   162     05  FILLER             PIC 9(3)   VALUE 121.
   163     05  FILLER             PIC 9(3)   VALUE 31.
   164     05  FILLER             PIC X(10)  VALUE '  JUNE    '.
   165     05  FILLER             PIC 9(3)   VALUE 151.
   166     05  FILLER             PIC 9(3)   VALUE 152.
   167     05  FILLER             PIC 9(3)   VALUE 30.
   168     05  FILLER             PIC X(10)  VALUE '  JULY    '.
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page   6
* ELDATCV.cbl
   169     05  FILLER             PIC 9(3)   VALUE 181.
   170     05  FILLER             PIC 9(3)   VALUE 182.
   171     05  FILLER             PIC 9(3)   VALUE 31.
   172     05  FILLER             PIC X(10)  VALUE ' AUGUST   '.
   173     05  FILLER             PIC 9(3)   VALUE 212.
   174     05  FILLER             PIC 9(3)   VALUE 213.
   175     05  FILLER             PIC 9(3)   VALUE 31.
   176     05  FILLER             PIC X(10)  VALUE 'SEPTEMBER '.
   177     05  FILLER             PIC 9(3)   VALUE 243.
   178     05  FILLER             PIC 9(3)   VALUE 244.
   179     05  FILLER             PIC 9(3)   VALUE 30.
   180     05  FILLER             PIC X(10)  VALUE ' OCTOBER  '.
   181     05  FILLER             PIC 9(3)   VALUE 273.
   182     05  FILLER             PIC 9(3)   VALUE 274.
   183     05  FILLER             PIC 9(3)   VALUE 31.
   184     05  FILLER             PIC X(10)  VALUE 'NOVEMBER  '.
   185     05  FILLER             PIC 9(3)   VALUE 304.
   186     05  FILLER             PIC 9(3)   VALUE 305.
   187     05  FILLER             PIC 9(3)   VALUE 30.
   188     05  FILLER             PIC X(10)  VALUE 'DECEMBER  '.
   189     05  FILLER             PIC 9(3)   VALUE 334.
   190     05  FILLER             PIC 9(3)   VALUE 335.
   191     05  FILLER             PIC 9(3)   VALUE 31.
   192     05  FILLER             PIC X(10)  VALUE 'XXXXXXXX  '.
   193     05  FILLER             PIC 9(3)   VALUE 365.
   194     05  FILLER             PIC 9(3)   VALUE 366.
   195     05  FILLER             PIC 9(3)   VALUE ZERO.
   196
   197 01  TABLE-OF-MONTHS-AND-DAYS  REDEFINES  MONTH-AND-DAYS-TABLE.
   198     05  MONTHS-AND-DAYS
   199         OCCURS 13 TIMES             INDEXED BY MTHX
   200                                                SUB1.
   201         10  NAME-OF-MONTH            PIC X(10).
   202         10  REGULAR-DAYS             PIC 999.
   203         10  LEAP-YR-DAYS             PIC 999.
   204         10  DAYS-IN-MONTH            PIC 999.
   205
   206 01  CENTURY-CONVERSION-TABLE.
   207     05  FILLER                      PIC 9(4)  VALUE 0019.
   208     05  FILLER                      PIC 9(4)  VALUE 0120.
   209     05  FILLER                      PIC 9(4)  VALUE 0221.
   210     05  FILLER                      PIC 9(4)  VALUE 0322.
   211     05  FILLER                      PIC 9(4)  VALUE 0423.
   212     05  FILLER                      PIC 9(4)  VALUE 0524.
   213     05  FILLER                      PIC 9(4)  VALUE 0625.
   214     05  FILLER                      PIC 9(4)  VALUE 0726.
   215     05  FILLER                      PIC 9(4)  VALUE 0827.
   216     05  FILLER                      PIC 9(4)  VALUE 0928.
   217 01  TABLE-CENTURY  REDEFINES CENTURY-CONVERSION-TABLE.
   218     05  CENTURY-TBL OCCURS 10 TIMES INDEXED BY CNTRY-NDX.
   219         10  CENTURY-CODE            PIC 99.
   220         10  CENTURY                 PIC 99.
   221
   222 01  CENTURY-SEARCH-VARIABLES.
   223     05  FIND-CENTURY-FLAG       PIC  X.
   224     05  SEARCH-CENTURY.
   225         10  SEARCH-CENTURY-N    PIC  99.
   226     05  SEARCH-CENTURY-CODE.
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page   7
* ELDATCV.cbl
   227         10  SEARCH-CENTURY-CD-N PIC  99.
   228     05  FOUND-CENTURY.
   229         10  FOUND-CENTURY-N     PIC  99.
   230     05  FOUND-CENTURY-CODE.
   231         10  FOUND-CENTURY-CD-N  PIC  99.
   232     05  CURRENT-CENTURY-1.
   233         10  CURRENT-CENTURY-1-N PIC 99     VALUE 19.
   234     05  CONTROL-YEAR            PIC 9(03)  VALUE 070.
   235     05  CONTROL-YR REDEFINES CONTROL-YEAR.
   236         10 CONTROL-YEAR-CD      PIC  9.
   237         10 CONTROL-YEAR-YY      PIC  99.
   238     05  W-PRESENT-YEAR          PIC  9(03) VALUE ZEROS.
   239     05  PREVIOUS-CENTURY        PIC  99    VALUE ZEROS.
   240     05  NEXT-CENTURY            PIC  99    VALUE ZEROS.
   241     05  CENTURY-MARK            PIC  9(03) VALUE 100.
   242     05  CHECK-CCYY              PIC  9(04) VALUE ZEROES.
   243     05  CHECK-CCYY-R REDEFINES CHECK-CCYY.
   244         10  CHECK-CCYY-CC       PIC 99.
   245         10  CHECK-CCYY-YY       PIC 99.
   246     05  BREAK-PERIOD            PIC  9(03) VALUE 0.
   247
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page   8
* ELDATCV.cbl
   249*                            COPY ELCDATE.
   250******************************************************************
   251*                                                                *
   252*                                                                *
   253*                            ELCDATE.                            *
   254*           COPYBOOK REVIEWED FOR YEAR 2000 COMPLIANCE
   255*                            VMOD=2.003
   256*                                                                *
   257*                                                                *
   258*   DESCRIPTION:  DATA PASSED TO DATE CONVERSION ROUTINE.        *
   259*                 LENGTH = 200                                   *
   260******************************************************************
   261
   262 01  DATE-CONVERSION-DATA.
   263     12  DC-COMM-LENGTH                PIC S9(4) COMP VALUE +200.
   264     12  DC-OPTION-CODE                PIC X.
   265         88  BIN-TO-GREG                VALUE ' '.
   266         88  ELAPSED-BETWEEN-BIN        VALUE '1'.
   267         88  EDIT-GREG-TO-BIN           VALUE '2'.
   268         88  YMD-GREG-TO-BIN            VALUE '3'.
   269         88  MDY-GREG-TO-BIN            VALUE '4'.
   270         88  JULIAN-TO-BIN              VALUE '5'.
   271         88  BIN-PLUS-ELAPSED           VALUE '6'.
   272         88  FIND-CENTURY               VALUE '7'.
   273         88  ELAPSED-BETWEEN-BIN-3      VALUE '8'.
   274         88  EDIT-GREG-TO-BIN-3         VALUE '9'.
   275         88  YMD-GREG-TO-BIN-3          VALUE 'A'.
   276         88  MDY-GREG-TO-BIN-3          VALUE 'B'.
   277         88  JULIAN-TO-BIN-3            VALUE 'C'.
   278         88  BIN-PLUS-ELAPSED-3         VALUE 'D'.
   279         88  JULIAN-EXPANDED-TO-BIN     VALUE 'E'.
   280         88  JULIAN-EXPANDED-TO-BIN-3   VALUE 'F'.
   281         88  BIN-TO-JULIAN-EXPANDED     VALUE 'G'.
   282         88  JULIAN-EXPANDED            VALUE 'E', 'F', 'G'.
   283         88  CHECK-LEAP-YEAR            VALUE 'H'.
   284         88  BIN-3-TO-GREG              VALUE 'I'.
   285         88  CYMD-GREG-TO-BIN-3         VALUE 'J'.
   286         88  MDCY-GREG-TO-BIN-3         VALUE 'K'.
   287         88  CYMD-GREG-TO-BIN           VALUE 'L'.
   288         88  MDCY-GREG-TO-BIN           VALUE 'M'.
   289         88  MDY-GREG-TO-JULIAN         VALUE 'N'.
   290         88  MDCY-GREG-TO-JULIAN        VALUE 'O'.
   291         88  YMD-GREG-TO-JULIAN         VALUE 'P'.
   292         88  CYMD-GREG-TO-JULIAN        VALUE 'Q'.
   293         88  THREE-CHARACTER-BIN
   294                  VALUES  '8' '9' 'A' 'B' 'C' 'D' 'I' 'J' 'K'.
   295         88  GREGORIAN-TO-BIN
   296                  VALUES '2' '3' '4' '9' 'A' 'B' 'J' 'K' 'L' 'M'.
   297         88  BIN-TO-GREGORIAN
   298                  VALUES ' ' '1' 'I' '8' 'G'.
   299         88  JULIAN-TO-BINARY
   300                  VALUES '5' 'C' 'E' 'F'.
   301     12  DC-ERROR-CODE                 PIC X.
   302         88  NO-CONVERSION-ERROR        VALUE ' '.
   303         88  DATE-CONVERSION-ERROR
   304                  VALUES '1' '2' '3' '4' '5' '9' 'A' 'B' 'C'.
   305         88  DATE-IS-ZERO               VALUE '1'.
   306         88  DATE-IS-NON-NUMERIC        VALUE '2'.
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page   9
* ELDATCV.cbl
   307         88  DATE-IS-INVALID            VALUE '3'.
   308         88  DATE1-GREATER-DATE2        VALUE '4'.
   309         88  ELAPSED-PLUS-NEGATIVE      VALUE '5'.
   310         88  DATE-INVALID-OPTION        VALUE '9'.
   311         88  INVALID-CENTURY            VALUE 'A'.
   312         88  ONLY-CENTURY               VALUE 'B'.
   313         88  ONLY-LEAP-YEAR             VALUE 'C'.
   314         88  VALID-CENTURY-LEAP-YEAR    VALUE 'B', 'C'.
   315     12  DC-END-OF-MONTH               PIC X.
   316         88  CALCULATE-END-OF-MONTH     VALUE '1'.
   317     12  DC-CENTURY-ADJUSTMENT         PIC X   VALUE SPACES.
   318         88  USE-NORMAL-PROCESS         VALUE ' '.
   319         88  ADJUST-DOWN-100-YRS        VALUE '1'.
   320         88  ADJUST-UP-100-YRS          VALUE '2'.
   321     12  FILLER                        PIC X.
   322     12  DC-CONVERSION-DATES.
   323         16  DC-BIN-DATE-1             PIC XX.
   324         16  DC-BIN-DATE-2             PIC XX.
   325         16  DC-GREG-DATE-1-EDIT       PIC X(08).
   326         16  DC-GREG-DATE-1-EDIT-R REDEFINES
   327                       DC-GREG-DATE-1-EDIT.
   328             20  DC-EDIT1-MONTH        PIC 99.
   329             20  SLASH1-1              PIC X.
   330             20  DC-EDIT1-DAY          PIC 99.
   331             20  SLASH1-2              PIC X.
   332             20  DC-EDIT1-YEAR         PIC 99.
   333         16  DC-GREG-DATE-2-EDIT       PIC X(08).
   334         16  DC-GREG-DATE-2-EDIT-R REDEFINES
   335                     DC-GREG-DATE-2-EDIT.
   336             20  DC-EDIT2-MONTH        PIC 99.
   337             20  SLASH2-1              PIC X.
   338             20  DC-EDIT2-DAY          PIC 99.
   339             20  SLASH2-2              PIC X.
   340             20  DC-EDIT2-YEAR         PIC 99.
   341         16  DC-GREG-DATE-1-YMD        PIC 9(06).
   342         16  DC-GREG-DATE-1-YMD-R  REDEFINES
   343                     DC-GREG-DATE-1-YMD.
   344             20  DC-YMD-YEAR           PIC 99.
   345             20  DC-YMD-MONTH          PIC 99.
   346             20  DC-YMD-DAY            PIC 99.
   347         16  DC-GREG-DATE-1-MDY        PIC 9(06).
   348         16  DC-GREG-DATE-1-MDY-R REDEFINES
   349                      DC-GREG-DATE-1-MDY.
   350             20  DC-MDY-MONTH          PIC 99.
   351             20  DC-MDY-DAY            PIC 99.
   352             20  DC-MDY-YEAR           PIC 99.
   353         16  DC-GREG-DATE-1-ALPHA.
   354             20  DC-ALPHA-MONTH        PIC X(10).
   355             20  DC-ALPHA-DAY          PIC 99.
   356             20  FILLER                PIC XX.
   357             20  DC-ALPHA-CENTURY.
   358                 24 DC-ALPHA-CEN-N     PIC 99.
   359             20  DC-ALPHA-YEAR         PIC 99.
   360         16  DC-ELAPSED-MONTHS         PIC S9(4)     COMP.
   361         16  DC-ODD-DAYS-OVER          PIC S9(4)     COMP.
   362         16  DC-ELAPSED-DAYS           PIC S9(4)     COMP.
   363         16  DC-JULIAN-DATE            PIC 9(05).
   364         16  DC-JULIAN-YYDDD REDEFINES DC-JULIAN-DATE
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  10
* ELDATCV.cbl
   365                                       PIC 9(05).
   366         16  DC-JULIAN-DT REDEFINES DC-JULIAN-DATE.
   367             20  DC-JULIAN-YEAR        PIC 99.
   368             20  DC-JULIAN-DAYS        PIC 999.
   369         16  DC-DAYS-IN-MONTH          PIC S9(3)       COMP-3.
   370         16  DC-DAY-OF-WEEK            PIC S9  VALUE ZERO COMP-3.
   371         16  DC-DAY-OF-WEEK2           PIC S9  VALUE ZERO COMP-3.
   372     12  DATE-CONVERSION-VARIBLES.
   373         16  HOLD-CENTURY-1            PIC 9(11) VALUE 0.
   374         16  HOLD-CENTURY-1-SPLIT REDEFINES HOLD-CENTURY-1.
   375             20  FILLER                PIC 9(3).
   376             20  HOLD-CEN-1-CCYY.
   377                 24  HOLD-CEN-1-CC     PIC 99.
   378                 24  HOLD-CEN-1-YY     PIC 99.
   379             20  HOLD-CEN-1-MO         PIC 99.
   380             20  HOLD-CEN-1-DA         PIC 99.
   381         16  HOLD-CENTURY-1-R   REDEFINES HOLD-CENTURY-1.
   382             20  HOLD-CEN-1-R-MO       PIC 99.
   383             20  HOLD-CEN-1-R-DA       PIC 99.
   384             20  HOLD-CEN-1-R-CCYY.
   385                 24  HOLD-CEN-1-R-CC   PIC 99.
   386                 24  HOLD-CEN-1-R-YY   PIC 99.
   387             20  FILLER                PIC 9(3).
   388         16  HOLD-CENTURY-1-X.
   389             20  FILLER                PIC X(3)  VALUE SPACES.
   390             20  HOLD-CEN-1-X-CCYY.
   391                 24  HOLD-CEN-1-X-CC   PIC XX VALUE SPACES.
   392                 24  HOLD-CEN-1-X-YY   PIC XX VALUE SPACES.
   393             20  HOLD-CEN-1-X-MO       PIC XX VALUE SPACES.
   394             20  HOLD-CEN-1-X-DA       PIC XX VALUE SPACES.
   395         16  HOLD-CENTURY-1-R-X REDEFINES HOLD-CENTURY-1-X.
   396             20  HOLD-CEN-1-R-X-MO     PIC XX.
   397             20  HOLD-CEN-1-R-X-DA     PIC XX.
   398             20  HOLD-CEN-1-R-X-CCYY.
   399                 24  HOLD-CEN-1-R-X-CC PIC XX.
   400                 24  HOLD-CEN-1-R-X-YY PIC XX.
   401             20  FILLER                PIC XXX.
   402         16  DC-BIN-DATE-EXPAND-1      PIC XXX.
   403         16  DC-BIN-DATE-EXPAND-2      PIC XXX.
   404         16  DC-JULIAN-DATE-1          PIC 9(07).
   405         16  DC-JULIAN-DATE-1-R REDEFINES DC-JULIAN-DATE-1.
   406             20  DC-JULIAN-1-CCYY.
   407                 24  DC-JULIAN-1-CC    PIC 99.
   408                 24  DC-JULIAN-1-YR    PIC 99.
   409             20  DC-JULIAN-DA-1        PIC 999.
   410         16  DC-JULIAN-DATE-2          PIC 9(07).
   411         16  DC-JULIAN-DATE-2-R REDEFINES DC-JULIAN-DATE-2.
   412             20  DC-JULIAN-2-CCYY.
   413                 24  DC-JULIAN-2-CC    PIC 99.
   414                 24  DC-JULIAN-2-YR    PIC 99.
   415             20  DC-JULIAN-DA-2        PIC 999.
   416         16  DC-GREG-DATE-A-EDIT.
   417             20  DC-EDITA-MONTH        PIC 99.
   418             20  SLASHA-1              PIC X VALUE '/'.
   419             20  DC-EDITA-DAY          PIC 99.
   420             20  SLASHA-2              PIC X VALUE '/'.
   421             20  DC-EDITA-CCYY.
   422                 24  DC-EDITA-CENT     PIC 99.
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  11
* ELDATCV.cbl
   423                 24  DC-EDITA-YEAR     PIC 99.
   424         16  DC-GREG-DATE-B-EDIT.
   425             20  DC-EDITB-MONTH        PIC 99.
   426             20  SLASHB-1              PIC X VALUE '/'.
   427             20  DC-EDITB-DAY          PIC 99.
   428             20  SLASHB-2              PIC X VALUE '/'.
   429             20  DC-EDITB-CCYY.
   430                 24  DC-EDITB-CENT     PIC 99.
   431                 24  DC-EDITB-YEAR     PIC 99.
   432         16  DC-GREG-DATE-CYMD         PIC 9(08).
   433         16  DC-GREG-DATE-CYMD-R REDEFINES
   434                              DC-GREG-DATE-CYMD.
   435             20  DC-CYMD-CEN           PIC 99.
   436             20  DC-CYMD-YEAR          PIC 99.
   437             20  DC-CYMD-MONTH         PIC 99.
   438             20  DC-CYMD-DAY           PIC 99.
   439         16  DC-GREG-DATE-MDCY         PIC 9(08).
   440         16  DC-GREG-DATE-MDCY-R REDEFINES
   441                              DC-GREG-DATE-MDCY.
   442             20  DC-MDCY-MONTH         PIC 99.
   443             20  DC-MDCY-DAY           PIC 99.
   444             20  DC-MDCY-CEN           PIC 99.
   445             20  DC-MDCY-YEAR          PIC 99.
   446    12  DC-FORCE-EL310-DATE-SW         PIC X    VALUE SPACE.
   447        88  DC-FORCE-EL310-DATE                 VALUE 'Y'.
   448    12  DC-EL310-DATE                  PIC X(21).
   449    12  FILLER                         PIC X(28).
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  12
* ELDATCV.cbl
   451****************************************************************
   452*
   453* Copyright (c) 2007 by Clerity Solutions, Inc.
   454* All rights reserved.
   455*
   456****************************************************************
   457 01  DFHEIV.
   458   02  DFHEIV0               PIC X(35).
   459   02  DFHEIV1               PIC X(08).
   460   02  DFHEIV2               PIC X(08).
   461   02  DFHEIV3               PIC X(08).
   462   02  DFHEIV4               PIC X(06).
   463   02  DFHEIV5               PIC X(04).
   464   02  DFHEIV6               PIC X(04).
   465   02  DFHEIV7               PIC X(02).
   466   02  DFHEIV8               PIC X(02).
   467   02  DFHEIV9               PIC X(01).
   468   02  DFHEIV10              PIC S9(7) COMP-3.
   469   02  DFHEIV11              PIC S9(4) COMP SYNC.
   470   02  DFHEIV12              PIC S9(4) COMP SYNC.
   471   02  DFHEIV13              PIC S9(4) COMP SYNC.
   472   02  DFHEIV14              PIC S9(4) COMP SYNC.
   473   02  DFHEIV15              PIC S9(4) COMP SYNC.
   474   02  DFHEIV16              PIC S9(9) COMP SYNC.
   475   02  DFHEIV17              PIC X(04).
   476   02  DFHEIV18              PIC X(04).
   477   02  DFHEIV19              PIC X(04).
   478   02  DFHEIV20              USAGE IS POINTER.
   479   02  DFHEIV21              USAGE IS POINTER.
   480   02  DFHEIV22              USAGE IS POINTER.
   481   02  DFHEIV23              USAGE IS POINTER.
   482   02  DFHEIV24              USAGE IS POINTER.
   483   02  DFHEIV25              PIC S9(9) COMP SYNC.
   484   02  DFHEIV26              PIC S9(9) COMP SYNC.
   485   02  DFHEIV27              PIC S9(9) COMP SYNC.
   486   02  DFHEIV28              PIC S9(9) COMP SYNC.
   487   02  DFHEIV97              PIC S9(7) COMP-3 VALUE ZERO.
   488   02  DFHEIV98              PIC S9(4) COMP SYNC VALUE ZERO.
   489   02  FILLER                PIC X(02).
   490   02  DFHEIV99              PIC X(08) VALUE SPACE.
   491   02  DFHEIVL0              PIC X(48) VALUE SPACE.
   492   02  DFHEIVL1              PIC X(48) VALUE SPACE.
   493   02  DFHEIVL2              PIC X(48) VALUE SPACE.
   494   02  DFHEIVL3              PIC X(48) VALUE SPACE.
   495 LINKAGE  SECTION.
   496*****************************************************************
   497*                                                               *
   498* Copyright (c) 2007 by Clerity Solutions, Inc.                 *
   499* All rights reserved.                                          *
   500*                                                               *
   501*****************************************************************
   502 01  dfheiblk.
   503     02  eibtime          pic s9(7) comp-3.
   504     02  eibdate          pic s9(7) comp-3.
   505     02  eibtrnid         pic x(4).
   506     02  eibtaskn         pic s9(7) comp-3.
   507     02  eibtrmid         pic x(4).
   508     02  dfheigdi         pic s9(4) comp.
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  13
* ELDATCV.cbl
   509     02  eibcposn         pic s9(4) comp.
   510     02  eibcalen         pic s9(4) comp.
   511     02  eibaid           pic x(1).
   512     02  eibfiller1       pic x(1).
   513     02  eibfn            pic x(2).
   514     02  eibfiller2       pic x(2).
   515     02  eibrcode         pic x(6).
   516     02  eibfiller3       pic x(2).
   517     02  eibds            pic x(8).
   518     02  eibreqid         pic x(8).
   519     02  eibrsrce         pic x(8).
   520     02  eibsync          pic x(1).
   521     02  eibfree          pic x(1).
   522     02  eibrecv          pic x(1).
   523     02  eibsend          pic x(1).
   524     02  eibatt           pic x(1).
   525     02  eibeoc           pic x(1).
   526     02  eibfmh           pic x(1).
   527     02  eibcompl         pic x(1).
   528     02  eibsig           pic x(1).
   529     02  eibconf          pic x(1).
   530     02  eiberr           pic x(1).
   531     02  eibrldbk         pic x(1).
   532     02  eiberrcd         pic x(4).
   533     02  eibsynrb         pic x(1).
   534     02  eibnodat         pic x(1).
   535     02  eibfiller5       pic x(2).
   536     02  eibresp          pic 9(09) comp.
   537     02  eibresp2         pic 9(09) comp.
   538     02  dfheigdj         pic s9(4) comp.
   539     02  dfheigdk         pic s9(4) comp.
   540
   541 01  DFHCOMMAREA                     PIC X(200).
   542
   543 PROCEDURE DIVISION USING DFHEIBLK DFHCOMMAREA.
   544 0000-DFHEXIT SECTION.
   545     MOVE '9#                    $   ' TO DFHEIV0.
   546     MOVE 'ELDATCV' TO DFHEIV1.
   547     CALL 'kxdfhei1' USING DFHEIV0 DFH-START DFHEIV DFHEIV1.
   548     MOVE eibtaskn to WKS-IN-TN.
   549*    EXEC CICS WRITE OPERATOR
   550*         TEXT(WKS-IN)
   551*          TEXTLENGTH(16)
   552*    END-EXEC.
   553
   554     MOVE DFHCOMMAREA          TO  DATE-CONVERSION-DATA.
   555
   556     MOVE SPACES                TO DC-ERROR-CODE.
   557
   558     INITIALIZE DC-GREG-DATE-1-ALPHA.
   559
   560     MOVE EIBDATE              TO  W-CURRENT-DATE.
   561
   562     MOVE W-CD-YEAR-CD         TO CONTROL-YEAR-CD
   563                                  SEARCH-CENTURY-CD-N.
   564
   565     MOVE '1'                  TO FIND-CENTURY-FLAG.
   566     PERFORM 0800-FIND-CENTURY.
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  14
* ELDATCV.cbl
   567     IF NO-CONVERSION-ERROR
   568         MOVE FOUND-CENTURY-N  TO CURRENT-CENTURY-1-N.
   569
   570     COMPUTE W-FLOAT-YEAR = W-CD-CCYY - CONTROL-YEAR.
   571*    display 'Test cobsw cpdebug ' eibtaskn.
   572
   573 0100-PROGRAM-PROCESSING SECTION.
   574*                                 COPY ELCDATP1.
   575*****************************************************************
   576*                                                               *
   577*                                                               *
   578*                            ELCDATP1.                          *
   579*           COPYBOOK REVIEWED FOR YEAR 2000 COMPLIANCE
   580*                            VMOD=2.002                         *
   581*                                                               *
   582*****************************************************************
   583
   584     IF NOT FIND-CENTURY
   585        MOVE GREG-ALPHA-MASK   TO DC-GREG-DATE-1-ALPHA
   586     END-IF
   587
   588     MOVE 2                    TO FIND-CENTURY-FLAG.
   589     MOVE CURRENT-CENTURY-1-N  TO SEARCH-CENTURY-N
   590     PERFORM 0800-FIND-CENTURY.
   591
   592     MOVE FOUND-CENTURY-CD-N   TO CONTROL-YEAR-CD
   593                                  W-CD-YEAR-CD.
   594*Y2K
   595*                                 W-FLOAT-YEAR-CD.
   596
   597     COMPUTE BREAK-PERIOD = (FOUND-CENTURY-CD-N * 100) + 69
   598
   599     EVALUATE TRUE
   600        WHEN W-CD-CCYY < BREAK-PERIOD
   601           COMPUTE CONTROL-YEAR-CD = FOUND-CENTURY-CD-N - 1
   602           ADD +1 TO CURRENT-CENTURY-1-N
   603                            GIVING NEXT-CENTURY
   604           SUBTRACT +1 FROM CURRENT-CENTURY-1-N
   605                            GIVING PREVIOUS-CENTURY
   606        WHEN OTHER
   607           MOVE FOUND-CENTURY-CD-N TO CONTROL-YEAR-CD
   608           COMPUTE CENTURY-MARK = 100 +
   609                           (FOUND-CENTURY-CD-N * 100)
   610           ADD +1 TO CURRENT-CENTURY-1-N
   611                            GIVING NEXT-CENTURY
   612           SUBTRACT +1 FROM CURRENT-CENTURY-1-N
   613                            GIVING PREVIOUS-CENTURY
   614     END-EVALUATE.
   615
   616     MOVE SPACES                 TO DC-ERROR-CODE.
   617
   618     MOVE ZERO                   TO  BIN-DATE.
   619
   620     EVALUATE TRUE
   621        WHEN BIN-TO-GREG
   622             OR ELAPSED-BETWEEN-BIN
   623             OR BIN-PLUS-ELAPSED
   624           MOVE DC-BIN-DATE-1    TO  BIN-DATE-WORK
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  15
* ELDATCV.cbl
   625        WHEN BIN-3-TO-GREG
   626             OR ELAPSED-BETWEEN-BIN-3
   627             OR BIN-TO-JULIAN-EXPANDED
   628             OR BIN-PLUS-ELAPSED-3
   629           MOVE DC-BIN-DATE-EXPAND-1 TO BIN-DATE-3-WORK
   630     END-EVALUATE.
   631
   632     MOVE BIN-DATE               TO  WS-BINARY-DATE-1.
   633
   634     MOVE ZERO                   TO  BIN-DATE.
   635
   636     EVALUATE TRUE
   637        WHEN ELAPSED-BETWEEN-BIN
   638           MOVE DC-BIN-DATE-2          TO  BIN-DATE-WORK
   639        WHEN ELAPSED-BETWEEN-BIN-3
   640           MOVE DC-BIN-DATE-EXPAND-2 TO BIN-DATE-3-WORK
   641     END-EVALUATE.
   642
   643     MOVE BIN-DATE               TO  WS-BINARY-DATE-2.
   644
   645     MOVE DC-ELAPSED-MONTHS      TO  WS-ELAPSED-MONTHS.
   646     MOVE DC-ELAPSED-DAYS        TO  WS-ELAPSED-DAYS.
   647
   648     EVALUATE TRUE
   649        WHEN JULIAN-TO-BIN OR
   650             JULIAN-TO-BIN-3
   651           MOVE DC-JULIAN-YEAR   TO  JULIAN-YEAR1
   652           MOVE DC-JULIAN-DAYS   TO  JULIAN-DAY1
   653        WHEN JULIAN-EXPANDED-TO-BIN OR
   654             JULIAN-EXPANDED-TO-BIN-3
   655           MOVE DC-JULIAN-1-CC   TO DC-ALPHA-CEN-N
   656           MOVE DC-JULIAN-1-YR   TO JULIAN-YEAR1
   657           MOVE DC-JULIAN-DA-1   TO JULIAN-DAY1
   658     END-EVALUATE.
   659
   660     EVALUATE TRUE
   661        WHEN BIN-PLUS-ELAPSED OR
   662             BIN-PLUS-ELAPSED-3
   663           PERFORM 0700-CALCULATE-END-DATE
   664        WHEN BIN-TO-GREGORIAN
   665           PERFORM 0300-REFORMAT-BINARY-DAYS
   666        WHEN GREGORIAN-TO-BIN
   667           PERFORM 0400-REFORMAT-GREGORIAN-DATE
   668        WHEN JULIAN-TO-BINARY
   669           PERFORM 0500-REFORMAT-JULIAN-DATE
   670        WHEN FIND-CENTURY
   671           MOVE SPACE         TO DC-ERROR-CODE
   672           MOVE 0             TO YEAR1
   673           MOVE 3             TO FIND-CENTURY-FLAG
   674           MOVE DC-ALPHA-YEAR TO YEAR1
   675*          display ' cpdbebug task prior if ' eibtaskn
   676           IF YEAR1 < W-FLOAT-YEAR
   677*             display ' cpdebug task inside if ' eibtaskn
   678              ADD 100 TO YEAR1
   679           END-IF
   680*          display ' cpdebug task prior  ' eibtaskn
   681           PERFORM 0800-FIND-CENTURY
   682*          display ' cpdebug task after  ' eibtaskn
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  16
* ELDATCV.cbl
   683           IF NO-CONVERSION-ERROR
   684              MOVE 'B'        TO DC-ERROR-CODE
   685           END-IF
   686        WHEN CHECK-LEAP-YEAR
   687           MOVE HOLD-CEN-1-YY TO CHECK-YEAR
   688           MOVE HOLD-CEN-1-CC TO SEARCH-CENTURY
   689           MOVE 2             TO FIND-CENTURY-FLAG
   690           PERFORM 0800-FIND-CENTURY
   691           IF NO-CONVERSION-ERROR
   692              PERFORM 0900-CHECK-FOR-LEAP-YEAR THRU 0900-EXIT
   693              IF A-LEAP-YEAR
   694                 MOVE LEAP-YR-DAYS (2) TO HOLD-CEN-1-DA
   695              ELSE
   696                 MOVE REGULAR-DAYS (2) TO HOLD-CEN-1-DA
   697              END-IF
   698              MOVE 'C'        TO DC-ERROR-CODE
   699           END-IF
   700        WHEN OTHER
   701           MOVE '9'           TO DC-ERROR-CODE
   702     END-EVALUATE.
   703
   704     IF NO-CONVERSION-ERROR
   705         PERFORM 0200-DATE-CONVERSION-ROUTINES.
   706
   707
   708     MOVE DATE-CONVERSION-DATA   TO  DFHCOMMAREA.
   709*    MOVE eibtaskn to WKS-OT-TN.
   710*    EXEC CICS WRITE OPERATOR
   711*         TEXT(WKS-OT)
   712*         TEXTLENGTH(16)
   713*    END-EXEC.
   714
   715
   716* EXEC CICS RETURN
   717*         END-EXEC.
   718*    MOVE '.(                    &   #00000711' TO DFHEIV0
   719     MOVE X'2E2820202020202020202020' TO DFHEIV0(1:12)
   720     MOVE X'202020202020202020202620' TO DFHEIV0(13:12)
   721     MOVE X'2020233030303030373131' TO DFHEIV0(25:11)
   722     CALL 'kxdfhei1' USING DFHEIV0,
   723           DFHEIV99,
   724           DFHEIV99,
   725           DFHEIV99,
   726           DFHEIV99,
   727           DFHEIV99
   728     GO TO 9999-DFHEXIT DEPENDING ON DFHEIGDK.
   729
   730
   731
   732* GOBACK.
   733     MOVE '9%                    "   ' TO DFHEIV0
   734     MOVE 'ELDATCV' TO DFHEIV1
   735     CALL 'kxdfhei1' USING DFHEIV0 DFHEIV1
   736     GOBACK.
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  17
* ELDATCV.cbl
   738 0200-DATE-CONVERSION-ROUTINES SECTION.
   739*                                       COPY ELCDATP2.
   740* 11-16-98: JJPA -  ADDED CODE TO FIX Y2K ERROR -
   741* 11-16-98: JJPA -  MOVE CCYY TO DC-EDITB-CENT/-YEAR
   742******************************************************************
   743*                                                                *
   744*                                                                *
   745*                            ELCDATP2.                           *
   746*           COPYBOOK REVIEWED FOR YEAR 2000 COMPLIANCE
   747*                            VMOD=2.005                          *
   748*                                                                *
   749*                       DATE CONVERSION ROUTINE                  *
   750*                                                                *
   751******************************************************************
   752
   753     IF BIN-PLUS-ELAPSED  OR
   754        BIN-PLUS-ELAPSED-3
   755         COMPUTE WS-BINARY-DATE-2 = (((YEAR1 * 12) +
   756                                    (MONTH1 - 1)) * 32) + DAY1
   757         MOVE WS-BINARY-DATE-2   TO  BIN-DATE
   758         MOVE BIN-DATE-WORK      TO  DC-BIN-DATE-2
   759         MOVE BIN-DATE-3-WORK    TO  DC-BIN-DATE-EXPAND-2
   760     ELSE
   761         COMPUTE WS-BINARY-DATE-1 = (((YEAR1 * 12) +
   762                                    (MONTH1 - 1)) * 32) + DAY1
   763         MOVE WS-BINARY-DATE-1   TO  BIN-DATE
   764         MOVE BIN-DATE-WORK      TO  DC-BIN-DATE-1
   765         MOVE BIN-DATE-3-WORK    TO  DC-BIN-DATE-EXPAND-1.
   766
   767     SET MTHX TO MONTH1.
   768
   769*    MOVE GREG-ALPHA-MASK        TO  DC-GREG-DATE-1-ALPHA.
   770
   771     MOVE '/'                    TO  SLASH1-1  SLASH1-2
   772                                     SLASH2-1  SLASH2-2
   773                                     SLASHA-1  SLASHA-2
   774                                     SLASHB-1  SLASHB-2.
   775
   776     EVALUATE TRUE
   777        WHEN ADJUST-DOWN-100-YRS
   778           IF CURRENT-CENTURY-1-N = 19
   779              MOVE 19               TO DC-ALPHA-CEN-N
   780           ELSE
   781              MOVE PREVIOUS-CENTURY TO DC-ALPHA-CEN-N
   782           END-IF
   783        WHEN ADJUST-UP-100-YRS
   784           MOVE NEXT-CENTURY TO DC-ALPHA-CEN-N
   785        WHEN DC-ALPHA-CEN-N > 0
   786           CONTINUE
   787        WHEN OTHER
   788           MOVE 3 TO FIND-CENTURY-FLAG
   789           PERFORM 0800-FIND-CENTURY
   790     END-EVALUATE.
   791
   792     MOVE MONTH1                TO DC-EDIT1-MONTH
   793                                   DC-YMD-MONTH
   794                                   DC-MDY-MONTH
   795                                   DC-CYMD-MONTH
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  18
* ELDATCV.cbl
   796                                   DC-MDCY-MONTH
   797                                   DC-EDITA-MONTH
   798                                   DC-EDITB-MONTH.
   799
   800     MOVE NAME-OF-MONTH (MTHX)  TO DC-ALPHA-MONTH.
   801
   802     MOVE DAYS-IN-MONTH (MTHX)  TO DC-DAYS-IN-MONTH.
   803
   804     MOVE DAY1                  TO DC-EDIT1-DAY
   805                                   DC-YMD-DAY
   806                                   DC-MDY-DAY
   807                                   DC-CYMD-DAY
   808                                   DC-MDCY-DAY
   809                                   DC-ALPHA-DAY
   810                                   DC-EDITA-DAY
   811                                   DC-EDITB-DAY.
   812
   813     MOVE YEAR1                 TO DC-EDIT1-YEAR
   814                                   DC-YMD-YEAR
   815                                   DC-MDY-YEAR
   816                                   DC-CYMD-YEAR
   817                                   DC-MDCY-YEAR
   818                                   DC-ALPHA-YEAR
   819                                   DC-EDITA-YEAR
   820                                   DC-EDITB-YEAR.
   821
   822     MOVE DC-ALPHA-CEN-N        TO DC-EDITA-CENT
   823                                   DC-EDITB-CENT
   824                                   DC-CYMD-CEN
   825                                   DC-MDCY-CEN.
   826
   827     IF JULIAN-TO-BIN
   828         MOVE WORK-JULIAN-1     TO WORK-JULIAN
   829         PERFORM 0250-CALCULATE-DAY-OF-WEEK
   830         MOVE DAY-OF-WEEK-X     TO DC-DAY-OF-WEEK
   831         GO TO 0200-EXIT.
   832
   833     MOVE YEAR1                 TO JULIAN-YEAR1.
   834
   835     IF A-LEAP-YEAR
   836         MOVE LEAP-YR-DAYS (MTHX) TO JULIAN-DAY1
   837       ELSE
   838         MOVE REGULAR-DAYS (MTHX) TO JULIAN-DAY1.
   839
   840     ADD DAY1 TO JULIAN-DAY1.
   841
   842     MOVE JULIAN-YEAR1           TO DC-JULIAN-YEAR
   843                                    DC-JULIAN-1-YR.
   844     MOVE JULIAN-DAY1            TO DC-JULIAN-DAYS
   845                                    DC-JULIAN-DA-1.
   846     MOVE DC-ALPHA-CEN-N         TO DC-JULIAN-1-CC.
   847
   848
   849     MOVE WORK-JULIAN-1          TO WORK-JULIAN.
   850     PERFORM 0250-CALCULATE-DAY-OF-WEEK.
   851     MOVE DAY-OF-WEEK-X          TO DC-DAY-OF-WEEK.
   852
   853     IF ELAPSED-BETWEEN-BIN OR
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  19
* ELDATCV.cbl
   854        ELAPSED-BETWEEN-BIN-3
   855         MOVE YEAR2              TO YR-2
   856         MOVE MONTH2             TO DC-EDIT2-MONTH
   857         MOVE DAY2               TO DC-EDIT2-DAY
   858         MOVE YEAR2-YR           TO DC-EDIT2-YEAR
   859                                    DC-EDITB-YEAR
   860         MOVE YEAR2-CEN-CD       TO SEARCH-CENTURY-CD-N
   861         MOVE 1                  TO FIND-CENTURY-FLAG
   862         PERFORM 0800-FIND-CENTURY
   863         IF NO-CONVERSION-ERROR
   864            MOVE FOUND-CENTURY-N TO DC-EDITB-CENT
   865         ELSE
   866            GO TO 0200-EXIT
   867         END-IF
   868         PERFORM 0600-ELAPSED-TIME-CALCULATIONS.
   869
   870     IF ELAPSED-BETWEEN-BIN   OR
   871        ELAPSED-BETWEEN-BIN-3 OR
   872        BIN-PLUS-ELAPSED      OR
   873        BIN-PLUS-ELAPSED-3
   874         MOVE WORK-JULIAN-2      TO WORK-JULIAN
   875         PERFORM 0250-CALCULATE-DAY-OF-WEEK
   876         MOVE DAY-OF-WEEK-X      TO DC-DAY-OF-WEEK2
   877       ELSE
   878         MOVE ZERO               TO DC-DAY-OF-WEEK2.
   879
   880 0200-EXIT.
   881     EXIT.
   882
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  20
* ELDATCV.cbl
   884 0250-CALCULATE-DAY-OF-WEEK SECTION.
   885
   886     COMPUTE WS-DAY-OF-CENTURY =
   887             (JULIAN-YEAR * +365.25) + JULIAN-DAY.
   888
   889     DIVIDE WS-DAY-OF-CENTURY BY +7 GIVING DIVIDE-RESULT
   890             REMAINDER DAY-OF-WEEK-X.
   891
   892     MOVE JULIAN-YEAR        TO  CHECK-YEAR.
   893
   894     PERFORM 0900-CHECK-FOR-LEAP-YEAR.
   895
   896     IF NOT A-LEAP-YEAR
   897         ADD +1  TO  DAY-OF-WEEK-X
   898       ELSE
   899         IF DAY-OF-WEEK-X NOT > ZERO
   900             MOVE +7  TO  DAY-OF-WEEK-X.
   901
   902 0250-EXIT.
   903     EXIT.
   904
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  21
* ELDATCV.cbl
   906 0300-REFORMAT-BINARY-DAYS SECTION.
   907
   908     MOVE '00/00/00'             TO  DC-GREG-DATE-1-EDIT
   909                                     DC-GREG-DATE-2-EDIT.
   910     MOVE '00/00/0000'           TO  DC-GREG-DATE-A-EDIT
   911                                     DC-GREG-DATE-B-EDIT.
   912
   913     MOVE ZERO                   TO  DC-GREG-DATE-1-YMD
   914                                     DC-GREG-DATE-1-MDY
   915                                     DC-GREG-DATE-CYMD
   916                                     DC-GREG-DATE-MDCY
   917                                     DC-JULIAN-DATE
   918                                     DC-ELAPSED-MONTHS
   919                                     DC-ODD-DAYS-OVER
   920                                     DC-ELAPSED-DAYS
   921                                     DC-DAY-OF-WEEK
   922                                     DC-DAY-OF-WEEK2.
   923
   924     IF (ELAPSED-BETWEEN-BIN AND
   925         WS-BINARY-DATE-1 > WS-BINARY-DATE-2)
   926                    OR
   927        (ELAPSED-BETWEEN-BIN-3 AND
   928         WS-BINARY-DATE-1 > WS-BINARY-DATE-2)
   929           MOVE '4'               TO DC-ERROR-CODE
   930           GO TO 0300-EXIT.
   931
   932     IF WS-BINARY-DATE-1 = ZERO
   933         MOVE '1'                TO DC-ERROR-CODE
   934         MOVE ZERO               TO DC-GREG-DATE-1-EDIT
   935         GO TO 0300-EXIT.
   936
   937     DIVIDE WS-BINARY-DATE-1 BY +384 GIVING YEAR1
   938               REMAINDER DAYS-REMAINING.
   939
   940     DIVIDE DAYS-REMAINING BY +32 GIVING MONTH1
   941               REMAINDER DAY1.
   942
   943***  Y2K, PROJ 7744
   944     IF DAY1 = ZEROS
   945         MOVE '3'                TO DC-ERROR-CODE
   946         GO TO 0300-EXIT
   947     END-IF
   948***  Y2K, PROJ 7744
   949
   950     ADD +1 TO MONTH1.
   951
   952     MOVE YEAR1              TO CHECK-YEAR.
   953     PERFORM 0900-CHECK-FOR-LEAP-YEAR.
   954
   955     IF ELAPSED-BETWEEN-BIN OR
   956        ELAPSED-BETWEEN-BIN-3
   957        CONTINUE
   958     ELSE
   959        GO TO 0300-EXIT.
   960
   961     IF WS-BINARY-DATE-2 = ZERO
   962         MOVE '1'               TO DC-ERROR-CODE
   963         GO TO 0300-EXIT.
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  22
* ELDATCV.cbl
   964
   965     DIVIDE WS-BINARY-DATE-2 BY +384 GIVING YEAR2
   966                                 REMAINDER DAYS-REMAINING.
   967
   968     DIVIDE DAYS-REMAINING BY +32 GIVING MONTH2
   969                                 REMAINDER DAY2.
   970
   971     ADD +1 TO MONTH2.
   972
   973 0300-EXIT.
   974     EXIT.
   975
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  23
* ELDATCV.cbl
   977 0400-REFORMAT-GREGORIAN-DATE SECTION.
   978
   979     MOVE LOW-VALUES             TO  DC-BIN-DATE-1
   980                                     DC-BIN-DATE-2.
   981
   982     EVALUATE TRUE
   983        WHEN EDIT-GREG-TO-BIN OR
   984             EDIT-GREG-TO-BIN-3
   985           IF (DC-EDIT1-MONTH NOT NUMERIC) OR
   986              (DC-EDIT1-DAY   NOT NUMERIC) OR
   987              (DC-EDIT1-YEAR  NOT NUMERIC)
   988             MOVE '2'            TO DC-ERROR-CODE
   989             GO TO 0400-EXIT
   990           END-IF
   991           MOVE DC-EDIT1-MONTH   TO MONTH1
   992           MOVE DC-EDIT1-DAY     TO DAY1
   993           MOVE DC-EDIT1-YEAR    TO YEAR1
   994        WHEN YMD-GREG-TO-BIN OR
   995             YMD-GREG-TO-BIN-3
   996           IF DC-GREG-DATE-1-YMD NOT NUMERIC
   997              MOVE '2'           TO DC-ERROR-CODE
   998              GO TO 0400-EXIT
   999           END-IF
  1000           MOVE DC-YMD-YEAR      TO YEAR1
  1001           MOVE DC-YMD-MONTH     TO MONTH1
  1002           MOVE DC-YMD-DAY       TO DAY1
  1003           MOVE 0                TO DC-ALPHA-CEN-N
  1004        WHEN MDY-GREG-TO-BIN OR
  1005             MDY-GREG-TO-BIN-3
  1006           IF DC-GREG-DATE-1-MDY NOT NUMERIC
  1007              MOVE '2'           TO DC-ERROR-CODE
  1008              GO TO 0400-EXIT
  1009           END-IF
  1010           MOVE DC-MDY-MONTH     TO MONTH1
  1011           MOVE DC-MDY-DAY       TO DAY1
  1012           MOVE DC-MDY-YEAR      TO YEAR1
  1013           MOVE 0                TO DC-ALPHA-CEN-N
  1014        WHEN MDCY-GREG-TO-BIN OR
  1015             MDCY-GREG-TO-BIN-3
  1016           IF DC-GREG-DATE-MDCY NOT NUMERIC
  1017              MOVE '2'           TO DC-ERROR-CODE
  1018              GO TO 0400-EXIT
  1019           END-IF
  1020           MOVE DC-MDCY-MONTH    TO MONTH1
  1021           MOVE DC-MDCY-DAY      TO DAY1
  1022           MOVE DC-MDCY-YEAR     TO YEAR1
  1023           MOVE DC-MDCY-CEN      TO DC-ALPHA-CEN-N
  1024        WHEN CYMD-GREG-TO-BIN OR
  1025             CYMD-GREG-TO-BIN-3
  1026           IF DC-GREG-DATE-CYMD NOT NUMERIC
  1027              MOVE '2'           TO DC-ERROR-CODE
  1028              GO TO 0400-EXIT
  1029           END-IF
  1030           MOVE DC-CYMD-CEN      TO DC-ALPHA-CEN-N
  1031           MOVE DC-CYMD-YEAR     TO YEAR1
  1032           MOVE DC-CYMD-MONTH    TO MONTH1
  1033           MOVE DC-CYMD-DAY      TO DAY1
  1034     END-EVALUATE
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  24
* ELDATCV.cbl
  1035
  1036     EVALUATE TRUE
  1037        WHEN MONTH1 NOT NUMERIC OR
  1038             DAY1   NOT NUMERIC OR
  1039             YEAR1  NOT NUMERIC
  1040              MOVE '3'           TO DC-ERROR-CODE
  1041              GO TO 0400-EXIT
  1042        WHEN MONTH1 = ZERO  AND
  1043             DAY1   = ZERO  AND
  1044             YEAR1  = ZERO
  1045              MOVE '1'           TO DC-ERROR-CODE
  1046              GO TO 0400-EXIT
  1047        WHEN MONTH1 < 1 OR > 12
  1048              MOVE '3'           TO DC-ERROR-CODE
  1049              GO TO 0400-EXIT
  1050        WHEN DAY1 < 1 OR > 31
  1051              MOVE '3'           TO DC-ERROR-CODE
  1052              GO TO 0400-EXIT
  1053     END-EVALUATE
  1054
  1055     EVALUATE TRUE
  1056        WHEN ADJUST-DOWN-100-YRS
  1057           IF CURRENT-CENTURY-1-N = 19
  1058              CONTINUE
  1059           ELSE
  1060              MOVE '2'              TO FIND-CENTURY-FLAG
  1061              MOVE PREVIOUS-CENTURY TO SEARCH-CENTURY-N
  1062              PERFORM 0800-FIND-CENTURY
  1063              IF NO-CONVERSION-ERROR
  1064                 COMPUTE YEAR1 = YEAR1 +
  1065                                    (FOUND-CENTURY-CD-N * 100)
  1066              ELSE
  1067                 GO TO 0400-EXIT
  1068              END-IF
  1069           END-IF
  1070        WHEN ADJUST-UP-100-YRS
  1071           MOVE '2'              TO FIND-CENTURY-FLAG
  1072           MOVE NEXT-CENTURY TO SEARCH-CENTURY-N
  1073           PERFORM 0800-FIND-CENTURY
  1074           IF NO-CONVERSION-ERROR
  1075              COMPUTE YEAR1 = YEAR1 +
  1076                                 (FOUND-CENTURY-CD-N * 100)
  1077           ELSE
  1078              GO TO 0400-EXIT
  1079           END-IF
  1080        WHEN DC-ALPHA-CEN-N > 0
  1081           MOVE '2'              TO FIND-CENTURY-FLAG
  1082           MOVE DC-ALPHA-CEN-N   TO SEARCH-CENTURY-N
  1083           PERFORM 0800-FIND-CENTURY
  1084           IF NO-CONVERSION-ERROR
  1085              COMPUTE YEAR1 = YEAR1 + (FOUND-CENTURY-CD-N * 100)
  1086           ELSE
  1087              GO TO 0400-EXIT
  1088           END-IF
  1089        WHEN YEAR1 < W-FLOAT-YEAR
  1090           COMPUTE YEAR1 = YEAR1 + CENTURY-MARK
  1091     END-EVALUATE.
  1092
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  25
* ELDATCV.cbl
  1093     MOVE YEAR1                  TO CHECK-YEAR.
  1094     PERFORM 0900-CHECK-FOR-LEAP-YEAR THRU 0900-EXIT.
  1095
  1096     IF DAY1 > DAYS-IN-MONTH (MONTH1)
  1097         MOVE '3'                TO DC-ERROR-CODE
  1098         GO TO 0400-EXIT.
  1099
  1100 0400-EXIT.
  1101     EXIT.
  1102
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  26
* ELDATCV.cbl
  1104 0500-REFORMAT-JULIAN-DATE SECTION.
  1105
  1106     MOVE '00/00/00'             TO  DC-GREG-DATE-1-EDIT
  1107                                     DC-GREG-DATE-2-EDIT.
  1108
  1109*    MOVE GREG-ALPHA-MASK        TO  DC-GREG-DATE-1-ALPHA.
  1110
  1111     MOVE ZERO                   TO  DC-GREG-DATE-1-YMD
  1112                                     DC-GREG-DATE-1-MDY
  1113                                     DC-GREG-DATE-CYMD
  1114                                     DC-GREG-DATE-MDCY
  1115                                     DC-ELAPSED-MONTHS
  1116                                     DC-ODD-DAYS-OVER
  1117                                     DC-ALPHA-CEN-N
  1118                                     DC-ELAPSED-DAYS.
  1119
  1120     MOVE LOW-VALUES             TO  DC-BIN-DATE-1
  1121                                     DC-BIN-DATE-2.
  1122
  1123     IF DC-JULIAN-DATE = ZERO
  1124         MOVE '1'             TO DC-ERROR-CODE
  1125         GO TO 0500-EXIT.
  1126
  1127     IF DC-JULIAN-DAYS = ZERO
  1128         MOVE '3'             TO DC-ERROR-CODE
  1129         GO TO 0500-EXIT.
  1130
  1131     IF JULIAN-EXPANDED-TO-BIN OR
  1132        JULIAN-EXPANDED-TO-BIN-3
  1133          MOVE DC-JULIAN-1-CC   TO DC-ALPHA-CEN-N.
  1134
  1135     EVALUATE TRUE
  1136        WHEN ADJUST-DOWN-100-YRS
  1137           IF CURRENT-CENTURY-1-N = 19
  1138              CONTINUE
  1139           ELSE
  1140              MOVE '2'              TO FIND-CENTURY-FLAG
  1141              MOVE PREVIOUS-CENTURY TO SEARCH-CENTURY-N
  1142              PERFORM 0800-FIND-CENTURY
  1143              IF NO-CONVERSION-ERROR
  1144                 COMPUTE JULIAN-YEAR1 = JULIAN-YEAR1 +
  1145                                    (FOUND-CENTURY-CD-N * 100)
  1146              ELSE
  1147                 GO TO 0500-EXIT
  1148              END-IF
  1149           END-IF
  1150        WHEN ADJUST-UP-100-YRS
  1151           MOVE '2'              TO FIND-CENTURY-FLAG
  1152           MOVE NEXT-CENTURY     TO SEARCH-CENTURY-N
  1153           PERFORM 0800-FIND-CENTURY
  1154           IF NO-CONVERSION-ERROR
  1155              COMPUTE JULIAN-YEAR1 = JULIAN-YEAR1 +
  1156                                 (FOUND-CENTURY-CD-N * 100)
  1157           ELSE
  1158              GO TO 0500-EXIT
  1159           END-IF
  1160        WHEN DC-ALPHA-CEN-N > 0
  1161           MOVE DC-ALPHA-CEN-N        TO SEARCH-CENTURY-N
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  27
* ELDATCV.cbl
  1162           MOVE 2                     TO FIND-CENTURY-FLAG
  1163           PERFORM 0800-FIND-CENTURY
  1164           IF NO-CONVERSION-ERROR
  1165              COMPUTE JULIAN-YEAR1 =
  1166                      JULIAN-YEAR1 + (FOUND-CENTURY-CD-N * 100)
  1167           ELSE
  1168              GO TO 0500-EXIT
  1169           END-IF
  1170         WHEN JULIAN-YEAR1 NOT > W-FLOAT-YEAR
  1171                 COMPUTE JULIAN-YEAR1 =
  1172                            JULIAN-YEAR1 + 100
  1173     END-EVALUATE.
  1174
  1175     MOVE JULIAN-YEAR1           TO YEAR1
  1176                                    CHECK-YEAR.
  1177
  1178     PERFORM 0900-CHECK-FOR-LEAP-YEAR THRU 0900-EXIT.
  1179
  1180     IF (A-LEAP-YEAR AND JULIAN-DAY1 > LEAP-YR-DAYS (13))
  1181                       OR
  1182        (NOT A-LEAP-YEAR AND DC-JULIAN-DAYS > REGULAR-DAYS (13))
  1183           MOVE '3'              TO DC-ERROR-CODE
  1184           GO TO 0500-EXIT.
  1185
  1186     SET MTHX TO +1.
  1187
  1188     IF A-LEAP-YEAR
  1189         PERFORM 0550-JULIAN-LEAP-YEAR
  1190     ELSE
  1191         PERFORM 0575-JULIAN-REGULAR-YEAR
  1192     END-IF
  1193     .
  1194 0500-EXIT.
  1195     EXIT.
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  28
* ELDATCV.cbl
  1196/
  1197
  1198 0550-JULIAN-LEAP-YEAR SECTION.
  1199
  1200     IF JULIAN-DAY1 NOT > LEAP-YR-DAYS (MTHX)
  1201         SET MTHX DOWN BY +1
  1202         SET MONTH1 TO MTHX
  1203         SUBTRACT LEAP-YR-DAYS (MTHX) FROM JULIAN-DAY1
  1204                                      GIVING DAY1
  1205         MOVE JULIAN-YEAR1       TO  YEAR1
  1206       ELSE
  1207         SET MTHX UP BY +1
  1208         GO TO 0550-JULIAN-LEAP-YEAR.
  1209
  1210 0550-EXIT.
  1211     EXIT.
  1212
  1213
  1214 0575-JULIAN-REGULAR-YEAR SECTION.
  1215
  1216     IF JULIAN-DAY1 NOT > REGULAR-DAYS (MTHX)
  1217         SET MTHX DOWN BY +1
  1218         SET MONTH1 TO MTHX
  1219         SUBTRACT REGULAR-DAYS (MTHX) FROM JULIAN-DAY1
  1220                                      GIVING DAY1
  1221         MOVE JULIAN-YEAR1       TO  YEAR1
  1222       ELSE
  1223         SET MTHX UP BY +1
  1224         GO TO 0575-JULIAN-REGULAR-YEAR.
  1225
  1226 0575-EXIT.
  1227     EXIT.
  1228
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  29
* ELDATCV.cbl
  1230 0600-ELAPSED-TIME-CALCULATIONS SECTION.
  1231
  1232     MOVE YEAR2                 TO JULIAN-YEAR2
  1233                                   CHECK-YEAR.
  1234     PERFORM 0900-CHECK-FOR-LEAP-YEAR.
  1235
  1236     SET MTHX TO MONTH2.
  1237
  1238     IF A-LEAP-YEAR
  1239         MOVE LEAP-YR-DAYS (MTHX) TO JULIAN-DAY2
  1240       ELSE
  1241         MOVE REGULAR-DAYS (MTHX) TO JULIAN-DAY2.
  1242
  1243     ADD DAY2 TO JULIAN-DAY2.
  1244
  1245     MOVE ZERO                   TO WS-ELAPSED-DAYS.
  1246     MOVE YEAR1                  TO CHECK-YEAR.
  1247
  1248 0600-LOOP.
  1249     IF CHECK-YEAR = JULIAN-YEAR2
  1250         GO TO 0600-COMPUTE.
  1251
  1252     PERFORM 0900-CHECK-FOR-LEAP-YEAR.
  1253
  1254     IF A-LEAP-YEAR
  1255         ADD +366 TO WS-ELAPSED-DAYS
  1256       ELSE
  1257         ADD +365 TO WS-ELAPSED-DAYS.
  1258
  1259     ADD +1  TO  CHECK-YEAR.
  1260
  1261     GO TO 0600-LOOP.
  1262
  1263 0600-COMPUTE.
  1264     ADD JULIAN-DAY2        TO WS-ELAPSED-DAYS.
  1265
  1266     SUBTRACT JULIAN-DAY1 FROM WS-ELAPSED-DAYS.
  1267
  1268     COMPUTE WS-ELAPSED-MONTHS =
  1269         ((YEAR2 - YEAR1) * 12) + (MONTH2 - MONTH1)
  1270
  1271     IF DAY2 = DAY1
  1272         MOVE ZERO               TO  DC-ODD-DAYS-OVER
  1273       ELSE
  1274     IF DAY1 NOT < DAYS-IN-MONTH (MONTH1)
  1275         MOVE DAY2               TO  DC-ODD-DAYS-OVER
  1276         SUBTRACT +1 FROM WS-ELAPSED-MONTHS
  1277       ELSE
  1278     IF DAY2 > DAY1
  1279         SUBTRACT DAY1 FROM DAY2 GIVING DC-ODD-DAYS-OVER
  1280       ELSE
  1281         COMPUTE DC-ODD-DAYS-OVER =
  1282              (DAYS-IN-MONTH (MONTH1) - DAY1) + DAY2
  1283         SUBTRACT +1 FROM WS-ELAPSED-MONTHS.
  1284
  1285     MOVE YEAR2                  TO CHECK-YEAR.
  1286     PERFORM 0900-CHECK-FOR-LEAP-YEAR.
  1287
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  30
* ELDATCV.cbl
  1288     IF DC-ODD-DAYS-OVER NOT < DAYS-IN-MONTH (MONTH2) AND
  1289        DAY2 = DAYS-IN-MONTH (MONTH2)
  1290         MOVE ZERO               TO  DC-ODD-DAYS-OVER
  1291         ADD +1 TO WS-ELAPSED-MONTHS.
  1292
  1293 0600-MOVE.
  1294     MOVE WS-ELAPSED-MONTHS      TO  DC-ELAPSED-MONTHS.
  1295     MOVE WS-ELAPSED-DAYS        TO  DC-ELAPSED-DAYS.
  1296
  1297 0600-EXIT.
  1298     EXIT.
  1299
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  31
* ELDATCV.cbl
  1301 0700-CALCULATE-END-DATE SECTION.
  1302
  1303     IF NOT CALCULATE-END-OF-MONTH
  1304         GO TO 0700-CONTINUE.
  1305
  1306     IF WS-ELAPSED-MONTHS = ZERO  OR
  1307        WS-ELAPSED-DAYS NOT = ZERO
  1308         MOVE '2'                TO  DC-END-OF-MONTH
  1309         GO TO 0700-CONTINUE.
  1310
  1311     DIVIDE WS-BINARY-DATE-1 BY +384 GIVING YEAR1
  1312             REMAINDER DAYS-REMAINING.
  1313
  1314     DIVIDE DAYS-REMAINING BY +32 GIVING MONTH1
  1315             REMAINDER DAY1.
  1316
  1317     ADD +1  TO  MONTH1.
  1318
  1319     SET MTHX TO MONTH1.
  1320
  1321     MOVE YEAR1                 TO CHECK-YEAR.
  1322     PERFORM 0900-CHECK-FOR-LEAP-YEAR.
  1323
  1324     IF DAY1 < DAYS-IN-MONTH (MTHX)
  1325         MOVE '3'            TO  DC-END-OF-MONTH.
  1326
  1327 0700-CONTINUE.
  1328     COMPUTE WS-BINARY-DATE-2 = WS-BINARY-DATE-1 +
  1329             (WS-ELAPSED-MONTHS * 32).
  1330
  1331     IF WS-BINARY-DATE-2 NOT > ZERO
  1332         MOVE '5'                TO  DC-ERROR-CODE
  1333         GO TO 0700-EXIT.
  1334
  1335     DIVIDE WS-BINARY-DATE-2 BY +384 GIVING YEAR2
  1336             REMAINDER DAYS-REMAINING.
  1337
  1338     DIVIDE DAYS-REMAINING BY +32 GIVING MONTH2
  1339             REMAINDER DAY2.
  1340
  1341     ADD +1 TO MONTH2.
  1342
  1343     SET MTHX TO MONTH2.
  1344
  1345     MOVE YEAR2 TO YEAR1
  1346                   CHECK-YEAR
  1347                   JULIAN-YEAR2.
  1348
  1349     PERFORM 0900-CHECK-FOR-LEAP-YEAR.
  1350
  1351     IF A-LEAP-YEAR
  1352         MOVE LEAP-YR-DAYS (MTHX) TO JULIAN-DAY2
  1353       ELSE
  1354         MOVE REGULAR-DAYS (MTHX) TO JULIAN-DAY2.
  1355
  1356     IF DAY2 NOT < DAYS-IN-MONTH (MTHX)
  1357         MOVE DAYS-IN-MONTH (MTHX) TO DAY2.
  1358
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  32
* ELDATCV.cbl
  1359     ADD DAY2 TO JULIAN-DAY2.
  1360
  1361 0700-ADD-DAYS.
  1362     IF WS-ELAPSED-DAYS = ZERO
  1363         GO TO 0700-CONVERT-NEW-DATE.
  1364
  1365     MOVE WS-ELAPSED-DAYS TO DAYS-ELAPSED.
  1366
  1367     IF WS-ELAPSED-DAYS < ZERO
  1368         MULTIPLY -1  BY  WS-ELAPSED-DAYS
  1369         GO TO 0700-SUBTRACT-DAYS.
  1370
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  33
* ELDATCV.cbl
  1372 0700-ADD-DAYS-LOOP.
  1373     IF A-LEAP-YEAR
  1374         MOVE 366 TO DAYS-NEEDED
  1375       ELSE
  1376         MOVE 365 TO DAYS-NEEDED.
  1377
  1378     SUBTRACT JULIAN-DAY2 FROM DAYS-NEEDED.
  1379
  1380     IF DAYS-ELAPSED NOT > DAYS-NEEDED
  1381         GO TO 0700-ADD-REMAINING-DAYS.
  1382
  1383     IF DAYS-ELAPSED > ZERO
  1384         SUBTRACT +1  FROM DAYS-ELAPSED.
  1385
  1386     SUBTRACT DAYS-NEEDED FROM DAYS-ELAPSED.
  1387
  1388     ADD +1 TO JULIAN-YEAR2.
  1389
  1390     MOVE +1                     TO JULIAN-DAY2.
  1391
  1392     MOVE JULIAN-YEAR2           TO CHECK-YEAR.
  1393
  1394     PERFORM 0900-CHECK-FOR-LEAP-YEAR.
  1395
  1396     GO TO 0700-ADD-DAYS-LOOP.
  1397
  1398 0700-ADD-REMAINING-DAYS.
  1399     ADD DAYS-ELAPSED TO JULIAN-DAY2.
  1400
  1401     GO TO 0700-CALCULATE-JULIAN-DATE.
  1402
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  34
* ELDATCV.cbl
  1404 0700-SUBTRACT-DAYS.
  1405     IF WS-ELAPSED-DAYS < JULIAN-DAY2
  1406         SUBTRACT WS-ELAPSED-DAYS FROM JULIAN-DAY2
  1407         GO TO 0700-CALCULATE-JULIAN-DATE.
  1408
  1409     SUBTRACT JULIAN-DAY2 FROM WS-ELAPSED-DAYS.
  1410
  1411     SUBTRACT +1  FROM JULIAN-YEAR2.
  1412
  1413     MOVE JULIAN-YEAR2           TO  CHECK-YEAR.
  1414     PERFORM 0900-CHECK-FOR-LEAP-YEAR.
  1415
  1416     IF A-LEAP-YEAR
  1417         MOVE +366               TO  JULIAN-DAY2
  1418       ELSE
  1419         MOVE +365               TO  JULIAN-DAY2.
  1420
  1421     GO TO 0700-SUBTRACT-DAYS.
  1422
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  35
* ELDATCV.cbl
  1424 0700-CALCULATE-JULIAN-DATE.
  1425     MOVE WORK-JULIAN-2          TO  WORK-JULIAN-1.
  1426     SET MTHX TO +1.
  1427
  1428     IF A-LEAP-YEAR
  1429         PERFORM 0550-JULIAN-LEAP-YEAR
  1430       ELSE
  1431         PERFORM 0575-JULIAN-REGULAR-YEAR.
  1432
  1433     MOVE WORK-DATE-1 TO WORK-DATE-2.
  1434
  1435 0700-CONVERT-NEW-DATE.
  1436     IF CALCULATE-END-OF-MONTH
  1437         SET MTHX TO MONTH2
  1438         IF DAY2 < DAYS-IN-MONTH (MTHX)
  1439             MOVE DAYS-IN-MONTH (MTHX) TO  DAY2.
  1440
  1441     MOVE WORK-DATE-2 TO WORK-DATE-1.
  1442
  1443 0700-EXIT.
  1444     EXIT.
  1445
  1446*0800-FIND-CENTURY.
  1447 0800-FIND-CENTURY section.
  1448
  1449     SET CNTRY-NDX TO +1.
  1450     EVALUATE FIND-CENTURY-FLAG
  1451        WHEN 1
  1452           SEARCH  CENTURY-TBL
  1453             AT END
  1454               MOVE 'A' TO DC-ERROR-CODE
  1455           WHEN CENTURY-CODE(CNTRY-NDX) = SEARCH-CENTURY-CD-N
  1456              MOVE CENTURY(CNTRY-NDX) TO FOUND-CENTURY-N
  1457           END-SEARCH
  1458        WHEN 2
  1459           SEARCH  CENTURY-TBL
  1460              AT END
  1461                 MOVE 'A' TO DC-ERROR-CODE
  1462           WHEN CENTURY(CNTRY-NDX) = SEARCH-CENTURY-N
  1463              MOVE CENTURY-CODE(CNTRY-NDX) TO FOUND-CENTURY-CD-N
  1464           END-SEARCH
  1465        WHEN 3
  1466***  Y2K
  1467*          IF YEAR1 <= CENTURY-MARK
  1468           EVALUATE YEAR1 < CENTURY-MARK
  1469                    ALSO W-FLOAT-YEAR-YY > 34
  1470                WHEN TRUE ALSO TRUE
  1471                    MOVE PREVIOUS-CENTURY TO
  1472                                   DC-ALPHA-CEN-N
  1473                WHEN TRUE ALSO FALSE
  1474                 IF W-FLOAT-YEAR-YY < 30
  1475                    MOVE CURRENT-CENTURY-1-N TO
  1476                                   DC-ALPHA-CEN-N
  1477                 ELSE
  1478                    MOVE NEXT-CENTURY TO DC-ALPHA-CEN-N
  1479                 END-IF
  1480                WHEN FALSE ALSO FALSE
  1481                 IF YEAR1 > BREAK-PERIOD
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  36
* ELDATCV.cbl
  1482                    MOVE NEXT-CENTURY TO DC-ALPHA-CEN-N
  1483                 ELSE
  1484                    MOVE PREVIOUS-CENTURY TO DC-ALPHA-CEN-N
  1485                 END-IF
  1486                WHEN  OTHER
  1487                 IF YEAR1 > BREAK-PERIOD
  1488                    MOVE PREVIOUS-CENTURY TO DC-ALPHA-CEN-N
  1489                 ELSE
  1490                    MOVE CURRENT-CENTURY-1-N
  1491                                         TO DC-ALPHA-CEN-N
  1492                 END-IF
  1493           END-EVALUATE
  1494     END-EVALUATE.
  1495***  Y2K
  1496
  1497 0800-EXIT.
  1498     EXIT.
  1499
  1500 0900-CHECK-FOR-LEAP-YEAR SECTION.
  1501
  1502     MOVE CHECK-YEAR TO CHECK-CCYY.
  1503
  1504***  Y2K, PROJ 7744
  1505     IF CHECK-CCYY-YY > 00
  1506         COMPUTE DIVIDE-LEAP-YEAR = CHECK-CCYY / 4
  1507     ELSE
  1508         MOVE CHECK-CCYY-CC      TO SEARCH-CENTURY-CD-N
  1509         MOVE 1                  TO FIND-CENTURY-FLAG
  1510         PERFORM 0800-FIND-CENTURY
  1511         IF NO-CONVERSION-ERROR
  1512             MOVE FOUND-CENTURY-N TO CHECK-CCYY-CC
  1513             COMPUTE DIVIDE-LEAP-YEAR = CHECK-CCYY / 400
  1514         END-IF
  1515     END-IF
  1516***  Y2K, PROJ 7744
  1517
  1518     IF A-LEAP-YEAR
  1519         MOVE +29                TO  DAYS-IN-MONTH (2)
  1520     ELSE
  1521         MOVE +28                TO  DAYS-IN-MONTH (2).
  1522
  1523 0900-EXIT.
  1524     EXIT.
  1525
  1526
  1527 9999-DFHBACK SECTION.
  1528     MOVE '9%                    "   ' TO DFHEIV0
  1529     MOVE 'ELDATCV' TO DFHEIV1
  1530     CALL 'kxdfhei1' USING DFHEIV0 DFHEIV1
  1531     GOBACK.
  1532 9999-DFHEXIT.
  1533     IF DFHEIGDJ EQUAL 0001
  1534         NEXT SENTENCE.
  1535     MOVE '9%                    "   ' TO DFHEIV0
  1536     MOVE 'ELDATCV' TO DFHEIV1
  1537     CALL 'kxdfhei1' USING DFHEIV0 DFHEIV1
  1538     GOBACK.
* Micro Focus Server Express         V5.1 revision 000 Compiler
* Micro Focus Server Express         V5.1 revision 000 02-Nov-12 23:15 Page  37
* ELDATCV.cbl
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
*                                                        REF GNR-008065005AF
* Total Messages:     0
* Data:        1764     Code:        5821
