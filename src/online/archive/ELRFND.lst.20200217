* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page   1
* ELRFND.cbl
* Options: int("ELRFND.int") anim csi verbose NOBOUND LINKCHECK
*          PARAMCOUNTCHECK directives(cobopt.bth) endp list("ELRFND.lst")
* Setting: NOACCEPTREFRESH NOADV ALIGN"8" ALPHASTART"1" NOALTER NOAMODE ANIM
*          NOANIMPREP ANS85 APOST NOAREACHECK ARITHMETIC"OSVS" ASSIGN
*          "EXTERNAL" NOASSIGN-PRINTER NOAUTOLOCK NOBELL NOBOUND NOBRIEF
*          NOBS2000 BWZSTAR NOBYTEMODEMOVE CALLFH"EXTFH" NOCALLMCS
*          NOCALLRECOVERY CALLSORT"EXTSM" CANCEL CANCELLBR NOCHANGEMESSAGE
*          CHARSET"ASCII" CHECKDIV"ANSI" NOCHECKREFMOD NOCICS CICS-CPY
*          NOCICSOPTIMIZE NOCMPR2 NOCOBFSTATCONV NOCOBIDY NOCOBOL370 COBOLDIR
*          NOCOMP COMP-5"2" COMP-6"2" NOCOMS85 CONFIRM NOCONVERTRET CONVSPACE
*          COPYEXT",cbl,cpy" NOCOPYLBR COPYLIST COPYLISTCOMMENT"1" CSI
*          CURRENCY-SIGN"36" CURRENT-DATE"MMDDYY" NODATA DATACOMPRESS"0"
*          NODATA-CONTEXT DATE DBCHECK DBCS"2" NODBCSSOSI DBSPACE DE-EDIT"2"
*          DEFAULTBYTE"0" NODEFAULTCALLS DETECTLOCK NODG DIALECT"MF"
*          NODIRECTIVES-IN-COMMENTS NODOSVS NODPCINSUBSCRIPT DYNAM
*          NOEARLY-RELEASE ECHO NOECHOALL NOEDITOR ENSUITE"0" NOENTCOBOL
*          ERRFORMAT"1" ERRLIST"EMBED" NOERRQ FASTSORT NOFCD3 NOFCDREG
*          NOFDCLEAR NOFILESHARE FILETYPE"0" NOFLAG NOFLAGAS NOFLAGCD
*          NOFLAGEUC NOFLAGMIG NOFLAGQ FLAGSINEDIT NOFLAGSTD NOFOLDCALLNAME
*          NOFOLDCOPYNAME FORM"60" NOFP-ROUNDING NOHOSTARITHMETIC
*          NOHOSTCONTZERO NOHOST-NUMCOMPARE NOHOST-NUMMOVE NOHOSTFD NOHOSTRW
*          NOIBM-MS IBMCOMP IDXFORMAT"0" NOILGEN IMPLICITSCOPE NOINDD
*          INFORETURN"0" NOINITCALL INITPTR INT"ELRFND.int" INTDATE"ANSI"
*          INTLEVEL"2" IOCONV NOISO2002 NOIXNLSKEY NOIXNUMKEY KEEP-INT
*          KEYCHECK KEYCOMPRESS"0" LIBRARIAN"2" NOLINE-COUNT LIST"ELRFND.lst"
*          LISTPATH"" LISTWIDTH"80" LITVAL-SIZE"4" LOCKTYPE"0" NOMAPNAME
*          NOMAXERROR METHODDEFAULT"REFERENCE" MF"15" MFCOMMENT NOMOVELENCHECK
*          NOMS NOMVS NATIVE"ASCII" NONATIVEFLOATINGPOINT NONCHAR
*          NONEWBASENAME NONLS NSYMBOL"DBCS" NOODOOSVS NOODOSLIDE
*          NOOLDBLANKLINE NOOLDCOPY NOOLDINDEX NOOLDNEXTSENTENCE NOOLDREADINTO
*          NOOLDSTRMIX OOCTRL"-C-E-G-P+Q+R-S+W" OPTIONAL-FILE NOOS390 OSEXT""
*          NOOSVS NOOUTDD NOP64 NOPANVALET PERFORM-TYPE"OSVS" NOPREPLIST
*          NOPREPROCESS NOPRINT-EXT NOPROFILE NOPROGID-COMMENT
*          NOPROGID-INT-NAME NOPROTECT-LINKAGE PROTOTYPE"RELAXED" QUAL
*          QUALPROC NOQUERY NOQUOTE NORAWLIST NORDW RECMODE"F" NOREENTRANT
*          NOREF NOREFNO REMAINDER"1" REPORT-LINE"256" RESEQ NORETRYLOCK
*          REWRITE-LS NORM RTNCODE-SIZE"4" NORWHARDPAGE NOSAA SEG NOSEQCHK
*          SEQUENTIAL"RECORD" NOSERIAL SETTING"LINE" NOSHAREOUTDD NOSHOW-DIR
*          SIGN"ASCII" NOSIGNDISCARD NOSIGNFIXUP SORTTYPE"DFSORT" SOURCEFORMAT
*          "FIXED" SOURCETABSTOP"8" NOSPZERO NOSSRANGE STDERR STICKY-LINKAGE
*          "2" NOSTICKY-PERFORM SUPFF SWITCHTYPE"1" SYMBSTART"1" SYSPUNCH"132"
*          TERMPAGE TIME NOTRACE NOTRUNC NOTRUNCCALLNAME NOTRUNCCOPY TRUNCINC
*          "10" UNICODE"NATIVE" VERBOSE VSC2"4" WARNING"1" NOWB NOWB2 NOWB3
*          WEBSERVER"CGI" NOWRITELOCK NOWRITETHRU NOXOPEN NOXREF
*          NOZEROLENGTHFALSE NOZEROSEQ NOZWB
     1 IDENTIFICATION DIVISION.
     2
     3 PROGRAM-ID.                 ELRFND.
     4*              PROGRAM CONVERTED BY
     5*              COBOL CONVERSION AID PO 5785-ABJ
     6*              CONVERSION DATE 03/05/96 16:23:50.
     7*                            VMOD=2.011
     8*
     9*AUTHOR.       LOGIC, INC.
    10*              DALLAS, TEXAS.
    11
    12*DATE-COMPILED.
    13
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page   2
* ELRFND.cbl
    14*SECURITY.   *****************************************************
    15*            *                                                   *
    16*            *   THIS PROGRAM IS THE PROPERTY OF LOGIC, INC.     *
    17*            *                                                   *
    18*            *   USE OF THIS PROGRAM BY OTHER THAN THE EMPLOYEES *
    19*            *   OF LOGIC, INC. IS EXPRESSLY PROHIBITED WITHOUT  *
    20*            *   THE PRIOR WRITTEN PERMISSION OF LOGIC INC.      *
    21*            *                                                   *
    22*            *****************************************************
    23
    24*REMARKS.    *****************************************************
    25*            *                                                   *
    26*            *    THIS 'SUBROUTINE' WILL, DEPENDING UPON THE     *
    27*            *    OPTION SPECIFIED, COMPUTE PREMIUM REFUNDS      *
    28*            *****************************************************
    29
    30
    31******************************************************************
    32*                                                                *
    33*              INPUT FIELDS USED                                 *
    34*                                                                *
    35******************************************************************
    36*  CERT ISSUE DATE  - CP-CERT-EFF-DT                             *
    37*  REFUND DATE      - CP-VALUATION-DT                            *
    38*  ORIGINAL TERM    - CP-ORIGINAL-TERM                           *
    39*  LOAN TERM        - CP-LOAN-TERM                               *
    40*  REMAINING TERM   - CP-REMAINING-TERM                          *
    41*  TERM OR EXT DAYS - CP-TERM-OR-EXT-DAYS                        *
    42*  STATE CODE       - CP-STATE                                   *
    43*  STATE CODE       - CP-STATE-STD-ABBV                          *
    44*  CLASS CODE       - CP-CLASS-CODE                              *
    45*  DEVIATION CODE   - CP-DEVIATION-CODE                          *
    46*  ORIGINAL BENEFIT - CP-ORIGINAL-BENEFIT                        *
    47*  PROCESS TYPE     - CP-PROCESS-TYPE                            *
    48*  BENEFIT KIND     - CP-BENEFIT-TYPE                            *
    49*  A.P.R.           - CP-LOAN-APR                                *
    50*  METHOD           - CP-EARNING-METHOD                          *
    51*  SPECIAL METHOD   - CP-SPECIAL-CALC-CODE                       *
    52*  PAYMENT FREQUENCY- CP-PAY-FREQUENCY                           *
    53*  COMPANY I.D.     - CP-COMPANY-ID                              *
    54*  BENEFIT CODE     - CP-BENEFIT-CD                              *
    55*  INSURED AGE      - CP-ISSUE-AGE                               *
    56******************************************************************
    57 ENVIRONMENT DIVISION.
    58
    59 DATA DIVISION.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page   3
* ELRFND.cbl
    61 WORKING-STORAGE SECTION.
    62 01  DFH-START PIC X(04).
    63 77  FILLER   PIC X(32) VALUE '********************************'.
    64 77  FILLER   PIC X(32) VALUE '**  ELRFND  WORKING STORAGE   **'.
    65 77  FILLER   PIC X(32) VALUE '********VMOD=2.011 *************'.
    66 77  WS-UE-CLP                   PIC S9(5)V99 COMP-3 VALUE +0.
    67 77  WS-GFR3                     PIC S9(5)V99 COMP-3 VALUE +0.
    68 77  WS-MONTH                    PIC S999     COMP-3 VALUE +0.
    69
    70 01  WS-WORK-MISC.
    71     12  WS-REMAINING-TERM   PIC S9(4)V9      COMP-3.
    72     12  WS-TEMP-RESULT      PIC S9(7)V9(6)   COMP-3.
    73     12  WS-REMAINING-AMT    PIC S9(7)V9(6)   COMP-3.
    74     12  WS-ORIG-PREM        PIC S9(7)V9(6)   COMP-3.
    75     12  WS-REMAIN-PREM      PIC S9(7)V9(6)   COMP-3.
    76     12  WS-NP-REF-FACTOR    PIC S9(4)V9(11)  COMP-3.
    77     12  WS-SAVE-TERM        PIC S9(3)        COMP-3.
    78     12  WS-SAVE-LOAN-TERM   PIC S9(3)        COMP-3.
    79     12  WS-SAVE-BENEFIT     PIC S9(9)V99     COMP-3.
    80     12  WS-SAVE-EARN-METHOD PIC X.
    81     12  ws-save-ext-days    pic s9(5)        comp-3.
    82     12  CAL-RFND            PIC S9(5)V99     COMP-3.
    83     12  FACTOR-1            PIC S9(4)V9(11)  COMP-3.
    84     12  FACTOR-2            PIC S9(4)V9(11)  COMP-3.
    85     12  FACTOR-3            PIC S9(4)V9(11)  COMP-3.
    86     12  FACTOR-4            PIC S9(4)V9(11)  COMP-3.
    87     12  FACTOR-5            PIC S9(7)        COMP-3.
    88     12  FACTOR-6            PIC S9(7)        COMP-3.
    89     12  RATE-FACTOR-1       PIC S9V99        COMP-3.
    90     12  RATE-FACTOR-2       PIC S999         COMP-3.
    91     12  R78-FACTOR          PIC S9(4)V9(11)  COMP-3.
    92     12  PR-FACTOR           PIC S9(4)V9(11)  COMP-3.
    93     12  RSUM-FACTOR         PIC S9(4)V9(11)  COMP-3.
    94     12  RSUM-REMAINING-TERM PIC S9(3)V99     COMP-3.
    95
    96 01  TEXAS-REG-WORK-AREAS.
    97     12  TEX-FACT-1          PIC S9(7)V9(2)  COMP-3.
    98     12  TEX-FACT-2          PIC S9(3)       COMP-3.
    99     12  TEX-FACT-3          PIC S9(3)       COMP-3.
   100     12  TEX-FACT-4          PIC S9(7)       COMP-3.
   101     12  TEX-FACT-5          PIC S9(3)       COMP-3.
   102     12  TEX-FACT-6          PIC S9(3)       COMP-3.
   103     12  TEX-FACT-7          PIC S9(7)       COMP-3.
   104     12  TEX-FACT-8          PIC S9V9(6)     COMP-3.
   105     12  TEX-FACT-9          PIC S9(4)V9(11) COMP-3.
   106
   107 01  NET-PAY-INTERFACE.
   108     12  N-P-APR             PIC S9(3)V9(4)  COMP-3.
   109     12  N-P-ORIG            PIC S9(3)       COMP-3.
   110     12  N-P-REM             PIC S9(3)       COMP-3.
   111     12  N-P-OPT             PIC X.
   112     12  N-P-LOAN            PIC S9(3)       COMP-3.
   113     12  N-P-FACTOR          PIC S9(4)V9(9)  COMP-3.
   114
   115*                        COPY ERCNETWS.
   116*****************************************************************
   117*                                                               *
   118*                                                               *
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page   4
* ELRFND.cbl
   119*                            ERCNETWS                           *
   120*           COPYBOOK REVIEWED FOR YEAR 2000 COMPLIANCE
   121*                            VMOD=2.014                         *
   122*                                                               *
   123*    WORKING STORAGE TO USE WITH ERCNETP - NET PAY CALCULATIONS *
   124*                                                               *
   125*****************************************************************.
   126*                   C H A N G E   L O G
   127*
   128* CHANGES ARE MARKED BY THE CHANGE EFFECTIVE DATE.
   129*-----------------------------------------------------------------
   130*  CHANGE   CHANGE REQUEST PGMR  DESCRIPTION OF CHANGE
   131* EFFECTIVE    NUMBER
   132*-----------------------------------------------------------------
   133* 060909  CR2008042300002  PEMA  ADD NEW FARM PLAN CALC
   134* 101509  IR2009100700002  PEMA  INCREASE DECIMAL POSITIONS
   135* 071910  IR2010062900001  PEMA  ADD MN NET BALLOON REFUND CALC
   136* 071511  CR2011021500001  PEMA  ADD CODE FOR DCC 10C
   137* 050713  CR2008052200001  PEMA  ADD CODE FOR 0 PCT APR
   138******************************************************************
   139
   140 01  NET-PAY-WORK-AREA.
   141     12  OPTION-SW               PIC X   VALUE 'X'.
   142        88  NPO-STD         VALUE SPACE.
   143        88  NPO-ALT         VALUE 'A'.
   144        88  NPO-SIMPLE      VALUE 'S'.
   145        88  NPO-2MO         VALUE 'I'.
   146        88  NPO-3MO         VALUE 'J'.
   147        88  NPO-4MO         VALUE 'K'.
   148        88  NPO-TRUNC       VALUE 'T' 'U' 'V' 'W' 'X'.
   149        88  NPO-TRUNC-0     VALUE 'T'.
   150        88  NPO-TRUNC-1     VALUE 'U'.
   151        88  NPO-TRUNC-2     VALUE 'V'.
   152        88  NPO-TRUNC-3     VALUE 'W'.
   153        88  NPO-TRUNC-4     VALUE 'X'.
   154        88  NPO-REFUND      VALUE 'R'.
   155        88  NPO-PRUDENTIAL  VALUE 'P'.
   156
   157     12  TYPE-SW             PIC X   VALUE 'N'.
   158        88  NET-STD             VALUE 'N'.
   159        88  NET-SMP             VALUE 'S'.
   160
   161     12  NP-PROCESS-SW       PIC X   VALUE '1'.
   162        88  NP-RATING           VALUE '1'.
   163        88  NP-REFUND           VALUE '2'.
   164        88  NP-REMAIN-AMT       VALUE '3'.
   165
   166     12  COMP-3-WORK-AREA         COMP-3.
   167         16  WS-WORK-DIS-RATE PIC S99V9(06)    VALUE +0.
   168         16  V               PIC SV9(13)       VALUE +.0.
   169         16  J               PIC SV9(9)        VALUE +0.
   170         16  K               PIC SV9(9)        VALUE +0.
   171         16  I               PIC SV9(10)       VALUE +.0.
   172         16  D               PIC S9(5)         VALUE +.0.
   173         16  APR100          PIC SV9(9)        VALUE +.0.
   174         16  RA              PIC S9(6)V9(9)    VALUE +.0.
   175         16  WK1             PIC S9(4)V9(13)   VALUE +.0.
   176         16  WK2             PIC S9(4)V9(13)   VALUE +.0.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page   5
* ELRFND.cbl
   177         16  pema            pic s9(2)v9(15)   value +0.
   178         16  WK3             PIC S9(7)V9(10)   VALUE +.0.
   179         16  WK4             PIC S9(7)V9(8)    VALUE +.0.
   180         16  WK5             PIC S9(5)V9(13)   VALUE +.0.
   181         16  WK5-CSL         PIC S9(9)V9(6)    VALUE +.0.
   182         16  WK6             PIC S9(7)V9(10)   VALUE +.0.
   183         16  WK7             PIC S9(7)V9(10)   VALUE +.0.
   184         16  WK8             PIC S9(3)V9(10)   VALUE +.0.
   185         16  WK9             PIC S9(3)V9(10)   VALUE +.0.
   186         16  GR              PIC S9(7)V9(10)   VALUE +.0.
   187         16  ONE-PLUS-I      PIC S9(3)V9(10)   VALUE +.0.
   188         16  ODF             PIC S9(3)V9(10)   VALUE +.0.
   189         16  OD              PIC S9(3)V9(10)   VALUE +.0.
   190         16  FM              PIC S9(3)V9(10)   VALUE +.0.
   191         16  FN              PIC S9(3)V9(10)   VALUE +.0.
   192         16  FNM             PIC S9(3)V9(10)   VALUE +.0.
   193         16  ANGLEM          PIC S9(5)V9(13)   VALUE +.0.
   194         16  ANGLEMY         PIC S9(5)V9(13)   VALUE +.0.
   195         16  ANGLEMP1        PIC S9(5)V9(13)   VALUE +.0.
   196         16  ANGLEN          PIC S9(5)V9(13)   VALUE +.0.
   197         16  ANGLENY         PIC S9(5)V9(13)   VALUE +.0.
   198         16  ANGLEN-M        PIC S9(5)V9(13)   VALUE +.0.
   199         16  ANGLEN-MP1      PIC S9(5)V9(13)   VALUE +.0.
   200         16  ANGLEN-MP1Y     PIC S9(5)V9(13)   VALUE +.0.
   201         16  ANGLEN-1        PIC S9(7)V9(10)   VALUE +.0.
   202         16  ANGLEM-1        PIC S9(7)V9(10)   VALUE +.0.
   203         16  ANGLEM-1Y       PIC S9(7)V9(10)   VALUE +.0.
   204         16  ANGLEM-T        PIC S9(5)V9(13)   VALUE +.0.
   205         16  PVBALLOON       PIC S9(7)V99      VALUE +.0.
   206         16  TRUNC-PMT       PIC S9(7)V99      VALUE +.0.
   207         16  K1              PIC S999          VALUE +1.
   208         16  K12             PIC S999          VALUE +12.
   209         16  K100            PIC S999          VALUE +100.
   210         16  K1000           PIC S9(7)         VALUE +1000.
   211         16  NC-LR           PIC S9(2)V9(5)    VALUE +.0.
   212         16  Y REDEFINES NC-LR
   213                             PIC S99V9(5).
   214         16  TI              PIC S999V9(5)     VALUE +0.
   215         16  NC-R            PIC S9(7)V9(10)   VALUE +.0.
   216         16  NC-OB           PIC S9(7)V9(10)   VALUE +.0.
   217         16  NC-P            PIC S9(7)V9(10)   VALUE +.0.
   218         16  NC-D            PIC S9(7)V9(10)   VALUE +.0.
   219         16  NC-BIG-D        PIC S9(3)         VALUE +030.
   220         16  NC-LITTLE-D     PIC S9(2)V9(7)    VALUE +.0.
   221         16  NC-MP           PIC S9(5)V9(2)    VALUE +.0.
   222         16  NC-LP           PIC S9(5)V9(2)    VALUE +.0.
   223
   224         16  CA-MP           PIC S9(5)V9(2)    VALUE +.0.
   225         16  CA-API          PIC S9(2)V9(8)    VALUE +.0.
   226         16  CA-APJ          PIC S9(2)V9(8)    VALUE +.0.
   227         16  CA-VI           PIC S9(2)V9(8)    VALUE +.0.
   228         16  CA-J            PIC S9(2)V9(8)    VALUE +.0.
   229         16  CA-DISCOUNT     PIC S9(2)V9(8)    VALUE +.042000.
   230         16  GTL-IA-DIVIDEND PIC S9(5)V9(8)    VALUE +.0.
   231         16  GTL-IA-DIVISOR  PIC S9(5)V9(8)    VALUE +.0.
   232         16  GTL-IA-FACTOR   PIC S9(5)V9(8)    VALUE +.0.
   233         16  GTL-IA-ODF      PIC S9(5)V9(8)    VALUE +.0.
   234         16  GTL-IA-ODD-DAYS PIC S999          VALUE +.0.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page   6
* ELRFND.cbl
   235         16  GTL-IA-SGN      PIC S9            VALUE +.0.
   236         16  GTL-IA-ABS      PIC 999           VALUE ZEROS.
   237
   238         16  ANNUAL-INT-RATE PIC S9(3)V9(4)    VALUE +.0.
   239
   240         16  ORIGINAL-TERM   PIC S999.
   241         16  M              REDEFINES ORIGINAL-TERM
   242                             PIC S999.
   243
   244         16  REMAINING-TERM  PIC S999.
   245         16  R              REDEFINES REMAINING-TERM
   246                             PIC S999.
   247
   248         16  LOAN-TERM       PIC S999.
   249         16  N              REDEFINES LOAN-TERM
   250                             PIC S999.
   251
   252         16  EXPIRED-TERM    PIC S999.
   253         16  E              REDEFINES EXPIRED-TERM
   254                             PIC S999.
   255
   256         16  PRUDENTIAL-WORK-AMT
   257                             PIC S9(7)V9(8).
   258         16  PWK            REDEFINES PRUDENTIAL-WORK-AMT
   259                             PIC S9(7)V9(8).
   260
   261         16  FACTOR          PIC S9(4)V9(9)    VALUE +0.0.
   262         16  VX              PIC S9V9(13)      VALUE +0.0.
   263         16  SV              PIC S9V9(13)      VALUE +0.0.
   264         16  SV-MINUS-ONE    PIC S999V9(09)    VALUE +0.0.
   265         16  SX              PIC S9V9(13)      VALUE +0.0.
   266         16  SE              PIC S9V9(10)      VALUE +0.0.
   267         16  N2              PIC S9(7)         VALUE +0.
   268         16  N3              PIC S9(7)         VALUE +0.
   269         16  K-I             PIC S9V9(8)       VALUE +0.0.
   270
   271     12  BINARY-WORK-AREA        COMP.
   272         16  X1              PIC S999        VALUE +0.
   273         16  X2              PIC S999        VALUE +0.
   274         16  MAX-X           PIC S9(5)       VALUE +0.
   275         16  B1              PIC S9(5)       VALUE +1.
   276         16  LINDX           PIC S999        VALUE ZEROS.
   277         16  AHNDX           PIC S999        VALUE ZEROS.
   278
   279     12  CSO-RATE-WORK-AREAS.
   280         16  C-PMTS-PER-YEAR     PIC S999V99 COMP-3 VALUE ZEROS.
   281         16  C-DAYS-IN-PMT-PER   PIC S999 COMP-3 VALUE ZEROS.
   282         16  C-TOT-PMTS          PIC S999 COMP-3 VALUE ZEROS.
   283     12  WS-WORK-MISC.
   284         16  ws-extra-pmts       pic s999         comp-3.
   285         16  NET-BEN             PIC S9(9)V9999   COMP-3.
   286         16  WS-RATE-TERM        PIC S9(3)        COMP-3.
   287*        16  WS-AGE              PIC 99           VALUE ZEROS.
   288         16  WS-AGE              PIC S9(3)V99 COMP-3 VALUE +0.
   289         16  WS-AH-FACE-BENEFIT  PIC S9(7)        COMP-3.
   290         16  WS-COUNTER          PIC S9(3)    COMP-3  VALUE +0.
   291         16  WS-WORK-RATE        PIC S9(2)V9(8) COMP-3 VALUE +0.
   292         16  WS-DISCOUNT-OPTION  PIC X VALUE SPACES.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page   7
* ELRFND.cbl
   293         16  WS-DUE-DATE         PIC S9(7) COMP-3 VALUE +0.
   294         16  WS-INT-BEGIN-DATE   PIC S9(7) COMP-3 VALUE +0.
   295         16  WS-X-Y-FACTOR       PIC S9(3)V9(15) COMP-3 VALUE +0.
   296         16  WS-Y-X-FACTOR       PIC S9(3)V9(15) COMP-3 VALUE +0.
   297         16  WS-ODD-DAY-UNITS    PIC S9(3)V9(15) COMP-3 VALUE +0.
   298         16  WS-CALC-FREQ-RATE   PIC S9(2)V9(15) COMP-3 VALUE +0.
   299         16  WS-NP-FACTOR        PIC S9(5)V9(10) COMP-3 VALUE +0.
   300******************************************************************
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page   8
* ELRFND.cbl
   302*                        COPY ELCDATE.
   303******************************************************************
   304*                                                                *
   305*                                                                *
   306*                            ELCDATE.                            *
   307*           COPYBOOK REVIEWED FOR YEAR 2000 COMPLIANCE
   308*                            VMOD=2.003
   309*                                                                *
   310*                                                                *
   311*   DESCRIPTION:  DATA PASSED TO DATE CONVERSION ROUTINE.        *
   312*                 LENGTH = 200                                   *
   313******************************************************************
   314
   315 01  DATE-CONVERSION-DATA.
   316     12  DC-COMM-LENGTH                PIC S9(4) COMP VALUE +200.
   317     12  DC-OPTION-CODE                PIC X.
   318         88  BIN-TO-GREG                VALUE ' '.
   319         88  ELAPSED-BETWEEN-BIN        VALUE '1'.
   320         88  EDIT-GREG-TO-BIN           VALUE '2'.
   321         88  YMD-GREG-TO-BIN            VALUE '3'.
   322         88  MDY-GREG-TO-BIN            VALUE '4'.
   323         88  JULIAN-TO-BIN              VALUE '5'.
   324         88  BIN-PLUS-ELAPSED           VALUE '6'.
   325         88  FIND-CENTURY               VALUE '7'.
   326         88  ELAPSED-BETWEEN-BIN-3      VALUE '8'.
   327         88  EDIT-GREG-TO-BIN-3         VALUE '9'.
   328         88  YMD-GREG-TO-BIN-3          VALUE 'A'.
   329         88  MDY-GREG-TO-BIN-3          VALUE 'B'.
   330         88  JULIAN-TO-BIN-3            VALUE 'C'.
   331         88  BIN-PLUS-ELAPSED-3         VALUE 'D'.
   332         88  JULIAN-EXPANDED-TO-BIN     VALUE 'E'.
   333         88  JULIAN-EXPANDED-TO-BIN-3   VALUE 'F'.
   334         88  BIN-TO-JULIAN-EXPANDED     VALUE 'G'.
   335         88  JULIAN-EXPANDED            VALUE 'E', 'F', 'G'.
   336         88  CHECK-LEAP-YEAR            VALUE 'H'.
   337         88  BIN-3-TO-GREG              VALUE 'I'.
   338         88  CYMD-GREG-TO-BIN-3         VALUE 'J'.
   339         88  MDCY-GREG-TO-BIN-3         VALUE 'K'.
   340         88  CYMD-GREG-TO-BIN           VALUE 'L'.
   341         88  MDCY-GREG-TO-BIN           VALUE 'M'.
   342         88  MDY-GREG-TO-JULIAN         VALUE 'N'.
   343         88  MDCY-GREG-TO-JULIAN        VALUE 'O'.
   344         88  YMD-GREG-TO-JULIAN         VALUE 'P'.
   345         88  CYMD-GREG-TO-JULIAN        VALUE 'Q'.
   346         88  THREE-CHARACTER-BIN
   347                  VALUES  '8' '9' 'A' 'B' 'C' 'D' 'I' 'J' 'K'.
   348         88  GREGORIAN-TO-BIN
   349                  VALUES '2' '3' '4' '9' 'A' 'B' 'J' 'K' 'L' 'M'.
   350         88  BIN-TO-GREGORIAN
   351                  VALUES ' ' '1' 'I' '8' 'G'.
   352         88  JULIAN-TO-BINARY
   353                  VALUES '5' 'C' 'E' 'F'.
   354     12  DC-ERROR-CODE                 PIC X.
   355         88  NO-CONVERSION-ERROR        VALUE ' '.
   356         88  DATE-CONVERSION-ERROR
   357                  VALUES '1' '2' '3' '4' '5' '9' 'A' 'B' 'C'.
   358         88  DATE-IS-ZERO               VALUE '1'.
   359         88  DATE-IS-NON-NUMERIC        VALUE '2'.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page   9
* ELRFND.cbl
   360         88  DATE-IS-INVALID            VALUE '3'.
   361         88  DATE1-GREATER-DATE2        VALUE '4'.
   362         88  ELAPSED-PLUS-NEGATIVE      VALUE '5'.
   363         88  DATE-INVALID-OPTION        VALUE '9'.
   364         88  INVALID-CENTURY            VALUE 'A'.
   365         88  ONLY-CENTURY               VALUE 'B'.
   366         88  ONLY-LEAP-YEAR             VALUE 'C'.
   367         88  VALID-CENTURY-LEAP-YEAR    VALUE 'B', 'C'.
   368     12  DC-END-OF-MONTH               PIC X.
   369         88  CALCULATE-END-OF-MONTH     VALUE '1'.
   370     12  DC-CENTURY-ADJUSTMENT         PIC X   VALUE SPACES.
   371         88  USE-NORMAL-PROCESS         VALUE ' '.
   372         88  ADJUST-DOWN-100-YRS        VALUE '1'.
   373         88  ADJUST-UP-100-YRS          VALUE '2'.
   374     12  FILLER                        PIC X.
   375     12  DC-CONVERSION-DATES.
   376         16  DC-BIN-DATE-1             PIC XX.
   377         16  DC-BIN-DATE-2             PIC XX.
   378         16  DC-GREG-DATE-1-EDIT       PIC X(08).
   379         16  DC-GREG-DATE-1-EDIT-R REDEFINES
   380                       DC-GREG-DATE-1-EDIT.
   381             20  DC-EDIT1-MONTH        PIC 99.
   382             20  SLASH1-1              PIC X.
   383             20  DC-EDIT1-DAY          PIC 99.
   384             20  SLASH1-2              PIC X.
   385             20  DC-EDIT1-YEAR         PIC 99.
   386         16  DC-GREG-DATE-2-EDIT       PIC X(08).
   387         16  DC-GREG-DATE-2-EDIT-R REDEFINES
   388                     DC-GREG-DATE-2-EDIT.
   389             20  DC-EDIT2-MONTH        PIC 99.
   390             20  SLASH2-1              PIC X.
   391             20  DC-EDIT2-DAY          PIC 99.
   392             20  SLASH2-2              PIC X.
   393             20  DC-EDIT2-YEAR         PIC 99.
   394         16  DC-GREG-DATE-1-YMD        PIC 9(06).
   395         16  DC-GREG-DATE-1-YMD-R  REDEFINES
   396                     DC-GREG-DATE-1-YMD.
   397             20  DC-YMD-YEAR           PIC 99.
   398             20  DC-YMD-MONTH          PIC 99.
   399             20  DC-YMD-DAY            PIC 99.
   400         16  DC-GREG-DATE-1-MDY        PIC 9(06).
   401         16  DC-GREG-DATE-1-MDY-R REDEFINES
   402                      DC-GREG-DATE-1-MDY.
   403             20  DC-MDY-MONTH          PIC 99.
   404             20  DC-MDY-DAY            PIC 99.
   405             20  DC-MDY-YEAR           PIC 99.
   406         16  DC-GREG-DATE-1-ALPHA.
   407             20  DC-ALPHA-MONTH        PIC X(10).
   408             20  DC-ALPHA-DAY          PIC 99.
   409             20  FILLER                PIC XX.
   410             20  DC-ALPHA-CENTURY.
   411                 24 DC-ALPHA-CEN-N     PIC 99.
   412             20  DC-ALPHA-YEAR         PIC 99.
   413         16  DC-ELAPSED-MONTHS         PIC S9(4)     COMP.
   414         16  DC-ODD-DAYS-OVER          PIC S9(4)     COMP.
   415         16  DC-ELAPSED-DAYS           PIC S9(4)     COMP.
   416         16  DC-JULIAN-DATE            PIC 9(05).
   417         16  DC-JULIAN-YYDDD REDEFINES DC-JULIAN-DATE
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  10
* ELRFND.cbl
   418                                       PIC 9(05).
   419         16  DC-JULIAN-DT REDEFINES DC-JULIAN-DATE.
   420             20  DC-JULIAN-YEAR        PIC 99.
   421             20  DC-JULIAN-DAYS        PIC 999.
   422         16  DC-DAYS-IN-MONTH          PIC S9(3)       COMP-3.
   423         16  DC-DAY-OF-WEEK            PIC S9  VALUE ZERO COMP-3.
   424         16  DC-DAY-OF-WEEK2           PIC S9  VALUE ZERO COMP-3.
   425     12  DATE-CONVERSION-VARIBLES.
   426         16  HOLD-CENTURY-1            PIC 9(11) VALUE 0.
   427         16  HOLD-CENTURY-1-SPLIT REDEFINES HOLD-CENTURY-1.
   428             20  FILLER                PIC 9(3).
   429             20  HOLD-CEN-1-CCYY.
   430                 24  HOLD-CEN-1-CC     PIC 99.
   431                 24  HOLD-CEN-1-YY     PIC 99.
   432             20  HOLD-CEN-1-MO         PIC 99.
   433             20  HOLD-CEN-1-DA         PIC 99.
   434         16  HOLD-CENTURY-1-R   REDEFINES HOLD-CENTURY-1.
   435             20  HOLD-CEN-1-R-MO       PIC 99.
   436             20  HOLD-CEN-1-R-DA       PIC 99.
   437             20  HOLD-CEN-1-R-CCYY.
   438                 24  HOLD-CEN-1-R-CC   PIC 99.
   439                 24  HOLD-CEN-1-R-YY   PIC 99.
   440             20  FILLER                PIC 9(3).
   441         16  HOLD-CENTURY-1-X.
   442             20  FILLER                PIC X(3)  VALUE SPACES.
   443             20  HOLD-CEN-1-X-CCYY.
   444                 24  HOLD-CEN-1-X-CC   PIC XX VALUE SPACES.
   445                 24  HOLD-CEN-1-X-YY   PIC XX VALUE SPACES.
   446             20  HOLD-CEN-1-X-MO       PIC XX VALUE SPACES.
   447             20  HOLD-CEN-1-X-DA       PIC XX VALUE SPACES.
   448         16  HOLD-CENTURY-1-R-X REDEFINES HOLD-CENTURY-1-X.
   449             20  HOLD-CEN-1-R-X-MO     PIC XX.
   450             20  HOLD-CEN-1-R-X-DA     PIC XX.
   451             20  HOLD-CEN-1-R-X-CCYY.
   452                 24  HOLD-CEN-1-R-X-CC PIC XX.
   453                 24  HOLD-CEN-1-R-X-YY PIC XX.
   454             20  FILLER                PIC XXX.
   455         16  DC-BIN-DATE-EXPAND-1      PIC XXX.
   456         16  DC-BIN-DATE-EXPAND-2      PIC XXX.
   457         16  DC-JULIAN-DATE-1          PIC 9(07).
   458         16  DC-JULIAN-DATE-1-R REDEFINES DC-JULIAN-DATE-1.
   459             20  DC-JULIAN-1-CCYY.
   460                 24  DC-JULIAN-1-CC    PIC 99.
   461                 24  DC-JULIAN-1-YR    PIC 99.
   462             20  DC-JULIAN-DA-1        PIC 999.
   463         16  DC-JULIAN-DATE-2          PIC 9(07).
   464         16  DC-JULIAN-DATE-2-R REDEFINES DC-JULIAN-DATE-2.
   465             20  DC-JULIAN-2-CCYY.
   466                 24  DC-JULIAN-2-CC    PIC 99.
   467                 24  DC-JULIAN-2-YR    PIC 99.
   468             20  DC-JULIAN-DA-2        PIC 999.
   469         16  DC-GREG-DATE-A-EDIT.
   470             20  DC-EDITA-MONTH        PIC 99.
   471             20  SLASHA-1              PIC X VALUE '/'.
   472             20  DC-EDITA-DAY          PIC 99.
   473             20  SLASHA-2              PIC X VALUE '/'.
   474             20  DC-EDITA-CCYY.
   475                 24  DC-EDITA-CENT     PIC 99.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  11
* ELRFND.cbl
   476                 24  DC-EDITA-YEAR     PIC 99.
   477         16  DC-GREG-DATE-B-EDIT.
   478             20  DC-EDITB-MONTH        PIC 99.
   479             20  SLASHB-1              PIC X VALUE '/'.
   480             20  DC-EDITB-DAY          PIC 99.
   481             20  SLASHB-2              PIC X VALUE '/'.
   482             20  DC-EDITB-CCYY.
   483                 24  DC-EDITB-CENT     PIC 99.
   484                 24  DC-EDITB-YEAR     PIC 99.
   485         16  DC-GREG-DATE-CYMD         PIC 9(08).
   486         16  DC-GREG-DATE-CYMD-R REDEFINES
   487                              DC-GREG-DATE-CYMD.
   488             20  DC-CYMD-CEN           PIC 99.
   489             20  DC-CYMD-YEAR          PIC 99.
   490             20  DC-CYMD-MONTH         PIC 99.
   491             20  DC-CYMD-DAY           PIC 99.
   492         16  DC-GREG-DATE-MDCY         PIC 9(08).
   493         16  DC-GREG-DATE-MDCY-R REDEFINES
   494                              DC-GREG-DATE-MDCY.
   495             20  DC-MDCY-MONTH         PIC 99.
   496             20  DC-MDCY-DAY           PIC 99.
   497             20  DC-MDCY-CEN           PIC 99.
   498             20  DC-MDCY-YEAR          PIC 99.
   499    12  DC-FORCE-EL310-DATE-SW         PIC X    VALUE SPACE.
   500        88  DC-FORCE-EL310-DATE                 VALUE 'Y'.
   501    12  DC-EL310-DATE                  PIC X(21).
   502    12  FILLER                         PIC X(28).
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  12
* ELRFND.cbl
   504*                        COPY ELCCALC.
   505******************************************************************
   506*                                                                *
   507*                           ELCCALC.                            *
   508*           COPYBOOK REVIEWED FOR YEAR 2000 COMPLIANCE
   509*                            VMOD=2.025                          *
   510*                                                                *
   511*   DESCRIPTION:  DATA TO BE PASSED TO REMAINING TERM ROUTINE    *
   512*                 REMAINING AMOUNT ROUTINE, LOSS RESERVE ROUTINE *
   513*                 REFUND CALCULATIONS ROUTINE, EARNINGS CALCU -  *
   514*                 LATIONS ROUTINE, AND THE RATING ROUTINE.       *
   515*                                                                *
   516*  PASSED TO ELRTRM                                              *
   517*  -----------------                                             *
   518*  METHOD CODE (I.E. FULL MONTH, HALF ADJ, ETC)                  *
   519*  ORIGINAL TERM                                                 *
   520*  BEGINNING DATE                                                *
   521*  ENDING DATE                                                   *
   522*  COMPANY I.D.                                                  *
   523*  ACCOUNT MASTER USER FIELD                                     *
   524*  PROCESS SWITCH (CANCEL, CLAIM)                                *
   525*  FREE LOOK DAYS                                                *
   526*                                                                *
   527*  RETURNED FROM ELRTRM                                          *
   528*  ---------------------                                         *
   529*  REMAINING TERM 1 - USED FOR EARNINGS                          *
   530*  REMAINING TERM 2 - USED FOR BENEFIT CALCULATIONS              *
   531*  REMAINING TERM 3 - USED FOR CLAIM BENEFITS                    *
   532*  ODD DAYS - REMAINING DAYS PAST FULL MONTHS                    *
   533*----------------------------------------------------------------*
   534*  PASSED TO ELRAMT                                              *
   535*  ----------------                                              *
   536*  REMAINING TERM 1 OR 2 OR 3 (FROM ELRTRM)                      *
   537*  ORIGINAL TERM (ADJUSTED IF SKIP MONTHS ARE USED)              *
   538*  ORIGINAL AMOUNT                                               *
   539*  ALTERNATE BENEFIT (BALLON)                                    *
   540*  A.P.R. - NET PAY ONLY                                         *
   541*  METHOD
   542*  PAYMENT FREQUENCY - FOR FARM PLAN                             *
   543*  COMPANY I.D.                                                  *
   544*  BENEFIT TYPE                                                  *
   545*                                                                *
   546*  RETURNED FROM ELRAMT                                          *
   547*  --------------------                                          *
   548*  REMAINING AMOUNT 1 - CURRENT                                  *
   549*  REMAINING AMOUNT 2 - PREVIOUS MONTH                           *
   550*  REMAINING AMOUNT FACTOR
   551*----------------------------------------------------------------*
   552*  PASSED TO ELRESV                                              *
   553*  -----------------                                             *
   554*  CERTIFICATE EFFECTIVE DATE                                    *
   555*  VALUATION DATE                                                *
   556*  PAID THRU DATE                                                *
   557*  BENEFIT                                                       *
   558*  INCURRED DATE                                                 *
   559*  REPORTED DATE                                                 *
   560*  ISSUE AGE                                                     *
   561*  TERM                                                          *
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  13
* ELRFND.cbl
   562*  CDT PERCENT                                                   *
   563*  CDT METHOD (I.E. INTERPOLATED, AVERAGE, ETC)                  *
   564* *CLAIM TYPE (LIFE, A/H)                                        *
   565* *REMAINING BENEFIT (FROM ELRAMT)                               *
   566* *ONLY FIELDS REQUIRED FOR LIFE CLAIMS                          *
   567*                                                                *
   568*  RETURNED FROM ELRESV                                          *
   569*  --------------------                                          *
   570*  CDT TABLE USED                                                *
   571*  CDT FACTOR USED                                               *
   572*  PAY TO CURRENT RESERVE                                        *
   573*  I.B.N.R. - A/H ONLY                                           *
   574*  FUTURE (ACCRUED) AH ONLY                                      *
   575*----------------------------------------------------------------*
   576*  PASSED TO ELRATE                                              *
   577*  ----------------                                              *
   578*  CERT ISSUE DATE                                               *
   579*  ORIGINAL TERM (ADJUSTED IF SKIP MONTHS ARE USED)              *
   580*  TERM OR EXT DAYS  (DAY TERM FOR SP CALC = 'D', ELSE EXT DAYS) *
   581*  CAPPED TERM   (ONLY FOR TRUNCATED LIFE)                       *
   582*  STATE CODE (CLIENT DEFINED)                                   *
   583*  STATE CODE (STANDARD P.O. ABBRV)                              *
   584*  CLASS CODE (FROM CERT OR ACCOUNT IF CERT ZERO OR SPACES)      *
   585*  DEVIATION CODE                                                *
   586*  ISSUE AGE                                                     *
   587*  ORIGINAL BENEFIT AMOUNT                                       *
   588*  RATING BENEFIT AMT (TOTAL BENEFIT AMT FOR BALLOONS)           *
   589*  PROCESS TYPE (ISSUE OR CANCEL)                                *
   590*  BENEFIT KIND (LIFE OR A/H)                                    *
   591*  A.P.R.                                                        *
   592*  METHOD
   593*  SPECIAL METHOD - (SPECIAL CODE FROM BENEFIT RECORD)           *
   594*  PAYMENT FREQUENCY  (FOR TEXAS IRREGULAR)                      *
   595*  COMPANY I.D. (3 CHARACTER)                                    *
   596*  BENEFIT CODE                                                  *
   597*  BENEFIT OVERRIDE CODE                                         *
   598*  MAXIMUM MONTHLY BENEFIT (FROM ACCT MASTER - CSL ONLY)         *
   599*  MAXIMUM TOTAL BENEFIT (FROM ACCT MASTER - CSL ONLY)           *
   600*  JOINT INDICATOR (CSL ONLY)                                    *
   601*  FIRST PAYMENT DATE (CSL ONLY)                                 *
   602*  PERIODIC PAYMENT AMOUNT (IN CP-REMAINING-TERM - CSL ONLY)     *
   603*                                                                *
   604*  RETURNED FROM ELRATE                                          *
   605*  --------------------                                          *
   606*  CALCULATED PREMIUM                                            *
   607*  PREMIUM RATE                                                  *
   608*  MORTALITY CODE                                                *
   609*  MAX ATTAINED AGE                                              *
   610*  MAX AGE                                                       *
   611*  MAX TERM                                                      *
   612*  MAX MONTHLY BENEFIT                                           *
   613*  MAX TOTAL BENIFIT                                             *
   614*  COMPOSITE RATE (OPEN-END ONLY)                                *
   615*----------------------------------------------------------------*
   616*  PASSED TO ELRFND                                              *
   617*  ----------------                                              *
   618*  CERT ISSUE DATE                                               *
   619*  REFUND DATE                                                   *
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  14
* ELRFND.cbl
   620*  RULE OF 78 OPTION (FROM CONTROL RECORD)                       *
   621*  ORIGINAL TERM (ADJUSTED IF SKIP MONTHS ARE USED)              *
   622*  TERM OR EXT DAYS  (DAY TERM FOR SP CALC = 'D', ELSE EXT DAYS) *
   623*  REMAINING TERM (REMAINING TERM 1 FROM ELTERM)                 *
   624*  STATE CODE (CLIENT DEFINED)                                   *
   625*  STATE CODE (STANDARD P.O. ABBRV)                              *
   626*  CLASS CODE (FROM CERT OR ACCOUNT IF CERT ZERO OR SPACES)      *
   627*  DEVIATION CODE                                                *
   628*  ISSUE AGE                                                     *
   629*  ORIGINAL BENEFIT AMOUNT                                       *
   630*  RATING BENEFIT AMT (TOTAL BENEFIT AMT FOR BALLOONS)           *
   631*  PROCESS TYPE (CANCEL)                                         *
   632*  BENEFIT KIND (LIFE OR A/H)                                    *
   633*  A.P.R.                                                        *
   634*  EARNING METHOD - (CODE FROM BENEFIT, STATE OR ACCOUNT RECORD) *
   635*  RATING METHOD -  (CODE FROM BENEFIT)                          *
   636*  SPECIAL METHOD - (SPECIAL CODE FROM BENEFIT RECORD)           *
   637*  PAYMENT FREQUENCY  (FOR TEXAS IRREGULAR)                      *
   638*  COMPANY I.D. (3 CHARACTER)                                    *
   639*  BENEFIT CODE                                                  *
   640*  BENEFIT OVERRIDE CODE                                         *
   641*                                                                *
   642*  RETURNED FROM ELRFND                                          *
   643*  --------------------                                          *
   644*  CALCULATED REFUND                                             *
   645*----------------------------------------------------------------*
   646*  PASSED TO ELEARN                                              *
   647*  ----------------                                              *
   648*  CERT ISSUE DATE                                               *
   649*  ORIGINAL TERM (ADJUSTED IF SKIP MONTHS ARE USED)              *
   650*  REMAINING TERM (REMAINING TERM 1 FROM ELTERM)                 *
   651*  RULE OF 78 OPTION (FROM CONTROL RECORD)                       *
   652*  STATE CODE (CLIENT DEFINED)                                   *
   653*  STATE CODE (STANDARD P.O. ABBRV)                              *
   654*  CLASS CODE (FROM CERT OR ACCOUNT IF CERT ZERO OR SPACES)      *
   655*  DEVIATION CODE                                                *
   656*  ISSUE AGE                                                     *
   657*  ORIGINAL BENEFIT AMOUNT                                       *
   658*  BENEFIT KIND (LIFE OR A/H)                                    *
   659*  A.P.R.                                                        *
   660*  METHOD - (EARNING CODE FROM BENEFIT RECORD)                   *
   661*  SPECIAL METHOD - (SPECIAL CODE FROM BENEFIT RECORD)           *
   662*  PAYMENT FREQUENCY  (FOR TEXAS IRREGULAR)                      *
   663*  COMPANY I.D. (3 CHARACTER)                                    *
   664*  BENEFIT CODE                                                  *
   665*  BENEFIT OVERRIDE CODE                                         *
   666*                                                                *
   667*  RETURNED FROM ELEARN                                          *
   668*  --------------------                                          *
   669*  INDICATED  EARNINGS                                           *
   670*----------------------------------------------------------------*
   671*                 LENGTH = 450                                   *
   672*                                                                *
   673******************************************************************
   674******************************************************************
   675*                   C H A N G E   L O G
   676*
   677* CHANGES ARE MARKED BY THE CHANGE EFFECTIVE DATE.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  15
* ELRFND.cbl
   678*-----------------------------------------------------------------
   679*  CHANGE   CHANGE REQUEST PGMR  DESCRIPTION OF CHANGE
   680* EFFECTIVE    NUMBER
   681*-----------------------------------------------------------------
   682* 010303    2001061800003  PEMA  ADD DCC/MONTHLY PROCESSING
   683* 033104    2003080800002  PEMA  ADD GAP NON REFUNDABLE OPTION
   684* 101807    2007100100007  PEMA  EXPAND CLM RESERVE FIELDS
   685* 010410    2008021200005  PEMA  ADD FIELDS FOR MN NET PAY BALLOON
   686* 010410    2009050700003  PEMA  ADD FIELDS FOR SPP-DD
   687* 041310  CR2008021200005  PEMA  ADD CODE FOR MN LEVEL
   688* 041710    2007111300001  AJRA  ADD CLAIM CALC SW FOR SC NP+6
   689* 101110  CR2010012700001  PEMA ADD DDF REFUND/UEP PROCESSING
   690* 071211  CR2009050700003  PEMA  ADD SPP DEALER DIRECT
   691* 040615  CR2013072200002  PEMA  ADD EXTRA PERIODS
   692* 010716    2015082500001  PEMA CHG POLICY FEE TO CANCEL FEE
   693******************************************************************
   694
   695 01  CALCULATION-PASS-AREA.
   696     12  CP-COMM-LENGTH            PIC S9(4)         VALUE +450
   697                                     COMP.
   698
   699     12  CP-RETURN-CODE            PIC X             VALUE ZERO.
   700       88  NO-CP-ERROR                             VALUE ZERO.
   701       88  CP-ERROR-OCCURED VALUE '1' '2' '3' '4' '5' '6' '7' '8'
   702                                  '9' 'A' 'B' 'C' 'D' 'E' 'H'.
   703       88  CP-ERROR-IN-AMOUNTS                     VALUE '1'.
   704       88  CP-ERROR-IN-DATES                       VALUE '2'.
   705       88  CP-ERROR-IN-OPTIONS                     VALUE '3'.
   706       88  CP-ERROR-IN-TERMS                       VALUE '4'.
   707       88  CP-ERROR-IN-FREQUENCY                   VALUE '5'.
   708       88  CP-ERROR-RATE-NOT-FOUND                 VALUE '6'.
   709       88  CP-ERROR-RATE-IS-ZERO                   VALUE '7'.
   710       88  CP-ERROR-AMT-OUTSIDE-LIMIT              VALUE '8'.
   711       88  CP-ERROR-TERM-OUTSIDE-LIMIT             VALUE '9'.
   712       88  CP-ERROR-AGE-OUTSIDE-LIMIT              VALUE 'A'.
   713       88  CP-ERROR-ATT-OUTSIDE-LIMIT              VALUE 'B'.
   714       88  CP-ERROR-TOT-OUTSIDE-LIMIT              VALUE 'C'.
   715       88  CP-ERROR-RATE-FILE-NOTOPEN              VALUE 'D'.
   716       88  CP-ERROR-ISSUE-AGE-ZERO                 VALUE 'E'.
   717       88  CP-ERROR-NO-LIMITS-CRI                  VALUE 'F'.
   718       88  CP-ERROR-DIV-BY-ZERO                    VALUE 'G'.
   719       88  CP-ERROR-LOAN-TERM                      VALUE 'H'.
   720
   721     12  CP-RETURN-CODE-2          PIC X             VALUE ZERO.
   722       88  NO-CP-ERROR-2                           VALUE ZERO.
   723***********************  INPUT AREAS ****************************
   724
   725     12  CP-CALCULATION-AREA.
   726         16  CP-ACCOUNT-NUMBER     PIC X(10)       VALUE SPACES.
   727         16  CP-CERT-EFF-DT        PIC XX.
   728         16  CP-VALUATION-DT       PIC XX.
   729         16  CP-PAID-THRU-DT       PIC XX.
   730         16  CP-BENEFIT-TYPE       PIC X.
   731           88  CP-AH                               VALUE 'A' 'D'
   732                                                   'I' 'U'.
   733           88  CP-REDUCING-LIFE                    VALUE 'R'.
   734           88  CP-LEVEL-LIFE                       VALUE 'L' 'P'.
   735         16  CP-INCURRED-DT        PIC XX.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  16
* ELRFND.cbl
   736         16  CP-REPORTED-DT        PIC XX.
   737         16  CP-ACCT-FLD-5         PIC XX            VALUE SPACE.
   738         16  CP-COMPANY-ID         PIC XXX           VALUE SPACE.
   739         16  CP-ISSUE-AGE          PIC S9(3)         VALUE ZERO
   740                                     COMP-3.
   741         16  CP-CDT-PERCENT        PIC S9(3)V99      VALUE ZERO
   742                                     COMP-3.
   743         16  CP-CDT-METHOD         PIC X.
   744           88  CP-CDT-ROUND-NEAR                   VALUE '1'.
   745           88  CP-CDT-ROUND-HIGH                   VALUE '2'.
   746           88  CP-CDT-INTERPOLATED                 VALUE '3'.
   747         16  CP-CLAIM-TYPE         PIC X.
   748           88  CP-AH-CLAIM                         VALUE 'A'.
   749           88  CP-LIFE-CLAIM                       VALUE 'L'.
   750         16  CP-ORIGINAL-TERM      PIC S9(3)         VALUE ZERO
   751                                     COMP-3.
   752         16  CP-ORIGINAL-BENEFIT   PIC S9(9)V99      VALUE ZERO
   753                                     COMP-3.
   754         16  CP-ORIGINAL-PREMIUM   PIC S9(7)V99      VALUE ZERO
   755                                     COMP-3.
   756         16  CP-REMAINING-TERM     PIC S9(3)V99      VALUE ZERO
   757                                     COMP-3.
   758         16  CP-REMAINING-BENEFIT  PIC S9(9)V99      VALUE ZERO
   759                                     COMP-3.
   760         16  CP-LOAN-APR           PIC S9(3)V9(4)    VALUE ZERO
   761                                     COMP-3.
   762         16  CP-PAY-FREQUENCY      PIC S9(3)         VALUE ZERO
   763                                     COMP-3.
   764         16  CP-REM-TERM-METHOD    PIC X.
   765           88  CP-EARN-AFTER-15TH                  VALUE '1'.
   766           88  CP-EARN-ON-HALF-MONTH               VALUE '2'.
   767           88  CP-EARN-ON-1ST-DAY                  VALUE '3'.
   768           88  CP-EARN-ON-FULL-MONTH               VALUE '4'.
   769           88  CP-EARN-WITH-NO-DAYS                VALUE '5'.
   770           88  CP-EARN-AFTER-14TH                  VALUE '6'.
   771           88  CP-EARN-AFTER-16TH                  VALUE '7'.
   772         16  CP-EARNING-METHOD     PIC X.
   773           88  CP-EARN-BY-R78                      VALUE '1' 'R'.
   774           88  CP-EARN-BY-PRORATA                  VALUE '2' 'P'.
   775           88  CP-EARN-AS-CALIF                    VALUE '3' 'C'.
   776           88  CP-EARN-AS-TEXAS                    VALUE '4' 'T'.
   777           88  CP-EARN-AS-FARM-PLAN                VALUE '4' 'T'.
   778           88  CP-EARN-AS-NET-PAY                  VALUE '5' 'N'.
   779           88  CP-EARN-ANTICIPATION                VALUE '6' 'A'.
   780           88  CP-EARN-AS-MEAN                     VALUE '8' 'M'.
   781           88  CP-EARN-AS-SUM-OF-DIGITS            VALUE '9'.
   782           88  CP-EARN-AS-REG-BALLOON              VALUE 'B'.
   783           88  CP-GAP-NON-REFUNDABLE               VALUE 'G'.
   784           88  CP-GAP-ACTUARIAL                    VALUE 'S'.
   785           88  CP-DCC-SPP-DDF                      VALUE 'D' 'I'.
   786           88  CP-DCC-SPP-DDF-IU                   VALUE 'I'.
   787         16  CP-PROCESS-TYPE       PIC X.
   788           88  CP-CLAIM                            VALUE '1'.
   789           88  CP-CANCEL                           VALUE '2'.
   790           88  CP-ISSUE                            VALUE '3'.
   791         16  CP-SPECIAL-CALC-CD    PIC X.
   792           88  CP-OUTSTANDING-BAL              VALUE 'O'.
   793           88  CP-1-MTH-INTEREST               VALUE ' '.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  17
* ELRFND.cbl
   794           88  CP-0-MTH-INTEREST               VALUE 'A'.
   795           88  CP-OB-OFFLINE-RESERVED          VALUE 'B'.
   796           88  CP-CRITICAL-PERIOD              VALUE 'C'.
   797           88  CP-TERM-IS-DAYS                 VALUE 'D'.
   798           88  CP-USE-PREM-AS-ENTERED          VALUE 'E'.
   799           88  CP-FARM-PLAN                    VALUE 'F'.
   800           88  CP-RATE-AS-STANDARD             VALUE 'G'.
   801           88  CP-2-MTH-INTEREST               VALUE 'I'.
   802           88  CP-3-MTH-INTEREST               VALUE 'J'.
   803           88  CP-4-MTH-INTEREST               VALUE 'K'.
   804           88  CP-BALLOON-LAST-PMT             VALUE 'L'.
   805           88  CP-MORTGAGE-REC                 VALUE 'M'.
   806           88  CP-OUTSTANDING-BALANCE          VALUE 'O'.
   807           88  CP-NET-PAY-PRUDENTIAL           VALUE 'P'.
   808           88  CP-NET-PAY-SIMPLE               VALUE 'S'.
   809           88  CP-TRUNCATED-LIFE               VALUE 'T' 'U' 'V'
   810                                                     'W' 'X'.
   811           88  CP-TRUNCATE-0-MTH               VALUE 'T'.
   812           88  CP-TRUNCATE-1-MTH               VALUE 'U'.
   813           88  CP-TRUNCATE-2-MTH               VALUE 'V'.
   814           88  CP-TRUNCATE-3-MTH               VALUE 'W'.
   815           88  CP-TRUNCATE-4-MTH               VALUE 'X'.
   816           88  CP-SUMMARY-REC                  VALUE 'Z'.
   817           88  CP-PROPERTY-BENEFIT             VALUE '2'.
   818           88  CP-UNEMPLOYMENT-BENEFIT         VALUE '3'.
   819           88  CP-AD-D-BENEFIT                 VALUE '4'.
   820           88  CP-CSL-METH-1                   VALUE '5'.
   821           88  CP-CSL-METH-2                   VALUE '6'.
   822           88  CP-CSL-METH-3                   VALUE '7'.
   823           88  CP-CSL-METH-4                   VALUE '8'.
   824
   825         16  CP-LOAN-TERM          PIC S9(3)       VALUE ZERO
   826                                     COMP-3.
   827         16  CP-CLASS-CODE         PIC XX          VALUE ZERO.
   828         16  CP-DEVIATION-CODE     PIC XXX         VALUE ZERO.
   829         16  CP-STATE              PIC XX          VALUE SPACE.
   830         16  CP-STATE-STD-ABBRV    PIC XX          VALUE SPACE.
   831         16  CP-BENEFIT-CD         PIC XX          VALUE ZERO.
   832           88  CP-CSL-VALID-NP-BENEFIT-CD VALUES '12' '13'
   833               '34' '35' '36' '37' '44' '45' '46' '47' '72' '73'.
   834         16  CP-R78-OPTION         PIC X.
   835           88  CP-TERM-TIMES-TERM-PLUS-1           VALUE ' '.
   836           88  CP-TERM-TIMES-TERM                  VALUE '1'.
   837
   838         16  CP-COMPANY-CD         PIC X             VALUE SPACE.
   839         16  CP-IBNR-RESERVE-SW    PIC X.
   840         16  CP-CLAIM-STATUS       PIC X.
   841         16  CP-RATE-FILE          PIC X.
   842         16  CP-TERM-OR-EXT-DAYS   PIC S9(05)        VALUE ZERO
   843                                     COMP-3.
   844
   845         16  CP-LIFE-OVERRIDE-CODE PIC X.
   846         16  CP-AH-OVERRIDE-CODE   PIC X.
   847
   848         16  CP-RATE-DEV-PCT       PIC S9V9(6)       VALUE ZERO
   849                                     COMP-3.
   850         16  CP-CLP-RATE-UP        REDEFINES CP-RATE-DEV-PCT
   851                                   PIC S9(5)V99 COMP-3.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  18
* ELRFND.cbl
   852         16  CP-CRITICAL-MONTHS    PIC S9(3)         VALUE ZERO
   853                                     COMP-3.
   854         16  CP-ALTERNATE-BENEFIT  PIC S9(9)V99      VALUE ZERO
   855                                     COMP-3.
   856         16  CP-ALTERNATE-PREMIUM  PIC S9(7)V99      VALUE ZERO
   857                                     COMP-3.
   858         16  CP-DDF-CSO-ADMIN-FEE REDEFINES CP-ALTERNATE-PREMIUM
   859                                  PIC S9(7)V99 COMP-3.
   860
   861         16  CP-PAID-FROM-DATE     PIC X(02).
   862         16  CP-CLAIM-CALC-METHOD  PIC X(01).
   863         16  CP-EXT-DAYS-CALC      PIC X.
   864           88  CP-EXT-NO-CHG                   VALUE ' '.
   865           88  CP-EXT-CHG-LF                   VALUE '1'.
   866           88  CP-EXT-CHG-AH                   VALUE '2'.
   867           88  CP-EXT-CHG-LF-AH                VALUE '3'.
   868         16  CP-DOMICILE-STATE     PIC XX.
   869         16  CP-CARRIER            PIC X.
   870         16  CP-REIN-FLAG          PIC X.
   871         16  CP-REM-TRM-CALC-OPTION PIC X.
   872           88  VALID-REM-TRM-CALC-OPTION    VALUE '1'
   873                      '2' '3' '4' '5'.
   874           88  CP-CALC-OPTION-DEFAULT       VALUE '4'.
   875           88  CP-CONSIDER-EXTENSION        VALUE '3' '4' '5'.
   876           88  CP-30-DAY-MONTH              VALUE '1' '3' '5'.
   877           88  CP-NO-EXT-30-DAY-MONTH       VALUE '1'.
   878           88  CP-NO-EXT-ACTUAL-DAYS        VALUE '2'.
   879           88  CP-EXT-30-DAY-MONTH          VALUE '3'.
   880           88  CP-EXT-ACTUAL-DAYS           VALUE '4'.
   881           88  CP-USE-EXP-AND-1ST-PMT       VALUE '5'.
   882         16  CP-SIG-SWITCH         PIC X.
   883         16  CP-RATING-METHOD      PIC X.
   884           88  CP-RATE-AS-R78                      VALUE '1' 'R'.
   885           88  CP-RATE-AS-PRORATA                  VALUE '2' 'P'.
   886           88  CP-RATE-AS-CALIF                    VALUE '3' 'C'.
   887           88  CP-RATE-AS-TEXAS                    VALUE '4' 'T'.
   888           88  CP-RATE-AS-FARM-PLAN                VALUE '4' 'T'.
   889           88  CP-RATE-AS-NET-PAY                  VALUE '5' 'N'.
   890           88  CP-RATE-AS-ANTICIPATION             VALUE '6' 'A'.
   891           88  CP-RATE-AS-MEAN                     VALUE '8' 'M'.
   892           88  CP-RATE-AS-REG-BALLOON              VALUE 'B'.
   893         16  CP-SALES-TAX          PIC S9V9999     VALUE  ZEROS
   894                                     COMP-3.
   895         16  CP-BEN-CATEGORY       PIC X.
   896         16  CP-DCC-LF-RATE        PIC S99V9(5) COMP-3 VALUE +0.
   897         16  CP-DCC-ACT-COMM REDEFINES CP-DCC-LF-RATE
   898                                   PIC S99V9(5) COMP-3.
   899         16  CP-DCC-AH-RATE        PIC S99V9(5) COMP-3 VALUE +0.
   900         16  CP-DCC-PMF-COMM REDEFINES CP-DCC-AH-RATE
   901                                   PIC S99V9(5) COMP-3.
   902         16  CP-DAYS-TO-1ST-PMT    PIC S999     COMP-3 VALUE +0.
   903         16  CP-AH-BALLOON-SW      PIC X  VALUE ' '.
   904         16  CP-EXPIRE-DT          PIC XX.
   905         16  CP-LF-CLAIM-CALC-SW   PIC X  VALUE ' '.
   906         16  CP-DDF-HI-FACT        PIC S9V999   COMP-3 VALUE +0.
   907         16  CP-DDF-LO-FACT        PIC S9V999   COMP-3 VALUE +0.
   908         16  CP-DDF-CLP            PIC S9(5)V99 COMP-3 VALUE +0.
   909         16  CP-DDF-SPEC-CALC      PIC X.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  19
* ELRFND.cbl
   910             88  CP-CALC-GROSS-FEE        VALUE 'G'.
   911             88  CP-CALC-CLP              VALUE 'C'.
   912         16  CP-IU-RATE-UP         PIC S9(5)V99   COMP-3 VALUE +0.
   913         16  CP-CANCEL-REASON      PIC X.
   914         16  CP-DDF-ADMIN-FEES     PIC S9(5)V99 COMP-3 VALUE +0.
   915         16  CP-PMT-MODE           PIC X.
   916         16  CP-NO-OF-PMTS         PIC S999 COMP-3 VALUE +0.
   917         16  CP-1ST-YR-ALLOW       PIC S999V99 COMP-3 VALUE +0.
   918         16  CP-DDF-COMM-AND-MFEE  PIC S9(5)V99 COMP-3 VALUE +0.
   919         16  CP-DDF-YR1AF          PIC S9(5)V99 COMP-3 VALUE +0.
   920         16  FILLER                PIC X.
   921
   922***************    OUTPUT FROM ELRESV   ************************
   923
   924         16  CP-CDT-TABLE          PIC 9             VALUE ZERO.
   925
   926         16  CP-CDT-FACTOR         PIC S9(5)V9(6)    VALUE ZERO
   927                                     COMP-3.
   928         16  CP-PTC-RESERVE        PIC S9(7)V99   VALUE ZERO
   929                                     COMP-3.
   930         16  CP-IBNR-RESERVE       PIC S9(7)V99   VALUE ZERO
   931                                     COMP-3.
   932         16  CP-FUTURE-RESERVE     PIC S9(7)V99   VALUE ZERO
   933                                     COMP-3.
   934         16  FILLER                PIC X(09).
   935***************    OUTPUT FROM ELRTRM   *************************
   936
   937         16  CP-REMAINING-TERM-1   PIC S9(4)V9    VALUE ZERO
   938                                     COMP-3.
   939         16  CP-REMAINING-TERM-2   PIC S9(4)V9    VALUE ZERO
   940                                     COMP-3.
   941         16  CP-REMAINING-TERM-3   PIC S9(4)V9    VALUE ZERO
   942                                     COMP-3.
   943         16  CP-ODD-DAYS           PIC S9(3)      VALUE ZERO
   944                                     COMP-3.
   945         16  FILLER                PIC X(12).
   946
   947***************    OUTPUT FROM ELRAMT   *************************
   948
   949         16  CP-REMAINING-AMT      PIC S9(9)V99   VALUE ZERO
   950                                     COMP-3.
   951         16  CP-REMAINING-AMT-PRV  PIC S9(9)V99   VALUE ZERO
   952                                     COMP-3.
   953         16  FILLER                PIC X(12).
   954
   955***************    OUTPUT FROM ELRATE   *************************
   956
   957         16  CP-CALC-PREMIUM       PIC S9(7)V99   VALUE ZERO
   958                                     COMP-3.
   959         16  CP-PREMIUM-RATE       PIC S9(2)V9(5) VALUE ZERO
   960                                     COMP-3.
   961         16  CP-MORTALITY-CODE     PIC X(4).
   962         16  CP-RATE-EDIT-FLAG     PIC X.
   963             88  CP-RATES-NEED-APR                  VALUE '1'.
   964         16  CP-COMPOSITE-RATE     PIC S99V999    VALUE ZERO
   965                                     COMP-3.
   966         16  CP-CANCEL-FEE         PIC S9(3)V99 VALUE +0 COMP-3.
   967         16  CP-LF-PREM            PIC S9(7)V99 VALUE +0 COMP-3.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  20
* ELRFND.cbl
   968         16  CP-LF-BALLOON-PREM REDEFINES CP-LF-PREM
   969                                   PIC S9(7)V99 COMP-3.
   970         16  FILLER                PIC X(07).
   971
   972***************    OUTPUT FROM ELRFND   *************************
   973
   974         16  CP-CALC-REFUND        PIC S9(7)V99   VALUE ZERO
   975                                     COMP-3.
   976         16  CP-REFUND-TYPE-USED   PIC X.
   977           88  CP-R-AS-R78                         VALUE '1'.
   978           88  CP-R-AS-PRORATA                     VALUE '2'.
   979           88  CP-R-AS-CALIF                       VALUE '3'.
   980           88  CP-R-AS-TEXAS                       VALUE '4'.
   981           88  CP-R-AS-FARM-PLAN                   VALUE '4'.
   982           88  CP-R-AS-NET-PAY                     VALUE '5'.
   983           88  CP-R-AS-ANTICIPATION                VALUE '6'.
   984           88  CP-R-AS-MEAN                        VALUE '8'.
   985           88  CP-R-AS-SUM-OF-DIGITS               VALUE '9'.
   986           88  CP-R-AS-GAP-NON-REFUND              VALUE 'G'.
   987           88  CP-R-AS-GAP-ACTUARIAL               VALUE 'S'.
   988           88  CP-R-AS-SPP-DDF                     VALUE 'D'.
   989           88  CP-R-AS-SPP-DDF-IU                  VALUE 'I'.
   990           88  CP-R-AS-REPOSSESSION                VALUE 'R'.
   991         16  FILLER                PIC X(12).
   992
   993***************    OUTPUT FROM ELEARN   *************************
   994
   995         16  CP-R78-U-PRM          PIC S9(7)V99   VALUE ZERO
   996                                     COMP-3.
   997         16  CP-R78-U-PRM-ALT      PIC S9(7)V99   VALUE ZERO
   998                                     COMP-3.
   999         16  CP-PRORATA-U-PRM      PIC S9(7)V99   VALUE ZERO
  1000                                     COMP-3.
  1001         16  CP-PRORATA-U-PRM-ALT  PIC S9(7)V99   VALUE ZERO
  1002                                     COMP-3.
  1003         16  CP-STATE-U-PRM        PIC S9(7)V99   VALUE ZERO
  1004                                     COMP-3.
  1005         16  CP-DOMICILE-U-PRM     PIC S9(7)V99   VALUE ZERO
  1006                                     COMP-3.
  1007         16  CP-EARNING-TYPE-USED  PIC X.
  1008           88  CP-E-AS-SPECIAL                     VALUE 'S'.
  1009           88  CP-E-AS-R78                         VALUE '1'.
  1010           88  CP-E-AS-PRORATA                     VALUE '2'.
  1011           88  CP-E-AS-TEXAS                       VALUE '4'.
  1012           88  CP-E-AS-FARM-PLAN                   VALUE '4'.
  1013           88  CP-E-AS-NET-PAY                     VALUE '5'.
  1014           88  CP-E-AS-ANTICIPATION                VALUE '6'.
  1015           88  CP-E-AS-MEAN                        VALUE '8'.
  1016           88  CP-E-AS-SUM-OF-DIGITS               VALUE '9'.
  1017         16  FILLER                PIC X(12).
  1018
  1019***************    OUTPUT FROM ELPMNT   *************************
  1020
  1021         16  CP-ACTUAL-DAYS        PIC S9(05)     VALUE ZERO
  1022                                     COMP-3.
  1023         16  CP-CLAIM-PAYMENT      PIC S9(7)V99   VALUE ZERO
  1024                                     COMP-3.
  1025         16  FILLER                PIC X(12).
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  21
* ELRFND.cbl
  1026
  1027***************   MISC WORK AREAS    *****************************
  1028         16  CP-TOTAL-PAID         PIC S9(7)V99   VALUE ZERO
  1029                                     COMP-3.
  1030         16  CP-R-MAX-ATT-AGE      PIC S9(3)      VALUE ZERO
  1031                                     COMP-3.
  1032         16  CP-R-MAX-AGE          PIC S9(3)      VALUE ZERO
  1033                                     COMP-3.
  1034         16  CP-R-MAX-TERM         PIC S9(5)      VALUE ZERO
  1035                                     COMP-3.
  1036         16  CP-R-MAX-TOT-BEN      PIC S9(7)V99   VALUE ZERO
  1037                                     COMP-3.
  1038         16  CP-R-MAX-MON-BEN      PIC S9(7)V99   VALUE ZERO
  1039                                     COMP-3.
  1040         16  CP-IO-FUNCTION        PIC X          VALUE SPACE.
  1041             88  OPEN-RATE-FILE                   VALUE 'O'.
  1042             88  CLOSE-RATE-FILE                  VALUE 'C'.
  1043             88  IO-ERROR                         VALUE 'E'.
  1044
  1045         16  CP-FIRST-PAY-DATE     PIC XX.
  1046
  1047         16  CP-JOINT-INDICATOR    PIC X.
  1048
  1049         16  CP-RESERVE-REMAINING-TERM
  1050                                   PIC S9(4)V9    VALUE ZERO
  1051                                     COMP-3.
  1052
  1053         16  CP-INSURED-BIRTH-DT   PIC XX.
  1054
  1055         16  CP-INCURRED-AGE       PIC S9(3)      VALUE ZERO
  1056                                     COMP-3.
  1057
  1058         16  CP-MONTHLY-PAYMENT    PIC S9(5)V99   VALUE ZERO
  1059                                     COMP-3.
  1060
  1061         16  CP-RATING-BENEFIT-AMT PIC S9(9)V99   VALUE ZERO
  1062                                     COMP-3.
  1063
  1064         16  CP-ODD-DAYS-TO-PMT    PIC S9(3)      VALUE ZERO
  1065                                     COMP-3.
  1066
  1067         16  CP-MNTHS-TO-FIRST-PMT PIC S9(3)      VALUE ZERO
  1068                                     COMP-3.
  1069
  1070         16  CP-REMAMT-FACTOR      PIC S9(4)V9(9) VALUE ZEROS
  1071                                     COMP-3.
  1072
  1073         16  CP-FREE-LOOK          PIC S9(3)      VALUE ZERO
  1074                                     COMP-3.
  1075
  1076         16  CP-ROA-REFUND         PIC X          VALUE 'N'.
  1077             88  CP-ROA-PREM-AT-REFUND            VALUE 'Y'.
  1078
  1079         16  CP-NET-BENEFIT-AMT    PIC S9(9)V99   VALUE ZERO
  1080                                     COMP-3.
  1081         16  CP-SCNP-6MO-AMT       PIC S9(9)V99   VALUE ZERO
  1082                                     COMP-3.
  1083         16  CP-MONTH              PIC S999     COMP-3 VALUE +0.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  22
* ELRFND.cbl
  1084         16  cp-extra-periods      pic 9 value zeros.
  1085         16  cp-net-only-state     pic x value spaces.
  1086         16  FILLER                PIC X(13).
  1087******************************************************************
  1088
  1089
  1090****************************************************************
  1091*
  1092* Copyright (c) 2007 by Clerity Solutions, Inc.
  1093* All rights reserved.
  1094*
  1095****************************************************************
  1096 01  DFHEIV.
  1097   02  DFHEIV0               PIC X(35).
  1098   02  DFHEIV1               PIC X(08).
  1099   02  DFHEIV2               PIC X(08).
  1100   02  DFHEIV3               PIC X(08).
  1101   02  DFHEIV4               PIC X(06).
  1102   02  DFHEIV5               PIC X(04).
  1103   02  DFHEIV6               PIC X(04).
  1104   02  DFHEIV7               PIC X(02).
  1105   02  DFHEIV8               PIC X(02).
  1106   02  DFHEIV9               PIC X(01).
  1107   02  DFHEIV10              PIC S9(7) COMP-3.
  1108   02  DFHEIV11              PIC S9(4) COMP SYNC.
  1109   02  DFHEIV12              PIC S9(4) COMP SYNC.
  1110   02  DFHEIV13              PIC S9(4) COMP SYNC.
  1111   02  DFHEIV14              PIC S9(4) COMP SYNC.
  1112   02  DFHEIV15              PIC S9(4) COMP SYNC.
  1113   02  DFHEIV16              PIC S9(9) COMP SYNC.
  1114   02  DFHEIV17              PIC X(04).
  1115   02  DFHEIV18              PIC X(04).
  1116   02  DFHEIV19              PIC X(04).
  1117   02  DFHEIV20              USAGE IS POINTER.
  1118   02  DFHEIV21              USAGE IS POINTER.
  1119   02  DFHEIV22              USAGE IS POINTER.
  1120   02  DFHEIV23              USAGE IS POINTER.
  1121   02  DFHEIV24              USAGE IS POINTER.
  1122   02  DFHEIV25              PIC S9(9) COMP SYNC.
  1123   02  DFHEIV26              PIC S9(9) COMP SYNC.
  1124   02  DFHEIV27              PIC S9(9) COMP SYNC.
  1125   02  DFHEIV28              PIC S9(9) COMP SYNC.
  1126   02  DFHEIV97              PIC S9(7) COMP-3 VALUE ZERO.
  1127   02  DFHEIV98              PIC S9(4) COMP SYNC VALUE ZERO.
  1128   02  FILLER                PIC X(02).
  1129   02  DFHEIV99              PIC X(08) VALUE SPACE.
  1130   02  DFHEIVL0              PIC X(48) VALUE SPACE.
  1131   02  DFHEIVL1              PIC X(48) VALUE SPACE.
  1132   02  DFHEIVL2              PIC X(48) VALUE SPACE.
  1133   02  DFHEIVL3              PIC X(48) VALUE SPACE.
  1134 LINKAGE  SECTION.
  1135*****************************************************************
  1136*                                                               *
  1137* Copyright (c) 2007 by Clerity Solutions, Inc.                 *
  1138* All rights reserved.                                          *
  1139*                                                               *
  1140*****************************************************************
  1141 01  dfheiblk.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  23
* ELRFND.cbl
  1142     02  eibtime          pic s9(7) comp-3.
  1143     02  eibdate          pic s9(7) comp-3.
  1144     02  eibtrnid         pic x(4).
  1145     02  eibtaskn         pic s9(7) comp-3.
  1146     02  eibtrmid         pic x(4).
  1147     02  dfheigdi         pic s9(4) comp.
  1148     02  eibcposn         pic s9(4) comp.
  1149     02  eibcalen         pic s9(4) comp.
  1150     02  eibaid           pic x(1).
  1151     02  eibfiller1       pic x(1).
  1152     02  eibfn            pic x(2).
  1153     02  eibfiller2       pic x(2).
  1154     02  eibrcode         pic x(6).
  1155     02  eibfiller3       pic x(2).
  1156     02  eibds            pic x(8).
  1157     02  eibreqid         pic x(8).
  1158     02  eibrsrce         pic x(8).
  1159     02  eibsync          pic x(1).
  1160     02  eibfree          pic x(1).
  1161     02  eibrecv          pic x(1).
  1162     02  eibsend          pic x(1).
  1163     02  eibatt           pic x(1).
  1164     02  eibeoc           pic x(1).
  1165     02  eibfmh           pic x(1).
  1166     02  eibcompl         pic x(1).
  1167     02  eibsig           pic x(1).
  1168     02  eibconf          pic x(1).
  1169     02  eiberr           pic x(1).
  1170     02  eibrldbk         pic x(1).
  1171     02  eiberrcd         pic x(4).
  1172     02  eibsynrb         pic x(1).
  1173     02  eibnodat         pic x(1).
  1174     02  eibfiller5       pic x(2).
  1175     02  eibresp          pic 9(09) comp.
  1176     02  eibresp2         pic 9(09) comp.
  1177     02  dfheigdj         pic s9(4) comp.
  1178     02  dfheigdk         pic s9(4) comp.
  1179 01  DFHCOMMAREA                PIC X(450).
  1180
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  24
* ELRFND.cbl
  1182 PROCEDURE DIVISION USING DFHEIBLK DFHCOMMAREA.
  1183 0000-DFHEXIT SECTION.
  1184     MOVE '9#                    $   ' TO DFHEIV0.
  1185     MOVE 'ELRFND' TO DFHEIV1.
  1186     CALL 'kxdfhei1' USING DFHEIV0 DFH-START DFHEIV DFHEIV1.
  1187     MOVE DFHCOMMAREA    TO  CALCULATION-PASS-AREA.
  1188
  1189 000-START-REFUND-CALC.
  1190*                      COPY ELCRFNDP.
  1191****************************************************************
  1192*                                                              *
  1193*                            ELCRFNDP.                         *
  1194*           COPYBOOK REVIEWED FOR YEAR 2000 COMPLIANCE
  1195*                            VMOD=2.028                        *
  1196*                                                              *
  1197****************************************************************.
  1198*                   C H A N G E   L O G
  1199*
  1200* CHANGES ARE MARKED BY THE CHANGE EFFECTIVE DATE.
  1201*-----------------------------------------------------------------
  1202*  CHANGE   CHANGE REQUEST PGMR  DESCRIPTION OF CHANGE
  1203* EFFECTIVE    NUMBER
  1204*-----------------------------------------------------------------
  1205* 042203                   PEMA ADD SPECIAL IN CALC FOR CID
  1206* 033104    2003080800002  PEMA ADD GAP NON REFUNDABLE OPTION
  1207* 042904    2003080800002  PEMA ADD ACTUARIAL EARNING METHOD
  1208* 110609  CR2009092300002  PEMA CHANGE MN REFUNDS
  1209* 000000  CR2008042200001  PEMA ADD 0 APR PROCESSING
  1210* 071910  IR2010062900001  PEMA ADD MN NET BALLOON REFUND CALC
  1211* 101110  CR2010012700001  PEMA ADD DDF REFUND/UEP PROCESSING
  1212* 032612  CR2011110200001  PEMA AHL CHANGES
  1213* 050713  CR2008042200001  PEMA  ADD CODE FOR ZERO APR NET PAY
  1214* 020816  CR2015082500001  PEMA  ADD NEW VPP COMPANY
  1215* 011317  IR2017011000002  PEMA  REMOVE 'CT' HARDCODING
  1216******************************************************************
  1217
  1218     MOVE ZERO                   TO  CP-RETURN-CODE
  1219                                     CP-CALC-REFUND.
  1220     MOVE SPACE                  TO  CP-REFUND-TYPE-USED.
  1221
  1222 0001-GET-CANCEL-TYPE.
  1223     IF CP-CERT-EFF-DT = CP-VALUATION-DT
  1224        MOVE CP-ORIGINAL-PREMIUM TO CP-CALC-REFUND
  1225        GO TO 1999-CALC-REF-AMT-X.
  1226
  1227     IF CP-CANCEL-REASON = 'R'
  1228        IF CP-CALC-CLP
  1229           MOVE CP-ORIGINAL-PREMIUM
  1230                                 TO CP-CALC-REFUND
  1231        ELSE
  1232           COMPUTE CP-CALC-REFUND = CP-ORIGINAL-PREMIUM -
  1233              CP-DDF-ADMIN-FEES
  1234        END-IF
  1235        MOVE 'R'                 TO CP-REFUND-TYPE-USED
  1236        GO TO 1999-CALC-REF-AMT-X
  1237     END-IF
  1238     IF CP-REMAINING-TERM = ZERO   OR
  1239        CP-REMAINING-TERM NEGATIVE
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  25
* ELRFND.cbl
  1240          MOVE ZERO TO CP-CALC-REFUND
  1241          GO TO 1999-CALC-REF-AMT-X.
  1242
  1243     MOVE CP-CERT-EFF-DT     TO DC-BIN-DATE-1.
  1244     MOVE SPACE              TO DC-OPTION-CODE.
  1245     PERFORM 9100-CONVERT-DATE THRU 9100-EXIT.
  1246
  1247     IF DATE-CONVERSION-ERROR
  1248         MOVE '2' TO CP-RETURN-CODE
  1249         GO TO 1999-CALC-REF-AMT-X.
  1250
  1251     IF CP-AH
  1252        GO TO 1030-GET-AH-REFUND.
  1253
  1254********************    LIFE REFUNDS    **************************
  1255
  1256     IF CP-TERM-OR-EXT-DAYS NOT NUMERIC
  1257         MOVE +0                TO CP-TERM-OR-EXT-DAYS.
  1258
  1259     IF CP-LOAN-TERM NOT NUMERIC
  1260         MOVE +0                TO CP-LOAN-TERM.
  1261
  1262     COMPUTE PR-FACTOR = CP-REMAINING-TERM / CP-ORIGINAL-TERM.
  1263
  1264     COMPUTE R78-FACTOR =
  1265            (CP-REMAINING-TERM * (CP-REMAINING-TERM + 1)) /
  1266              (CP-ORIGINAL-TERM * (CP-ORIGINAL-TERM + 1)).
  1267************************************************************
  1268***       ADDED IF CONDITION FOR TESTING PURPOSES.       ***
  1269***---------------------------------------------------------
  1270     IF CP-TRUNCATED-LIFE
  1271        MOVE  CP-LOAN-TERM         TO  WS-RATE-TERM
  1272     ELSE
  1273        MOVE  CP-ORIGINAL-TERM     TO  WS-RATE-TERM.
  1274***
  1275************************************************************
  1276**** THE FOLLOWING IF STATEMENT FOR NCL ONLY SHOULD DO THE
  1277**** FOLLOWING.
  1278****       FOR NC. LIFE..
  1279****  LEVEL LIFE COVERAGES   --- REFUND AS PRO RATA.
  1280****  TRUNCATED NET COVERAGE --- TERM > 60 USE RULE OF ANTIC.
  1281****                             TERM <= 60 USE SUM OF DIGITS.
  1282****  DECREASING COVERAGE    --- EFF DATE > 093081 AND
  1283****                             TERM > 60 USE RULE OF ANTIC
  1284****                             OTHERWISE USE RULE OF 78.
  1285****
  1286****
  1287
  1288     IF (CP-COMPANY-ID = 'NCL') AND
  1289        (CP-STATE-STD-ABBRV = 'NC')
  1290        IF CP-LEVEL-LIFE
  1291           GO TO 1023-REF-PR
  1292        ELSE
  1293        IF CP-EARN-AS-NET-PAY AND
  1294           CP-TRUNCATED-LIFE
  1295           IF CP-ORIGINAL-TERM GREATER THAN 60
  1296              GO TO 1021-ANTICIPATION-REF
  1297           ELSE
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  26
* ELRFND.cbl
  1298              GO TO 1026-REF-R78
  1299        ELSE
  1300        IF CP-REDUCING-LIFE
  1301           IF (DC-GREG-DATE-CYMD  GREATER 19810930 AND
  1302              CP-ORIGINAL-TERM GREATER THAN 60)
  1303              GO TO 1021-ANTICIPATION-REF
  1304           ELSE
  1305              GO TO 1075-SUM-OF-DIGITS.
  1306
  1307****
  1308**** THE FOLLOWING IF STATEMENT FOR CID ONLY SHOULD DO THE
  1309**** FOLLOWING.
  1310****       FOR OH. LIFE..
  1311****  LEVEL LIFE COVERAGES   --- REFUND AS PRO RATA.
  1312****  NET/NET TRUNCATED      --- TERM > 60 USE RULE OF ANTIC.
  1313****  GROSS DECREASING       --- RULE OF 78
  1314****
  1315****
  1316
  1317     IF (CP-COMPANY-ID = 'CID') AND
  1318        (CP-STATE-STD-ABBRV = 'OH') AND
  1319        (CP-CLASS-CODE NOT = 'L ')
  1320        IF CP-LEVEL-LIFE
  1321           GO TO 1023-REF-PR
  1322        ELSE
  1323           IF (CP-ORIGINAL-TERM > 60) OR
  1324              (CP-EARN-AS-NET-PAY)
  1325              GO TO 1028-NET-PAY-REFUND
  1326           ELSE
  1327              GO TO 1026-REF-R78
  1328           END-IF
  1329        END-IF
  1330     END-IF
  1331
  1332**** THE FOLLOWING IF STATEMENT FOR NCL ONLY SHOULD DO THE
  1333**** FOLLOWING.
  1334****       FOR VA. LIFE..
  1335****  LEVEL LIFE COVERAGES   --- REFUND AS PRO RATA.
  1336****           NET COVERAGES --- USE RULE OF ANTIC.
  1337****  DECREASING COVERAGE    --- EFF DATE < 010193 USE R78.
  1338****                         --- EFF DATE > 123194 USE ANTIC.
  1339****                         --- EFF DATE BETWEEN 010193 AND 12319
  1340****                             WITH TERM > 61 USE RULE OF ANTIC
  1341****                             OTHERWISE USE RULE OF 78.
  1342****
  1343****    NOTE... PER NCL WE SHOULD NOT INCLUDE THEM IN ANY
  1344****            OF THE SYSTEM DEFAULT STATUTORY REFUND RULES.
  1345****            NCL WILL SUPPLY US WITH THE STATUTORY RULES THEY
  1346****            WILL FOLLOW.
  1347****
  1348****
  1349****
  1350
  1351     IF (CP-COMPANY-ID = 'NCL') AND
  1352        (CP-STATE-STD-ABBRV = 'VA')
  1353        IF CP-LEVEL-LIFE
  1354           GO TO 1023-REF-PR
  1355        ELSE
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  27
* ELRFND.cbl
  1356        IF CP-EARN-AS-NET-PAY
  1357           GO TO 1021-ANTICIPATION-REF
  1358        ELSE
  1359        IF CP-REDUCING-LIFE
  1360           IF DC-GREG-DATE-CYMD LESS THAN 19930101
  1361              GO TO 1026-REF-R78
  1362           ELSE
  1363           IF DC-GREG-DATE-CYMD GREATER THAN 19941231
  1364              GO TO 1021-ANTICIPATION-REF
  1365           ELSE
  1366           IF CP-ORIGINAL-TERM GREATER THAN 61
  1367              GO TO 1021-ANTICIPATION-REF
  1368           ELSE
  1369              GO TO 1026-REF-R78.
  1370
  1371     IF (CP-COMPANY-ID = 'CID')
  1372        AND (CP-STATE-STD-ABBRV = 'IN')
  1373        AND (DC-GREG-DATE-CYMD < 20030401)
  1374        IF CP-REDUCING-LIFE
  1375           GO TO 1026-REF-R78
  1376        ELSE
  1377           IF CP-LEVEL-LIFE
  1378              GO TO 1023-REF-PR
  1379           END-IF
  1380        END-IF
  1381     END-IF
  1382
  1383     IF (CP-COMPANY-ID = 'CID')
  1384        AND (CP-STATE-STD-ABBRV = 'FL')
  1385        AND (DC-GREG-DATE-CYMD > 20030630)
  1386        IF CP-RATE-AS-NET-PAY
  1387           GO TO 1028-NET-PAY-REFUND
  1388        END-IF
  1389     END-IF
  1390
  1391     IF (CP-COMPANY-ID = 'CID')
  1392        AND (CP-STATE-STD-ABBRV = 'MN')
  1393        AND (CP-EARN-AS-NET-PAY)
  1394        AND (CP-RATE-AS-REG-BALLOON)
  1395        AND (DC-GREG-DATE-CYMD > 20091231)
  1396        GO TO 1028-NET-PAY-REFUND
  1397     END-IF
  1398     IF (CP-COMPANY-ID = 'CID')
  1399        AND (CP-STATE-STD-ABBRV = 'MN')
  1400        AND (DC-GREG-DATE-CYMD > 20091231)
  1401        AND (CP-RATE-AS-NET-PAY)
  1402        GO TO 1021-ANTICIPATION-REF
  1403     END-IF
  1404     IF (CP-COMPANY-ID = 'CID')
  1405        AND (CP-STATE-STD-ABBRV = 'MO')
  1406        AND (DC-GREG-DATE-CYMD > 20030630)
  1407        AND (CP-LOAN-TERM < +121)
  1408        IF CP-RATE-AS-NET-PAY
  1409           GO TO 1028-NET-PAY-REFUND
  1410        END-IF
  1411     END-IF
  1412
  1413     IF (CP-COMPANY-ID = 'CID')
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  28
* ELRFND.cbl
  1414        AND (CP-STATE-STD-ABBRV = 'ND')
  1415        AND (DC-GREG-DATE-CYMD > 20011231)
  1416        AND (CP-REDUCING-LIFE)
  1417        GO TO 1021-ANTICIPATION-REF
  1418     END-IF
  1419
  1420     IF CP-CRITICAL-PERIOD
  1421        IF CP-COMPANY-ID = 'NCL'
  1422           NEXT SENTENCE
  1423        ELSE
  1424           GO TO 1022-REF-CRITICAL-PERIOD-LF.
  1425
  1426     IF CP-TERM-IS-DAYS  AND
  1427        CP-TERM-OR-EXT-DAYS GREATER ZERO
  1428         GO TO 1024-REF-PR-DAYS.
  1429
  1430     IF CP-STATE-STD-ABBRV = 'NM'
  1431       IF CP-REDUCING-LIFE
  1432*        IF DC-GREG-DATE-1-YMD LESS THAN '980901'
  1433         IF DC-GREG-DATE-CYMD LESS THAN 19980901
  1434             GO TO 1026-REF-R78.
  1435
  1436     IF CP-EARN-ANTICIPATION
  1437         GO TO 1021-ANTICIPATION-REF.
  1438
  1439     IF CP-STATE-STD-ABBRV = 'ME'
  1440         IF CP-COMPANY-ID = 'NCL' OR 'CVL'
  1441            NEXT SENTENCE
  1442         ELSE
  1443            IF CP-REDUCING-LIFE
  1444               GO TO 1021-ANTICIPATION-REF.
  1445
  1446     IF CP-COMPANY-ID EQUAL 'CID' OR 'CSO'
  1447        IF CP-STATE-STD-ABBRV = 'TX'
  1448            GO TO SKIP-CSO-TEXAS-LIFE-PROCESSING
  1449        END-IF
  1450     END-IF.
  1451
  1452     IF CP-STATE-STD-ABBRV = 'TX'
  1453       IF CP-COMPANY-ID EQUAL 'HER' OR 'NCL'
  1454          NEXT SENTENCE
  1455       END-IF
  1456        IF DC-GREG-DATE-CYMD GREATER 19920629  AND
  1457           CP-ORIGINAL-TERM NOT GREATER THAN 120
  1458           GO TO 1021-ANTICIPATION-REF.
  1459
  1460 SKIP-CSO-TEXAS-LIFE-PROCESSING.
  1461
  1462     IF CP-EARN-BY-PRORATA
  1463         GO TO 1023-REF-PR.
  1464
  1465     IF CP-EARN-AS-MEAN
  1466         GO TO 1025-REF-MEAN.
  1467
  1468     IF CP-EARN-AS-TEXAS
  1469         GO TO 1027-TEXAS-REFUND.
  1470
  1471     IF CP-EARN-AS-NET-PAY
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  29
* ELRFND.cbl
  1472         GO TO 1028-NET-PAY-REFUND.
  1473
  1474     IF CP-LIFE-OVERRIDE-CODE NOT = 'L'
  1475         GO TO 1000-NO-NET-PAY.
  1476
  1477     IF  CP-COMPANY-ID IS EQUAL TO 'CID' OR 'CSO'
  1478       IF CP-STATE-STD-ABBRV = 'NC'
  1479         IF CP-REDUCING-LIFE
  1480           IF CP-ORIGINAL-TERM GREATER 60  AND
  1481              DC-GREG-DATE-CYMD GREATER 19810930
  1482                GO TO 1028-NET-PAY-REFUND
  1483           ELSE
  1484              GO TO 1026-REF-R78.
  1485
  1486
  1487     IF CP-STATE-STD-ABBRV = 'NC'
  1488       IF CP-COMPANY-ID EQUAL 'NCL'
  1489          NEXT SENTENCE
  1490       END-IF
  1491       IF CP-REDUCING-LIFE
  1492         IF CP-ORIGINAL-TERM GREATER 60  AND
  1493            DC-GREG-DATE-CYMD GREATER 19810930
  1494             GO TO 1021-ANTICIPATION-REF
  1495         ELSE
  1496             GO TO 1026-REF-R78.
  1497
  1498     IF CP-STATE-STD-ABBRV = 'UT'
  1499       IF CP-COMPANY-ID EQUAL 'NCL'
  1500          NEXT SENTENCE
  1501       END-IF
  1502         IF CP-ORIGINAL-TERM GREATER 62         AND
  1503            CP-LOAN-APR GREATER ZERO            AND
  1504            DC-GREG-DATE-CYMD GREATER 19810831 AND
  1505            DC-GREG-DATE-CYMD LESS    19830901
  1506             GO TO 1028-NET-PAY-REFUND
  1507         ELSE
  1508             GO TO 1026-REF-R78.
  1509
  1510     IF CP-STATE-STD-ABBRV = 'OH'
  1511       IF CP-COMPANY-ID EQUAL 'NCL' OR 'HER'
  1512          NEXT SENTENCE
  1513       END-IF
  1514           IF CP-ORIGINAL-TERM GREATER 60         AND
  1515              CP-CLASS-CODE NOT = 'L '            AND
  1516              CP-LOAN-APR GREATER ZERO            AND
  1517              DC-GREG-DATE-CYMD GREATER 19831031
  1518              GO TO 1028-NET-PAY-REFUND
  1519           ELSE
  1520              GO TO 1026-REF-R78.
  1521
  1522     IF CP-COMPANY-ID EQUAL 'CID' OR 'CSO'
  1523       IF CP-STATE-STD-ABBRV = 'MT'
  1524         GO TO SKIP-CSO-MT-LF-PROCESSING.
  1525
  1526
  1527     IF CP-STATE-STD-ABBRV = 'MT'
  1528       IF CP-COMPANY-ID EQUAL 'NCL'
  1529          NEXT SENTENCE
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  30
* ELRFND.cbl
  1530       END-IF
  1531         IF CP-ORIGINAL-TERM GREATER 61         AND
  1532            CP-LOAN-APR GREATER ZERO            AND
  1533            DC-GREG-DATE-CYMD GREATER 19830318
  1534             GO TO 1028-NET-PAY-REFUND
  1535         ELSE
  1536             GO TO 1026-REF-R78.
  1537
  1538 SKIP-CSO-MT-LF-PROCESSING.
  1539
  1540     IF CP-STATE-STD-ABBRV = 'RI'
  1541       IF CP-COMPANY-ID EQUAL 'NCL'
  1542          NEXT SENTENCE
  1543       END-IF
  1544         IF CP-ORIGINAL-TERM GREATER 60         AND
  1545            CP-LOAN-APR GREATER ZERO            AND
  1546            DC-GREG-DATE-CYMD GREATER 19831231
  1547             GO TO 1028-NET-PAY-REFUND
  1548         ELSE
  1549             GO TO 1026-REF-R78.
  1550
  1551
  1552 1000-NO-NET-PAY.
  1553
  1554     IF CP-STATE-STD-ABBRV = 'WY'
  1555       IF CP-COMPANY-ID EQUAL 'NCL'
  1556          NEXT SENTENCE
  1557       END-IF
  1558        IF CP-COMPANY-ID = 'TMS'
  1559           GO TO 1026-REF-R78
  1560        ELSE
  1561           GO TO 1023-REF-PR.
  1562
  1563     IF CP-EARN-BY-R78
  1564         GO TO 1026-REF-R78.
  1565
  1566     IF CP-EARN-AS-SUM-OF-DIGITS
  1567         GO TO 1075-SUM-OF-DIGITS.
  1568
  1569     IF CP-LEVEL-LIFE
  1570         GO TO 1023-REF-PR
  1571     ELSE
  1572         GO TO 1026-REF-R78.
  1573
  1574*-----------------------------------------------------------------
  1575 1021-ANTICIPATION-REF.
  1576     MOVE '6'                  TO CP-REFUND-TYPE-USED.
  1577
  1578     MOVE CP-LOAN-TERM         TO WS-SAVE-LOAN-TERM.
  1579     IF CP-LOAN-TERM = ZEROS
  1580        MOVE CP-ORIGINAL-TERM TO CP-LOAN-TERM
  1581     END-IF
  1582     COMPUTE CP-LOAN-TERM = CP-LOAN-TERM - CP-ORIGINAL-TERM +
  1583                            CP-REMAINING-TERM.
  1584
  1585     MOVE CP-ORIGINAL-BENEFIT  TO WS-SAVE-BENEFIT.
  1586     MOVE CP-ORIGINAL-TERM     TO WS-SAVE-TERM.
  1587     MOVE CP-EARNING-METHOD    TO WS-SAVE-EARN-METHOD.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  31
* ELRFND.cbl
  1588     move cp-term-or-ext-days  to ws-save-ext-days
  1589
  1590     MOVE CP-REMAINING-BENEFIT TO CP-ORIGINAL-BENEFIT.
  1591     MOVE CP-REMAINING-TERM    TO CP-ORIGINAL-TERM.
  1592     MOVE CP-RATING-METHOD     TO CP-EARNING-METHOD.
  1593
  1594     IF CP-REMAINING-TERM = WS-SAVE-TERM
  1595         MOVE 'N'              TO CP-ROA-REFUND
  1596     ELSE
  1597         MOVE 'Y'              TO CP-ROA-REFUND.
  1598
  1599******    TO COMPUTE PREMIUM AT REFUND DATE
  1600     PERFORM 2500-GET-RATE.
  1601
  1602     MOVE 'N'                  TO CP-ROA-REFUND.
  1603     MOVE WS-SAVE-BENEFIT      TO CP-ORIGINAL-BENEFIT.
  1604     MOVE WS-SAVE-TERM         TO CP-ORIGINAL-TERM.
  1605     MOVE WS-SAVE-LOAN-TERM    TO CP-LOAN-TERM.
  1606     move ws-save-ext-days     to cp-term-or-ext-days
  1607
  1608     IF CP-PREMIUM-RATE = ZEROS
  1609        MOVE '7'                 TO CP-RETURN-CODE
  1610        MOVE WS-SAVE-EARN-METHOD TO CP-EARNING-METHOD
  1611        GO TO 1999-CALC-REF-AMT-X.
  1612
  1613     MOVE CP-CALC-PREMIUM         TO WS-REMAIN-PREM.
  1614
  1615******    TO COMPUTE PREMIUM AT ORIGINAL ISSUE DATE
  1616     PERFORM 2500-GET-RATE.
  1617
  1618     MOVE WS-SAVE-EARN-METHOD     TO CP-EARNING-METHOD.
  1619
  1620     IF CP-PREMIUM-RATE = ZEROS
  1621        MOVE '7'            TO CP-RETURN-CODE
  1622        GO TO 1999-CALC-REF-AMT-X.
  1623
  1624     MOVE CP-CALC-PREMIUM         TO WS-ORIG-PREM.
  1625
  1626     IF  WS-ORIG-PREM = ZEROS
  1627         MOVE ZEROS TO WS-NP-REF-FACTOR
  1628        ELSE
  1629         COMPUTE WS-NP-REF-FACTOR ROUNDED = WS-REMAIN-PREM /
  1630                                            WS-ORIG-PREM.
  1631
  1632     COMPUTE CP-CALC-REFUND ROUNDED = WS-NP-REF-FACTOR *
  1633                                        CP-ORIGINAL-PREMIUM.
  1634
  1635     GO TO 1999-CALC-REF-AMT-X.
  1636
  1637*---------------------------------------------------------------
  1638 1022-REF-CRITICAL-PERIOD-LF.
  1639     GO TO 1023-REF-PR.
  1640
  1641*---------------------------------------------------------------
  1642 1023-REF-PR.
  1643     MOVE '2'               TO CP-REFUND-TYPE-USED.
  1644     COMPUTE CP-CALC-REFUND ROUNDED =
  1645            CP-ORIGINAL-PREMIUM * PR-FACTOR.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  32
* ELRFND.cbl
  1646
  1647     GO TO 1999-CALC-REF-AMT-X.
  1648
  1649*---------------------------------------------------------------
  1650 1024-REF-PR-DAYS.
  1651     MOVE CP-CERT-EFF-DT     TO DC-BIN-DATE-1.
  1652     MOVE CP-VALUATION-DT    TO DC-BIN-DATE-2.
  1653     MOVE '1'                TO DC-OPTION-CODE.
  1654     PERFORM 9100-CONVERT-DATE THRU 9100-EXIT.
  1655
  1656     IF DATE-CONVERSION-ERROR
  1657         MOVE '2' TO CP-RETURN-CODE
  1658         GO TO 1999-CALC-REF-AMT-X.
  1659
  1660     COMPUTE CP-CALC-REFUND ROUNDED =
  1661         (CP-ORIGINAL-PREMIUM / CP-TERM-OR-EXT-DAYS) *
  1662                 (CP-TERM-OR-EXT-DAYS - DC-ELAPSED-DAYS).
  1663
  1664     GO TO 1999-CALC-REF-AMT-X.
  1665
  1666*---------------------------------------------------------------
  1667 1025-REF-MEAN.
  1668     MOVE '8'               TO CP-REFUND-TYPE-USED.
  1669     COMPUTE CP-CALC-REFUND ROUNDED =
  1670          ((CP-ORIGINAL-PREMIUM * PR-FACTOR) +
  1671           (CP-ORIGINAL-PREMIUM * R78-FACTOR)) * +.5.
  1672
  1673     GO TO 1999-CALC-REF-AMT-X.
  1674
  1675*---------------------------------------------------------------
  1676 1026-REF-R78.
  1677     MOVE '1'               TO CP-REFUND-TYPE-USED.
  1678*    IF CP-TERM-TIMES-TERM
  1679*        COMPUTE R78-FACTOR =
  1680*            (CP-REMAINING-TERM * CP-REMAINING-TERM) /
  1681*               (CP-ORIGINAL-TERM * (CP-ORIGINAL-TERM + 1)).
  1682*
  1683     COMPUTE CP-CALC-REFUND ROUNDED =
  1684        CP-ORIGINAL-PREMIUM * R78-FACTOR.
  1685
  1686     GO TO 1999-CALC-REF-AMT-X.
  1687
  1688*---------------------------------------------------------------
  1689 1027-TEXAS-REFUND.
  1690     MOVE '4'               TO CP-REFUND-TYPE-USED.
  1691     IF CP-PAY-FREQUENCY = ZERO
  1692        MOVE ZERO TO CP-CALC-REFUND
  1693        MOVE '5'  TO CP-RETURN-CODE
  1694        GO TO 1999-CALC-REF-AMT-X.
  1695
  1696     COMPUTE TEX-FACT-4 = (CP-ORIGINAL-TERM * CP-ORIGINAL-TERM) +
  1697         (CP-PAY-FREQUENCY * CP-ORIGINAL-TERM).
  1698
  1699     DIVIDE CP-REMAINING-TERM BY CP-PAY-FREQUENCY
  1700         GIVING TEX-FACT-5
  1701             REMAINDER TEX-FACT-6.
  1702
  1703     COMPUTE TEX-FACT-5 = TEX-FACT-5 * CP-PAY-FREQUENCY.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  33
* ELRFND.cbl
  1704
  1705     COMPUTE TEX-FACT-7 = (TEX-FACT-5 * TEX-FACT-5) +
  1706         (TEX-FACT-5 * CP-PAY-FREQUENCY) +
  1707         (2 * (TEX-FACT-6 * (TEX-FACT-5 + CP-PAY-FREQUENCY))).
  1708
  1709     COMPUTE TEX-FACT-8 ROUNDED = TEX-FACT-7 / TEX-FACT-4.
  1710
  1711     COMPUTE CP-CALC-REFUND ROUNDED = CP-ORIGINAL-PREMIUM
  1712                                        * TEX-FACT-8.
  1713
  1714     GO TO 1999-CALC-REF-AMT-X.
  1715
  1716*---------------------------------------------------------------
  1717 1028-NET-PAY-REFUND.
  1718     MOVE '5'               TO CP-REFUND-TYPE-USED.
  1719     IF CP-LOAN-APR = ZERO
  1720        move '1'                 to cp-refund-type-used
  1721        compute cp-calc-refund rounded =
  1722           cp-original-premium * r78-factor
  1723        go to 1999-calc-ref-amt-x
  1724     end-if
  1725*       MOVE ZERO TO CP-CALC-REFUND
  1726*       MOVE '1'  TO CP-RETURN-CODE
  1727*       GO TO 1999-CALC-REF-AMT-X.
  1728
  1729     MOVE CP-LOAN-APR           TO N-P-APR.
  1730     MOVE CP-ORIGINAL-TERM      TO N-P-ORIG  N-P-LOAN.
  1731     MOVE CP-REMAINING-TERM     TO N-P-REM.
  1732
  1733     IF CP-TRUNCATED-LIFE
  1734        MOVE CP-LOAN-TERM     TO N-P-LOAN.
  1735
  1736     MOVE 'R'                   TO N-P-OPT.
  1737
  1738     PERFORM 10000-NET-TERM THRU 99999-EXIT.
  1739
  1740     COMPUTE CP-CALC-REFUND ROUNDED = N-P-FACTOR *
  1741                                        CP-ORIGINAL-PREMIUM.
  1742
  1743 1029-UTAH-REFUND.
  1744*
  1745*---------------------------------------------------------------
  1746* FOLLOWING IS FOR TRISH - 10/26/98  (FOR UTAH ONLY).
  1747*---------------------------------------------------------------
  1748*
  1749     GO TO 1999-CALC-REF-AMT-X.
  1750*
  1751*---------------------------------------------------------------
  1752     IF (CP-STATE-STD-ABBRV NOT = 'UT')
  1753                      OR
  1754        (CP-COMPANY-ID EQUAL 'NCL')
  1755         GO TO 1999-CALC-REF-AMT-X.
  1756     MOVE '3'               TO CP-REFUND-TYPE-USED.
  1757
  1758     IF (CP-ORIGINAL-TERM - CP-REMAINING-TERM)
  1759        GREATER ZERO AND LESS 13
  1760         COMPUTE CP-CALC-REFUND = CP-CALC-REFUND -
  1761                 (CP-CALC-REFUND * .05).
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  34
* ELRFND.cbl
  1762
  1763     IF (CP-ORIGINAL-TERM - CP-REMAINING-TERM)
  1764        GREATER 12 AND LESS 25
  1765         COMPUTE CP-CALC-REFUND = CP-CALC-REFUND -
  1766                 (CP-CALC-REFUND * .025).
  1767
  1768     GO TO 1999-CALC-REF-AMT-X.
  1769*---------------------------------------------------------------
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  35
* ELRFND.cbl
  1771*---------------------------------------------------------------
  1772 1030-GET-AH-REFUND.
  1773     COMPUTE PR-FACTOR = CP-REMAINING-TERM / CP-ORIGINAL-TERM.
  1774
  1775     COMPUTE R78-FACTOR =
  1776            ((CP-REMAINING-TERM * (CP-REMAINING-TERM + 1)) /
  1777                (CP-ORIGINAL-TERM * (CP-ORIGINAL-TERM + 1))).
  1778
  1779*    IF CP-TERM-TIMES-TERM
  1780*        COMPUTE R78-FACTOR =
  1781*            (CP-REMAINING-TERM * CP-REMAINING-TERM) /
  1782*            (CP-ORIGINAL-TERM * (CP-ORIGINAL-TERM + 1)).
  1783*
  1784
  1785**** THE FOLLOWING IF STATEMENT FOR NCL ONLY SHOULD DO THE
  1786**** FOLLOWING.
  1787****       FOR VA. DISABILITY
  1788****                         --- EFF DATE > 123192 AND
  1789****                             TERM > 61 USE RULE OF ANTIC
  1790****                             OTHERWISE USE RULE OF 78.
  1791****
  1792****    NOTE... PER NCL WE SHOULD NOT INCLUDE THEM IN ANY
  1793****            OF THE SYSTEM DEFAULT STATUTORY REFUND RULES.
  1794****            NCL WILL SUPPLY US WITH THE STATUTORY RULES THEY
  1795****            WILL FOLLOW.
  1796****
  1797****
  1798****
  1799     IF CP-COMPANY-ID = 'NCL' or 'AHL'
  1800        IF CP-STATE-STD-ABBRV = 'VA'
  1801           IF (DC-GREG-DATE-CYMD GREATER 19921231) AND
  1802              (CP-ORIGINAL-TERM GREATER THAN 61)
  1803               MOVE '6'        TO CP-EARNING-METHOD
  1804               GO TO 1060-ANTICIPATION-REF
  1805            ELSE
  1806               MOVE '1'        TO CP-EARNING-METHOD
  1807               GO TO 1050-R78-REF.
  1808
  1809     IF CP-STATE-STD-ABBRV = 'WY'
  1810        IF CP-COMPANY-ID = 'TMS'
  1811           GO TO 1050-R78-REF.
  1812
  1813     IF CP-COMPANY-ID = 'NCL' OR 'WDS' OR 'CID' OR 'DCC'
  1814                     OR 'AHL' OR 'VPP'
  1815         NEXT SENTENCE
  1816     ELSE
  1817         IF CP-CRITICAL-PERIOD
  1818             GO TO 1035-REF-AH-CRITICAL-PERIOD.
  1819
  1820*      THE FOLLOWING HAPPENS WHEN THE REFUND METHOD FOR THE
  1821*    BENEFIT CODE IS A NON REFUNDABLE METHOD
  1822*    I AM CHECKING THE TERM AND REM TERM BECAUSE OF THE 30
  1823*    DAY FREE LOOK PERIOD. ALSO, 55 AND 56 ARE THE BIU CODES
  1824     IF (CP-GAP-NON-REFUNDABLE)
  1825        IF (CP-ORIGINAL-TERM NOT = CP-REMAINING-TERM)
  1826           OR (CP-BENEFIT-CD = '55' OR '56')
  1827           MOVE ZEROS            TO CP-CALC-REFUND
  1828           MOVE 'G'              TO CP-REFUND-TYPE-USED
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  36
* ELRFND.cbl
  1829           GO TO 1999-CALC-REF-AMT-X
  1830        END-IF
  1831     END-IF
  1832     IF CP-GAP-ACTUARIAL
  1833         GO TO 1070-NET-PAY-REFUND
  1834     END-IF
  1835     IF (CP-COMPANY-ID = 'CID')
  1836        AND (CP-STATE-STD-ABBRV = 'MN')
  1837        AND (DC-GREG-DATE-CYMD > 20091231)
  1838        IF (CP-CRITICAL-PERIOD)
  1839           GO TO 1040-PR-REF
  1840        ELSE
  1841           GO TO 1055-MEAN-REF
  1842     END-IF
  1843     IF CP-COMPANY-ID EQUAL 'CID' OR 'DCC' OR 'VPP'
  1844        IF CP-STATE-STD-ABBRV = 'NC'
  1845           GO TO SKIP-CSO-NC-AH-PROCESSING.
  1846
  1847     IF (CP-COMPANY-ID = 'CID')
  1848        AND (CP-STATE-STD-ABBRV = 'IN')
  1849        AND (DC-GREG-DATE-CYMD < 20030401)
  1850        GO TO 1026-REF-R78
  1851     END-IF
  1852
  1853     IF (CP-COMPANY-ID = 'CID')
  1854        AND (CP-STATE-STD-ABBRV = 'FL')
  1855        AND (DC-GREG-DATE-CYMD > 20030630)
  1856        AND (CP-CRITICAL-PERIOD)
  1857        GO TO 1040-PR-REF
  1858     END-IF
  1859
  1860     IF (CP-COMPANY-ID = 'CID')
  1861        AND (CP-STATE-STD-ABBRV = 'MO')
  1862        AND (DC-GREG-DATE-CYMD > 20030630)
  1863        AND (CP-CRITICAL-PERIOD)
  1864        GO TO 1040-PR-REF
  1865     END-IF
  1866
  1867     IF (CP-COMPANY-ID = 'CID')
  1868        AND (CP-STATE-STD-ABBRV = 'ND')
  1869        AND (CP-CRITICAL-PERIOD)
  1870        AND (DC-GREG-DATE-CYMD > 20011231)
  1871        GO TO 1040-PR-REF
  1872     END-IF
  1873
  1874     IF (CP-COMPANY-ID = 'CID')
  1875        AND (CP-STATE-STD-ABBRV = 'ND')
  1876        AND (DC-GREG-DATE-CYMD > 20011231)
  1877        GO TO 1060-ANTICIPATION-REF
  1878     END-IF
  1879
  1880     IF CP-STATE-STD-ABBRV = 'NC'
  1881       IF CP-COMPANY-ID = 'NCL' OR 'NCB'
  1882          NEXT SENTENCE
  1883       END-IF
  1884         IF DC-GREG-DATE-CYMD GREATER 19810930
  1885            IF CP-EARN-ANTICIPATION
  1886                GO TO 1060-ANTICIPATION-REF
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  37
* ELRFND.cbl
  1887            ELSE
  1888                GO TO 1055-MEAN-REF.
  1889
  1890 SKIP-CSO-NC-AH-PROCESSING.
  1891
  1892     IF CP-STATE-STD-ABBRV = 'NM'
  1893       IF CP-COMPANY-ID = 'NCL' OR 'DCC' OR 'AHL' OR 'VPP'
  1894          NEXT SENTENCE
  1895       END-IF
  1896         IF DC-GREG-DATE-CYMD GREATER THAN 19871231
  1897            IF CP-COMPANY-ID = 'MON'
  1898              MOVE '6'             TO CP-EARNING-METHOD
  1899              GO TO 1060-ANTICIPATION-REF
  1900             ELSE
  1901              GO TO 1055-MEAN-REF.
  1902
  1903*    IF CP-STATE-STD-ABBRV = 'CT'
  1904*      IF CP-COMPANY-ID EQUAL 'NCL' OR 'DCC' OR 'VPP'
  1905*         NEXT SENTENCE
  1906*      END-IF
  1907*         MOVE '6'              TO CP-EARNING-METHOD
  1908*         GO TO 1060-ANTICIPATION-REF.
  1909
  1910     IF CP-STATE-STD-ABBRV = 'ME'
  1911       IF CP-COMPANY-ID = 'NCL' OR 'CVL' OR 'DCC' OR 'VPP'
  1912          NEXT SENTENCE
  1913       END-IF
  1914           IF CP-EARN-BY-PRORATA
  1915              GO TO 1040-PR-REF
  1916           ELSE
  1917              MOVE '6'           TO CP-EARNING-METHOD
  1918              GO TO 1060-ANTICIPATION-REF.
  1919
  1920
  1921     IF CP-COMPANY-ID = 'CID' OR 'DCC' OR 'VPP'
  1922        IF CP-STATE-STD-ABBRV = 'TX' OR 'VA'
  1923            GO TO SKIP-CSO-TX-VA-AH-PROCESSING.
  1924
  1925     IF CP-STATE-STD-ABBRV = 'TX'
  1926       IF CP-COMPANY-ID = 'NCL' OR 'HER'
  1927          NEXT SENTENCE
  1928       END-IF
  1929        IF DC-GREG-DATE-CYMD GREATER 19920629  AND
  1930           CP-ORIGINAL-TERM NOT GREATER THAN 120
  1931           MOVE '6'              TO CP-EARNING-METHOD
  1932           GO TO 1060-ANTICIPATION-REF.
  1933
  1934     IF CP-STATE-STD-ABBRV = 'VA'
  1935       IF CP-COMPANY-ID EQUAL 'NCL'
  1936          NEXT SENTENCE
  1937       END-IF
  1938       IF CP-COMPANY-ID = 'NCB'
  1939           MOVE '6'                TO CP-EARNING-METHOD
  1940           GO TO 1060-ANTICIPATION-REF
  1941       ELSE
  1942           IF DC-GREG-DATE-CYMD GREATER 19921231
  1943               IF CP-ORIGINAL-TERM GREATER THAN 61
  1944                   MOVE '6'        TO CP-EARNING-METHOD
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  38
* ELRFND.cbl
  1945                   GO TO 1060-ANTICIPATION-REF
  1946               ELSE
  1947                   MOVE '1'        TO CP-EARNING-METHOD
  1948                   GO TO 1050-R78-REF.
  1949
  1950 SKIP-CSO-TX-VA-AH-PROCESSING.
  1951
  1952     IF CP-EARN-BY-PRORATA
  1953         GO TO 1040-PR-REF.
  1954
  1955     IF CP-EARN-BY-R78
  1956         GO TO 1050-R78-REF.
  1957
  1958     IF CP-EARN-AS-MEAN
  1959        GO TO 1055-MEAN-REF.
  1960
  1961     IF CP-EARN-AS-SUM-OF-DIGITS
  1962         GO TO 1075-SUM-OF-DIGITS.
  1963     IF CP-DCC-SPP-DDF
  1964        GO TO 1080-DCC-DDF-SPECIAL
  1965     END-IF
  1966     IF CP-EARN-AS-CALIF
  1967         GO TO 1060-ANTICIPATION-REF.
  1968
  1969     IF CP-EARN-ANTICIPATION
  1970         GO TO 1060-ANTICIPATION-REF.
  1971
  1972     IF CP-EARN-AS-NET-PAY
  1973         GO TO 1070-NET-PAY-REFUND.
  1974
  1975     GO TO 1050-R78-REF.
  1976
  1977*---------------------------------------------------------------
  1978 1035-REF-AH-CRITICAL-PERIOD.
  1979     IF CP-REMAINING-TERM GREATER +6
  1980        COMPUTE CP-CALC-REFUND ROUNDED =
  1981          CP-ORIGINAL-PREMIUM * (((CP-REMAINING-TERM * +2) - +5) /
  1982                       ((CP-ORIGINAL-TERM * +2) - + 5))
  1983      ELSE
  1984        COMPUTE CP-CALC-REFUND ROUNDED =
  1985          CP-ORIGINAL-PREMIUM * ((CP-REMAINING-TERM *
  1986                                           CP-REMAINING-TERM + 1)
  1987                              /  (+12 * CP-ORIGINAL-TERM) - +30).
  1988
  1989     IF CP-CALC-REFUND LESS ZERO
  1990         MOVE ZERO TO CP-CALC-REFUND.
  1991
  1992     GO TO 1999-CALC-REF-AMT-X.
  1993
  1994*---------------------------------------------------------------
  1995 1040-PR-REF.
  1996     MOVE '2'               TO CP-REFUND-TYPE-USED.
  1997     COMPUTE CP-CALC-REFUND = CP-ORIGINAL-PREMIUM * PR-FACTOR.
  1998
  1999     GO TO 1999-CALC-REF-AMT-X.
  2000
  2001*---------------------------------------------------------------
  2002 1050-R78-REF.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  39
* ELRFND.cbl
  2003     MOVE '1'               TO CP-REFUND-TYPE-USED.
  2004     COMPUTE CP-CALC-REFUND ROUNDED =
  2005           CP-ORIGINAL-PREMIUM * R78-FACTOR.
  2006
  2007     GO TO 1999-CALC-REF-AMT-X.
  2008
  2009*---------------------------------------------------------------
  2010 1055-MEAN-REF.
  2011     MOVE '8'               TO CP-REFUND-TYPE-USED.
  2012     COMPUTE CP-CALC-REFUND ROUNDED =
  2013         ((CP-ORIGINAL-PREMIUM * R78-FACTOR) +
  2014          (CP-ORIGINAL-PREMIUM * PR-FACTOR)) * .5.
  2015
  2016     GO TO 1999-CALC-REF-AMT-X.
  2017
  2018*---------------------------------------------------------------
  2019 1060-ANTICIPATION-REF.
  2020     MOVE '6'               TO CP-REFUND-TYPE-USED.
  2021
  2022     MOVE CP-ORIGINAL-TERM  TO WS-SAVE-TERM.
  2023     MOVE CP-LOAN-TERM      TO WS-SAVE-LOAN-TERM.
  2024     MOVE CP-EARNING-METHOD TO WS-SAVE-EARN-METHOD.
  2025
  2026     MOVE CP-REMAINING-TERM TO CP-ORIGINAL-TERM
  2027                               CP-LOAN-TERM.
  2028     MOVE CP-RATING-METHOD  TO CP-EARNING-METHOD.
  2029
  2030     PERFORM 2500-GET-RATE.
  2031
  2032     MOVE WS-SAVE-TERM      TO CP-ORIGINAL-TERM.
  2033     MOVE WS-SAVE-LOAN-TERM TO CP-LOAN-TERM.
  2034
  2035     IF CP-PREMIUM-RATE = ZEROS
  2036        MOVE '7'                 TO CP-RETURN-CODE
  2037        MOVE WS-SAVE-EARN-METHOD TO CP-EARNING-METHOD
  2038        GO TO 1999-CALC-REF-AMT-X.
  2039
  2040     MOVE CP-CALC-PREMIUM         TO WS-REMAIN-PREM.
  2041
  2042     PERFORM 2500-GET-RATE.
  2043
  2044     MOVE WS-SAVE-EARN-METHOD     TO CP-EARNING-METHOD.
  2045
  2046     IF CP-PREMIUM-RATE = ZEROS
  2047        MOVE '7'            TO CP-RETURN-CODE
  2048        GO TO 1999-CALC-REF-AMT-X.
  2049
  2050     MOVE CP-CALC-PREMIUM         TO WS-ORIG-PREM.
  2051
  2052     IF  WS-ORIG-PREM = ZERO
  2053         MOVE ZERO                TO WS-NP-REF-FACTOR
  2054        ELSE
  2055         COMPUTE WS-NP-REF-FACTOR ROUNDED = WS-REMAIN-PREM /
  2056                                            WS-ORIG-PREM.
  2057
  2058     COMPUTE CP-CALC-REFUND ROUNDED = WS-NP-REF-FACTOR *
  2059                                        CP-ORIGINAL-PREMIUM.
  2060
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  40
* ELRFND.cbl
  2061     IF NOT CP-EARN-AS-CALIF
  2062         GO TO 1999-CALC-REF-AMT-X.
  2063
  2064*---------------------------------------------------------------
  2065 1065-CALIF-REGS.
  2066     MOVE '3'               TO CP-REFUND-TYPE-USED.
  2067     SUBTRACT CP-REMAINING-TERM FROM CP-ORIGINAL-TERM
  2068         GIVING FACTOR-5.
  2069
  2070     IF FACTOR-5 NOT GREATER +6  AND
  2071        CP-CLASS-CODE = 'A '
  2072         GO TO 1050-R78-REF.
  2073
  2074     IF FACTOR-5 = ZERO
  2075         MOVE CP-ORIGINAL-PREMIUM   TO CP-CALC-REFUND
  2076         GO TO 1999-CALC-REF-AMT-X.
  2077
  2078     IF CP-ORIGINAL-TERM LESS +014
  2079         GO TO 1999-CALC-REF-AMT-X.
  2080
  2081     MULTIPLY CP-ORIGINAL-TERM BY CP-ORIGINAL-TERM
  2082                                   GIVING FACTOR-5 ROUNDED.
  2083
  2084     MULTIPLY FACTOR-5 BY +0.0000045573 GIVING FACTOR-1 ROUNDED.
  2085
  2086     MULTIPLY +0.001125 BY CP-ORIGINAL-TERM
  2087                                   GIVING FACTOR-2 ROUNDED.
  2088
  2089     SUBTRACT FACTOR-2 FROM FACTOR-1.
  2090     ADD +0.099375 TO FACTOR-1.
  2091
  2092     SUBTRACT CP-REMAINING-TERM FROM CP-ORIGINAL-TERM
  2093                                   GIVING FACTOR-5 ROUNDED.
  2094
  2095     SUBTRACT +1.00 FROM FACTOR-5.
  2096
  2097     IF CP-ORIGINAL-TERM LESS +049
  2098         SUBTRACT +013 FROM CP-ORIGINAL-TERM
  2099                                   GIVING FACTOR-6 ROUNDED
  2100     ELSE
  2101         MOVE +035 TO FACTOR-6.
  2102
  2103     MOVE +001 TO FACTOR-2.
  2104
  2105     DIVIDE FACTOR-5 BY FACTOR-6 GIVING FACTOR-4 ROUNDED.
  2106     SUBTRACT FACTOR-4 FROM FACTOR-2.
  2107     MULTIPLY FACTOR-1 BY FACTOR-2 GIVING FACTOR-3 ROUNDED.
  2108     MOVE +001 TO FACTOR-2.
  2109     SUBTRACT FACTOR-3 FROM FACTOR-2 GIVING FACTOR-1 ROUNDED.
  2110
  2111     MULTIPLY FACTOR-1 BY CP-CALC-REFUND
  2112         GIVING CAL-RFND ROUNDED.
  2113
  2114     IF CAL-RFND LESS +0.01
  2115         MOVE ZEROS TO CAL-RFND.
  2116
  2117     IF CAL-RFND LESS CP-CALC-REFUND
  2118         MOVE CAL-RFND TO CP-CALC-REFUND.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  41
* ELRFND.cbl
  2119
  2120     GO TO 1999-CALC-REF-AMT-X.
  2121
  2122*-----------------------------------------------------------------
  2123 1070-NET-PAY-REFUND.
  2124     MOVE '5'                    TO  CP-REFUND-TYPE-USED.
  2125     IF CP-LOAN-APR = ZERO
  2126         MOVE ZEROS              TO  CP-CALC-REFUND
  2127         MOVE '1'                TO  CP-RETURN-CODE
  2128         GO TO 1999-CALC-REF-AMT-X.
  2129
  2130     MOVE CP-LOAN-APR            TO  N-P-APR.
  2131     MOVE CP-ORIGINAL-TERM       TO  N-P-ORIG  N-P-LOAN.
  2132     MOVE CP-REMAINING-TERM      TO  N-P-REM.
  2133
  2134     MOVE 'R'                    TO  N-P-OPT.
  2135
  2136     PERFORM 10000-NET-TERM THRU 99999-EXIT.
  2137
  2138     COMPUTE CP-CALC-REFUND ROUNDED = N-P-FACTOR *
  2139                                        CP-ORIGINAL-PREMIUM.
  2140
  2141     GO TO 1999-CALC-REF-AMT-X.
  2142*---------------------------------------------------------------
  2143
  2144 1075-SUM-OF-DIGITS.
  2145
  2146     MOVE '9'               TO CP-REFUND-TYPE-USED.
  2147
  2148     COMPUTE RSUM-REMAINING-TERM =
  2149             CP-LOAN-TERM -
  2150                  (CP-ORIGINAL-TERM - (CP-REMAINING-TERM + 1))
  2151
  2152     COMPUTE RSUM-FACTOR =
  2153        ((RSUM-REMAINING-TERM * (RSUM-REMAINING-TERM + 1)) -
  2154               ((CP-LOAN-TERM - CP-ORIGINAL-TERM)          *
  2155                 (CP-LOAN-TERM - CP-ORIGINAL-TERM + 1)))   /
  2156            ((CP-LOAN-TERM * (CP-LOAN-TERM + 1))           -
  2157               ((CP-LOAN-TERM - CP-ORIGINAL-TERM)          *
  2158                 (CP-LOAN-TERM - CP-ORIGINAL-TERM  + 1))).
  2159
  2160     COMPUTE CP-CALC-REFUND ROUNDED =
  2161           CP-ORIGINAL-PREMIUM * RSUM-FACTOR.
  2162
  2163     GO TO 1999-CALC-REF-AMT-X
  2164     .
  2165 1080-DCC-DDF-SPECIAL.
  2166     COMPUTE CP-MONTH =
  2167        FUNCTION REM(CP-ORIGINAL-TERM - CP-REMAINING-TERM, 12)
  2168*    DISPLAY ' BEGIN ELCRFNDP ************** '
  2169*    DISPLAY ' SPEC       ' CP-DDF-SPEC-CALC
  2170*    DISPLAY ' MONTH      ' CP-MONTH
  2171*    DISPLAY ' ORIG TERM  ' CP-ORIGINAL-TERM
  2172*    DISPLAY ' REM TERM   ' CP-REMAINING-TERM
  2173*    DISPLAY ' ORIG PREM  ' CP-ORIGINAL-PREMIUM
  2174*    DISPLAY ' 1YR EXP AL ' CP-1ST-YR-ALLOW
  2175*    DISPLAY ' HI FACT    ' CP-DDF-HI-FACT
  2176*    DISPLAY ' LO FACT    ' CP-DDF-LO-FACT
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  42
* ELRFND.cbl
  2177*    DISPLAY ' RATE UP    ' CP-IU-RATE-UP
  2178*    DISPLAY ' CLP RAT UP ' CP-CLP-RATE-UP
  2179*    DISPLAY ' EARM METH  ' CP-EARNING-METHOD
  2180*    DISPLAY '   END ELCRFNDP ************** '
  2181     IF CP-MONTH = 0
  2182        MOVE 12                  TO CP-MONTH
  2183     END-IF
  2184     MOVE CP-MONTH               TO WS-MONTH
  2185     MOVE 'D'                    TO CP-REFUND-TYPE-USED
  2186     IF CP-DCC-SPP-DDF-IU
  2187        GO TO 1090-DCC-DDF-IU
  2188     END-IF
  2189     IF CP-CALC-CLP
  2190        GO TO 1085-DCC-DDF-SPECIAL-CLP
  2191     END-IF
  2192     EVALUATE TRUE
  2193        WHEN ((CP-ORIGINAL-TERM - CP-REMAINING-TERM) < 1)
  2194           OR (CP-ORIGINAL-PREMIUM = ZEROS)
  2195           MOVE CP-ORIGINAL-PREMIUM
  2196                                 TO CP-CALC-REFUND
  2197        WHEN (CP-ORIGINAL-TERM - CP-REMAINING-TERM) < 4
  2198           MOVE CP-MONTH         TO WS-MONTH
  2199           PERFORM 1150-UE-GROSS-LT-4
  2200           COMPUTE CP-CALC-REFUND ROUNDED = WS-TEMP-RESULT * 1
  2201        WHEN (CP-ORIGINAL-TERM - CP-REMAINING-TERM) < 13
  2202           MOVE CP-MONTH         TO WS-MONTH
  2203           PERFORM 1160-UE-GROSS-LT-13
  2204           COMPUTE CP-CALC-REFUND ROUNDED = WS-TEMP-RESULT * 1
  2205        WHEN OTHER
  2206           MOVE CP-MONTH         TO WS-MONTH
  2207           PERFORM 1170-UE-GROSS-GT-12
  2208           COMPUTE CP-CALC-REFUND ROUNDED = WS-TEMP-RESULT * 1
  2209     END-EVALUATE
  2210     GO TO 1999-CALC-REF-AMT-X
  2211     .
  2212 1085-DCC-DDF-SPECIAL-CLP.
  2213     EVALUATE TRUE
  2214        WHEN ((CP-ORIGINAL-TERM - CP-REMAINING-TERM) < 1)
  2215           OR (CP-ORIGINAL-PREMIUM = ZEROS)
  2216           MOVE CP-ORIGINAL-PREMIUM
  2217                                 TO CP-CALC-REFUND
  2218        WHEN (CP-ORIGINAL-TERM - CP-REMAINING-TERM) < 4
  2219           MOVE CP-MONTH         TO WS-MONTH
  2220           PERFORM 1100-UE-CLP-LT-4
  2221           COMPUTE CP-CALC-REFUND ROUNDED = WS-TEMP-RESULT * 1
  2222        WHEN (CP-ORIGINAL-TERM - CP-REMAINING-TERM) < 13
  2223           MOVE CP-MONTH         TO WS-MONTH
  2224           PERFORM 1110-UE-CLP-LT-13
  2225           COMPUTE CP-CALC-REFUND ROUNDED = WS-TEMP-RESULT * 1
  2226        WHEN OTHER
  2227           MOVE CP-MONTH         TO WS-MONTH
  2228           PERFORM 1120-UE-CLP-GT-12
  2229           COMPUTE CP-CALC-REFUND ROUNDED = WS-TEMP-RESULT * 1
  2230     END-EVALUATE
  2231     GO TO 1999-CALC-REF-AMT-X
  2232     .
  2233 1090-DCC-DDF-IU.
  2234     MOVE 'I'                    TO CP-REFUND-TYPE-USED
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  43
* ELRFND.cbl
  2235     IF CP-CALC-CLP
  2236        GO TO 1095-DCC-DDF-IU-SPECIAL-CLP
  2237     END-IF
  2238     EVALUATE TRUE
  2239        WHEN ((CP-ORIGINAL-TERM - CP-REMAINING-TERM) < 1)
  2240           OR (CP-ORIGINAL-PREMIUM = ZEROS)
  2241           MOVE CP-ORIGINAL-PREMIUM
  2242                                 TO CP-CALC-REFUND
  2243        WHEN (CP-ORIGINAL-TERM - CP-REMAINING-TERM) < 4
  2244           MOVE CP-MONTH         TO WS-MONTH
  2245           PERFORM 1250-IU-UE-GROSS-LT-4
  2246           COMPUTE CP-CALC-REFUND ROUNDED = WS-TEMP-RESULT * 1
  2247        WHEN (CP-ORIGINAL-TERM - CP-REMAINING-TERM) < 13
  2248           MOVE CP-MONTH         TO WS-MONTH
  2249           PERFORM 1260-IU-UE-GROSS-LT-13
  2250           COMPUTE CP-CALC-REFUND ROUNDED = WS-TEMP-RESULT * 1
  2251        WHEN OTHER
  2252           MOVE CP-MONTH         TO WS-MONTH
  2253           PERFORM 1270-IU-UE-GROSS-GT-12
  2254           COMPUTE CP-CALC-REFUND ROUNDED = WS-TEMP-RESULT * 1
  2255     END-EVALUATE
  2256     GO TO 1999-CALC-REF-AMT-X
  2257     .
  2258 1095-DCC-DDF-IU-SPECIAL-CLP.
  2259     EVALUATE TRUE
  2260        WHEN ((CP-ORIGINAL-TERM - CP-REMAINING-TERM) < 1)
  2261           OR (CP-DDF-CLP = ZEROS)
  2262           MOVE CP-DDF-CLP       TO CP-CALC-REFUND
  2263        WHEN (CP-ORIGINAL-TERM - CP-REMAINING-TERM) < 4
  2264           MOVE CP-MONTH         TO WS-MONTH
  2265           PERFORM 1200-IU-UE-CLP-LT-4
  2266           COMPUTE CP-CALC-REFUND ROUNDED = WS-TEMP-RESULT * 1
  2267        WHEN (CP-ORIGINAL-TERM - CP-REMAINING-TERM) < 13
  2268           MOVE CP-MONTH         TO WS-MONTH
  2269           PERFORM 1210-IU-UE-CLP-LT-13
  2270           COMPUTE CP-CALC-REFUND ROUNDED = WS-TEMP-RESULT * 1
  2271        WHEN OTHER
  2272           MOVE CP-MONTH         TO WS-MONTH
  2273           PERFORM 1220-IU-UE-CLP-GT-12
  2274           COMPUTE CP-CALC-REFUND ROUNDED = WS-TEMP-RESULT * 1
  2275     END-EVALUATE
  2276     GO TO 1999-CALC-REF-AMT-X
  2277     .
  2278 1100-UE-CLP-LT-4.
  2279*****  (CLP-Yr1 Exp)-CLP*{((CLP-Yr1 Exp)/CLP - UEF1)*mo/12}
  2280     COMPUTE WS-TEMP-RESULT ROUNDED = (CP-DDF-CLP - 0)
  2281        - CP-DDF-CLP * (((CP-DDF-CLP - 0)
  2282        / CP-DDF-CLP - CP-DDF-HI-FACT)
  2283        * WS-MONTH / 12)
  2284     .
  2285 1110-UE-CLP-LT-13.
  2286*****  (CLP-Yr1 Exp)-CLP*{((CLP-Yr1 Exp)/CLP - UEF1)*3/12}
  2287*****  -[(CLP-Yr1 Exp)-CLP*{((CLP-Yr1 Exp)/CLP - UEF1)*3/12
  2288*****  -CLP*UEF1}*(mo-3)/9]
  2289     COMPUTE WS-TEMP-RESULT ROUNDED = (CP-DDF-CLP - 0)
  2290        - CP-DDF-CLP * (((CP-DDF-CLP - 0)
  2291        / CP-DDF-CLP - CP-DDF-HI-FACT) * 3 / 12)
  2292        -  ((CP-DDF-CLP - 0) - CP-DDF-CLP
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  44
* ELRFND.cbl
  2293        * (((CP-DDF-CLP - 0) / CP-DDF-CLP
  2294        - CP-DDF-HI-FACT) * 3 / 12) - CP-DDF-CLP
  2295        * CP-DDF-HI-FACT) * (WS-MONTH - 3) / 9
  2296     .
  2297 1120-UE-CLP-GT-12.
  2298*****  CLP * {UEF1 - (UEF1 -UEF2)*mo/12}
  2299     COMPUTE WS-TEMP-RESULT ROUNDED = CP-DDF-CLP *
  2300        (CP-DDF-HI-FACT - (CP-DDF-HI-FACT - CP-DDF-LO-FACT)
  2301        * WS-MONTH / 12)
  2302     .
  2303 1150-UE-GROSS-LT-4.
  2304     COMPUTE CP-1ST-YR-ALLOW = CP-1ST-YR-ALLOW - CP-DDF-YR1AF
  2305     COMPUTE WS-TEMP-RESULT ROUNDED =
  2306        (CP-ORIGINAL-PREMIUM - CP-1ST-YR-ALLOW - CP-DDF-YR1AF
  2307        * WS-MONTH / 3) - (CP-ORIGINAL-PREMIUM -
  2308        CP-1ST-YR-ALLOW - CP-DDF-YR1AF) * (1 - CP-DDF-HI-FACT)
  2309        * WS-MONTH / 12
  2310     .
  2311 1160-UE-GROSS-LT-13.
  2312     MOVE 3                      TO WS-MONTH
  2313     PERFORM 1150-UE-GROSS-LT-4
  2314     COMPUTE WS-GFR3 ROUNDED = WS-TEMP-RESULT * 1
  2315     MOVE CP-MONTH               TO WS-MONTH
  2316     COMPUTE WS-TEMP-RESULT ROUNDED = WS-GFR3 - (WS-GFR3
  2317        - (CP-ORIGINAL-PREMIUM - CP-1ST-YR-ALLOW - CP-DDF-YR1AF)
  2318        * (CP-DDF-HI-FACT)) * ((WS-MONTH - 3) / 9)
  2319     .
  2320 1170-UE-GROSS-GT-12.
  2321*****  (GF-Yr1 Texp) * {UEF1 - (UEF1 -UEF2)*mo/12}
  2322     COMPUTE WS-TEMP-RESULT ROUNDED =
  2323        (CP-ORIGINAL-PREMIUM - CP-1ST-YR-ALLOW)
  2324        * (CP-DDF-HI-FACT - (CP-DDF-HI-FACT
  2325        - CP-DDF-LO-FACT) * WS-MONTH / 12)
  2326     .
  2327 1200-IU-UE-CLP-LT-4.
  2328*****  no changes with < 4  pema 08/03/11
  2329*****  (CLPCounty-Yr1 Exp)-(CLP*(UEF1 - UEF2)*mo/12)
  2330     COMPUTE WS-TEMP-RESULT ROUNDED =
  2331        (CP-DDF-CLP - 0)
  2332        - (CP-DDF-CLP - CP-CLP-RATE-UP)
  2333        * (CP-DDF-HI-FACT - CP-DDF-LO-FACT)
  2334        * WS-MONTH / 12
  2335     .
  2336 1210-IU-UE-CLP-LT-13.
  2337*****  (CLPCounty-Yr1 Exp)-(CLP*(UEF1 - UEF2)*3/12)
  2338*****  -[(CLPCounty-Yr1 Exp)-(CLP*(UEF1 - UEF2)*3/12)
  2339*****  - CLP*UEF1]*(mo-3)/9
  2340     MOVE 3                      TO WS-MONTH
  2341     PERFORM 1200-IU-UE-CLP-LT-4
  2342     COMPUTE WS-UE-CLP ROUNDED = WS-TEMP-RESULT * 1
  2343     MOVE CP-MONTH               TO WS-MONTH
  2344     COMPUTE WS-TEMP-RESULT ROUNDED =
  2345        WS-UE-CLP - (WS-UE-CLP - (CP-DDF-CLP - CP-CLP-RATE-UP)
  2346          * CP-DDF-HI-FACT) * (WS-MONTH - 3) / 9
  2347     .
  2348 1220-IU-UE-CLP-GT-12.
  2349*****  CLP*{UEF1 - (UEF1 -UEF2)*mo/12}
  2350     COMPUTE WS-TEMP-RESULT ROUNDED =
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  45
* ELRFND.cbl
  2351        (CP-DDF-CLP - CP-CLP-RATE-UP)
  2352        * (CP-DDF-HI-FACT - (CP-DDF-HI-FACT
  2353        - CP-DDF-LO-FACT) * WS-MONTH / 12)
  2354     .
  2355 1250-IU-UE-GROSS-LT-4.
  2356*****  (Comm+MngtFee)*UECLPmo/CLPCounty+CLPCounty+AdminFee-
  2357*****  Yr1 AF*(mo/3)-[CLP*(UEF1-UEF2)+(AdminFee-Yr1AF)*
  2358*****  (1-UEF1)]*mo/12
  2359     PERFORM 1200-IU-UE-CLP-LT-4
  2360     COMPUTE WS-UE-CLP ROUNDED = WS-TEMP-RESULT * 1
  2361     COMPUTE WS-TEMP-RESULT = CP-DDF-COMM-AND-MFEE *
  2362        WS-UE-CLP / CP-DDF-CLP + CP-DDF-CLP +
  2363        CP-DDF-CSO-ADMIN-FEE - CP-DDF-YR1AF *
  2364        WS-MONTH / 3 - ((CP-DDF-CLP - CP-CLP-RATE-UP)
  2365        * (CP-DDF-HI-FACT - CP-DDF-LO-FACT)
  2366        + (CP-DDF-CSO-ADMIN-FEE - CP-DDF-YR1AF)
  2367        * (1 - CP-DDF-HI-FACT)) * WS-MONTH / 12
  2368     .
  2369 1260-IU-UE-GROSS-LT-13.
  2370***** uegf3-(uegf3-(gf - 1st yr - clprateu)*hi))*(mo-3)/9
  2371     MOVE 3                      TO WS-MONTH
  2372     PERFORM 1250-IU-UE-GROSS-LT-4
  2373     move cp-month               to ws-month
  2374     COMPUTE WS-GFR3 ROUNDED = WS-TEMP-RESULT * 1
  2375     COMPUTE WS-TEMP-RESULT ROUNDED =
  2376        WS-GFR3 - (WS-GFR3 - ((CP-ORIGINAL-PREMIUM
  2377        - CP-1ST-YR-ALLOW - cp-clp-rate-up))
  2378        * CP-DDF-HI-FACT) * (WS-MONTH - 3) / 9
  2379     .
  2380 1270-IU-UE-GROSS-GT-12.
  2381***** (gf - 1st yr - clprateu)*(hi-(hi-lo)*mo/12)
  2382     COMPUTE WS-TEMP-RESULT ROUNDED =
  2383        (CP-ORIGINAL-PREMIUM - CP-1ST-YR-ALLOW
  2384        - CP-CLP-RATE-UP) *
  2385        (CP-DDF-HI-FACT - (CP-DDF-HI-FACT - CP-DDF-LO-FACT)
  2386        * WS-MONTH / 12)
  2387     .
  2388 1299-END-DDF-CALCS.
  2389     .
  2390 1999-CALC-REF-AMT-X.
  2391
  2392     MOVE CALCULATION-PASS-AREA TO DFHCOMMAREA.
  2393
  2394
  2395* EXEC CICS RETURN
  2396*    END-EXEC.
  2397*    MOVE '.(                    ''   #00002390' TO DFHEIV0
  2398     MOVE X'2E2820202020202020202020' TO DFHEIV0(1:12)
  2399     MOVE X'202020202020202020202720' TO DFHEIV0(13:12)
  2400     MOVE X'2020233030303032333930' TO DFHEIV0(25:11)
  2401     CALL 'kxdfhei1' USING DFHEIV0,
  2402           DFHEIV99,
  2403           DFHEIV99,
  2404           DFHEIV99,
  2405           DFHEIV99,
  2406           DFHEIV99,
  2407           DFHEIV99
  2408     GO TO 9999-DFHEXIT DEPENDING ON DFHEIGDK.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  46
* ELRFND.cbl
  2409
  2410
  2411* GOBACK.
  2412     MOVE '9%                    "   ' TO DFHEIV0
  2413     MOVE 'ELRFND' TO DFHEIV1
  2414     CALL 'kxdfhei1' USING DFHEIV0 DFHEIV1
  2415     GOBACK.
  2416
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  47
* ELRFND.cbl
  2418  2500-GET-RATE.
  2419
  2420* EXEC CICS LINK
  2421*        PROGRAM    ('ELRATE')
  2422*        COMMAREA   (CALCULATION-PASS-AREA)
  2423*        LENGTH     (CP-COMM-LENGTH)
  2424*        END-EXEC.
  2425     MOVE 'ELRATE' TO DFHEIV1
  2426*    MOVE '."C                   (   #00002396' TO DFHEIV0
  2427     MOVE X'2E2243202020202020202020' TO DFHEIV0(1:12)
  2428     MOVE X'202020202020202020202820' TO DFHEIV0(13:12)
  2429     MOVE X'2020233030303032333936' TO DFHEIV0(25:11)
  2430     CALL 'kxdfhei1' USING DFHEIV0,
  2431           DFHEIV1,
  2432           CALCULATION-PASS-AREA,
  2433           CP-COMM-LENGTH,
  2434           DFHEIV99,
  2435           DFHEIV99,
  2436           DFHEIV99,
  2437           DFHEIV99
  2438     GO TO 9999-DFHEXIT DEPENDING ON DFHEIGDK.
  2439
  2440
  2441  2500-EXIT.
  2442       EXIT.
  2443
  2444  9100-CONVERT-DATE.
  2445
  2446* EXEC CICS LINK
  2447*         PROGRAM   ('ELDATCV')
  2448*         COMMAREA  (DATE-CONVERSION-DATA)
  2449*         LENGTH    (DC-COMM-LENGTH)
  2450*    END-EXEC.
  2451     MOVE 'ELDATCV' TO DFHEIV1
  2452*    MOVE '."C                   (   #00002406' TO DFHEIV0
  2453     MOVE X'2E2243202020202020202020' TO DFHEIV0(1:12)
  2454     MOVE X'202020202020202020202820' TO DFHEIV0(13:12)
  2455     MOVE X'2020233030303032343036' TO DFHEIV0(25:11)
  2456     CALL 'kxdfhei1' USING DFHEIV0,
  2457           DFHEIV1,
  2458           DATE-CONVERSION-DATA,
  2459           DC-COMM-LENGTH,
  2460           DFHEIV99,
  2461           DFHEIV99,
  2462           DFHEIV99,
  2463           DFHEIV99
  2464     GO TO 9999-DFHEXIT DEPENDING ON DFHEIGDK.
  2465
  2466
  2467  9100-EXIT.
  2468       EXIT.
  2469
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  48
* ELRFND.cbl
  2471  10000-NET-TERM  SECTION.
  2472*                      COPY ERCNETP.
  2473*****************************************************************
  2474*                                                               *
  2475*                            ERCNETP                            *
  2476*           COPYBOOK REVIEWED FOR YEAR 2000 COMPLIANCE
  2477*                            VMOD=2.029                         *
  2478*                                                               *
  2479*****************************************************************.
  2480*
  2481*    FIVE PARAMETERS ARE PASSED TO THIS MODULE AND A FACTOR IS
  2482*    RETURNED. PARAMETERS PASSED  - A.P.R. (S999V9999)
  2483*                                   ORIGINAL TERM (S999)
  2484*                                   REMAINING TERM (S999)
  2485*                                   NET PAY OPTION (X)
  2486*                                   LOAN TERM (S999)
  2487*              FACTOR RETURNED IS - FACTOR (S9(4)V9(9))
  2488*
  2489*    FACTOR RETURNED IS MULTIPLIED BY ORIG. FACE TO GET REMAINING
  2490*    FACE. IF ORIGNAL TERM = REMAINING TERM, FACTOR WOULD BE 1,
  2491*    THEREFORE MODULE ASSUMES RATING IS DESIRED AND FACTOR THAT
  2492*    IS RETURNED MAY BE MULTIPLIED BY THOUSANDS OF ORIGINAL FACE
  2493*    AND REGULAR PREMIUM PER $100 PER MONTH TO GET PREMIUM TO BE
  2494*    CHARGED.
  2495*
  2496*    OPTIONS - S = NET SIMPLE
  2497*          SPACE = NET PAY  (1 MO. INTEREST)
  2498*              A = NET PAY  (0 MO. INTEREST)
  2499*              I = NET PAY  (2 MO. INTEREST)
  2500*              J = NET PAY  (3 MO. INTEREST)
  2501*              K = NET PAY  (4 MO. INTEREST)
  2502*              T = TRUNCATED  (0 MO. INTEREST)
  2503*              U = TRUNCATED  (1 MO. INTEREST)
  2504*              V = TRUNCATED  (2 MO. INTEREST)
  2505*              W = TRUNCATED  (3 MO. INTEREST)
  2506*              X = TRUNCATED  (4 MO. INTEREST)
  2507*              R = REFUNDS (REGULAR OR TRUNCATED)
  2508******************************************************************
  2509*                   C H A N G E   L O G
  2510*
  2511* CHANGES ARE MARKED BY THE CHANGE EFFECTIVE DATE.
  2512*-----------------------------------------------------------------
  2513*  CHANGE   CHANGE REQUEST PGMR  DESCRIPTION OF CHANGE
  2514* EFFECTIVE    NUMBER
  2515*-----------------------------------------------------------------
  2516* 120202    2001061800003  PEMA  ADD DCC PROCESSING
  2517* 120502                   PEMA  ADD SPECIAL IN CALC FOR CID
  2518* 120403                   PEMA  ADD SPECIAL TX CALC
  2519* 011904                   PEMA  ADD TOTAL FEE PROCESSING
  2520* 033104    2003080800002  PEMA  ADD GAP NON REFUNDABLE OPTION
  2521* 081205                   PEMA  ADD DAYS TO 1ST PMT ON 'S'
  2522* 083105                   PEMA  ADD DAYS TO 1ST PMT ON 'N'
  2523* 011707                   PEMA  ADD SC NP PLUS 6 PMTS
  2524* 021207                   PEMA  ADD PA NP
  2525* 022107                   PEMA  ADD NH NP AND NP TRUNC
  2526* 032807                   PEMA  ADD VT NP PLUS 2
  2527* 091307  IR2007090600001  PEMA  REMOVE LOW APR CHECK
  2528* 110207    2007010300001  PEMA  FIX PROBLEM WHERE DIFF OF LOAN
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  49
* ELRFND.cbl
  2529* 110207      LOAN TERM AND INS TERM IS 1. ALSO ADD TRUNC
  2530* 110207      TO 'AL' NET PAY CALC
  2531* 052808    2008032000002  PEMA  ADD CODE FOR AK NET PAY
  2532* 052808    2008050800003  PEMA  ADD CODE FOR NV NET +2
  2533* 060308  IR2008052800002  PEMA  ADD TNP FOR ME
  2534* 060308  CR2008032700002  PEMA  ADD EXT DAYS FOR ME
  2535* 0600909 CR2008042300002  PEMA  ADD NEW FARM PLAN CALC
  2536* 010410  CR2009092300002  PEMA  ADD MN NET CALC
  2537* 010410  CR2008021200005  PEMA  ADD MN NET BALLOON
  2538* 041310  CR2008021200005  PEMA  ADD CODE FOR MN LEVEL
  2539* 071910  IR2010062900001  PEMA ADD MN NET BALLOON REFUND CALC
  2540* 071211  CR2010012700001  PEMA  ADD SPP DEALER DIRECT
  2541* 092311  IR2011092100001  PEMA  ID 10C MONTHLY
  2542* 032612  CR2011110200001  PEMA  AHL CHANGES
  2543* 111212  CR2012013100001  PEMA  CHANGES FOR MN AND WA
  2544* 022613  CR2011021500001  PEMA  ADD CODE 4 TRUNC BALLOON DCC 10C
  2545* 050713  CR2008042200001  PEMA  ADD CODE FOR ZERO APR
  2546* 030515  IR2015022300001  PEMA  ADD MN AND WA FARMPLAN CODING
  2547* 040615  CR2013072200002  PEMA  ADD EXTRA PERIODS FOR NET BALLOON
  2548* 020816  CR2015082500001  PEMA  ADD NEW VPP COMPANY
  2549******************************************************************
  2550
  2551     MOVE N-P-APR     TO ANNUAL-INT-RATE.
  2552     MOVE N-P-ORIG    TO ORIGINAL-TERM.
  2553     MOVE N-P-LOAN    TO LOAN-TERM.
  2554     MOVE N-P-REM     TO REMAINING-TERM.
  2555     MOVE N-P-OPT     TO OPTION-SW.
  2556
  2557     MOVE +0 TO FACTOR.
  2558     if cp-company-id = 'CID'
  2559        if annual-int-rate = +99.9999
  2560           go to 99000-error
  2561        end-if
  2562     else
  2563        if annual-int-rate = zero
  2564           go to 99000-error
  2565        end-if
  2566     end-if
  2567     IF ORIGINAL-TERM = ZERO
  2568         GO TO 99999-RETURN.
  2569     IF REMAINING-TERM = ZERO
  2570         GO TO 99999-RETURN.
  2571     IF REMAINING-TERM GREATER ORIGINAL-TERM
  2572         GO TO 99000-ERROR.
  2573     IF LOAN-TERM = ZERO
  2574         GO TO 99999-RETURN.
  2575     IF LOAN-TERM LESS ORIGINAL-TERM
  2576         GO TO 99000-ERROR.
  2577
  2578*    IF ANNUAL-INT-RATE LESS +2
  2579*        COMPUTE ANNUAL-INT-RATE = ANNUAL-INT-RATE * +10.
  2580*    IF ANNUAL-INT-RATE LESS +2
  2581*        COMPUTE ANNUAL-INT-RATE = ANNUAL-INT-RATE * +10.
  2582*    IF ANNUAL-INT-RATE LESS +2
  2583*        COMPUTE ANNUAL-INT-RATE = ANNUAL-INT-RATE * +10.
  2584
  2585     IF NPO-REFUND
  2586         MOVE '2' TO NP-PROCESS-SW
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  50
* ELRFND.cbl
  2587       ELSE
  2588         IF ORIGINAL-TERM = REMAINING-TERM
  2589            MOVE '1'   TO NP-PROCESS-SW
  2590           ELSE
  2591            MOVE '3'   TO NP-PROCESS-SW.
  2592
  2593     IF NPO-SIMPLE
  2594         MOVE 'S' TO TYPE-SW
  2595     ELSE
  2596         MOVE 'N' TO TYPE-SW.
  2597
  2598     COMPUTE I ROUNDED = (ANNUAL-INT-RATE / K100) / K12.
  2599     if i = zeros
  2600        move .0000000001         to i
  2601     end-if
  2602
  2603     COMPUTE V ROUNDED = K1 / (K1 + I).
  2604
  2605     MOVE V     TO VX
  2606                   SV.
  2607
  2608     MOVE +1    TO X1
  2609                   SX.
  2610
  2611     MOVE LOAN-TERM TO MAX-X.
  2612
  2613     COMPUTE X2 = MAX-X - ORIGINAL-TERM.
  2614
  2615     IF MAX-X = +1
  2616        GO TO 10700-COMPUTE-REMAINING-FACTOR.
  2617
  2618     COMPUTE EXPIRED-TERM = ORIGINAL-TERM - REMAINING-TERM.
  2619
  2620     IF (CP-COMPANY-ID EQUAL 'CDC' OR 'GTL' OR 'CID' OR 'MON'
  2621         OR 'DCC' or 'VPP' OR 'NCL') AND
  2622        (NOT NP-REFUND)
  2623        NEXT SENTENCE
  2624     ELSE
  2625     IF LOAN-TERM NOT = ORIGINAL-TERM
  2626        COMPUTE REMAINING-TERM = LOAN-TERM - EXPIRED-TERM.
  2627
  2628     COMPUTE SV-MINUS-ONE EQUAL ORIGINAL-TERM - +1.
  2629
  2630 10500-VX-LOOP.
  2631
  2632***  VX = AMORT. LOAN TERM.
  2633***  SV = AMORT. INSURANCE TERM.
  2634***  SV = AMORT. REMAINING TERM FOR REFUND CALCS.
  2635***  SX = AMORT. LOAN TERM - INSURANCE TERM. (USED FOR TRUNCATED.
  2636***  SV-MINUS-ONE = INSURANCE TERM - +1... (TMS ONLY)
  2637
  2638     IF X2 = 1
  2639        MOVE V         TO SX
  2640     END-IF
  2641     COMPUTE VX ROUNDED = VX * V.
  2642
  2643     ADD B1 TO X1.
  2644
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  51
* ELRFND.cbl
  2645     IF X1 = REMAINING-TERM
  2646          MOVE VX    TO SV.
  2647
  2648     IF X1 EQUAL SV-MINUS-ONE
  2649        MOVE VX      TO SV-MINUS-ONE.
  2650
  2651     IF X1 = X2
  2652          MOVE VX    TO SX.
  2653
  2654     IF X1 NOT = MAX-X
  2655          GO TO 10500-VX-LOOP.
  2656
  2657 10700-COMPUTE-REMAINING-FACTOR.
  2658*****  WK1 = LOAN TERM AMORT
  2659     COMPUTE WK1 = K1 - VX.
  2660*****  WK2 = INS TERM AMORT
  2661     COMPUTE WK2 = K1 - SV.
  2662*****  WK5 = LOAN TERM - INS TERM AMORT (TRUNCATED)
  2663     COMPUTE WK5 = K1 - SX.
  2664*****  WK6 = INS TERM - 1
  2665     COMPUTE WK6 = K1 - SV-MINUS-ONE.
  2666
  2667     IF NP-RATING
  2668         GO TO 12000-PREMIUM-RATE.
  2669
  2670     IF NP-REFUND
  2671         GO TO 11000-REFUND-CALC.
  2672
  2673     IF NET-STD
  2674         COMPUTE WK3 ROUNDED = (WK2 * K1000) / WK1.
  2675
  2676     IF NET-SMP
  2677         COMPUTE WK3 ROUNDED = ((R + 1) / (N + 1)) * (R / N)
  2678         COMPUTE WK3 ROUNDED = (1 - WK3) * ((I * N / WK1) - 1)
  2679         COMPUTE WK3 ROUNDED = WK3 + 1 - ((N - R) * I / WK1)
  2680         COMPUTE WK3 ROUNDED = WK3 * 1000.
  2681
  2682     IF REMAINING-TERM LESS THAN X2
  2683         MOVE +0 TO WK3.
  2684
  2685     MOVE WK3 TO FACTOR.
  2686
  2687     GO TO 99999-RETURN.
  2688
  2689 11000-REFUND-CALC.
  2690     IF REMAINING-TERM NOT LESS MAX-X
  2691        MOVE +1 TO FACTOR
  2692        GO TO 99999-RETURN.
  2693
  2694     IF REMAINING-TERM LESS +1
  2695        MOVE 0 TO FACTOR
  2696        GO TO 99999-RETURN.
  2697
  2698     COMPUTE WK2 ROUNDED = WK2 / I.
  2699     COMPUTE WK5 ROUNDED = WK5 / I.
  2700     COMPUTE WK1 ROUNDED = WK1 / I.
  2701
  2702     IF (CP-COMPANY-ID EQUAL 'CID')
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  52
* ELRFND.cbl
  2703        AND (CP-STATE-STD-ABBRV = 'MN')
  2704        AND (CP-CERT-EFF-DT > X'A4FF')
  2705        AND (CP-RATE-AS-REG-BALLOON)
  2706        AND (CP-EARN-AS-NET-PAY)
  2707        AND (CP-DEVIATION-CODE NOT = 'LEV')
  2708        CONTINUE
  2709     ELSE
  2710        GO TO 11000-CHECK-MN-LEV-BALLOON
  2711     END-IF
  2712
  2713     COMPUTE R = M - E
  2714     COMPUTE FACTOR = (R - WK2 + WK5) /
  2715        (M - WK1 + WK5)
  2716
  2717     GO TO 99999-RETURN
  2718
  2719      .
  2720 11000-CHECK-MN-LEV-BALLOON.
  2721
  2722     IF (CP-COMPANY-ID EQUAL 'CID')
  2723        AND (CP-STATE-STD-ABBRV = 'MN')
  2724        AND (CP-CERT-EFF-DT > X'A4FF')
  2725        AND (CP-RATE-AS-REG-BALLOON)
  2726        AND (CP-EARN-AS-NET-PAY)
  2727        AND (CP-DEVIATION-CODE = 'LEV')
  2728        CONTINUE
  2729     ELSE
  2730        GO TO 11000-CONTINUE-REFUND
  2731     END-IF
  2732
  2733     COMPUTE ANGLEM = (1 - (1 / (1 + I)) ** M) / I
  2734     COMPUTE ANGLEM-T = (1 - (1 / (1 + I))
  2735        ** (M - E)) / I
  2736
  2737     COMPUTE FACTOR = ANGLEM-T / ANGLEM
  2738
  2739     GO TO 99999-RETURN
  2740
  2741     .
  2742 11000-CONTINUE-REFUND.
  2743*    IF CP-GAP-ACTUARIAL
  2744*       COMPUTE ANGLEN = WK1 / ((1 + I) **
  2745*          (CP-TERM-OR-EXT-DAYS * 12 / 365))
  2746*       COMPUTE WK3 = WK2 / ANGLEN
  2747*       MOVE 'S'                 TO CP-REFUND-TYPE-USED
  2748     IF CP-GAP-ACTUARIAL
  2749        COMPUTE ANGLEN = WK1 / ((1 + I) **
  2750           (CP-TERM-OR-EXT-DAYS * 12 / 365))
  2751        COMPUTE WK3 = (R - WK2) / (M - ANGLEN)
  2752     ELSE
  2753        COMPUTE WK3 ROUNDED =
  2754          (N-P-REM - WK2 + WK5) / (ORIGINAL-TERM - WK1 + WK5)
  2755     END-IF
  2756
  2757     MOVE WK3  TO FACTOR.
  2758
  2759     GO TO 99999-RETURN.
  2760
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  53
* ELRFND.cbl
  2761 12000-PREMIUM-RATE.
  2762*    K-I IS ADJUSTMENT FACTOR FOR NO. MONTHS ADD'L. INTEREST
  2763*      OPTION - N OR U OR SPACE  = 1 MO,  SO K-I = 1 + I
  2764*      OPTION - A OR T           = 0 MO,  SO K-I = 1
  2765*      OPTION - I OR V           = 2 MO,  SO K-I = 1 + 2I
  2766*      OPTION - J OR W           = 3 MO,  SO K-I = 1 + 3I
  2767*      OPTION - K OR X           = 4 MO,  SO K-I = 1 + 4I
  2768
  2769     COMPUTE K-I = K1 + I.
  2770     MOVE K-I TO ONE-PLUS-I.
  2771
  2772     IF NPO-ALT OR NPO-TRUNC-0
  2773         MOVE K1 TO K-I.
  2774
  2775     IF NPO-2MO OR NPO-TRUNC-2
  2776         COMPUTE K-I = K1 + (2 * I).
  2777
  2778     IF NPO-3MO OR NPO-TRUNC-3
  2779         COMPUTE K-I = K1 + (3 * I).
  2780
  2781     IF NPO-4MO OR NPO-TRUNC-4
  2782         COMPUTE K-I = K1 + (4 * I).
  2783
  2784     COMPUTE RA ROUNDED = 1 -
  2785             ((X2 * (X2 + 1)) /
  2786              (N *  (N  + 1))).
  2787
  2788     IF (CP-COMPANY-ID EQUAL 'CSL') AND
  2789        (CP-CSL-VALID-NP-BENEFIT-CD)
  2790        NEXT SENTENCE
  2791     ELSE
  2792        GO TO XXXX-CHECK-DISCOUNT-5.
  2793
  2794     MOVE CP-CERT-EFF-DT TO DC-BIN-DATE-1.
  2795     MOVE ' ' TO DC-OPTION-CODE.
  2796     PERFORM 9100-CONVERT-DATE THRU 9100-EXIT.
  2797
  2798     IF DATE-CONVERSION-ERROR
  2799        MOVE '2'                 TO CP-RETURN-CODE
  2800        MOVE ZEROS               TO FACTOR
  2801                                    CP-CALC-PREMIUM
  2802         GO TO 99999-RETURN.
  2803
  2804     MOVE DC-JULIAN-DATE-1 TO WS-INT-BEGIN-DATE
  2805     MOVE CP-FIRST-PAY-DATE TO DC-BIN-DATE-1
  2806     MOVE ' ' TO DC-OPTION-CODE
  2807     PERFORM 9100-CONVERT-DATE THRU 9100-EXIT.
  2808
  2809     IF DATE-CONVERSION-ERROR
  2810        MOVE '2'                 TO CP-RETURN-CODE
  2811        MOVE ZEROS               TO FACTOR
  2812                                    CP-CALC-PREMIUM
  2813         GO TO 99999-RETURN.
  2814
  2815     MOVE DC-JULIAN-DATE-1 TO WS-DUE-DATE.
  2816
  2817     COMPUTE ANGLEN-1 EQUAL 1 + (WK6 / I).
  2818
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  54
* ELRFND.cbl
  2819     IF (WS-DUE-DATE - WS-INT-BEGIN-DATE) GREATER THAN 30
  2820        COMPUTE WK3 EQUAL 1 + ((30 + CP-TERM-OR-EXT-DAYS) *
  2821        CP-PAY-FREQUENCY / 365) * I
  2822     ELSE
  2823        COMPUTE WK3 EQUAL 1 + ((30 - CP-TERM-OR-EXT-DAYS) *
  2824        CP-PAY-FREQUENCY / 365) * I.
  2825
  2826     COMPUTE WS-WORK-RATE EQUAL ((2 * CP-PREMIUM-RATE) /
  2827     13).
  2828
  2829     COMPUTE WK5-CSL EQUAL WS-WORK-RATE * ((1 + I) / I) *
  2830     (N - ( ANGLEN-1 / WK3)).
  2831
  2832     MOVE ZEROS TO WS-Y-X-FACTOR WS-X-Y-FACTOR.
  2833
  2834     COMPUTE WS-CALC-FREQ-RATE EQUAL
  2835       (CP-LOAN-APR * .01) / CP-PAY-FREQUENCY.
  2836
  2837     COMPUTE WS-Y-X-FACTOR EQUAL
  2838       1 + ((1 - (1 + WS-CALC-FREQ-RATE) ** -(N - 1)) /
  2839       WS-CALC-FREQ-RATE).
  2840
  2841     COMPUTE WS-ODD-DAY-UNITS EQUAL
  2842       (WS-DUE-DATE - WS-INT-BEGIN-DATE) * CP-PAY-FREQUENCY / 365.
  2843
  2844     COMPUTE WS-X-Y-FACTOR EQUAL
  2845       1 + (WS-ODD-DAY-UNITS * WS-CALC-FREQ-RATE).
  2846
  2847     COMPUTE WS-NP-FACTOR EQUAL WS-WORK-RATE *
  2848       ((1 + WS-CALC-FREQ-RATE) / WS-CALC-FREQ-RATE) *
  2849       (N - (WS-Y-X-FACTOR / WS-X-Y-FACTOR)).
  2850
  2851     COMPUTE CP-CALC-PREMIUM EQUAL CP-MONTHLY-PAYMENT * WK5-CSL.
  2852
  2853     GO TO 99999-RETURN.
  2854
  2855 XXXX-CHECK-DISCOUNT-5.
  2856
  2857     IF WS-DISCOUNT-OPTION EQUAL '5'
  2858        NEXT SENTENCE
  2859     ELSE
  2860        GO TO 12000-CHECK-CLIENT.
  2861
  2862      COMPUTE ANGLEN EQUAL WK1 / I.
  2863
  2864      COMPUTE APR100 EQUAL ANNUAL-INT-RATE / +100.
  2865
  2866      COMPUTE WK3 EQUAL
  2867        (12 *
  2868        (((CP-ORIGINAL-BENEFIT / ANGLEN) * N) -
  2869        CP-ORIGINAL-BENEFIT)) /
  2870        APR100.
  2871
  2872     COMPUTE WK3 EQUAL
  2873        (WK3 * CP-PREMIUM-RATE) / +1000.
  2874
  2875     COMPUTE WK3 EQUAL
  2876        (24 * WK3) / (24 + (WS-WORK-DIS-RATE * N)).
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  55
* ELRFND.cbl
  2877
  2878      MOVE WK3 TO CP-CALC-PREMIUM.
  2879
  2880     GO TO 99999-RETURN.
  2881
  2882 12000-CHECK-CLIENT.
  2883
  2884     IF (CP-COMPANY-ID EQUAL 'MON') AND
  2885        (CP-STATE-STD-ABBRV EQUAL 'MD') AND
  2886        (CP-TRUNCATED-LIFE)
  2887        NEXT SENTENCE
  2888     ELSE
  2889        GO TO 12000-CHECK-NEXT.
  2890
  2891     COMPUTE WS-WORK-RATE EQUAL CP-PREMIUM-RATE / +100.
  2892
  2893     COMPUTE ANGLEN EQUAL WK1 / I.
  2894     COMPUTE ANGLEM EQUAL WK2 / I.
  2895
  2896     COMPUTE FM EQUAL
  2897                    (((ONE-PLUS-I ** M) * I * M) /
  2898                    ((ONE-PLUS-I ** M) - 1))
  2899                    - 1.
  2900
  2901     COMPUTE FN EQUAL
  2902                    (((ONE-PLUS-I ** N) * I * N) /
  2903                    ((ONE-PLUS-I ** N) - 1))
  2904                    - 1.
  2905
  2906     COMPUTE FNM EQUAL
  2907                    (((ONE-PLUS-I ** (N - M)) * I * (N - M)) /
  2908                    ((ONE-PLUS-I ** (N - M)) - 1))
  2909                    - 1.
  2910
  2911     COMPUTE GR EQUAL
  2912                    (WS-WORK-RATE * ANGLEM * I) /
  2913                    (M - ANGLEM).
  2914
  2915     COMPUTE ODF EQUAL
  2916                     (1 +
  2917                     ((12 * I * (CP-TERM-OR-EXT-DAYS + 30)) /
  2918                     360)) /
  2919                     ONE-PLUS-I.
  2920
  2921     COMPUTE OD EQUAL
  2922                    (1 + (ODF * (FN / I - 1))) +
  2923                    ((12 * CP-TERM-OR-EXT-DAYS) / +360).
  2924
  2925     COMPUTE WK3 EQUAL
  2926*                   ((1 + FN) * ODF * CP-ORIGINAL-BENEFIT) /
  2927                    ((1 + FN) * ODF *
  2928                    (CP-ORIGINAL-BENEFIT - CP-ORIGINAL-PREMIUM)) /
  2929                    (1 - (GR * (OD - ((ONE-PLUS-I ** M) / I) *
  2930                    FNM * ODF * (1 - ANGLEM / ANGLEN)))).
  2931
  2932     COMPUTE TRUNC-PMT EQUAL WK3 / N.
  2933     COMPUTE WK3 EQUAL TRUNC-PMT * N.
  2934
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  56
* ELRFND.cbl
  2935     COMPUTE WK3 EQUAL
  2936                    (WK3 / (ODF * (1 + FN))) -
  2937*                   CP-ORIGINAL-BENEFIT.
  2938                    (CP-ORIGINAL-BENEFIT - CP-ORIGINAL-PREMIUM).
  2939
  2940      MOVE WK3 TO CP-CALC-PREMIUM.
  2941
  2942     GO TO 99999-RETURN.
  2943
  2944 12000-CHECK-NEXT.
  2945
  2946     IF WS-DISCOUNT-OPTION EQUAL '3' OR '4'
  2947        NEXT SENTENCE
  2948     ELSE
  2949        GO TO 12000-CHECK-PA-TRUNC.
  2950
  2951      IF WS-WORK-DIS-RATE EQUAL +0
  2952         MOVE '7'                TO CP-RETURN-CODE
  2953         MOVE ZEROS              TO FACTOR
  2954                                    CP-CALC-PREMIUM
  2955         GO TO 99999-RETURN.
  2956
  2957      COMPUTE ANGLEN EQUAL WK1 / I.
  2958
  2959      COMPUTE APR100 EQUAL ANNUAL-INT-RATE / +100.
  2960
  2961      IF WS-WORK-DIS-RATE EQUAL APR100
  2962         ADD .00001 TO APR100.
  2963
  2964      COMPUTE WK8 EQUAL 12 / (12 + WS-WORK-DIS-RATE).
  2965      COMPUTE WK9 EQUAL 12 / (12 + APR100).
  2966
  2967     COMPUTE Y = (1 + ((CP-TERM-OR-EXT-DAYS + +30) * I) / +30)
  2968        / (1 + I)
  2969     COMPUTE ANGLEN-1 = ANGLEN / Y
  2970      IF CP-COMPANY-ID EQUAL 'CDL'
  2971         COMPUTE WK3 EQUAL
  2972
  2973          (144 * CP-ORIGINAL-BENEFIT / ANGLEN) *
  2974          ((1 + WS-WORK-DIS-RATE / 12) ** .5) *
  2975
  2976          ((1 / (WS-WORK-DIS-RATE * APR100)) -
  2977
  2978          ((WK8 ** N) /
  2979          (WS-WORK-DIS-RATE * (APR100 - WS-WORK-DIS-RATE))) +
  2980
  2981          ((WK9 ** N) /
  2982          (APR100 * (APR100 - WS-WORK-DIS-RATE))))
  2983
  2984      ELSE
  2985         COMPUTE WK3 EQUAL
  2986
  2987          ((CP-ORIGINAL-BENEFIT / ANGLEN-1) *
  2988          (12 + WS-WORK-DIS-RATE) * 12) *
  2989
  2990          ((1 / (WS-WORK-DIS-RATE * APR100)) -
  2991
  2992          ((WK8 ** N) /
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  57
* ELRFND.cbl
  2993          (WS-WORK-DIS-RATE * (APR100 - WS-WORK-DIS-RATE))) +
  2994
  2995          ((WK9 ** N) /
  2996          (APR100 * (APR100 - WS-WORK-DIS-RATE)))).
  2997
  2998      COMPUTE WK3 EQUAL
  2999          (WK3 * CP-PREMIUM-RATE) / +1000.
  3000
  3001      MOVE WK3 TO CP-CALC-PREMIUM.
  3002
  3003     GO TO 99999-RETURN.
  3004
  3005 12000-CHECK-PA-TRUNC.
  3006
  3007     IF (CP-COMPANY-ID EQUAL 'NCL') AND
  3008        (CP-STATE-STD-ABBRV EQUAL 'PA') AND
  3009        (CP-EARN-AS-NET-PAY) AND
  3010        (CP-TRUNCATED-LIFE)
  3011        NEXT SENTENCE
  3012     ELSE
  3013        GO TO 12000-CHECK-MD-TRUNC.
  3014
  3015     COMPUTE WS-WORK-RATE EQUAL CP-PREMIUM-RATE / +100.
  3016
  3017     COMPUTE ANGLEN-M EQUAL WK5 / I.
  3018     COMPUTE ANGLEN EQUAL WK1 / I.
  3019
  3020     COMPUTE ANGLEN-1 EQUAL ANGLEN * ODF.
  3021
  3022     COMPUTE WK3 EQUAL
  3023        (CP-ORIGINAL-BENEFIT * 2 * (M - (ANGLEN-M - ANGLEN)) *
  3024        WS-WORK-RATE) / (ANGLEN-1 * (N + 1) * I).
  3025
  3026     MOVE WK3 TO CP-CALC-PREMIUM.
  3027
  3028     GO TO 99999-RETURN.
  3029
  3030 12000-CHECK-MD-TRUNC.
  3031
  3032     IF (CP-COMPANY-ID EQUAL 'NCL') AND
  3033        (CP-STATE-STD-ABBRV EQUAL 'MD') AND
  3034        (CP-EARN-AS-NET-PAY) AND
  3035        (CP-TRUNCATED-LIFE)
  3036        NEXT SENTENCE
  3037     ELSE
  3038        GO TO 12000-CHECK-MD.
  3039
  3040     COMPUTE WS-WORK-RATE EQUAL CP-PREMIUM-RATE / +100.
  3041
  3042     COMPUTE ANGLEN-M EQUAL WK5 / I.
  3043     COMPUTE ANGLEM EQUAL WK2 / I.
  3044     COMPUTE ANGLEN EQUAL WK1 / I.
  3045
  3046     COMPUTE ANGLEN-1 EQUAL ANGLEN * ODF.
  3047
  3048     COMPUTE WK3 EQUAL
  3049        CP-ORIGINAL-BENEFIT * WS-WORK-RATE *
  3050        ((ANGLEM * (M - (ANGLEN - ANGLEN-M))) /
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  58
* ELRFND.cbl
  3051        (ANGLEN-1 * (M - ANGLEM))).
  3052
  3053     MOVE WK3 TO CP-CALC-PREMIUM.
  3054
  3055     GO TO 99999-RETURN.
  3056
  3057 12000-CHECK-MD.
  3058
  3059     IF (CP-COMPANY-ID EQUAL 'NCL') AND
  3060        (CP-STATE-STD-ABBRV EQUAL 'MD') AND
  3061        (CP-EARN-AS-NET-PAY)
  3062        NEXT SENTENCE
  3063     ELSE
  3064        GO TO 12000-CHECK-ME-TRUNC.
  3065
  3066     COMPUTE WS-WORK-RATE EQUAL CP-PREMIUM-RATE / +100.
  3067
  3068     COMPUTE WK3 EQUAL
  3069        CP-ORIGINAL-BENEFIT * WS-WORK-RATE.
  3070
  3071     MOVE WK3 TO CP-CALC-PREMIUM.
  3072
  3073     GO TO 99999-RETURN.
  3074
  3075 12000-CHECK-ME-TRUNC.
  3076
  3077     IF (CP-COMPANY-ID EQUAL 'NCL' OR 'CID')
  3078        AND (CP-STATE-STD-ABBRV EQUAL 'ME')
  3079        AND (CP-EARN-AS-NET-PAY)
  3080        AND (CP-TRUNCATED-LIFE)
  3081        CONTINUE
  3082     ELSE
  3083        GO TO 12000-CHECK-CID-WA-FARMPLAN
  3084     END-IF
  3085
  3086     COMPUTE WS-WORK-RATE = CP-PREMIUM-RATE / +1000
  3087     COMPUTE ANGLEN = (1 - (1 / (1 + I)) ** N) / I
  3088     COMPUTE ANGLEN-M = (1 - (1 / (1 + I)) ** (N - M)) / I
  3089     COMPUTE D = CP-TERM-OR-EXT-DAYS + +30
  3090     COMPUTE Y = (1 + (D * I) / 30) / (1 + I)
  3091     COMPUTE ANGLEN-1 = ANGLEN / Y
  3092     COMPUTE WK4 = CP-ORIGINAL-BENEFIT / ANGLEN-1
  3093     COMPUTE WK5 = 1 / (1 + (WS-WORK-DIS-RATE * N / 24))
  3094     COMPUTE WK9 = 1 / (1 + (WS-WORK-DIS-RATE * (N - M) / 24))
  3095     COMPUTE WK3
  3096        = (WK4 * ((N - ANGLEN) / I) * WS-WORK-RATE * WK5)
  3097        - (WK4 * (((N - M) - ANGLEN-M) / I) * WS-WORK-RATE * WK9
  3098            * (1 / (1.0635 ** (M / 12))))
  3099*    COMPUTE WK8 EQUAL 1 / (1 + (.045 * N / 24)).
  3100*    COMPUTE WK9 EQUAL
  3101*       1 / (1 + (.045 * (N - M) / 24))
  3102*    COMPUTE WK7 EQUAL
  3103*       WS-WORK-RATE * 20 / (M + 1).
  3104*    COMPUTE WK3 EQUAL
  3105*       ((( N - ANGLEN) * WK7 * WK8) /
  3106*       (10 * ANGLEN-1 * I)) -
  3107*       (((N - M - ANGLEN-M) * WK7 * WK9 * 1) /
  3108*       (10 * ANGLEN-1 * I * (1.0635 ** (M / 12)))).
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  59
* ELRFND.cbl
  3109*    COMPUTE WK3 EQUAL WK3 * CP-ORIGINAL-BENEFIT.
  3110*
  3111     MOVE WK3 TO CP-CALC-PREMIUM.
  3112
  3113     GO TO 99999-RETURN
  3114      .
  3115 12000-CHECK-CID-WA-FARMPLAN.
  3116
  3117     IF (CP-COMPANY-ID EQUAL 'CID')
  3118        AND (CP-STATE-STD-ABBRV = 'WA')
  3119        AND (CP-FARM-PLAN)
  3120        CONTINUE
  3121     ELSE
  3122        GO TO 12000-CHECK-CID-FARMPLAN
  3123     END-IF
  3124**  This was removed due to IR 2015022300001
  3125    GO TO 12000-CHECK-CID-FARMPLAN
  3126
  3127     move cp-original-term       to n
  3128     move cp-no-of-pmts          TO C-TOT-PMTS
  3129     compute c-pmts-per-year = 12 / cp-pay-frequency
  3130     move cp-pay-frequency       to m
  3131     compute c-days-in-pmt-per = 365 / c-pmts-per-year
  3132     COMPUTE I = CP-LOAN-APR / C-PMTS-PER-YEAR / 100
  3133     if i = zeros
  3134        move .0000000001         to i
  3135     end-if
  3136     COMPUTE ANGLEN   = (1 - (1 / (1 + I)) ** c-tot-pmts) / I
  3137
  3138     COMPUTE Y = (1 + ((CP-DAYS-TO-1ST-PMT * I) /
  3139        (m * 30))) / (1 + I)
  3140     COMPUTE J = ((1 + WS-WORK-DIS-RATE)
  3141        ** CP-PAY-FREQUENCY) - 1
  3142     COMPUTE TI = (cp-days-to-1st-pmt - (M * 30)) / 30
  3143     COMPUTE WK1 = (1 - (1 / (1 + WS-WORK-DIS-RATE))
  3144        ** TI) / WS-WORK-DIS-RATE
  3145     COMPUTE WK2 = (1 - (1 / (1 + J)) ** c-tot-pmts) / J
  3146     COMPUTE WK3 = (1 - (1 / (1 + J)) ** (c-tot-pmts - 1)) / J
  3147     COMPUTE WK4 = (1 - (1 / (1 + WS-WORK-DIS-RATE))
  3148        ** m) / WS-WORK-DIS-RATE
  3149     COMPUTE WK2 = WK2 * (1 + J)
  3150     COMPUTE WK4 = WK4 * (1 + WS-WORK-DIS-RATE)
  3151     COMPUTE WK1 = WK1 * (1 + WS-WORK-DIS-RATE)
  3152     COMPUTE WK3 = WK3 * (1 + J)
  3153     COMPUTE WK5 = (WK3 - (c-tot-pmts - 1) * (1 / (1 + J)
  3154        ** (c-tot-pmts - 1))) / J
  3155     COMPUTE GR = (((1 / (1 + WS-WORK-DIS-RATE) ** TI) * WK4 *
  3156        ((c-tot-pmts * WK2) - WK5)) + (c-tot-pmts * WK1)) *
  3157        (CP-PREMIUM-RATE / 1000)
  3158     COMPUTE WK7 = CP-ORIGINAL-BENEFIT / (anglen / y)
  3159     COMPUTE WK6 = (WK7 * GR)
  3160
  3161     MOVE WK6 TO CP-CALC-PREMIUM
  3162
  3163     GO TO 99999-RETURN
  3164
  3165     .
  3166 12000-CHECK-CID-FARMPLAN.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  60
* ELRFND.cbl
  3167     IF (CP-COMPANY-ID EQUAL 'CID')
  3168        AND (CP-STATE-STD-ABBRV EQUAL 'ND' OR 'MT' OR 'NJ'
  3169           OR 'IN' OR 'AZ')
  3170        AND (CP-FARM-PLAN)
  3171        CONTINUE
  3172     ELSE
  3173        GO TO 12000-CHECK-SC-CID
  3174     END-IF
  3175     COMPUTE N = M / CP-PAY-FREQUENCY
  3176     COMPUTE D = CP-TERM-OR-EXT-DAYS + +30
  3177     COMPUTE J = ((1 + WS-WORK-DIS-RATE)
  3178        ** CP-PAY-FREQUENCY) - 1
  3179     COMPUTE TI = (D - (CP-PAY-FREQUENCY * 30)) / 30
  3180     COMPUTE WK1 = (1 - (1 / (1 + WS-WORK-DIS-RATE))
  3181        ** TI) / WS-WORK-DIS-RATE
  3182     COMPUTE WK2 = (1 - (1 / (1 + J)) ** N) / J
  3183     COMPUTE WK3 = (1 - (1 / (1 + J)) ** (N - 1)) / J
  3184     COMPUTE WK4 = (1 - (1 / (1 + WS-WORK-DIS-RATE))
  3185        ** CP-PAY-FREQUENCY) / WS-WORK-DIS-RATE
  3186     COMPUTE WK2 = WK2 * (1 + J)
  3187     COMPUTE WK4 = WK4 * (1 + WS-WORK-DIS-RATE)
  3188     COMPUTE WK1 = WK1 * (1 + WS-WORK-DIS-RATE)
  3189     COMPUTE WK3 = WK3 * (1 + J)
  3190     COMPUTE WK5 = (WK3 - (N - 1) * (1 / (1 + J)
  3191        ** (N - 1))) / J
  3192     COMPUTE GR = (((1 / (1 + WS-WORK-DIS-RATE) ** TI) * WK4 *
  3193        ((N * WK2) - WK5)) + (N * WK1)) *
  3194        (CP-PREMIUM-RATE / 1000)
  3195     COMPUTE WK7 = CP-ORIGINAL-BENEFIT / N
  3196     COMPUTE WK6 = (WK7 * GR)
  3197     MOVE WK6 TO CP-CALC-PREMIUM
  3198     GO TO 99999-RETURN
  3199     .
  3200 12000-CHECK-SC-CID.
  3201     IF (CP-COMPANY-ID = 'CID')
  3202        AND (CP-STATE-STD-ABBRV = 'SC')
  3203        AND (CP-EARN-AS-NET-PAY)
  3204        AND (CP-BENEFIT-CD = '2I' OR '2J' OR '2K' OR '2L')
  3205        move 6                   to ws-extra-pmts
  3206     ELSE
  3207        GO TO 12000-CHECK-AL-CID
  3208     END-IF
  3209     COMPUTE D = CP-TERM-OR-EXT-DAYS + +30
  3210     COMPUTE Y = (1 + (D * I) / 30) / (1 + I)
  3211     COMPUTE WK2 = (CP-PREMIUM-RATE * ((M + ((D - 30) / 30))
  3212        / 12)) / ((M + 1) / 2)
  3213
  3214     if i = .0000000001
  3215        compute wk4 = cp-original-benefit / n
  3216        compute wk3 = wk4 * (((n * (n + 1)) / 2 - ((n - m) *
  3217            (n - m + 1)) / 2 + ws-extra-pmts * m) * wk2 / 100)
  3218        display ' hit sc wo apr - wk2 ' wk2
  3219     else
  3220        COMPUTE ANGLEN rounded = (1 - (1 / (1 + I)) ** N) / I
  3221        COMPUTE ANGLEN-M = (1 - (1 / (1 + I)) ** (N - M)) / I
  3222        COMPUTE ANGLEN-1 = ANGLEN / Y
  3223        COMPUTE WK4 = CP-ORIGINAL-BENEFIT / ANGLEN-1
  3224        COMPUTE WK3 = WK4 * (((M - (ANGLEN - ANGLEN-M)) / I)
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  61
* ELRFND.cbl
  3225           + WS-EXTRA-PMTS * M) * (WK2 / 100) * (1 + I)
  3226     end-if
  3227*    COMPUTE ANGLEN = (1 - (1 / (1 + I)) ** N) / I
  3228*    COMPUTE ANGLEN-M = (1 - (1 / (1 + I)) ** (N - M)) / I
  3229*    COMPUTE D = CP-TERM-OR-EXT-DAYS + +30
  3230*    COMPUTE Y = (1 + (D * I) / 30) / (1 + I)
  3231*    COMPUTE ANGLEN-1 = ANGLEN / Y
  3232*    COMPUTE WK2 = (CP-PREMIUM-RATE * ((M + ((D - 30) / 30))
  3233*       / 12)) / ((M + 1) / 2)
  3234*    COMPUTE WK4 = CP-ORIGINAL-BENEFIT / ANGLEN-1
  3235*    COMPUTE WK3 = WK4 * (((M - (ANGLEN - ANGLEN-M)) / I)
  3236*       + WS-EXTRA-PMTS * M) * (WK2 / 100) * (1 + I)
  3237     MOVE WK3 TO CP-CALC-PREMIUM
  3238     GO TO 99999-RETURN
  3239     .
  3240 12000-CHECK-AL-CID.
  3241     IF (CP-COMPANY-ID EQUAL 'CID')
  3242        AND (CP-BENEFIT-CD = '49' OR '50' OR '53' OR '54')
  3243        AND (CP-EARN-AS-NET-PAY)
  3244        CONTINUE
  3245     ELSE
  3246        GO TO 12000-CHECK-NH-CID
  3247     END-IF
  3248     COMPUTE ANGLEN = (1 - (1 / (1 + I)) ** N) / I
  3249     COMPUTE ANGLEM = (1 - (1 / (1 + I)) ** M) / I
  3250     COMPUTE ANGLEN-M = (1 - (1 / (1 + I)) ** (N - M)) / I
  3251     COMPUTE WK8 = (1 + ((CP-TERM-OR-EXT-DAYS + +30)* I) / +30)
  3252                   / (1 + I)
  3253     COMPUTE ANGLEN-1 = ANGLEN / WK8
  3254     COMPUTE WK4 = CP-ORIGINAL-BENEFIT / ANGLEN-1
  3255     COMPUTE WK3 = WK4 * ((M - (ANGLEN - ANGLEN-M) + I * M) / I) *
  3256        (CP-PREMIUM-RATE / 1000)
  3257     MOVE WK3 TO CP-CALC-PREMIUM
  3258     GO TO 99999-RETURN
  3259     .
  3260 12000-CHECK-NH-CID.
  3261     IF (CP-COMPANY-ID EQUAL 'CID')
  3262        AND (CP-STATE-STD-ABBRV = 'NH' OR 'AK')
  3263        AND (CP-EARN-AS-NET-PAY)
  3264        CONTINUE
  3265     ELSE
  3266        GO TO 12000-CHECK-PA-CID
  3267     END-IF
  3268     COMPUTE ANGLEN = (1 - (1 / (1 + I)) ** N) / I
  3269     COMPUTE ANGLEN-M = (1 - (1 / (1 + I)) ** (N - M)) / I
  3270     COMPUTE WK8 = (1 + ((CP-TERM-OR-EXT-DAYS + +30)* I) / +30)
  3271                   / (1 + I)
  3272     COMPUTE ANGLEN-1 = ANGLEN / WK8
  3273     COMPUTE WK4 = CP-ORIGINAL-BENEFIT / ANGLEN-1
  3274     COMPUTE WK3 = WK4 * ((M - (ANGLEN - ANGLEN-M)) / I) *
  3275        (1 + (2 * I)) * (CP-PREMIUM-RATE / 1000)
  3276     MOVE WK3 TO CP-CALC-PREMIUM
  3277     GO TO 99999-RETURN
  3278     .
  3279 12000-CHECK-PA-CID.
  3280     IF (CP-COMPANY-ID EQUAL 'CID')
  3281        AND (CP-STATE-STD-ABBRV EQUAL 'PA')
  3282        AND (CP-EARN-AS-NET-PAY)
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  62
* ELRFND.cbl
  3283        CONTINUE
  3284     ELSE
  3285        GO TO 12000-CHECK-ME-CID
  3286     END-IF
  3287
  3288     COMPUTE ANGLEN = (1 - (1 / (1 + I)) ** N) / I
  3289     COMPUTE D = CP-TERM-OR-EXT-DAYS + +30
  3290     COMPUTE Y = (1 + (D * I) / 30) / (1 + I)
  3291     COMPUTE ANGLEN-1 = ANGLEN / Y
  3292     COMPUTE WK5 = 1 / (10 * (1 + (WS-WORK-DIS-RATE / 24) * N))
  3293     COMPUTE WK4 = CP-ORIGINAL-BENEFIT / ANGLEN-1
  3294     COMPUTE WS-WORK-RATE EQUAL CP-PREMIUM-RATE / +100
  3295     COMPUTE WK3 = WK4 * ((N - ANGLEN) / I) * WS-WORK-RATE
  3296        * WK5
  3297     MOVE WK3 TO CP-CALC-PREMIUM
  3298     GO TO 99999-RETURN
  3299     .
  3300 12000-CHECK-ME-CID.
  3301     IF (CP-COMPANY-ID EQUAL 'CID')
  3302        AND (CP-STATE-STD-ABBRV EQUAL 'ME')
  3303        AND (CP-EARN-AS-NET-PAY)
  3304        CONTINUE
  3305     ELSE
  3306        GO TO 12000-CHECK-VT-TRUNC
  3307     END-IF
  3308     COMPUTE WS-WORK-RATE = CP-PREMIUM-RATE / +1000
  3309     COMPUTE ANGLEN = (1 - (1 / (1 + I)) ** N) / I
  3310     COMPUTE D = CP-TERM-OR-EXT-DAYS + +30
  3311     COMPUTE Y = (1 + (D * I) / 30) / (1 + I)
  3312     COMPUTE ANGLEN-1 = ANGLEN / Y
  3313     COMPUTE WK4 = CP-ORIGINAL-BENEFIT / ANGLEN-1
  3314     COMPUTE WK5 = 1 / (1 + (WS-WORK-DIS-RATE * N / 24))
  3315     COMPUTE WK3 = WK4 * ((N - ANGLEN) / I) * WS-WORK-RATE
  3316        * WK5
  3317     MOVE WK3 TO CP-CALC-PREMIUM
  3318     GO TO 99999-RETURN
  3319     .
  3320 12000-CHECK-VT-TRUNC.
  3321
  3322     IF (CP-COMPANY-ID EQUAL 'NCL') AND
  3323        (CP-STATE-STD-ABBRV EQUAL 'VT') AND
  3324        (CP-EARN-AS-NET-PAY) AND
  3325        (CP-TRUNCATED-LIFE)
  3326        NEXT SENTENCE
  3327     ELSE
  3328        GO TO 12000-CHECK-VT.
  3329
  3330      COMPUTE WS-WORK-RATE EQUAL CP-PREMIUM-RATE / +1000.
  3331
  3332      COMPUTE ANGLEN EQUAL WK1 / I.
  3333
  3334      COMPUTE ANGLEN-1 EQUAL ANGLEN * ODF.
  3335
  3336      COMPUTE WK8 EQUAL (1 / (1 + I)) ** N.
  3337      COMPUTE WK9 EQUAL
  3338        (1 - ((1 / (1 + ((.0054 - I) / (1 + I)))) ** (M - 1))) /
  3339        ((.0054 - I) / (1 + I)).
  3340      COMPUTE WK7 EQUAL
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  63
* ELRFND.cbl
  3341        (1 - (1 / 1.0054) ** (M - 1)) / .0054.
  3342      COMPUTE WK3 EQUAL  CP-ORIGINAL-BENEFIT * WS-WORK-RATE *
  3343        ((WK7 + 1) - (WK8 * (WK9 + 1))) / (ANGLEN-1 * I).
  3344
  3345      MOVE WK3 TO CP-CALC-PREMIUM.
  3346
  3347     GO TO 99999-RETURN.
  3348
  3349 12000-CHECK-VT.
  3350
  3351     IF (CP-COMPANY-ID EQUAL 'NCL') AND
  3352        (CP-STATE-STD-ABBRV EQUAL 'VT') AND
  3353        (CP-EARN-AS-NET-PAY)
  3354        NEXT SENTENCE
  3355     ELSE
  3356        GO TO 12000-CHECK-MINN-WDS.
  3357
  3358      COMPUTE WS-WORK-RATE EQUAL CP-PREMIUM-RATE / +1000.
  3359
  3360      COMPUTE ANGLEN EQUAL WK1 / I.
  3361
  3362      COMPUTE ANGLEN-1 EQUAL ANGLEN * ODF.
  3363
  3364      COMPUTE WK3 EQUAL ((CP-ORIGINAL-BENEFIT * WS-WORK-RATE) /
  3365                        (ANGLEN-1 * I)) *
  3366
  3367                        (((1.0054 ** N - 1) /
  3368                        (1.0054 ** (N - 1) * .0054)) -
  3369
  3370                        ((V * (1 - 1.0054 ** N * VX)) /
  3371                        (1.0054 ** (N - 1) * (1 - 1.0054 * V)))).
  3372
  3373      MOVE WK3 TO CP-CALC-PREMIUM.
  3374
  3375     GO TO 99999-RETURN.
  3376
  3377 12000-CHECK-MINN-WDS.
  3378
  3379     IF (CP-COMPANY-ID EQUAL 'WDS') AND
  3380        (CP-STATE-STD-ABBRV EQUAL 'MN') AND
  3381        (CP-EARN-AS-NET-PAY)
  3382        NEXT SENTENCE
  3383     ELSE
  3384        GO TO 12000-CHECK-MINN-BALL-LEV.
  3385
  3386     COMPUTE ANGLEN EQUAL WK1 / I.
  3387     COMPUTE WK3 EQUAL (CP-PREMIUM-RATE / +100) *
  3388              (N / +12) * (2 / (N + 1)).
  3389     COMPUTE WK3 EQUAL (CP-ORIGINAL-BENEFIT / ANGLEN) *
  3390         WK3 * ((N - ANGLEN) / I).
  3391
  3392      MOVE WK3 TO CP-CALC-PREMIUM.
  3393
  3394     GO TO 99999-RETURN.
  3395
  3396 12000-CHECK-MINN-BALL-LEV.
  3397
  3398     IF (CP-COMPANY-ID EQUAL 'WDS') AND
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  64
* ELRFND.cbl
  3399        (CP-STATE-STD-ABBRV EQUAL 'MN') AND
  3400        (CP-DEVIATION-CODE EQUAL 'LEV') AND
  3401        (CP-EARN-AS-REG-BALLOON)
  3402        NEXT SENTENCE
  3403     ELSE
  3404        GO TO 12000-CHECK-MINN-BALL.
  3405
  3406     COMPUTE ANGLEN EQUAL WK1 / I.
  3407
  3408     COMPUTE WK3 EQUAL 1 / (1 + I) ** N.
  3409
  3410     COMPUTE WK3 EQUAL CP-ORIGINAL-BENEFIT * CP-PREMIUM-RATE /
  3411        +100 * N / 12 * 2 / (N + 1) * (ANGLEN / WK3).
  3412
  3413     MOVE WK3 TO CP-CALC-PREMIUM.
  3414
  3415     GO TO 99999-RETURN.
  3416
  3417 12000-CHECK-MINN-BALL.
  3418
  3419     IF (CP-COMPANY-ID EQUAL 'WDS') AND
  3420        (CP-STATE-STD-ABBRV EQUAL 'MN') AND
  3421        (CP-EARN-AS-REG-BALLOON)
  3422        NEXT SENTENCE
  3423     ELSE
  3424        GO TO 12000-CHECK-CID-MN-BALL.
  3425
  3426     COMPUTE ANGLEN EQUAL WK1 / I.
  3427     COMPUTE ANGLEN-1 EQUAL WK6 / I.
  3428
  3429     COMPUTE WK3 EQUAL CP-ORIGINAL-BENEFIT * CP-PREMIUM-RATE
  3430     / +100 * (N - 1) / 12 * 2 / N *
  3431     (((N - 1) - ANGLEN-1) / (I * ANGLEN-1)).
  3432
  3433      MOVE WK3 TO CP-CALC-PREMIUM.
  3434
  3435     GO TO 99999-RETURN.
  3436
  3437 12000-CHECK-CID-MN-BALL.
  3438     IF (CP-COMPANY-ID EQUAL 'CID')
  3439        AND (CP-STATE-STD-ABBRV = 'MN')
  3440        AND (CP-CERT-EFF-DT > X'A4FF')
  3441        AND (CP-EARN-AS-REG-BALLOON)
  3442        CONTINUE
  3443     ELSE
  3444        GO TO 12000-CHECK-CID-MN-FARM
  3445     END-IF
  3446     COMPUTE ANGLEN = (1 - (1 / (1 + I)) ** N) / I
  3447     COMPUTE ANGLEM = (1 - (1 / (1 + I)) ** M) / I
  3448     COMPUTE ANGLEMP1 = (1 - (1 / (1 + I)) ** (M + 1)) / I
  3449     COMPUTE ANGLEM-1 = (1 - (1 / (1 + I)) ** (M - 1)) / I
  3450     COMPUTE ANGLEN-M = (1 - (1 / (1 + I)) ** (N - M + 1)) / I
  3451     COMPUTE V = 1 / (1 + I)
  3452     COMPUTE D = CP-TERM-OR-EXT-DAYS + +30
  3453     COMPUTE Y = (1 + (D * I) / +30)
  3454        / (1 + I)
  3455     COMPUTE CP-LF-BALLOON-PREM = CP-ALTERNATE-BENEFIT * (M + 1)
  3456        * CP-PREMIUM-RATE / 1000
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  65
* ELRFND.cbl
  3457*    IF CP-MONTHLY-PAYMENT NOT = ZEROS
  3458*       MOVE CP-MONTHLY-PAYMENT  TO GR
  3459*    ELSE
  3460*       COMPUTE WK6 = CP-ORIGINAL-BENEFIT + CP-ALTERNATE-BENEFIT
  3461*          * (ANGLEM / Y) * (CP-PREMIUM-RATE / 1000) -
  3462*          CP-ALTERNATE-BENEFIT * V ** (M + ((D - 30) / 30))
  3463*       DISPLAY ' BALLOON TOP ' WK6
  3464*       COMPUTE WK7 = (ANGLEM-1 / Y) - ((M - 1) - ANGLEM-1) / I
  3465*          * (CP-PREMIUM-RATE / 1000) * (1 + I) - ((M - 1) * 6.65)
  3466*          / 100
  3467*       DISPLAY ' BALLOON BOTTOM ' WK7
  3468*       COMPUTE GR = WK6 / WK7
  3469*       DISPLAY ' BALLOON PAYMENT ' GR
  3470*    END-IF
  3471     COMPUTE WK8 = (1 + I) ** ((M + 1) * -1)
  3472     COMPUTE CP-ORIGINAL-BENEFIT ROUNDED = (CP-ORIGINAL-BENEFIT
  3473        + CP-ALTERNATE-BENEFIT) - (CP-ALTERNATE-BENEFIT * WK8)
  3474     COMPUTE GR = CP-ORIGINAL-BENEFIT / ANGLEM
  3475     COMPUTE WK3 = (GR * ((M - ANGLEM) / I) * (1 + I)
  3476        + (CP-ALTERNATE-BENEFIT * ANGLEMP1) -
  3477           (CP-ALTERNATE-BENEFIT * (M + 1)))
  3478           * CP-PREMIUM-RATE / 1000
  3479     MOVE WK3                    TO CP-CALC-PREMIUM
  3480     GO TO 99999-RETURN.
  3481     .
  3482 12000-CHECK-CID-MN-FARM.
  3483
  3484     IF (CP-COMPANY-ID EQUAL 'CID')
  3485        AND (CP-STATE-STD-ABBRV = 'MN' or 'WA')
  3486        AND (CP-CERT-EFF-DT > X'A4FF')
  3487        AND (CP-EARN-AS-FARM-PLAN)
  3488        CONTINUE
  3489     ELSE
  3490        GO TO 12000-CHECK-CID-NET-BALLoons
  3491     END-IF
  3492
  3493     EVALUATE CP-PMT-MODE
  3494        WHEN 'B'
  3495           MOVE +14              TO C-DAYS-IN-PMT-PER
  3496           MOVE +26              TO C-PMTS-PER-YEAR
  3497           MOVE CP-NO-OF-PMTS    TO C-TOT-PMTS
  3498        WHEN 'S'
  3499           MOVE +15              TO C-DAYS-IN-PMT-PER
  3500           MOVE +24              TO C-PMTS-PER-YEAR
  3501           MOVE CP-NO-OF-PMTS    TO C-TOT-PMTS
  3502        WHEN 'T'
  3503           MOVE +360             TO C-DAYS-IN-PMT-PER
  3504           MOVE +1               TO C-PMTS-PER-YEAR
  3505           MOVE CP-NO-OF-PMTS    TO C-TOT-PMTS
  3506        WHEN 'W'
  3507           MOVE +7               TO C-DAYS-IN-PMT-PER
  3508           MOVE +52              TO C-PMTS-PER-YEAR
  3509           MOVE CP-NO-OF-PMTS    TO C-TOT-PMTS
  3510        WHEN OTHER
  3511           move cp-no-of-pmts    to c-tot-pmts
  3512           if cp-pay-frequency > zeros
  3513              compute c-pmts-per-year =
  3514                 12 / cp-pay-frequency
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  66
* ELRFND.cbl
  3515              compute c-days-in-pmt-per = 360 / c-pmts-per-year
  3516           else
  3517              MOVE +30           TO C-DAYS-IN-PMT-PER
  3518              MOVE +12           TO C-PMTS-PER-YEAR
  3519              MOVE CP-LOAN-TERM  TO C-TOT-PMTS
  3520           end-if
  3521     END-EVALUATE
  3522
  3523     COMPUTE I = CP-LOAN-APR / C-PMTS-PER-YEAR / 100
  3524     if i = zeros
  3525        move .0000000001         to i
  3526     end-if
  3527
  3528     COMPUTE Y = (1 + (CP-DAYS-TO-1ST-PMT * I /
  3529        C-DAYS-IN-PMT-PER)) / (1 + I)
  3530
  3531     compute cp-premium-rate =
  3532        cp-premium-rate * 12 / c-pmts-per-year / 10
  3533     move c-tot-pmts to n m
  3534     COMPUTE ANGLEN   = (1 - (1 / (1 + I)) ** N) / I
  3535     COMPUTE ANGLEN-M = (1 - (1 / (1 + I)) ** (N - M)) / I
  3536     COMPUTE ANGLEN-1 = ANGLEN / Y
  3537     COMPUTE WK3 = CP-ORIGINAL-BENEFIT / ANGLEN-1
  3538
  3539     compute wk3 = wk3 * ((m - (anglen - anglen-m)) / i) *
  3540        (cp-premium-rate / 100)
  3541
  3542
  3543     MOVE WK3                    TO CP-CALC-PREMIUM
  3544
  3545     GO TO 99999-RETURN.
  3546
  3547     .
  3548 12000-check-cid-net-balloons.
  3549     IF (CP-COMPANY-ID EQUAL 'CID')
  3550        AND (CP-EARN-AS-REG-BALLOON)
  3551        and (CP-NET-ONLY-STATE not = 'Y')
  3552        AND (CP-BEN-CATEGORY = 'P' OR 'I')
  3553        CONTINUE
  3554     ELSE
  3555        GO TO 12000-check-cid-net-only-balls
  3556     END-IF
  3557     display ' *** NOT NET ONLY STATE BALLOONS *** '
  3558     COMPUTE Y =
  3559        (1 + (CP-DAYS-TO-1ST-PMT * I / 30)) / (1 + I)
  3560     COMPUTE ANGLEN   = (1 - (1 / (1 + I)) ** N) / I
  3561     COMPUTE ANGLEM   = (1 - (1 / (1 + I)) ** M) / I
  3562     COMPUTE ANGLEM-1   = (1 - (1 / (1 + I)) ** (M - 1)) / I
  3563     COMPUTE ANGLEN-MP1 = (1 - (1 / (1 + I)) ** (N - M + 1)) / I
  3564     COMPUTE ANGLEMY = ANGLEM / Y
  3565     COMPUTE ANGLEM-1Y = ANGLEM-1 / Y
  3566     COMPUTE ANGLENY = ANGLEN / Y
  3567     COMPUTE ANGLEN-MP1Y = ANGLEN-MP1 / Y
  3568     compute cp-original-benefit =
  3569        cp-original-benefit + cp-alternate-benefit
  3570     COMPUTE PVBALLOON rounded =
  3571        CP-ALTERNATE-BENEFIT / ((1 + I) ** (N + 1))
  3572     compute wk4 rounded =
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  67
* ELRFND.cbl
  3573        cp-original-benefit - pvballoon
  3574     compute wk6 rounded =
  3575        (cp-original-benefit - cp-alternate-benefit)
  3576***  compute ra = wk4 / anglem-1y
  3577     compute ra = wk4 / anglemy
  3578     compute wk6 rounded = wk6 / anglemy
  3579     display ' rate before ' cp-premium-rate
  3580     compute cp-premium-rate =
  3581        (cp-premium-rate * ((m + (cp-days-to-1st-pmt - 30)
  3582            / 30) / 12))     /
  3583           ((m + 1) / 2)
  3584     display '************************************'
  3585     display ' orign ben    ' cp-original-benefit
  3586     display ' balloon      ' cp-alternate-benefit
  3587     display ' ra           ' ra
  3588     display ' wk6          ' wk6
  3589     display ' m            ' m
  3590     display ' anglemy      ' anglemy
  3591     display ' anglem-1     ' anglem-1y
  3592     display ' i            ' i
  3593     display ' extra per    ' cp-extra-periods
  3594     display ' prem rate    ' cp-premium-rate
  3595***  compute wk3 = ra * ((m - 1) - anglem-1y) / i * (1 +
  3596***     (cp-extra-periods * i)) * cp-premium-rate / 100
  3597     compute wk3 = wk6 * (m - anglem) / i * (1 +
  3598        (cp-extra-periods * i)) * cp-premium-rate / 100
  3599     move wk3                    to cp-calc-premium
  3600     display ' wk3          ' wk3
  3601     display '************************************'
  3602*    compute wk3 rounded =
  3603*       cp-alternate-benefit * (m + 1) * cp-premium-rate / 100
  3604*    move wk3                    to cp-lf-balloon-prem
  3605     GO TO 99999-RETURN.
  3606     .
  3607 12000-check-cid-net-only-balls.
  3608     IF (CP-COMPANY-ID EQUAL 'CID')
  3609        AND (CP-EARN-AS-REG-BALLOON)
  3610        AND (CP-BEN-CATEGORY = 'P' OR 'I')
  3611        CONTINUE
  3612     ELSE
  3613        GO TO 12000-CHECK-NC-WDS
  3614     END-IF
  3615     display ' *** NET ONLY STATE BALLOONS *** '
  3616     COMPUTE Y =
  3617        (1 + (CP-DAYS-TO-1ST-PMT * I / 30)) / (1 + I)
  3618     COMPUTE ANGLEN   = (1 - (1 / (1 + I)) ** N) / I
  3619     COMPUTE ANGLEM   = (1 - (1 / (1 + I)) ** M) / I
  3620     COMPUTE ANGLEM-1   = (1 - (1 / (1 + I)) ** (M - 1)) / I
  3621     COMPUTE ANGLEN-MP1 = (1 - (1 / (1 + I)) ** (N - M + 1)) / I
  3622     COMPUTE ANGLEMY = ANGLEM / Y
  3623     COMPUTE ANGLEM-1Y = ANGLEM-1 / Y
  3624     COMPUTE ANGLENY = ANGLEN / Y
  3625     COMPUTE ANGLEN-MP1Y = ANGLEN-MP1 / Y
  3626     COMPUTE PVBALLOON rounded =
  3627        CP-ALTERNATE-BENEFIT / ((1 + I) ** (N + 1))
  3628     compute wk4 rounded =
  3629        cp-original-benefit - pvballoon
  3630*    compute cp-premium-rate =
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  68
* ELRFND.cbl
  3631*       (cp-premium-rate * (m + 1) / 12)  /
  3632*          ((m + 2) / 2)
  3633***  compute ra = wk4 / anglem-1y
  3634     compute ra = (cp-original-benefit + cp-alternate-benefit -
  3635        pvballoon) / anglemy
  3636     display '************************************'
  3637     display ' ra           ' ra
  3638     display ' m            ' m
  3639     display ' anglemy      ' anglemy
  3640     display ' anglem-1     ' anglem-1y
  3641     display ' i            ' i
  3642     display ' extra per    ' cp-extra-periods
  3643     display ' prem rate    ' cp-premium-rate
  3644     display '************************************'
  3645***  compute wk3 = ra * ((m - 1) - anglem-1y) / i * (1 +
  3646***     (cp-extra-periods * i)) * cp-premium-rate / 100
  3647     compute wk3 = ra * (m - anglemy) / i * (1 +
  3648        (cp-extra-periods * i)) * cp-premium-rate / 100
  3649     move wk3                    to cp-calc-premium
  3650     compute wk3 rounded =
  3651        cp-alternate-benefit * (m + 1) * cp-premium-rate / 100
  3652     move wk3                    to cp-lf-balloon-prem
  3653     GO TO 99999-RETURN.
  3654     .
  3655 12000-CHECK-NC-WDS.
  3656
  3657     IF (CP-COMPANY-ID EQUAL 'WDS') AND
  3658        (CP-STATE-STD-ABBRV EQUAL 'NC') AND
  3659        (CP-EARN-AS-NET-PAY)
  3660        NEXT SENTENCE
  3661     ELSE
  3662        GO TO 12000-CHECK-NC-BALL-LEV.
  3663
  3664     COMPUTE WK4 EQUAL N * (1 + I * 2).
  3665     COMPUTE ANGLEN EQUAL WK1 / I.
  3666     COMPUTE WK3 EQUAL CP-ORIGINAL-BENEFIT *
  3667              CP-PREMIUM-RATE / +100 *
  3668              N / +12 * 2 / (N + 1) *
  3669              (WK4 - ANGLEN) / (I * ANGLEN).
  3670
  3671      MOVE WK3 TO CP-CALC-PREMIUM.
  3672
  3673     GO TO 99999-RETURN.
  3674
  3675 12000-CHECK-NC-BALL-LEV.
  3676
  3677     IF (CP-COMPANY-ID EQUAL 'WDS') AND
  3678        (CP-STATE-STD-ABBRV EQUAL 'NC') AND
  3679        (CP-DEVIATION-CODE EQUAL 'LEV') AND
  3680        (CP-EARN-AS-REG-BALLOON)
  3681        NEXT SENTENCE
  3682     ELSE
  3683        GO TO 12000-CHECK-NC-BALL.
  3684
  3685     COMPUTE ANGLEN EQUAL WK1 / I.
  3686
  3687**** VX = 1 / (1 + I)**N.
  3688
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  69
* ELRFND.cbl
  3689     COMPUTE WK3 EQUAL CP-ORIGINAL-BENEFIT * CP-PREMIUM-RATE /
  3690        +100 * N / 12 * 2 / (N + 1) * (ANGLEN / VX).
  3691
  3692     MOVE WK3 TO CP-CALC-PREMIUM.
  3693
  3694     GO TO 99999-RETURN.
  3695
  3696 12000-CHECK-NC-BALL.
  3697
  3698     IF (CP-COMPANY-ID EQUAL 'WDS') AND
  3699        (CP-STATE-STD-ABBRV EQUAL 'NC') AND
  3700        (CP-EARN-AS-REG-BALLOON)
  3701        NEXT SENTENCE
  3702     ELSE
  3703        GO TO 12000-CHECK-MINN-TRUNC.
  3704
  3705     COMPUTE WK4 EQUAL (N - 1) * (1 + I * 2).
  3706     COMPUTE ANGLEN EQUAL WK1 / I.
  3707     COMPUTE ANGLEN-1 EQUAL WK6 / I.
  3708**** VX = 1 / (1 + I)**N.
  3709
  3710     COMPUTE WK3 EQUAL CP-ORIGINAL-BENEFIT * CP-PREMIUM-RATE
  3711     / +100 * (N - 1) / 12 * 2 / N *
  3712     (WK4 - ANGLEN-1) / (I * ANGLEN-1).
  3713
  3714      MOVE WK3 TO CP-CALC-PREMIUM.
  3715
  3716     GO TO 99999-RETURN.
  3717
  3718 12000-CHECK-MINN-TRUNC.
  3719
  3720     IF (CP-COMPANY-ID EQUAL 'NCL') AND
  3721        (CP-STATE-STD-ABBRV EQUAL 'MN') AND
  3722        (M GREATER THAN +63) AND
  3723        (CP-EARN-AS-NET-PAY) AND
  3724        (CP-TRUNCATED-LIFE)
  3725        NEXT SENTENCE
  3726     ELSE
  3727        GO TO 12000-CHECK-MINN.
  3728
  3729      COMPUTE ANGLEN EQUAL WK1 / I.
  3730      COMPUTE ANGLEN-M EQUAL WK5 / I.
  3731
  3732      COMPUTE ANGLEN-1 EQUAL ANGLEN * ODF.
  3733
  3734      COMPUTE WK3 EQUAL (CP-ORIGINAL-BENEFIT *
  3735       (CP-PREMIUM-RATE / +100) * 2) / (ANGLEN-1 * (N + 1)) *
  3736       (((M - ANGLEN + ANGLEN-M) / I) + (2 * M)).
  3737
  3738      MOVE WK3 TO CP-CALC-PREMIUM.
  3739
  3740     GO TO 99999-RETURN.
  3741
  3742 12000-CHECK-MINN.
  3743
  3744     IF (CP-COMPANY-ID EQUAL 'NCL') AND
  3745        (CP-STATE-STD-ABBRV EQUAL 'MN') AND
  3746        (M GREATER THAN +63) AND
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  70
* ELRFND.cbl
  3747        (CP-EARN-AS-NET-PAY)
  3748        NEXT SENTENCE
  3749     ELSE
  3750        GO TO 12000-CHECK-MONTANA-TRUNC.
  3751
  3752      COMPUTE ANGLEN EQUAL WK1 / I.
  3753
  3754      COMPUTE ANGLEN-1 EQUAL ANGLEN * ODF.
  3755
  3756      COMPUTE WK3 EQUAL (CP-ORIGINAL-BENEFIT *
  3757       (CP-PREMIUM-RATE / +100) * 2) / (ANGLEN-1 * (N + 1)) *
  3758       (((N - ANGLEN) / I) + (2 * N)).
  3759
  3760      MOVE WK3 TO CP-CALC-PREMIUM.
  3761
  3762     GO TO 99999-RETURN.
  3763
  3764 12000-CHECK-MONTANA-TRUNC.
  3765
  3766     IF (CP-COMPANY-ID EQUAL 'NCL') AND
  3767        (CP-STATE-STD-ABBRV EQUAL 'MT') AND
  3768        (M GREATER THAN +63) AND
  3769        (CP-EARN-AS-NET-PAY) AND
  3770        (CP-TRUNCATED-LIFE)
  3771        NEXT SENTENCE
  3772     ELSE
  3773        GO TO 12000-CHECK-MONTANA.
  3774
  3775      COMPUTE ANGLEN EQUAL WK1 / I.
  3776      COMPUTE ANGLEN-M EQUAL WK5 / I.
  3777
  3778      COMPUTE ANGLEN-1 EQUAL ANGLEN * ODF.
  3779
  3780      COMPUTE WK3 EQUAL CP-ORIGINAL-BENEFIT *
  3781      ((CP-PREMIUM-RATE / +100) * 2) / (ANGLEN-1 * (N + 1)) *
  3782       (((M - ANGLEN + ANGLEN-M) / I) + (4 * M)).
  3783
  3784      MOVE WK3 TO CP-CALC-PREMIUM.
  3785
  3786     GO TO 99999-RETURN.
  3787
  3788 12000-CHECK-MONTANA.
  3789
  3790     IF (CP-COMPANY-ID EQUAL 'NCL') AND
  3791        (CP-STATE-STD-ABBRV EQUAL 'MT') AND
  3792        (M GREATER THAN +63) AND
  3793        (CP-EARN-AS-NET-PAY)
  3794        NEXT SENTENCE
  3795     ELSE
  3796        GO TO 12001-CONTINUE-NCL-TRUNC.
  3797
  3798      COMPUTE ANGLEN EQUAL WK1 / I.
  3799
  3800      COMPUTE ANGLEN-1 EQUAL ANGLEN * ODF.
  3801
  3802      COMPUTE WK3 EQUAL (CP-ORIGINAL-BENEFIT *
  3803       (CP-PREMIUM-RATE / +100) * 2) / (ANGLEN-1 * (N + 1)) *
  3804       (((N - ANGLEN) / I) + (4 * N)).
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  71
* ELRFND.cbl
  3805
  3806      MOVE WK3 TO CP-CALC-PREMIUM.
  3807
  3808     GO TO 99999-RETURN.
  3809
  3810 12001-CONTINUE-NCL-TRUNC.
  3811
  3812     IF (CP-COMPANY-ID EQUAL 'NCL') AND
  3813        (CP-EARN-AS-NET-PAY) AND
  3814        (CP-TRUNCATED-LIFE)
  3815        NEXT SENTENCE
  3816     ELSE
  3817        GO TO 12001-CONTINUE-NCL.
  3818
  3819      COMPUTE ANGLEN EQUAL WK1 / I.
  3820      COMPUTE ANGLEN-M EQUAL WK5 / I.
  3821
  3822      COMPUTE ANGLEN-1 EQUAL ANGLEN * ODF.
  3823
  3824      COMPUTE WK3 EQUAL (CP-ORIGINAL-BENEFIT * 2 *
  3825      (M - (ANGLEN - ANGLEN-M)) * (CP-PREMIUM-RATE / +100)) /
  3826      (ANGLEN-1 * (N + 1) * I).
  3827
  3828      MOVE WK3 TO CP-CALC-PREMIUM.
  3829
  3830     GO TO 99999-RETURN.
  3831
  3832 12001-CONTINUE-NCL.
  3833
  3834     IF (CP-COMPANY-ID EQUAL 'NCL') AND
  3835        (CP-STATE-STD-ABBRV EQUAL 'NC') AND
  3836        (CP-EARN-AS-NET-PAY)
  3837        GO TO 12001-CHECK-NC-NET-PLUS3.
  3838
  3839     IF (CP-COMPANY-ID EQUAL 'NCL') AND
  3840        (CP-STATE-STD-ABBRV EQUAL 'CA') AND
  3841        (CP-EARN-AS-NET-PAY)
  3842        GO TO 12001-CHECK-CA.
  3843
  3844     IF (CP-COMPANY-ID EQUAL 'NCL') AND
  3845        (CP-EARN-AS-NET-PAY)
  3846        NEXT SENTENCE
  3847     ELSE
  3848        GO TO 12000-CONTINUE-NET.
  3849
  3850      COMPUTE ANGLEN EQUAL WK1 / I.
  3851      MOVE ANGLEN                TO ANGLEN-1.
  3852
  3853      COMPUTE ANGLEN-1 EQUAL ANGLEN * ODF.
  3854
  3855      COMPUTE WK3 EQUAL (CP-ORIGINAL-BENEFIT *
  3856       (CP-PREMIUM-RATE / +100) * 2) / (ANGLEN-1 * (N + 1)) *
  3857       ((N - ANGLEN) / I).
  3858
  3859      MOVE WK3 TO CP-CALC-PREMIUM.
  3860
  3861     GO TO 99999-RETURN.
  3862
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  72
* ELRFND.cbl
  3863 12000-CONTINUE-NET.
  3864
  3865     IF (CP-COMPANY-ID EQUAL 'TMS') AND
  3866        (CP-STATE-STD-ABBRV EQUAL 'MN' OR 'CA' OR 'WA') AND
  3867        (CP-EARN-AS-NET-PAY)
  3868        NEXT SENTENCE
  3869     ELSE
  3870        GO TO 12001-CONTINUE-MINN.
  3871
  3872      COMPUTE ANGLEN EQUAL WK6 / I.
  3873      COMPUTE ODF EQUAL 1 + (12 * CP-TERM-OR-EXT-DAYS / +365).
  3874
  3875      COMPUTE WK7 EQUAL (1 + ODF * I) / (1 + ANGLEN).
  3876      COMPUTE WK3 EQUAL (M  * WK7) - 1.
  3877      COMPUTE WK3 EQUAL (WK3 / I) *
  3878       ((M * (CP-PREMIUM-RATE / +100)) / (+6 * (M + 1))).
  3879
  3880      IF CP-R-MAX-TOT-BEN NOT NUMERIC
  3881         MOVE +0 TO CP-R-MAX-TOT-BEN.
  3882
  3883      COMPUTE WK3 EQUAL (WK3 * CP-ORIGINAL-BENEFIT)
  3884
  3885      IF (CP-ORIGINAL-BENEFIT GREATER THAN CP-R-MAX-TOT-BEN) AND
  3886         (CP-R-MAX-TOT-BEN NOT EQUAL +0)
  3887         COMPUTE WK3 EQUAL (WK3 * CP-R-MAX-TOT-BEN).
  3888
  3889      MOVE WK3 TO CP-CALC-PREMIUM.
  3890
  3891     GO TO 99999-RETURN.
  3892
  3893 12001-CONTINUE-MINN.
  3894
  3895     IF (CP-COMPANY-ID EQUAL 'GTL') AND
  3896        (CP-STATE-STD-ABBRV EQUAL 'NJ') AND
  3897        (CP-TRUNCATED-LIFE)
  3898        NEXT SENTENCE
  3899     ELSE
  3900        GO TO 12001-CHECK-RI-GTL.
  3901
  3902      COMPUTE ANGLEN EQUAL WK1 / I.
  3903      COMPUTE ANGLEM EQUAL WK2 / I.
  3904
  3905      COMPUTE WK3 EQUAL ((M - ANGLEM * SX) /
  3906       (I * ANGLEN) * CP-PREMIUM-RATE / (1 + WS-WORK-DIS-RATE
  3907       * M / 2400) * 1000 + .5) / 1000000.
  3908
  3909      COMPUTE CP-CALC-PREMIUM EQUAL WK3 * (CP-ORIGINAL-BENEFIT
  3910       - CP-ORIGINAL-PREMIUM) / (1 - WK3).
  3911
  3912     GO TO 99999-RETURN.
  3913
  3914 12001-CHECK-RI-GTL.
  3915
  3916     IF (CP-COMPANY-ID EQUAL 'GTL' ) AND
  3917        (CP-STATE-STD-ABBRV EQUAL 'RI') AND
  3918        (CP-EARN-AS-NET-PAY)
  3919        NEXT SENTENCE
  3920     ELSE
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  73
* ELRFND.cbl
  3921        GO TO 12001-CHECK-RI-LEASE-GTL.
  3922
  3923      COMPUTE ANGLEN EQUAL WK1 / I.
  3924*     COMPUTE ANGLEM EQUAL WK2 / I.
  3925
  3926      COMPUTE WK3 EQUAL (1000 * I * ANGLEN) *
  3927               (1 + WS-WORK-DIS-RATE * N).
  3928      COMPUTE CP-CALC-PREMIUM EQUAL CP-ORIGINAL-BENEFIT *
  3929         ((N - ANGLEN) * (1 + 2 * I) * CP-PREMIUM-RATE) / WK3.
  3930
  3931
  3932     GO TO 99999-RETURN.
  3933
  3934 12001-CHECK-RI-LEASE-GTL.
  3935
  3936     IF (CP-COMPANY-ID EQUAL 'GTL' ) AND
  3937        (CP-STATE-STD-ABBRV EQUAL 'RI') AND
  3938        (CP-SPECIAL-CALC-CD EQUAL 'H')
  3939        NEXT SENTENCE
  3940     ELSE
  3941        GO TO 12001-CHECK-OR-GTL.
  3942
  3943     COMPUTE ANGLEN EQUAL WK1 / I.
  3944
  3945     COMPUTE WK3 EQUAL (CP-ORIGINAL-BENEFIT / ANGLEN *
  3946        (N - ANGLEN) * CP-PREMIUM-RATE * (1 + 2 * I))
  3947                        /
  3948        (1000 * I * (1 + .0021 * N)).
  3949     COMPUTE CP-CALC-PREMIUM EQUAL WK3 +
  3950       (CP-ALTERNATE-BENEFIT * CP-PREMIUM-RATE * (N + 1))
  3951                            /
  3952       (1000 * (1 + .0027 * (N + 1))).
  3953
  3954     GO TO 99999-RETURN.
  3955
  3956 12001-CHECK-OR-GTL.
  3957
  3958     IF (CP-COMPANY-ID EQUAL 'GTL' ) AND
  3959        (CP-STATE-STD-ABBRV EQUAL 'OR') AND
  3960        (CP-EARN-AS-NET-PAY)
  3961        NEXT SENTENCE
  3962     ELSE
  3963        GO TO 12001-CHECK-GA-GTL.
  3964
  3965     COMPUTE ANGLEN-M EQUAL WK5 / I.
  3966     COMPUTE ANGLEN EQUAL WK1 / I.
  3967
  3968     IF M LESS THAN +64
  3969        COMPUTE WK3 EQUAL (((N - (N - M)) - (ANGLEN - ANGLEN-M)) *
  3970         (1 + I) * CP-PREMIUM-RATE * (N - (N - M)))
  3971                   /
  3972         (I * ANGLEN * (N - (N - M) + 1) * 600)
  3973        COMPUTE CP-CALC-PREMIUM EQUAL WK3 * CP-ORIGINAL-BENEFIT
  3974     ELSE
  3975        COMPUTE WK3 EQUAL (((N - (N - M)) - (ANGLEN - ANGLEN-M)) *
  3976        CP-PREMIUM-RATE * (1 + I))
  3977                  /
  3978        (+1000 * I * ANGLEN)
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  74
* ELRFND.cbl
  3979        COMPUTE CP-CALC-PREMIUM EQUAL WK3 * CP-ORIGINAL-BENEFIT.
  3980*    MOVE WK3 TO CP-CALC-PREMIUM.
  3981     GO TO 99999-RETURN.
  3982
  3983 12001-CHECK-GA-GTL.
  3984
  3985     IF (CP-COMPANY-ID EQUAL 'GTL') AND
  3986        (CP-STATE-STD-ABBRV EQUAL 'GA') AND
  3987        (CP-EARN-AS-NET-PAY)
  3988*       (CP-TRUNCATED-LIFE)
  3989        NEXT SENTENCE
  3990     ELSE
  3991        GO TO 12001-CHECK-MA-GTL.
  3992
  3993     COMPUTE ANGLEN-M EQUAL WK5 / I.
  3994     COMPUTE ANGLEN EQUAL WK1 / I.
  3995
  3996     COMPUTE WK3 EQUAL CP-ORIGINAL-BENEFIT / ANGLEN.
  3997     COMPUTE WK3 EQUAL (CP-PREMIUM-RATE / +1000) * WK3 *
  3998      ((N - (ANGLEN - ANGLEN-M)) / I) * (1 + 2 * I).
  3999     MOVE WK3 TO CP-CALC-PREMIUM.
  4000
  4001     GO TO 99999-RETURN.
  4002
  4003 12001-CHECK-MA-GTL.
  4004
  4005     IF (CP-COMPANY-ID EQUAL 'GTL') AND
  4006        (CP-STATE-STD-ABBRV EQUAL 'MA') AND
  4007        (CP-EARN-AS-NET-PAY) AND
  4008        (CP-SPECIAL-CALC-CD EQUAL 'H')
  4009        NEXT SENTENCE
  4010     ELSE
  4011        GO TO 12001-CHECK-NV-NET.
  4012
  4013     COMPUTE ANGLEN EQUAL WK1 / I.
  4014
  4015     COMPUTE WK3 EQUAL (CP-PREMIUM-RATE / +1000) *
  4016      CP-ALTERNATE-BENEFIT * N.
  4017
  4018     COMPUTE WK7 EQUAL (CP-ORIGINAL-BENEFIT + WK3) /
  4019     (ANGLEN - (CP-PREMIUM-RATE / +1000) * (N - ANGLEN) / I).
  4020
  4021     COMPUTE WK3 EQUAL WK3 + (CP-PREMIUM-RATE / +1000) *
  4022     WK7 * (N - ANGLEN) / I.
  4023     MOVE WK3 TO CP-CALC-PREMIUM.
  4024
  4025     GO TO 99999-RETURN.
  4026
  4027 12001-CHECK-NV-NET.
  4028     IF (CP-COMPANY-ID EQUAL 'CID')
  4029        AND (CP-STATE-STD-ABBRV = 'NV' OR 'WA')
  4030        AND (CP-EARN-AS-NET-PAY)
  4031        CONTINUE
  4032     ELSE
  4033        GO TO 12001-CHECK-MN-NET
  4034     END-IF
  4035     COMPUTE ANGLEN = (1 - (1 / (1 + I)) ** N) / I
  4036     COMPUTE ANGLEN-M = (1 - (1 / (1 + I)) ** (N - M)) / I
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  75
* ELRFND.cbl
  4037     COMPUTE WK8 = (1 + ((CP-TERM-OR-EXT-DAYS + +30) * I) / +30)
  4038                   / (1 + I)
  4039     COMPUTE ANGLEN-1 = ANGLEN / WK8
  4040     COMPUTE WK4 = CP-ORIGINAL-BENEFIT / ANGLEN-1
  4041     COMPUTE WK3 = WK4 * ((M - (ANGLEN - ANGLEN-M)) / I) *
  4042        (CP-PREMIUM-RATE * K-I / 1000)
  4043     MOVE WK3                    TO CP-CALC-PREMIUM
  4044     GO TO 99999-RETURN
  4045      .
  4046 12001-CHECK-MN-NET.
  4047     IF (CP-COMPANY-ID EQUAL 'CID')
  4048        AND (CP-STATE-STD-ABBRV = 'MN')
  4049        AND (CP-EARN-AS-NET-PAY)
  4050        AND (NOT CP-LEVEL-LIFE)
  4051        AND (WS-DISCOUNT-OPTION = '1')
  4052        CONTINUE
  4053     ELSE
  4054        GO TO 12001-CHECK-NC-NET
  4055     END-IF
  4056     if i = .0000000001
  4057        compute wk4 = cp-original-benefit / n
  4058        compute wk3 = wk4 * ((n * (n + 1) / 2) - ((n - m) *
  4059           (n - m + 1) / 2))*(cp-premium-rate / 1000)
  4060        move wk3 to cp-calc-premium
  4061        go to 99999-return
  4062     end-if
  4063     COMPUTE ANGLEN = (1 - (1 / (1 + I)) ** N) / I
  4064     COMPUTE ANGLEN-M = (1 - (1 / (1 + I)) ** (N - M)) / I
  4065     COMPUTE WK8 = (1 + ((CP-TERM-OR-EXT-DAYS + +30) * I) / +30)
  4066                   / (1 + I)
  4067     COMPUTE ANGLEN-1 = ANGLEN / WK8
  4068     COMPUTE WK4 = CP-ORIGINAL-BENEFIT / ANGLEN-1
  4069     COMPUTE WK3 = WK4 * ((M - (ANGLEN - ANGLEN-M)) / I) *
  4070        (CP-PREMIUM-RATE / 1000) * (1 + I)
  4071     MOVE WK3                    TO CP-CALC-PREMIUM
  4072     GO TO 99999-RETURN
  4073      .
  4074 12001-CHECK-NC-NET.
  4075
  4076     IF (CP-COMPANY-ID EQUAL 'NCB' ) AND
  4077        (CP-STATE-STD-ABBRV EQUAL 'NC') AND
  4078        (CP-EARN-AS-NET-PAY)
  4079        NEXT SENTENCE
  4080     ELSE
  4081        GO TO 12001-CHECK-NC-NET-PLUS3.
  4082
  4083      COMPUTE ANGLEN EQUAL WK1 / I.
  4084      COMPUTE ANGLEN-M EQUAL WK5 / I.
  4085
  4086      COMPUTE WK6 ROUNDED = CP-ORIGINAL-BENEFIT /
  4087          (ANGLEN - (CP-PREMIUM-RATE / 1000) *
  4088          ((N - (ANGLEN - ANGLEN-M)) / I + 3 * N) -
  4089          N * (CP-PREMIUM-RATE / 1000)).
  4090
  4091      COMPUTE WK3 ROUNDED = (CP-PREMIUM-RATE / 1000) * WK6 *
  4092          ((N - (ANGLEN - ANGLEN-M)) / I + 3 * N).
  4093
  4094      COMPUTE WK7 ROUNDED = (1 - (CP-PREMIUM-RATE / 1000) *
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  76
* ELRFND.cbl
  4095          ((N - ANGLEN) / I + 3) / ANGLEN) /
  4096          (1 - (CP-PREMIUM-RATE / 1000) * N * (N + 1) /
  4097          (ANGLEN * 2))
  4098
  4099      COMPUTE WK7 ROUNDED = WK7 * N - 3.
  4100
  4101      IF ANGLEN IS NOT LESS THAN WK7
  4102          COMPUTE CP-PREMIUM-RATE ROUNDED =
  4103              (CP-PREMIUM-RATE / 1000) * +6.5 * (N / 12)
  4104          COMPUTE WK3 ROUNDED =
  4105              (CP-ORIGINAL-BENEFIT * CP-PREMIUM-RATE).
  4106
  4107     MOVE WK3 TO CP-CALC-PREMIUM.
  4108
  4109     GO TO 99999-RETURN.
  4110
  4111 12001-CHECK-NC-NET-PLUS3.
  4112
  4113     IF (CP-STATE-STD-ABBRV EQUAL 'NC') AND
  4114        (CP-EARN-AS-NET-PAY) AND
  4115        (CP-COMPANY-ID NOT = 'CID' AND 'DCC' AND 'AHL' AND 'VPP')
  4116        NEXT SENTENCE
  4117     ELSE
  4118        GO TO 12001-CHECK-CA.
  4119
  4120     MOVE CP-CERT-EFF-DT TO DC-BIN-DATE-1.
  4121     MOVE ' ' TO DC-OPTION-CODE.
  4122     PERFORM 9100-CONVERT-DATE THRU 9100-EXIT.
  4123
  4124     IF DATE-CONVERSION-ERROR
  4125        MOVE '2'                 TO CP-RETURN-CODE
  4126        MOVE ZEROS               TO FACTOR
  4127                                    CP-CALC-PREMIUM
  4128         GO TO 99999-RETURN.
  4129
  4130     IF DC-GREG-DATE-CYMD GREATER THAN 19931231
  4131        NEXT SENTENCE
  4132     ELSE
  4133        GO TO 12001-CONTINUE-NET.
  4134
  4135     COMPUTE ANGLEN EQUAL WK1 / I.
  4136     COMPUTE ANGLEN-M EQUAL WK5 / I.
  4137
  4138     COMPUTE NC-LR = CP-PREMIUM-RATE / ( ORIGINAL-TERM / 12).
  4139
  4140     COMPUTE NC-R = 20 *
  4141                    ((NC-LR * ORIGINAL-TERM) / 12)
  4142                          / (ORIGINAL-TERM + 1).
  4143
  4144     COMPUTE NC-OB = NC-R / 1000.
  4145
  4146     COMPUTE NC-P = (((ORIGINAL-TERM - ANGLEN) / I) * NC-OB) +
  4147                    (NC-OB * ORIGINAL-TERM * 3).
  4148
  4149     IF CP-EXT-CHG-LF
  4150         COMPUTE NC-BIG-D = CP-TERM-OR-EXT-DAYS + 30
  4151     ELSE
  4152         MOVE 30                 TO  NC-BIG-D.
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  77
* ELRFND.cbl
  4153
  4154     COMPUTE NC-LITTLE-D = (1 + I) /
  4155             ((( 1 + ((NC-BIG-D / 30.4166666)) * I))).
  4156
  4157     COMPUTE NC-MP ROUNDED = CP-ORIGINAL-BENEFIT  /
  4158             (ANGLEN * NC-LITTLE-D ).
  4159
  4160     COMPUTE CP-CALC-PREMIUM ROUNDED = NC-MP * NC-P.
  4161
  4162     GO TO 99999-RETURN.
  4163
  4164 12001-CHECK-CA.
  4165
  4166     IF (CP-STATE-STD-ABBRV EQUAL 'CA') AND
  4167        (WS-DISCOUNT-OPTION = '6')
  4168        NEXT SENTENCE
  4169     ELSE
  4170        GO TO 12001-CHECK-GTL-IA.
  4171
  4172     COMPUTE CA-J = CA-DISCOUNT / 12.
  4173     COMPUTE ANGLEN EQUAL WK1 / I.
  4174     COMPUTE CA-MP = CP-ORIGINAL-BENEFIT  / ANGLEN.
  4175     COMPUTE CA-API = (1 - (1 + I)** - ORIGINAL-TERM) / I.
  4176     COMPUTE CA-APJ = (1 - (1 + CA-J)** - ORIGINAL-TERM) / CA-J.
  4177     COMPUTE CA-VI = (1 + I)** -1.
  4178     COMPUTE CP-CALC-PREMIUM =
  4179         ((CP-PREMIUM-RATE * 2) / (100 * (ORIGINAL-TERM + 1)) *
  4180         ((1 + CA-J) / I) *
  4181         (CA-APJ + (CA-J * CA-APJ - I * CA-API) *
  4182         ((CA-VI ** (LOAN-TERM - ORIGINAL-TERM)) /
  4183         (I - CA-J))) * (1 + CP-ODD-DAYS-TO-PMT * I) * CA-MP).
  4184
  4185     GO TO 99999-RETURN.
  4186
  4187 12001-CHECK-GTL-IA.
  4188
  4189     IF (CP-COMPANY-ID EQUAL 'GTL')     AND
  4190        (CP-STATE-STD-ABBRV EQUAL 'IA') AND
  4191        (CP-EARN-AS-NET-PAY)
  4192        NEXT SENTENCE
  4193     ELSE
  4194        GO TO 12001-CHECK-CID-TRN-VA.
  4195
  4196***************************************************************
  4197
  4198     COMPUTE GTL-IA-ODD-DAYS = CP-ODD-DAYS-TO-PMT - 30.
  4199
  4200     IF GTL-IA-ODD-DAYS = ZEROS
  4201         MOVE ZERO               TO  GTL-IA-SGN
  4202     ELSE
  4203         IF GTL-IA-ODD-DAYS GREATER THAN ZERO
  4204             MOVE +1             TO  GTL-IA-SGN
  4205         ELSE
  4206             MOVE -1             TO  GTL-IA-SGN.
  4207
  4208     MOVE GTL-IA-ODD-DAYS        TO  GTL-IA-ABS.
  4209     COMPUTE GTL-IA-ABS = GTL-IA-ABS - 30.
  4210
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  78
* ELRFND.cbl
  4211     COMPUTE GTL-IA-ODF = (1 + I * GTL-IA-ABS / 30) **
  4212                          GTL-IA-SGN.
  4213
  4214     COMPUTE ANGLEN EQUAL WK1 / I.
  4215     COMPUTE ANGLEN-M EQUAL WK5 / I.
  4216
  4217     IF GTL-IA-ODF NOT = ZERO
  4218         COMPUTE ANGLEN EQUAL ANGLEN / GTL-IA-ODF
  4219         COMPUTE ANGLEN-M EQUAL ANGLEN-M / GTL-IA-ODF.
  4220
  4221     COMPUTE GTL-IA-DIVIDEND =
  4222           (((N-P-LOAN - (N-P-LOAN - N-P-ORIG)) -
  4223                             (ANGLEN - ANGLEN-M))) *
  4224           ((K1 + I) * CP-PREMIUM-RATE *
  4225                     (N-P-LOAN - (N-P-LOAN - N-P-ORIG))).
  4226
  4227     COMPUTE GTL-IA-DIVISOR =
  4228      I * ANGLEN * (N-P-LOAN - (N-P-LOAN - N-P-ORIG) + 1) * +600.
  4229
  4230     COMPUTE GTL-IA-FACTOR = GTL-IA-DIVIDEND / GTL-IA-DIVISOR.
  4231
  4232     COMPUTE CP-CALC-PREMIUM =
  4233                           GTL-IA-FACTOR * CP-ORIGINAL-BENEFIT.
  4234     GO TO 99999-RETURN.
  4235
  4236
  4237 12001-CHECK-CID-TRN-VA.
  4238
  4239     IF (CP-COMPANY-ID EQUAL 'CID')     AND
  4240        (CP-STATE-STD-ABBRV EQUAL 'VA') AND
  4241        (CP-EARN-AS-NET-PAY) AND
  4242        (CP-TRUNCATED-LIFE) AND
  4243        (CP-STATE-STD-ABBRV = CP-STATE)
  4244        CONTINUE
  4245     ELSE
  4246        GO TO 12001-CHECK-CID-TX
  4247     END-IF
  4248
  4249     COMPUTE ANGLEN EQUAL WK1 / I
  4250     COMPUTE WS-WORK-DIS-RATE = WS-WORK-DIS-RATE / +12
  4251     IF WS-WORK-DIS-RATE = ZEROS
  4252        CONTINUE
  4253     ELSE
  4254        COMPUTE WK4 = 1 / (1 + WS-WORK-DIS-RATE)
  4255        COMPUTE WK7 = (1 / I) *
  4256              (((WK4 ** M - 1) / (WK4 - 1)) -
  4257              ((WK4 ** M * SX - VX) /
  4258              (WK4 * (1 + I) - 1))) *
  4259              (CP-PREMIUM-RATE / 1000)
  4260        COMPUTE WK4 = CP-ORIGINAL-BENEFIT / ANGLEN
  4261        COMPUTE WK8 = WK7 * 100 / ANGLEN
  4262        COMPUTE CP-CALC-PREMIUM =
  4263           WK8 *  ((WK4 * ANGLEN) / 100)
  4264     END-IF
  4265
  4266     GO TO 99999-RETURN
  4267
  4268     .
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  79
* ELRFND.cbl
  4269
  4270 12001-CHECK-CID-TX.
  4271     IF (CP-COMPANY-ID EQUAL 'CID')     AND
  4272        (CP-STATE-STD-ABBRV EQUAL 'TX') AND
  4273        (CP-EARN-AS-NET-PAY) AND
  4274        (WS-WORK-DIS-RATE > ZEROS) AND
  4275        (CP-STATE-STD-ABBRV = CP-STATE)
  4276        CONTINUE
  4277     ELSE
  4278        GO TO 12001-CHECK-CID-LEV-MN-NEW
  4279     END-IF
  4280* THE FOLLOWING STMT FORCES ONE MONTH EXTRA INT PERIOD
  4281     COMPUTE K-I = 1 + (1 * I)
  4282     COMPUTE ANGLEN EQUAL WK1 / I
  4283     COMPUTE ANGLEM EQUAL WK2 / I
  4284     COMPUTE WS-WORK-DIS-RATE = WS-WORK-DIS-RATE / +12
  4285     IF WS-WORK-DIS-RATE = ZEROS
  4286        CONTINUE
  4287     ELSE
  4288        COMPUTE WK4 = 1 / (1 + WS-WORK-DIS-RATE)
  4289        COMPUTE WK7 = (K-I / I) *
  4290              (((WK4 ** M - 1) / (WK4 - 1)) -
  4291*             ((WK4 ** M * SX - VX) /
  4292              ((WK4 ** M * SX) - VX) /
  4293*             (WK4 * (1 + I) - 1))) *
  4294              (WK4 * (1 + I) - 1)) *
  4295              (CP-PREMIUM-RATE / 1000)
  4296        COMPUTE WK4 = CP-ORIGINAL-BENEFIT / ANGLEN
  4297        COMPUTE WK8 = (WK7 * 100) / (ANGLEN * K-I)
  4298        COMPUTE CP-CALC-PREMIUM =
  4299           WK8 *  ((WK4 * ANGLEN * K-I) / 100)
  4300     END-IF
  4301
  4302     GO TO 99999-RETURN
  4303     .
  4304 12001-CHECK-CID-LEV-MN-NEW.
  4305*    IF (CP-COMPANY-ID EQUAL 'CID')
  4306*       AND (CP-STATE-STD-ABBRV = 'MN')
  4307*       AND (CP-EARN-AS-NET-PAY)
  4308*       AND (CP-LEVEL-LIFE)
  4309*       AND (CP-CERT-EFF-DT > X'A4FF')
  4310*       CONTINUE
  4311*    ELSE
  4312*       GO TO 12001-CHECK-CID-LEV-MN
  4313*    END-IF
  4314*
  4315*    MOVE CP-CERT-EFF-DT         TO DC-BIN-DATE-1
  4316*    MOVE CP-EXPIRE-DT           TO DC-BIN-DATE-2
  4317*    MOVE '1'                    TO DC-OPTION-CODE
  4318*    PERFORM 9100-CONVERT-DATE THRU 9100-EXIT
  4319*
  4320*    IF DATE-CONVERSION-ERROR
  4321*       MOVE '2'                 TO CP-RETURN-CODE
  4322*       MOVE ZEROS               TO FACTOR
  4323*                                   CP-CALC-PREMIUM
  4324*       GO TO 99999-RETURN
  4325*    END-IF
  4326*
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  80
* ELRFND.cbl
  4327*    COMPUTE I = CP-LOAN-APR / 100
  4328*    COMPUTE D = DC-ELAPSED-DAYS + CP-TERM-OR-EXT-DAYS
  4329*
  4330*    COMPUTE WK3 = (CP-ORIGINAL-BENEFIT - CP-ORIGINAL-PREMIUM) /
  4331*      (1 / (1 + (I * D / 360)) - CP-PREMIUM-RATE / 1000
  4332*      * 12 / 360 * D)
  4333*
  4334*    COMPUTE CP-CALC-PREMIUM = WK3 * CP-PREMIUM-RATE / 1000
  4335*       * 12 / 360 * D
  4336*
  4337*    GO TO 99999-RETURN
  4338      .
  4339 12001-CHECK-CID-LEV-MN.
  4340
  4341     IF (CP-COMPANY-ID EQUAL 'CID')     AND
  4342        (CP-STATE-STD-ABBRV EQUAL 'MN') AND
  4343        (CP-EARN-AS-NET-PAY) AND
  4344        (CP-LEVEL-LIFE) AND
  4345        (CP-STATE-STD-ABBRV = CP-STATE)
  4346        CONTINUE
  4347     ELSE
  4348        GO TO 12001-CHECK-CID-LEV-CA
  4349     END-IF
  4350
  4351     COMPUTE CP-CALC-PREMIUM = (CP-ORIGINAL-BENEFIT *
  4352         (N / +12) * (CP-PREMIUM-RATE / +100)) /
  4353         (1 - (N / +12) * (CP-PREMIUM-RATE / 100))
  4354
  4355     GO TO 99999-RETURN
  4356
  4357      .
  4358 12001-CHECK-CID-LEV-CA.
  4359
  4360     IF (CP-COMPANY-ID EQUAL 'CID')     AND
  4361        (CP-STATE-STD-ABBRV EQUAL 'CA') AND
  4362        (CP-EARN-AS-NET-PAY) AND
  4363        (CP-LEVEL-LIFE) AND
  4364        (CP-STATE-STD-ABBRV = CP-STATE)
  4365        CONTINUE
  4366     ELSE
  4367        GO TO 12001-CHECK-CID-TRN-CA
  4368     END-IF
  4369
  4370     COMPUTE WK4 = WS-WORK-DIS-RATE / 12
  4371     COMPUTE WK7 = (1 / (1 + WK4)) ** N
  4372     COMPUTE WK8 = (1 / (1 + WK4)) ** (N - 1)
  4373     COMPUTE ANGLEN-1 = (1 - WK8) / WK4
  4374     COMPUTE CP-CALC-PREMIUM =
  4375          (CP-ORIGINAL-BENEFIT * (1 + ANGLEN-1) *
  4376          (CP-PREMIUM-RATE / 1000)) /
  4377          (1 - ((1 + ANGLEN-1) * (CP-PREMIUM-RATE / 1000)))
  4378
  4379     GO TO 99999-RETURN
  4380
  4381      .
  4382 12001-CHECK-CID-TRN-CA.
  4383
  4384     IF (CP-COMPANY-ID EQUAL 'CID')     AND
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  81
* ELRFND.cbl
  4385        (CP-STATE-STD-ABBRV EQUAL 'CA') AND
  4386        (CP-EARN-AS-NET-PAY) AND
  4387        (CP-TRUNCATED-LIFE) AND
  4388        (CP-STATE-STD-ABBRV = CP-STATE) AND
  4389        (WS-DISCOUNT-OPTION NOT = ' ')
  4390        CONTINUE
  4391     ELSE
  4392        GO TO 12001-CHECK-CID-TRN-MT
  4393     END-IF
  4394
  4395     COMPUTE ANGLEN EQUAL WK1 / I
  4396     COMPUTE WS-WORK-DIS-RATE = WS-WORK-DIS-RATE / +12
  4397     IF WS-WORK-DIS-RATE = ZEROS
  4398        CONTINUE
  4399     ELSE
  4400        COMPUTE WK4 = 1 / (1 + WS-WORK-DIS-RATE)
  4401        COMPUTE WK7 = (1 / I) *
  4402              (((WK4 ** M - 1) / (WK4 - 1)) -
  4403              ((WK4 ** M * SX - VX) /
  4404              (WK4 * (1 + I) - 1))) *
  4405              (CP-PREMIUM-RATE / 1000)
  4406        COMPUTE WK4 = CP-ORIGINAL-BENEFIT / ANGLEN
  4407        COMPUTE CP-CALC-PREMIUM =
  4408           WK4 *  WK7
  4409     END-IF
  4410
  4411     GO TO 99999-RETURN
  4412
  4413      .
  4414 12001-CHECK-CID-TRN-MT.
  4415
  4416     IF (CP-COMPANY-ID EQUAL 'CID') AND
  4417        ((CP-STATE-STD-ABBRV EQUAL 'MT' OR 'VT')
  4418                   OR
  4419        ((CP-STATE-STD-ABBRV = 'IN') AND
  4420        (CP-CERT-EFF-DT > X'9A7F'))
  4421                   OR
  4422        ((CP-STATE-STD-ABBRV = 'AZ' OR 'ND') AND
  4423        (CP-CERT-EFF-DT > X'9ADF'))) AND
  4424        (CP-EARN-AS-NET-PAY) AND
  4425        (CP-TRUNCATED-LIFE) AND
  4426        (CP-STATE-STD-ABBRV = CP-STATE)
  4427        CONTINUE
  4428     ELSE
  4429        GO TO 12001-CHECK-CID-MT
  4430     END-IF
  4431
  4432* K-I WILL BE USED FOR EXTRA INT. PERIODS
  4433     IF CP-STATE-STD-ABBRV = 'IN' OR 'ND'
  4434        MOVE 0                   TO K-I
  4435     ELSE
  4436        MOVE 2                   TO K-I
  4437     END-IF
  4438     COMPUTE CP-TERM-OR-EXT-DAYS =
  4439           CP-TERM-OR-EXT-DAYS + 30
  4440
  4441     COMPUTE ANGLEN EQUAL WK1 / I
  4442     COMPUTE WS-WORK-DIS-RATE = WS-WORK-DIS-RATE / +12
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  82
* ELRFND.cbl
  4443     COMPUTE WK8 = (1 + (CP-TERM-OR-EXT-DAYS * I) / +30)
  4444                   / (1 + I)
  4445     COMPUTE ANGLEN-1 = ANGLEN / WK8
  4446     IF WS-WORK-DIS-RATE = ZEROS
  4447        CONTINUE
  4448     ELSE
  4449        COMPUTE WK4 = 1 / (1 + WS-WORK-DIS-RATE)
  4450*       COMPUTE WK7 = ((1 + (2 * I)) / I) *
  4451        COMPUTE WK7 = ((1 + (K-I * I)) / I) *
  4452              (((WK4 ** M - 1) / (WK4 - 1)) -
  4453              ((WK4 ** M * SX - VX) /
  4454              (WK4 * (1 + I) - 1))) *
  4455              (CP-PREMIUM-RATE / 1000)
  4456        COMPUTE WK4 = CP-ORIGINAL-BENEFIT / ANGLEN-1
  4457*       COMPUTE WK8 = (WK7 * 100) / (ANGLEN * (1 + 2 * I))
  4458        COMPUTE WK8 = (WK7 * 100) / (ANGLEN * (1 + K-I * I))
  4459        COMPUTE CP-CALC-PREMIUM =
  4460           WK8 *  ((WK4 * ANGLEN * (1 + K-I * I)) / 100)
  4461*          WK8 *  ((WK4 * ANGLEN * (1 + 2 * I)) / 100)
  4462     END-IF
  4463
  4464     GO TO 99999-RETURN
  4465
  4466     .
  4467 12001-CHECK-CID-MT.
  4468
  4469     IF (CP-COMPANY-ID EQUAL 'CID')     AND
  4470        ((CP-STATE-STD-ABBRV EQUAL 'MT' OR 'NJ'
  4471                                OR 'VT')
  4472                   OR
  4473        ((CP-STATE-STD-ABBRV = 'IN') AND
  4474        (CP-CERT-EFF-DT > X'9A7F'))
  4475                   OR
  4476        ((CP-STATE-STD-ABBRV = 'AZ' OR 'ND') AND
  4477        (CP-CERT-EFF-DT > X'9ADF'))) AND
  4478        (CP-EARN-AS-NET-PAY) AND
  4479        (CP-STATE-STD-ABBRV = CP-STATE)
  4480        CONTINUE
  4481     ELSE
  4482        GO TO 12001-CHECK-DCC-DD
  4483     END-IF
  4484
  4485     COMPUTE CP-TERM-OR-EXT-DAYS =
  4486           CP-TERM-OR-EXT-DAYS + 30
  4487
  4488* K-I WILL BE USED FOR EXTRA INT. PERIODS
  4489     IF CP-STATE-STD-ABBRV = 'IN' OR 'ND'
  4490        MOVE 0                   TO K-I
  4491     ELSE
  4492        IF CP-STATE-STD-ABBRV = 'NJ'
  4493           MOVE 1                TO K-I
  4494        ELSE
  4495           MOVE 2                TO K-I
  4496        END-IF
  4497     END-IF
  4498     COMPUTE ANGLEN EQUAL WK1 / I
  4499     COMPUTE WS-WORK-DIS-RATE = WS-WORK-DIS-RATE / +12
  4500     COMPUTE WK8 = (1 + (CP-TERM-OR-EXT-DAYS * I) / +30)
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  83
* ELRFND.cbl
  4501                   / (1 + I)
  4502     COMPUTE ANGLEN-1 = ANGLEN / WK8
  4503     IF WS-WORK-DIS-RATE = ZEROS
  4504        CONTINUE
  4505     ELSE
  4506        COMPUTE WK4 = 1 / (1 + WS-WORK-DIS-RATE)
  4507*       COMPUTE WK7 = ((1 + (2 * I)) / I) *
  4508        COMPUTE WK7 = ((1 + (K-I * I)) / I) *
  4509              (((WK4 ** N - 1) / (WK4 - 1)) -
  4510              ((WK4 ** N - SV) /
  4511              (WK4 * (1 + I) - 1))) *
  4512              (CP-PREMIUM-RATE / 1000)
  4513        COMPUTE WK4 = CP-ORIGINAL-BENEFIT / ANGLEN-1
  4514*       COMPUTE WK8 = (WK7 * 100) / (ANGLEN * (1 + 2 * I))
  4515        COMPUTE WK8 = (WK7 * 100) / (ANGLEN * (1 + K-I * I))
  4516        COMPUTE CP-CALC-PREMIUM =
  4517           WK8 *  ((WK4 * ANGLEN * (1 + K-I * I)) / 100)
  4518*          WK8 *  ((WK4 * ANGLEN * (1 + 2 * I)) / 100)
  4519     END-IF
  4520
  4521     GO TO 99999-RETURN
  4522
  4523     .
  4524 12001-CHECK-DCC-DD.
  4525     IF (CP-COMPANY-ID EQUAL 'DCC' OR 'VPP')
  4526        AND (CP-EARN-AS-NET-PAY)
  4527        AND (CP-BEN-CATEGORY = 'D')
  4528        CONTINUE
  4529     ELSE
  4530        GO TO 12001-CHECK-DCC-NET
  4531     END-IF
  4532
  4533     COMPUTE CP-TERM-OR-EXT-DAYS =
  4534           CP-TERM-OR-EXT-DAYS + 30
  4535
  4536     COMPUTE ANGLEN EQUAL WK1 / I.
  4537     COMPUTE ANGLEM EQUAL WK2 / I.
  4538     COMPUTE ANGLEN-M EQUAL WK5 / I.
  4539
  4540     COMPUTE ODF = (1+ (CP-TERM-OR-EXT-DAYS * I / 30))
  4541           / (1 + I)
  4542     COMPUTE GR     = ANGLEN / ODF
  4543*    COMPUTE CP-PREMIUM-RATE = CP-PREMIUM-RATE *
  4544*      CP-RATE-DEV-PCT
  4545     COMPUTE WK4 = CP-ORIGINAL-BENEFIT / GR
  4546     COMPUTE WK3 = WK4 * ((M - (ANGLEN - ANGLEN-M)) / I) *
  4547       (CP-PREMIUM-RATE / 100) * (1 + (0 * (N-P-APR / 12)))
  4548     MOVE ZEROS                  TO CP-RATE-DEV-PCT
  4549     MOVE WK3                    TO CP-CALC-PREMIUM
  4550
  4551     GO TO 99999-RETURN
  4552
  4553     .
  4554 12001-CHECK-DCC-NET.
  4555
  4556     IF (CP-COMPANY-ID EQUAL 'DCC' OR 'VPP')
  4557        AND (CP-EARN-AS-NET-PAY)
  4558        AND (CP-BENEFIT-CD (1:1) NOT = 'M' AND 'N'
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  84
* ELRFND.cbl
  4559             AND 'H' AND 'S' AND 'P')
  4560        CONTINUE
  4561     ELSE
  4562        GO TO 12001-CHECK-DCC-PNET
  4563     END-IF
  4564
  4565     COMPUTE CP-TERM-OR-EXT-DAYS =
  4566           CP-TERM-OR-EXT-DAYS + 30
  4567
  4568     COMPUTE ANGLEN EQUAL WK1 / I.
  4569     COMPUTE ANGLEM EQUAL WK2 / I.
  4570     COMPUTE ANGLEN-M EQUAL WK5 / I.
  4571
  4572     COMPUTE ODF = (1+ (CP-TERM-OR-EXT-DAYS * I / 30))
  4573           / (1 + I)
  4574     COMPUTE GR     = ANGLEN / ODF
  4575     COMPUTE CP-PREMIUM-RATE = CP-PREMIUM-RATE / M * 12
  4576     COMPUTE CP-CALC-PREMIUM ROUNDED = CP-PREMIUM-RATE *
  4577       CP-RATE-DEV-PCT
  4578     MOVE CP-CALC-PREMIUM        TO CP-PREMIUM-RATE
  4579*    COMPUTE WK8 = CP-PREMIUM-RATE * M / 12
  4580
  4581     COMPUTE WK8 = CP-PREMIUM-RATE *
  4582        ((M + ((CP-TERM-OR-EXT-DAYS - 30) / 30)) / 12)
  4583     COMPUTE WK8 = WK8 / ((M + (12 / 12)) / 2)
  4584     COMPUTE WK4 = CP-ORIGINAL-BENEFIT / GR
  4585     COMPUTE WK3 = WK4 * ((M - (ANGLEN - ANGLEN-M)) / I) *
  4586       (WK8 / 100) * (1 + (0 * (N-P-APR / 12)))
  4587     MOVE ZEROS                  TO CP-RATE-DEV-PCT
  4588     MOVE WK3                    TO CP-CALC-PREMIUM
  4589
  4590     GO TO 99999-RETURN
  4591
  4592     .
  4593 12001-CHECK-DCC-PNET.
  4594     IF (CP-COMPANY-ID EQUAL 'DCC' OR 'VPP')
  4595        AND (CP-EARN-AS-NET-PAY)
  4596        AND (CP-BENEFIT-CD (1:1) = 'P')
  4597        CONTINUE
  4598     ELSE
  4599        GO TO 12001-CHECK-DCC-MNET
  4600     END-IF
  4601     IF CP-NO-OF-PMTS NOT NUMERIC
  4602        MOVE +0                  TO CP-NO-OF-PMTS
  4603     END-IF
  4604     IF CP-PMT-MODE NOT = 'W' AND 'S' AND 'B' AND 'T'
  4605        AND ' ' AND 'M'
  4606        MOVE ' '                 TO CP-PMT-MODE
  4607     END-IF
  4608******************************************************************
  4609***   Default is monthly, use loan term for rate and amort     ***
  4610******************************************************************
  4611     move cp-loan-term         to c-tot-pmts
  4612     MOVE +30                  TO C-DAYS-IN-PMT-PER
  4613     MOVE +12                  TO C-PMTS-PER-YEAR
  4614******************************************************************
  4615
  4616     evaluate true
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  85
* ELRFND.cbl
  4617        when cp-pmt-mode = 'W'
  4618           MOVE +52              TO C-PMTS-PER-YEAR
  4619           compute c-tot-pmts = cp-loan-term /
  4620              12 * c-pmts-per-year
  4621           MOVE +7               TO C-DAYS-IN-PMT-PER
  4622        when cp-pmt-mode = 'B'
  4623           MOVE +26              TO C-PMTS-PER-YEAR
  4624           compute c-tot-pmts = cp-loan-term /
  4625              12 * c-pmts-per-year
  4626           MOVE +14              TO C-DAYS-IN-PMT-PER
  4627     end-evaluate
  4628     COMPUTE I = CP-LOAN-APR / C-PMTS-PER-YEAR / 100
  4629     COMPUTE Y = (1 + (CP-DAYS-TO-1ST-PMT * I /
  4630        C-DAYS-IN-PMT-PER)) / (1 + I)
  4631     compute anglen = (1 - (1 / (1 + i)) ** c-tot-pmts) / i
  4632*    COMPUTE ANGLEN = (1 - ((1 + I) ** (C-TOT-PMTS * -1))) / I
  4633     COMPUTE ANGLEN-1 = ANGLEN / Y
  4634     COMPUTE WK3 = CP-ORIGINAL-BENEFIT / ANGLEN-1
  4635     IF CP-RATE-DEV-PCT NOT = ZEROS
  4636        COMPUTE CP-PREMIUM-RATE = CP-RATE-DEV-PCT *
  4637           CP-PREMIUM-RATE
  4638     END-IF
  4639     COMPUTE CP-CALC-PREMIUM = (WK3 / 100) * CP-PREMIUM-RATE
  4640     GO TO 99999-RETURN
  4641     .
  4642 12001-CHECK-DCC-MNET.
  4643
  4644     IF (CP-COMPANY-ID EQUAL 'DCC' OR 'VPP')
  4645        AND (CP-EARN-AS-NET-PAY)
  4646        AND (CP-BENEFIT-CD (1:1) = 'M' OR 'H')
  4647        CONTINUE
  4648     ELSE
  4649        GO TO 12001-CHECK-DCC-MNET-LF-BAL
  4650     END-IF
  4651
  4652*    COMPUTE ANGLEN EQUAL WK1 / I.
  4653*    COMPUTE ANGLEM EQUAL WK2 / I.
  4654*    COMPUTE ANGLEN-M EQUAL WK5 / I.
  4655
  4656     COMPUTE WK3 = CP-ORIGINAL-BENEFIT * CP-PREMIUM-RATE / 1000
  4657     MOVE WK3                    TO CP-CALC-PREMIUM
  4658
  4659     GO TO 99999-RETURN
  4660
  4661     .
  4662 12001-CHECK-DCC-MNET-LF-BAL.
  4663
  4664     IF (CP-COMPANY-ID EQUAL 'DCC' OR 'VPP')
  4665        AND (CP-EARN-AS-NET-PAY)
  4666        AND (CP-BENEFIT-CD (1:1) = 'N')
  4667        AND (CP-BEN-CATEGORY NOT = 'N')
  4668        AND (CP-ALTERNATE-BENEFIT NOT = ZEROS)
  4669        CONTINUE
  4670     ELSE
  4671        GO TO 12001-CHECK-DCC-MNET-LFSUM-BAL
  4672     END-IF
  4673
  4674     IF CP-RATE-DEV-PCT NOT = ZEROS
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  86
* ELRFND.cbl
  4675        COMPUTE CP-PREMIUM-RATE = CP-RATE-DEV-PCT *
  4676           CP-PREMIUM-RATE
  4677     END-IF
  4678*    COMPUTE OD = (1 + ((CP-TERM-OR-EXT-DAYS + +30) * I / 30))
  4679     COMPUTE OD = (1 + (CP-DAYS-TO-1ST-PMT * I / 30))
  4680        / (1 + I)
  4681     COMPUTE ANGLEN-M = (WK5 / I) / OD
  4682     COMPUTE J = I + (CP-PREMIUM-RATE / +1000)
  4683     COMPUTE WK2 = (1 + J) ** (M * -1)
  4684     COMPUTE ANGLEN-M = ANGLEN-M * WK2
  4685     COMPUTE ANGLEM-1 = ((1 - ((1 + J)
  4686          ** ((M - 1) * -1))) / J)
  4687     COMPUTE ANGLEM = ((1 - ((1 + J)
  4688          ** (M * -1))) / J) / OD
  4689     COMPUTE RA = (CP-ORIGINAL-BENEFIT * OD -
  4690        (CP-ALTERNATE-BENEFIT * (1 + J) ** (M * -1)))
  4691        / ANGLEM-1
  4692     COMPUTE ANGLEN-M = ((1 - ((1 + I)
  4693          ** ((N - M) * -1))) / I)
  4694     MOVE +0                     TO WK3
  4695     PERFORM VARYING WS-COUNTER FROM +1 BY +1 UNTIL
  4696        (WS-COUNTER > M)
  4697        COMPUTE ANGLEM = (1 - ((1 + J)
  4698          ** ((M - WS-COUNTER) * -1))) / J
  4699        COMPUTE WK2 = (1 / (1 + j)) ** (M - WS-COUNTER + 1)
  4700        COMPUTE WK5-CSL = (RA * ANGLEM)
  4701        + (CP-ALTERNATE-BENEFIT * WK2)
  4702        COMPUTE WK3 = WK3 + (WK5-CSL * CP-PREMIUM-RATE / +1000)
  4703     END-PERFORM
  4704     MOVE WK3                    TO CP-CALC-PREMIUM
  4705
  4706     GO TO 99999-RETURN
  4707
  4708     .
  4709 12001-CHECK-DCC-MNET-LFSUM-BAL.
  4710
  4711     IF (CP-COMPANY-ID EQUAL 'DCC' OR 'VPP')
  4712        AND (CP-EARN-AS-NET-PAY)
  4713        AND (CP-BENEFIT-CD (1:1) = 'S')
  4714        AND (CP-BEN-CATEGORY NOT = 'N')
  4715        AND (CP-ALTERNATE-BENEFIT NOT = ZEROS)
  4716        CONTINUE
  4717     ELSE
  4718        GO TO 12001-CHECK-DCC-MNET-LF
  4719     END-IF
  4720
  4721     IF CP-RATE-DEV-PCT NOT = ZEROS
  4722        COMPUTE CP-PREMIUM-RATE = CP-RATE-DEV-PCT *
  4723           CP-PREMIUM-RATE
  4724     END-IF
  4725     COMPUTE K = I + (CP-PREMIUM-RATE / +1000)
  4726     COMPUTE ANGLEM-1 = ((1 - ((1 + K)
  4727          ** ((M - 1) * -1))) / K)
  4728     COMPUTE ANGLEM = ((1 - ((1 + K)
  4729          ** (M * -1))) / K)
  4730     MOVE CP-MONTHLY-PAYMENT     TO RA
  4731     COMPUTE WK3 = (((((M - 1) - ANGLEM-1) / K) - ((((M - 1)
  4732        * M / 2 - (((M - 1) - ANGLEM-1) / K)) / K) * 0 / 1000))
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  87
* ELRFND.cbl
  4733        * RA + (CP-ALTERNATE-BENEFIT * ANGLEM)) *
  4734        CP-PREMIUM-RATE / 1000
  4735     MOVE WK3                    TO CP-CALC-PREMIUM
  4736
  4737     GO TO 99999-RETURN
  4738
  4739     .
  4740 12001-CHECK-DCC-MNET-LF.
  4741
  4742     IF (CP-COMPANY-ID EQUAL 'DCC' OR 'VPP')
  4743        AND (CP-EARN-AS-NET-PAY)
  4744        AND (CP-BENEFIT-CD (1:1) = 'N')
  4745        AND (CP-BEN-CATEGORY NOT = 'N')
  4746        CONTINUE
  4747     ELSE
  4748        GO TO 12001-CHECK-DCC-MNET-SUMLF
  4749     END-IF
  4750
  4751     IF CP-RATE-DEV-PCT NOT = ZEROS
  4752        COMPUTE CP-PREMIUM-RATE = CP-RATE-DEV-PCT *
  4753           CP-PREMIUM-RATE
  4754     END-IF
  4755*    COMPUTE OD = (1 + ((CP-TERM-OR-EXT-DAYS + +30) * I / 30))
  4756     COMPUTE OD = (1 + (CP-DAYS-TO-1ST-PMT * I / 30))
  4757        / (1 + I)
  4758     COMPUTE ANGLEN-M = (WK5 / I) / OD
  4759     COMPUTE J = I + (CP-PREMIUM-RATE / +1000)
  4760     COMPUTE WK2 = (1 + J) ** (M * -1)
  4761     COMPUTE ANGLEN-M = ANGLEN-M * WK2
  4762     COMPUTE ANGLEM = ((1 - ((1 + J)
  4763          ** (M * -1))) / J) / OD
  4764     COMPUTE RA = CP-ORIGINAL-BENEFIT / (ANGLEM + ANGLEN-M)
  4765     COMPUTE ANGLEN-M = ((1 - ((1 + I)
  4766          ** ((N - M) * -1))) / I)
  4767     MOVE +0                     TO WK3
  4768     PERFORM VARYING WS-COUNTER FROM +1 BY +1 UNTIL
  4769        (WS-COUNTER > M)
  4770        COMPUTE ANGLEM = (1 - ((1 + J)
  4771          ** ((M - WS-COUNTER + 1) * -1))) / J
  4772        COMPUTE WK2 = (1 / (1 + j)) ** (M - WS-COUNTER + 1)
  4773        COMPUTE WK5-CSL = RA * (ANGLEM + (ANGLEN-M * WK2))
  4774        COMPUTE WK3 = WK3 + (WK5-CSL * CP-PREMIUM-RATE / +1000)
  4775     END-PERFORM
  4776     MOVE WK3                    TO CP-CALC-PREMIUM
  4777
  4778     GO TO 99999-RETURN
  4779
  4780     .
  4781 12001-CHECK-DCC-MNET-SUMLF.
  4782
  4783     IF (CP-COMPANY-ID EQUAL 'DCC' OR 'VPP')
  4784        AND (CP-EARN-AS-NET-PAY)
  4785        AND (CP-BENEFIT-CD (1:1) = 'S')
  4786        AND (CP-BEN-CATEGORY NOT = 'N')
  4787        CONTINUE
  4788     ELSE
  4789        GO TO 12001-CHECK-DCC-MNET-TOT-BAL-N
  4790     END-IF
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  88
* ELRFND.cbl
  4791
  4792     IF CP-RATE-DEV-PCT NOT = ZEROS
  4793        COMPUTE CP-PREMIUM-RATE = CP-RATE-DEV-PCT *
  4794           CP-PREMIUM-RATE
  4795     END-IF
  4796     COMPUTE K = I + (CP-PREMIUM-RATE / +1000)
  4797     COMPUTE Y = (1 + (CP-DAYS-TO-1ST-PMT * K / 30))
  4798        / (1 + K)
  4799     COMPUTE ANGLEN-M = (WK5 / I)
  4800     COMPUTE WK2 = (1 + K) ** (M * -1)
  4801     COMPUTE ANGLEN-M = ANGLEN-M * WK2
  4802     COMPUTE ANGLEN-M = ANGLEN-M / Y
  4803     COMPUTE ANGLEM = ((1 - ((1 + K)
  4804          ** (M * -1))) / K) / Y
  4805     COMPUTE RA = CP-ORIGINAL-BENEFIT / (ANGLEM + ANGLEN-M)
  4806     COMPUTE WK5-CSL = (((M - ANGLEM) / K) + (ANGLEN-M *
  4807        ((1 + K) ** (M + 1 / Y * (CP-DAYS-TO-1ST-PMT - +30) / 30)
  4808        - 1)) / K) * RA
  4809     COMPUTE WK7 = (((((M * (M + 1) / 2)
  4810        + (CP-DAYS-TO-1ST-PMT - +30)
  4811        / 30 * M - (M - ANGLEM) / K) / K)) * RA *
  4812        +0 / 1000 * 12 / 12)
  4813     COMPUTE WK3 = (WK5-CSL - WK7) * (CP-PREMIUM-RATE / 1000)
  4814        * (12 / 12)
  4815     MOVE WK3                    TO CP-CALC-PREMIUM
  4816
  4817     GO TO 99999-RETURN
  4818
  4819     .
  4820 12001-CHECK-DCC-MNET-TOT-BAL-N.
  4821
  4822     IF (CP-COMPANY-ID EQUAL 'DCC' OR 'VPP')
  4823        AND (CP-EARN-AS-NET-PAY)
  4824        AND (CP-BENEFIT-CD (1:1) = 'N')
  4825        AND (CP-BEN-CATEGORY = 'N')
  4826        AND (CP-ALTERNATE-BENEFIT NOT = ZEROS)
  4827        CONTINUE
  4828     ELSE
  4829        GO TO 12001-CHECK-DCC-MNET-TOT-BAL-S
  4830     END-IF
  4831
  4832*    COMPUTE OD = (1 + ((CP-TERM-OR-EXT-DAYS + +30) * I / 30))
  4833     COMPUTE OD = (1 + (CP-DAYS-TO-1ST-PMT * I / 30))
  4834        / (1 + I)
  4835     COMPUTE ANGLEN-M = (WK5 / I) / OD
  4836     COMPUTE J = I + ((CP-DCC-LF-RATE + CP-DCC-AH-RATE) / +1000)
  4837     COMPUTE K = I + (CP-DCC-LF-RATE / +1000)
  4838     COMPUTE WK2 = (1 + J) ** (M * -1)
  4839     COMPUTE ANGLEN-M = ANGLEN-M * WK2
  4840     COMPUTE ANGLEM-1 = ((1 - ((1 + J)
  4841          ** ((M - 1) * -1))) / J)
  4842     COMPUTE ANGLEM = ((1 - ((1 + J)
  4843          ** (M * -1))) / J) / OD
  4844     COMPUTE RA = (CP-ORIGINAL-BENEFIT * OD -
  4845        (CP-ALTERNATE-BENEFIT * (1 + K) ** (M * -1)))
  4846        / ANGLEM-1
  4847     COMPUTE ANGLEN-M = ((1 - ((1 + I)
  4848          ** ((N - M) * -1))) / I)
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  89
* ELRFND.cbl
  4849     MOVE +0                     TO WK3
  4850     PERFORM VARYING WS-COUNTER FROM +1 BY +1 UNTIL
  4851        (WS-COUNTER > M)
  4852        COMPUTE ANGLEM = (1 - ((1 + J)
  4853          ** ((M - WS-COUNTER) * -1))) / J
  4854        COMPUTE WK2 = (1 / (1 + K)) ** (M - WS-COUNTER + 1)
  4855        COMPUTE WK5-CSL = (RA * ANGLEM)
  4856        + (CP-ALTERNATE-BENEFIT * WK2)
  4857        COMPUTE WK3 = WK3 +
  4858         (WK5-CSL * (CP-DCC-LF-RATE / +1000))
  4859        COMPUTE WK3 = WK3 + (WK5-CSL - (CP-ALTERNATE-BENEFIT *
  4860          (1 / (1 + K) ** (M - WS-COUNTER + 1)))) *
  4861          (CP-DCC-AH-RATE / 1000)
  4862     END-PERFORM
  4863     MOVE WK3                    TO CP-CALC-PREMIUM
  4864
  4865     GO TO 99999-RETURN
  4866
  4867     .
  4868 12001-CHECK-DCC-MNET-TOT-BAL-S.
  4869
  4870     IF (CP-COMPANY-ID EQUAL 'DCC' OR 'VPP')
  4871        AND (CP-EARN-AS-NET-PAY)
  4872        AND (CP-BENEFIT-CD (1:1) = 'S')
  4873        AND (CP-BEN-CATEGORY = 'N')
  4874        AND (CP-ALTERNATE-BENEFIT NOT = ZEROS)
  4875        CONTINUE
  4876     ELSE
  4877        GO TO 12001-CHECK-DCC-MNET-TOT-N
  4878     END-IF
  4879
  4880     COMPUTE K = I + (CP-DCC-LF-RATE / +1000)
  4881     COMPUTE ANGLEM-1 = ((1 - ((1 + K)
  4882          ** ((M - 1) * -1))) / K)
  4883     COMPUTE ANGLEM = ((1 - ((1 + K)
  4884          ** (M * -1))) / K)
  4885     MOVE CP-MONTHLY-PAYMENT     TO RA
  4886     COMPUTE WK3 = (((((M - 1) - ANGLEM-1) / K) - ((((M - 1)
  4887        * M / 2 - (((M - 1) - ANGLEM-1) / K)) / K)
  4888        * CP-DCC-AH-RATE / 1000))
  4889        * RA + (CP-ALTERNATE-BENEFIT * ANGLEM)) *
  4890        CP-DCC-LF-RATE / 1000
  4891     MOVE WK3                    TO CP-LF-PREM
  4892     COMPUTE WK5-CSL = RA * ((M - 1) * M / 2
  4893        + (M - 1) * (CP-DAYS-TO-1ST-PMT - 30) / 30)
  4894        * CP-DCC-AH-RATE / 1000
  4895     COMPUTE WK3 = WK3 + WK5-CSL
  4896     MOVE WK3                    TO CP-CALC-PREMIUM
  4897
  4898     GO TO 99999-RETURN
  4899      .
  4900 12001-CHECK-DCC-MNET-TOT-N.
  4901
  4902     IF (CP-COMPANY-ID EQUAL 'DCC' OR 'VPP')
  4903        AND (CP-EARN-AS-NET-PAY)
  4904        AND (CP-BENEFIT-CD (1:1) = 'N')
  4905        AND (CP-BEN-CATEGORY = 'N')
  4906        CONTINUE
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  90
* ELRFND.cbl
  4907     ELSE
  4908        GO TO 12001-CHECK-DCC-MNET-TOT-S
  4909     END-IF
  4910
  4911*    I = APR/1200
  4912*    J = APR/1200 THEN ADJUSTED FOR THE LIFE AND DIS RATE
  4913*    RA = PAYMENT AMOUNT
  4914*    WK5-CSL = THE BALANCE (PAY OFF )
  4915*    WK3 = THE ACCUMULATED PREMIUM
  4916*    WK2 = (1 + I) ^ (m * -1)
  4917*    OD  = GAMMA
  4918*
  4919*    COMPUTE OD = (1 + ((CP-TERM-OR-EXT-DAYS + +30) * I / 30))
  4920     COMPUTE OD = (1 + (CP-DAYS-TO-1ST-PMT * I / 30))
  4921        / (1 + I)
  4922     COMPUTE ANGLEN-M = (WK5 / I) / OD
  4923     COMPUTE J = I + (CP-DCC-LF-RATE / +1000) +
  4924        (CP-DCC-AH-RATE / +1000)
  4925     COMPUTE WK2 = (1 + J) ** (M * -1)
  4926     COMPUTE ANGLEN-M = ANGLEN-M * WK2
  4927     COMPUTE ANGLEM = ((1 - ((1 + J)
  4928          ** (M * -1))) / J) / OD
  4929     COMPUTE RA = CP-ORIGINAL-BENEFIT / (ANGLEM + ANGLEN-M)
  4930     COMPUTE ANGLEN-M = ((1 - ((1 + I)
  4931          ** ((N - M) * -1))) / I)
  4932     MOVE +0                     TO WK3
  4933     PERFORM VARYING WS-COUNTER FROM +1 BY +1 UNTIL
  4934        (WS-COUNTER > M)
  4935        COMPUTE ANGLEM = (1 - ((1 + J)
  4936          ** ((M - WS-COUNTER + 1) * -1))) / J
  4937        COMPUTE WK2 = (1 / (1 + j)) ** (M - WS-COUNTER + 1)
  4938        COMPUTE WK5-CSL = RA * (ANGLEM + (ANGLEN-M * WK2))
  4939        COMPUTE WK3 = WK3 + (WK5-CSL * CP-DCC-LF-RATE / +1000)
  4940           + (WK5-CSL * CP-DCC-AH-RATE / +1000)
  4941     END-PERFORM
  4942     MOVE WK3                    TO CP-CALC-PREMIUM
  4943
  4944     GO TO 99999-RETURN
  4945
  4946     .
  4947 12001-CHECK-DCC-MNET-TOT-S.
  4948
  4949     IF (CP-COMPANY-ID EQUAL 'DCC' OR 'VPP')
  4950        AND (CP-EARN-AS-NET-PAY)
  4951        AND (CP-BENEFIT-CD (1:1) = 'S')
  4952        AND (CP-BEN-CATEGORY = 'N')
  4953        CONTINUE
  4954     ELSE
  4955        GO TO 12001-CONTINUE-NET
  4956     END-IF
  4957
  4958*    I = APR/1200
  4959*    J = APR/1200 THEN ADJUSTED FOR THE LIFE RATE (K)
  4960*    RA = PAYMENT AMOUNT
  4961*    WK5-CSL = THE BALANCE (PAY OFF )
  4962*    WK3 = THE ACCUMULATED PREMIUM
  4963*    WK2 = (1 + I) ^ (m * -1)
  4964*    OD  = GAMMA
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  91
* ELRFND.cbl
  4965*
  4966     COMPUTE J = I + (CP-DCC-LF-RATE / +1000)
  4967     COMPUTE OD = ((1 + (CP-DAYS-TO-1ST-PMT * J / 30)))
  4968        / (1 + J)
  4969     COMPUTE ANGLEM = ((1 - ((1 + J)
  4970          ** (M * -1))) / J) / OD
  4971     COMPUTE ANGLEN-M = ((1 - ((1 + I)
  4972          ** ((N - M) * -1))) / I)
  4973          * (1 + J) ** (-1 * M)
  4974     COMPUTE ANGLEN-M = ANGLEN-M / OD
  4975     MOVE CP-MONTHLY-PAYMENT     TO RA
  4976     COMPUTE WK1 = (M + 1 / OD * (CP-DAYS-TO-1ST-PMT - +30)
  4977        / +30)
  4978     COMPUTE WK4 = (((M - ANGLEM) / J) + (ANGLEN-M * ((1 + J)
  4979        ** (WK1) - 1)) / J) * RA
  4980     COMPUTE WK5 = (((((M * (M + 1) / 2)
  4981        + (CP-DAYS-TO-1ST-PMT - +30)
  4982        / +30 * M - (M - ANGLEM) / J) / J)) * RA *
  4983        CP-DCC-AH-RATE / +1000 * 12 / 12)
  4984     COMPUTE WK3 = (WK4 - WK5) * (CP-DCC-LF-RATE / +1000) *
  4985        (12 / 12)
  4986     COMPUTE WK5-CSL = RA * (M * (M + 1) / 2 + M *
  4987        (CP-DAYS-TO-1ST-PMT - +30) / +30) *
  4988        (CP-DCC-AH-RATE / +1000) * 12 / 12
  4989     COMPUTE WK3 = WK3 + WK5-CSL
  4990     MOVE WK3                    TO CP-CALC-PREMIUM
  4991     COMPUTE K = I + (CP-DCC-LF-RATE / +1000)
  4992     COMPUTE Y = (1 + (CP-DAYS-TO-1ST-PMT * K / 30))
  4993        / (1 + K)
  4994     COMPUTE ANGLEN-M = ((1 - ((1 + I)
  4995          ** ((N - M) * -1))) / I)
  4996     COMPUTE WK2 = (1 + K) ** (M * -1)
  4997     COMPUTE ANGLEN-M = ANGLEN-M * WK2
  4998     COMPUTE ANGLEN-M = ANGLEN-M / Y
  4999     COMPUTE ANGLEM = ((1 - ((1 + K)
  5000          ** (M * -1))) / K) / Y
  5001*    COMPUTE RA = CP-ORIGINAL-BENEFIT / (ANGLEM + ANGLEN-M)
  5002     COMPUTE WK6 = (((M - ANGLEM) / K) + (ANGLEN-M *
  5003        ((1 + K) ** (M + 1 / Y
  5004        * (CP-DAYS-TO-1ST-PMT - +30) / 30)
  5005        - 1)) / K) * RA
  5006     COMPUTE WK7 = (((((M * (M + 1) / 2)
  5007        + (CP-DAYS-TO-1ST-PMT - +30)
  5008        / 30 * M - (M - ANGLEM) / K) / K)) * RA *
  5009        CP-DCC-AH-RATE / 1000 * 12 / 12)
  5010     COMPUTE WK3 = (WK6 - WK7) * (CP-DCC-LF-RATE / 1000)
  5011        * (12 / 12)
  5012     MOVE WK3                    TO CP-LF-PREM
  5013
  5014     GO TO 99999-RETURN
  5015
  5016     .
  5017 12001-CONTINUE-NET.
  5018
  5019     IF NET-STD
  5020        IF CP-COMPANY-ID EQUAL 'CDC' OR 'GTL' OR 'CID' OR 'MON'
  5021*          OR 'DCC'
  5022         COMPUTE WK3 ROUNDED = ((I * M) + VX - SX) * 2 * N
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  92
* ELRFND.cbl
  5023         COMPUTE WK3 ROUNDED = WK3 / ((1 - VX) * M * I)
  5024         COMPUTE WK3 ROUNDED = WK3 / ((2 * N) - M + 1)
  5025         COMPUTE WK3 ROUNDED = (WK3 * RA * K-I)
  5026                               * ((1 + N) / (1 + M))
  5027         if (i = .0000000001)
  5028            and (wk3 = zeros)
  5029            move 1               to wk3
  5030         end-if
  5031        ELSE
  5032         COMPUTE WK3 ROUNDED = ((I * M) + VX - SX) * 2 * N
  5033         COMPUTE WK3 ROUNDED = WK3 / ((1 - VX) * M * I)
  5034         COMPUTE WK3 ROUNDED = WK3 / ((2 * N) - M + 1)
  5035         COMPUTE WK3 ROUNDED = WK3 * RA * K-I.
  5036
  5037     IF NET-SMP
  5038         COMPUTE N2 = N * N
  5039         COMPUTE N3 = N2 * N
  5040         COMPUTE WK3 ROUNDED = 2 * N2 * WK1
  5041         COMPUTE WK3 ROUNDED = WK3 + (N3 * I) - (N2 * I)
  5042         COMPUTE WK3 ROUNDED = WK3 + (4 * N * WK1)
  5043         COMPUTE WK3 ROUNDED = WK3 * (1 + I) * 10
  5044         COMPUTE WK3 ROUNDED = WK3 / (36 * (N + 1) * WK1).
  5045
  5046     IF NPO-PRUDENTIAL
  5047       PERFORM 12100-PRU-CALC THRU 12199-EXIT
  5048           VARYING WS-COUNTER FROM 1 BY 1
  5049               UNTIL WS-COUNTER = N
  5050       COMPUTE WK3 ROUNDED = (N * (I * PWK / (PWK - 1))) - 1
  5051       COMPUTE WK3 ROUNDED = WK3 / (I * 12).
  5052
  5053     MOVE WK3 TO FACTOR.
  5054
  5055     GO TO 99999-RETURN.
  5056
  5057 12100-PRU-CALC.
  5058     IF WS-COUNTER = 1
  5059         COMPUTE PWK = (I + 1)
  5060     ELSE
  5061         COMPUTE PWK = PWK * (I + 1).
  5062
  5063 12199-EXIT.
  5064      EXIT.
  5065
  5066 99000-ERROR.
  5067     MOVE +9999.999999999 TO N-P-FACTOR.
  5068     MOVE '4'             TO CP-RETURN-CODE.
  5069
  5070     GO TO 99999-EXIT.
  5071
  5072 99999-RETURN.
  5073     MOVE FACTOR          TO N-P-FACTOR.
  5074
  5075 99999-EXIT.
  5076      EXIT.
  5077
  5078 9999-DFHBACK SECTION.
  5079     MOVE '9%                    "   ' TO DFHEIV0
  5080     MOVE 'ELRFND' TO DFHEIV1
* Micro Focus Server Express         V5.1 revision 000 13-Jan-17 13:06 Page  93
* ELRFND.cbl
  5081     CALL 'kxdfhei1' USING DFHEIV0 DFHEIV1
  5082     GOBACK.
  5083 9999-DFHEXIT.
  5084     IF DFHEIGDJ EQUAL 0001
  5085         NEXT SENTENCE.
  5086     MOVE '9%                    "   ' TO DFHEIV0
  5087     MOVE 'ELRFND' TO DFHEIV1
  5088     CALL 'kxdfhei1' USING DFHEIV0 DFHEIV1
  5089     GOBACK.
* Micro Focus Server Express         V5.1 revision 000 Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
*                                                        REF GNR-008065005AF
* Total Messages:     0
* Data:        2552     Code:       44351
