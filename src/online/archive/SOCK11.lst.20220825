* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page   1
* SOCK11.cbl
* Options: int("SOCK11.int") anim csi verbose NOBOUND LINKCHECK
*          PARAMCOUNTCHECK directives(cobopt.bth) endp list("SOCK11.lst")
     1$SET SQL(dbman=ODBC, TARGETDB=MSSQLSERVER, NOAUTOCOMMIT)
* Setting: NOACCEPTREFRESH NOADV ALIGN"8" ALPHASTART"1" NOALTER NOAMODE ANIM
*          NOANIMPREP ANS85 APOST NOAREACHECK ARITHMETIC"OSVS" ASSIGN
*          "EXTERNAL" NOASSIGN-PRINTER NOAUTOLOCK NOBELL NOBOUND NOBRIEF
*          NOBS2000 BWZSTAR NOBYTEMODEMOVE CALLFH"EXTFH" NOCALLMCS
*          NOCALLRECOVERY CALLSORT"EXTSM" CANCEL CANCELLBR NOCHANGEMESSAGE
*          CHARSET"ASCII" CHECKDIV"ANSI" NOCHECKREFMOD NOCICS CICS-CPY
*          NOCICSOPTIMIZE NOCMPR2 NOCOBFSTATCONV NOCOBIDY NOCOBOL370 COBOLDIR
*          NOCOMP COMP-5"2" COMP-6"2" NOCOMS85 CONFIRM NOCONVERTRET CONVSPACE
*          COPYEXT",cbl,cpy" NOCOPYLBR COPYLIST COPYLISTCOMMENT"1" CSI
*          CURRENCY-SIGN"36" CURRENT-DATE"MMDDYY" NODATA DATACOMPRESS"0"
*          NODATA-CONTEXT DATE DBCHECK DBCS"2" NODBCSSOSI DBSPACE DE-EDIT"2"
*          DEFAULTBYTE"0" NODEFAULTCALLS DETECTLOCK NODG DIALECT"MF"
*          NODIRECTIVES-IN-COMMENTS NODOSVS NODPCINSUBSCRIPT DYNAM
*          NOEARLY-RELEASE ECHO NOECHOALL NOEDITOR ENSUITE"0" NOENTCOBOL
*          ERRFORMAT"1" ERRLIST"EMBED" NOERRQ FASTSORT NOFCD3 NOFCDREG
*          NOFDCLEAR NOFILESHARE FILETYPE"0" NOFLAG NOFLAGAS NOFLAGCD
*          NOFLAGEUC NOFLAGMIG NOFLAGQ FLAGSINEDIT NOFLAGSTD NOFOLDCALLNAME
*          NOFOLDCOPYNAME FORM"60" NOFP-ROUNDING NOHOSTARITHMETIC
*          NOHOSTCONTZERO NOHOST-NUMCOMPARE NOHOST-NUMMOVE NOHOSTFD NOHOSTRW
*          NOIBM-MS IBMCOMP IDXFORMAT"0" NOILGEN IMPLICITSCOPE NOINDD
*          INFORETURN"0" NOINITCALL INITPTR INT"SOCK11.int" INTDATE"ANSI"
*          INTLEVEL"2" IOCONV NOISO2002 NOIXNLSKEY NOIXNUMKEY KEEP-INT
*          KEYCHECK KEYCOMPRESS"0" LIBRARIAN"2" NOLINE-COUNT LIST"SOCK11.lst"
*          LISTPATH"" LISTWIDTH"80" LITVAL-SIZE"4" LOCKTYPE"0" NOMAPNAME
*          NOMAXERROR METHODDEFAULT"REFERENCE" MF"15" MFCOMMENT NOMOVELENCHECK
*          NOMS NOMVS NATIVE"ASCII" NONATIVEFLOATINGPOINT NONCHAR
*          NONEWBASENAME NONLS NSYMBOL"DBCS" NOODOOSVS NOODOSLIDE
*          NOOLDBLANKLINE NOOLDCOPY NOOLDINDEX NOOLDNEXTSENTENCE NOOLDREADINTO
*          NOOLDSTRMIX OOCTRL"-C-E-G-P+Q+R-S+W" OPTIONAL-FILE NOOS390 OSEXT""
*          NOOSVS NOOUTDD NOP64 NOPANVALET PERFORM-TYPE"OSVS" NOPREPLIST
*          NOPREPROCESS NOPRINT-EXT NOPROFILE NOPROGID-COMMENT
*          NOPROGID-INT-NAME NOPROTECT-LINKAGE PROTOTYPE"RELAXED" QUAL
*          QUALPROC NOQUERY NOQUOTE NORAWLIST NORDW RECMODE"F" NOREENTRANT
*          NOREF NOREFNO REMAINDER"1" REPORT-LINE"256" RESEQ NORETRYLOCK
*          REWRITE-LS NORM RTNCODE-SIZE"4" NORWHARDPAGE NOSAA SEG NOSEQCHK
*          SEQUENTIAL"RECORD" NOSERIAL SETTING"LINE" NOSHAREOUTDD NOSHOW-DIR
*          SIGN"ASCII" NOSIGNDISCARD NOSIGNFIXUP SORTTYPE"DFSORT" SOURCEFORMAT
*          "FIXED" SOURCETABSTOP"8" NOSPZERO NOSSRANGE STDERR STICKY-LINKAGE
*          "2" NOSTICKY-PERFORM SUPFF SWITCHTYPE"1" SYMBSTART"1" SYSPUNCH"132"
*          TERMPAGE TIME NOTRACE NOTRUNC NOTRUNCCALLNAME NOTRUNCCOPY TRUNCINC
*          "10" UNICODE"NATIVE" VERBOSE VSC2"4" WARNING"1" NOWB NOWB2 NOWB3
*          WEBSERVER"CGI" NOWRITELOCK NOWRITETHRU NOXOPEN NOXREF
*          NOZEROLENGTHFALSE NOZEROSEQ NOZWB
     2 IDENTIFICATION DIVISION.
     3 PROGRAM-ID. SOCK11.
     4 AUTHOR.     Cowtown.
     5 DATE-COMPILED. 22-Aug-18 13:17.
     6*SECURITY.   *****************************************************
     7*            *                                                   *
     8*            *   THIS PROGRAM IS THE PROPERTY OF CSO             *
     9*            *                                                   *
    10*            *   USE OF THIS PROGRAM BY OTHER THAN THE EMPLOYEES *
    11*            *   OF     CSO     IS EXPRESSLY PROHIBITED WITHOUT  *
    12*            *   THE PRIOR WRITTEN PERMISSION OF CSO.            *
    13*            *                                                   *
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page   2
* SOCK11.cbl
    14*            *****************************************************
    15******************************************************************
    16*REMARKS.                                                        *
    17*  This program gets kicked off by C# APP SpecAcctHandling via   *
    18*     Transaction SO11. Pulls all table rows from table          *
    19*     RefSpecHand in the Logic DB into an array. Next reads the  *
    20*     account master (ERACCT) one record at a time, compares to  *
    21*     all entries in array and updates the ERACCT accordingly.   *
    22******************************************************************
    23*                   C H A N G E   L O G
    24*
    25* CHANGES ARE MARKED BY THE CHANGE EFFECTIVE DATE.
    26*-----------------------------------------------------------------
    27*  CHANGE   CHANGE REQUEST PGMR  DESCRIPTION OF CHANGE
    28* EFFECTIVE    NUMBER
    29*-----------------------------------------------------------------
    30* 080818   2018040600002   PEMA  New Program
    31******************************************************************
    32 ENVIRONMENT DIVISION.
    33 data division.
    34 WORKING-STORAGE SECTION.
    35 01  DFH-START PIC X(04).
    36 77  FILLER  PIC X(32) VALUE '********************************'.
    37 77  FILLER  PIC X(32) VALUE '   SOCK11   WORKING STORAGE     '.
    38 77  FILLER  PIC X(32) VALUE '********************************'.
    39*
    40* program buffers
    41*
    42 77 ws-send-msg-size             pic s9(8) comp value 256.
    43 77 ws-recv-msg-size             pic s9(8) comp value 256.
    44 77 ws-recv-buf                  pic x(256).
    45 77 ws-send-buf                  pic x(256) VALUE SPACES.
    46 77 ws-recv-total                pic s9(8) comp value 0.
    47 77 ws-recv-left                 pic s9(8) comp value 0.
    48 77 ws-seq-num                   pic s9(8) comp value 0.
    49 77 ws-flags                     pic s9(8) comp value 0.
    50 77 WS-COMP-CD                   PIC X  VALUE LOW-VALUES.
    51 77  ws-comp-id                  pic xxx value spaces.
    52 77 X1                           PIC S999 COMP-3 VALUE +0.
    53 77 S1                           PIC S999 COMP-3 VALUE +0.
    54 77 S2                           PIC S999 COMP-3 VALUE +0.
    55 77 WS-DIS-RESP                  PIC 9(05) VALUE ZEROS.
    56 77  WS-ERACCT-SW                PIC X VALUE ' '.
    57     88  END-OF-ERACCT                 VALUE 'Y'.
    58 77  ws-socket-sw                pic x value ' '.
    59     88  end-of-socket              value 'Y'.
    60 77  ws-browse-sw                pic x value ' '.
    61     88  browse-started            value 'Y'.
    62 77  ws-connect-sw               pic x value ' '.
    63     88  connected-to-db           value 'Y'.
    64 77  ws-bin-current-dt           pic xx value low-values.
    65 77  WS-MATCH-SW                 PIC X value ' '.
    66     88  found-match               value 'Y'.
    67 77  ws-acct-reads               pic 9(7) value zeros.
    68 77  ws-acnt-reads               pic 9(7) value zeros.
    69 77  ws-acnt-updates             pic 9(7) value zeros.
    70 77  ws-acnt-deletes             pic 9(7) value zeros.
    71 77  ws-batch-job-sw             pic x value spaces.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page   3
* SOCK11.cbl
    72     88  batch-job                  value 'Y'.
    73 01  P pointer.
    74 01  KIXSYS                      pic X(7)  VALUE Z"KIXSYS".
    75 01  var-ptr pointer.
    76 01  env-var-len                 pic 9(4)  binary.
    77 01  rc                          pic 9(9)  binary.
    78 01  ws-save-report-code-1       pic x(10) value spaces.
    79 01  ws-save-report-code-2       pic x(10) value spaces.
    80 01  ws-save-report-code-3       pic x(10) value spaces.
    81 01  ws-save-user-select-2       pic x(10) value spaces.
    82 01  ws-save-user-select-5       pic x(10) value spaces.
    83 01  ws-save-eracct-key.
    84     05  ws-save-comp-cd         pic x.
    85     05  ws-save-carrier         pic x.
    86     05  f                       pic x(6).
    87     05  ws-save-state           pic xx.
    88     05  ws-save-account         pic x(10).
    89 01  WS-KIXSYS.
    90     05  WS-KIX-FIL1             PIC X(10).
    91     05  WS-KIX-APPS             PIC X(10).
    92     05  WS-KIX-ENV              PIC X(10).
    93     05  WS-KIX-MYENV            PIC X(10).
    94     05  WS-KIX-SYS              PIC X(10).
*   95 EXEC SQL
*   96    INCLUDE SQLDA
*   97 END-EXEC
    98 01 SQLDA sync.
    99    05 SQLDAID               PIC X(8)  VALUE "SQLDA  ".
   100    05 SQLDABC               PIC S9(9) COMP-5 value 0.
   101    05 SQLN                  PIC S9(4) COMP-5 value 0.
   102    05 SQLD                  PIC S9(4) COMP-5 value 0.
   103    05 SQLVAR OCCURS 0 TO 1489 TIMES DEPENDING ON SQLD.
   104       10 SQLTYPE            PIC S9(4) COMP-5.
   105       10 SQLLEN             PIC S9(4) COMP-5.
   106$IF P64 SET
   107X      *> For 64-bit environments, ensure that SQLDATA is
   108X      *> aligned on an 8-byte boundary.
   109X      10 FILLER             PIC S9(9) COMP-5.
   110$END
   111       10 SQLDATA            USAGE POINTER.
   112       10 SQLIND             USAGE POINTER.
   113       10 SQLNAME.
   114          15 SQLNAMEL        PIC S9(4) COMP-5.
   115          15 SQLNAMEC        PIC X(30).
   116
   117* Values for SQLTYPE
   118
   119 78  ESQL-DATE-CHAR              VALUE 384.
   120 78  ESQL-DATE-CHAR-NULL         VALUE 385.
   121 78  ESQL-DATE-REC               VALUE 386.
   122 78  ESQL-DATE-REC-NULL          VALUE 387.
   123 78  ESQL-TIME-CHAR              VALUE 388.
   124 78  ESQL-TIME-CHAR-NULL         VALUE 389.
   125 78  ESQL-TIME-REC               VALUE 390.
   126 78  ESQL-TIME-REC-NULL          VALUE 391.
   127 78  ESQL-TIMESTAMP-CHAR         VALUE 392.
   128 78  ESQL-TIMESTAMP-CHAR-NULL    VALUE 393.
   129 78  ESQL-TIMESTAMP-REC          VALUE 394.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page   4
* SOCK11.cbl (/opt/lib/cobol/cpylib/sqlda.cpy)
   130 78  ESQL-TIMESTAMP-REC-NULL     VALUE 395.
   131 78  ESQL-TS-OFFSET-CHAR         VALUE 396. *> added nx51sp1
   132 78  ESQL-TS-OFFSET-CHAR-NULL    VALUE 397.
   133 78  ESQL-TS-OFFSET-REC          VALUE 398.
   134 78  ESQL-TS-OFFSET-REC-NULL     VALUE 399. *> end adds nx51sp1
   135 78  ESQL-LONGVARBINARY          VALUE 404.
   136 78  ESQL-LONGVARBINARY-NULL     VALUE 405.
   137 78  ESQL-LONGVARCHAR            VALUE 408.
   138 78  ESQL-LONGVARCHAR-NULL       VALUE 409.
   139 78  ESQL-BINARY                 VALUE 444.
   140 78  ESQL-BINARY-NULL            VALUE 445.
   141 78  ESQL-VARBINARY              VALUE 446.
   142 78  ESQL-VARBINARY-NULL         VALUE 447.
   143 78  ESQL-VARCHAR                VALUE 448.
   144 78  ESQL-VARCHAR-NULL           VALUE 449.
   145
   146 78  ESQL-CHARVARYING            VALUE 450.  *> added esq03n31
   147 78  ESQL-CHARVARYING-NULL       VALUE 451.  *> added esq03n31
   148
   149 78  ESQL-CHAR                   VALUE 452.
   150 78  ESQL-CHAR-NULL              VALUE 453.
   151
   152 78  ESQL-CHAR-FIXED             VALUE 454.  *> added esq03n31
   153 78  ESQL-CHAR-FIXED-NULL        VALUE 455.  *> added esq03n31
   154
   155 78  ESQL-DOUBLE                 VALUE 480.
   156 78  ESQL-DOUBLE-NULL            VALUE 481.
   157 78  ESQL-REAL                   VALUE 482.
   158 78  ESQL-REAL-NULL              VALUE 483.
   159 78  ESQL-DECIMAL                VALUE 484.
   160 78  ESQL-DECIMAL-NULL           VALUE 485.
   161 78  ESQL-INTEGER                VALUE 496.
   162 78  ESQL-INTEGER-NULL           VALUE 497.
   163 78  ESQL-SMALLINT               VALUE 500.
   164 78  ESQL-SMALLINT-NULL          VALUE 501.
   165 78  ESQL-TINYINT                VALUE 502.
   166 78  ESQL-TINYINT-NULL           VALUE 503.
*  167 EXEC SQL
*  168    INCLUDE SQLCA
*  169 END-EXEC
   170 01 SQLCA.
   171     05  SQLCAID         PIC X(8)         VALUE "SQLCA   ".
   172     05  SQLCABC         PIC S9(9) COMP-5 VALUE 136.
   173     05  SQLCODE         PIC S9(9) COMP-5 VALUE 0.
   174     05  SQLERRM.
   175         49  SQLERRML    PIC S9(4) COMP-5.
   176         49  SQLERRMC    PIC X(70).
   177     05  SQLERRP         PIC X(8).
   178     05  SQLERRD         PIC S9(9) COMP-5 OCCURS 6 VALUE 0.
   179     05  SQLWARN.
   180         10  SQLWARN0    PIC X.
   181         10  SQLWARN1    PIC X.
   182         10  SQLWARN2    PIC X.
   183         10  SQLWARN3    PIC X.
   184         10  SQLWARN4    PIC X.
   185         10  SQLWARN5    PIC X.
   186         10  SQLWARN6    PIC X.
   187         10  SQLWARN7    PIC X.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page   5
* SOCK11.cbl (/opt/lib/cobol/cpylib/sqlca.cpy)
   188     05  SQLEXT.
   189         10  SQLWARN8    PIC X.
   190         10  SQLWARN9    PIC X.
   191         10  SQLWARN10   PIC X.
   192         10  SQLWARNA    REDEFINES SQLWARN10 PIC X .
   193     05  SQLSTATE    PIC X(5).
   194 EXEC SQL
   195    BEGIN DECLARE SECTION
   196 END-EXEC
   197 01  ws-error-message            pic x(50) value spaces.
   198 01  ws-status-date              pic x(10).
   199 01  sqlcmd                      pic x(1024).
   200 01  svr                         pic x(32).
   201 01  usr                         pic x(32).
   202 01  pass                        pic x(32).
   203 01  usr-pass                    pic x(64).
   204 01  ws-disp-code                pic s9(11).
   205 01  ws-display-response         pic s9(9) value zeros.
   206***-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_***
   207***                                                            ***
   208***  These indicators are used to determine if a variable      ***
   209***  is        null.           The indicator will be -1        ***
   210***  if the value        is null  and +0 if the value is       ***
   211***  something other than null.  Here is an example on how     ***
   212***  to use the indicator variables.                           ***
   213***                                                            ***
   214***     EXEC SQL                                               ***
   215***        fetch checkapp into                                 ***
   216***           :db-app-status :nu-app-status,                   ***
   217***           :db-app-by     :nu-app-by,                       ***
   218***           :db-app-date   :nu-app-date,                     ***
   219***           :db-app-batch  :nu-app-batch                     ***
   220***     END-EXEC                                               ***
   221***                                                            ***
   222***           OR This way on an update                         ***
   223***                                                            ***
   224***     EXEC SQL                                               ***
   225***        UPDATE                                              ***
   226***           CUC_Logic_Remittance                             ***
   227***        SET                                                 ***
   228***           LogicStatus     = :ws-status-code,               ***
   229***           LogicStatusDate = :ws-status-date,               ***
   230***           BatchNumber     = :ws-batch-no :nu-batchno       ***
   231***        WHERE                                               ***
   232***           RemitId = :ws-remit-id                           ***
   233***     END-EXEC                                               ***
   234***                                                            ***
   235***    Also, when the table has a column with a data type of   ***
   236***  "BIT" and used as true/false move the 1 byte receiving    ***
   237***  field to ws-bit and check out ws-bit-comp. if = zeros,    ***
   238***  then its false. I think true would be 256.                ***
   239***                                                            ***
   240***                                                            ***
   241***_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-***
   242 01  ws-bit                      pic x.
   243 01  ws-bit-comp redefines ws-bit pic s9(4) comp.
   244 01  indicator-vaiables-for-nulls.
   245     05  nu-report-code1         pic s9(4) comp value +0.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page   6
* SOCK11.cbl
   246     05  nu-report-code2         pic s9(4) comp value +0.
   247     05  nu-report-code3         pic s9(4) comp value +0.
   248     05  nu-user-select2         pic s9(4) comp value +0.
   249     05  nu-user-select5         pic s9(4) comp value +0.
   250     05  nu-carrier              pic s9(4) comp value +0.
   251     05  nu-state                pic s9(4) comp value +0.
   252     05  nu-account              pic s9(4) comp value +0.
   253     05  nu-status               pic s9(4) comp value +0.
   254 01  table-row.
   255     05  tr-report-code1         pic x(10).
   256     05  tr-report-code2         pic x(10).
   257     05  tr-report-code3         pic x(10).
   258     05  tr-user-select2         pic x(10).
   259     05  tr-user-select5         pic x(10).
   260     05  tr-carrier              pic x.
   261     05  tr-state                pic xx.
   262     05  tr-account              pic x(10).
   263     05  tr-status               pic x.
   264 EXEC SQL
   265    END DECLARE SECTION
   266 END-EXEC
   267 01  a1                          pic s9(5) comp-3 value +0.
   268 01  ma1                         pic s9(5) comp-3 value +0.
   269 01  sql-table.
   270     05  sql-table-array occurs 3000.
   271         10  a1-report-code1     pic x(10).
   272         10  a1-report-code2     pic x(10).
   273         10  a1-report-code3     pic x(10).
   274         10  a1-user-select2     pic x(10).
   275         10  a1-user-select5     pic x(10).
   276         10  a1-carrier          pic x.
   277         10  a1-state            pic xx.
   278         10  a1-account          pic x(10).
   279         10  a1-status           pic x.
   280 01  soc-client-in-data          pic x(50).
   281 01  WS-AM-KEY.
   282     05  WS-AM-COMPANY-CD        PIC X.
   283     05  WS-AM-CARRIER           PIC X.
   284     05  WS-AM-GROUP             PIC X(6).
   285     05  WS-AM-STATE             PIC XX.
   286     05  WS-AM-ACCOUNT           PIC X(10).
   287     05  WS-AM-EXP-DT            PIC XX.
   288     05  FILLER                  PIC X(4).
   289 01  WS-NT-KEY.
   290     05  WS-NT-COMPANY-CD        PIC X.
   291     05  WS-NT-CARRIER           PIC X.
   292     05  WS-NT-GROUP             PIC X(6).
   293     05  WS-NT-STATE             PIC XX.
   294     05  WS-NT-ACCOUNT           PIC X(10).
   295     05  WS-NT-rec-type          PIC X.
   296     05  ws-nt-seq-no            pic s9(4) comp.
   297 01  ws-return-string.
   298     05  ws-return-error-no      pic x(4).
   299     05  ws-sc1                  pic x.
   300     05  ws-return-error-mess    pic x(45).
   301     05  ws-sc2                  pic x.
   302     05  ws-return-accts-read    pic zzzzzz9.
   303     05  ws-sc3                  pic x.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page   7
* SOCK11.cbl
   304     05  ws-return-acnts-read    pic zzzzzz9.
   305     05  ws-sc4                  pic x.
   306     05  ws-return-acnts-updated pic zzzzzz9.
   307     05  ws-sc5                  pic x.
   308     05  ws-return-acnts-deletes pic zzzzzz9.
   309 01  WS-CID-NO                   PIC X(8).
   310 01  WS-DISP-RESP                PIC 9(5).
   311 01  WS-RESPONSE                 PIC S9(8)   COMP.
   312     88  RESP-NORMAL                  VALUE +00.
   313     88  RESP-NOTFND                  VALUE +13.
   314     88  resp-duprec                  value +14.
   315     88  resp-dupkey                  value +15.
   316     88  RESP-NOTOPEN                 VALUE +19.
   317     88  RESP-ENDFILE                 VALUE +20.
   318*                                 COPY ERCACCT.
   319******************************************************************
   320*                                                                *
   321*                                                                *
   322*                            ERCACCT                             *
   323*           COPYBOOK REVIEWED FOR YEAR 2000 COMPLIANCE
   324*                            VMOD=2.031                          *
   325*                                                                *
   326*   CREDIT SYSTEM ACCOUNT MASTER FILE                            *
   327*                                                                *
   328*   THIS COPYBOOK IS USED FOR BOTH THE ONLINE AND BATCH          *
   329*   VSAM ACCOUNT MASTER FILES.                                   *
   330*                                                                *
   331*   FILE DESCRIPTION = ACCOUNT OR PRODUCER FILES                 *
   332*                                                                *
   333*   FILE TYPE = VSAM,KSDS                                        *
   334*   RECORD SIZE = 2000  RECFORM = FIX                            *
   335*                                                                *
   336*   BASE CLUSTER NAME = ERACCT                    RKP=2,LEN=26   *
   337*       ALTERNATE PATH1 = ERACCT2 (ALT GROUPING) RKP=28,LEN=26   *
   338*                                                                *
   339*   LOG = NO                                                     *
   340*   SERVREQ = BROWSE, DELETE, UPDATE, NEWREC                     *
   341*                                                                *
   342*                                                                *
   343******************************************************************
   344*                   C H A N G E   L O G
   345*
   346* CHANGES ARE MARKED BY THE CHANGE EFFECTIVE DATE.
   347*-----------------------------------------------------------------
   348*  CHANGE   CHANGE REQUEST PGMR  DESCRIPTION OF CHANGE
   349* EFFECTIVE    NUMBER
   350*-----------------------------------------------------------------
   351* 102004    2003031400002  PEMA  ADD NEW STATUS CODE
   352* 092705    2005050300006  PEMA  ADD SPP LEASES
   353* 022808    2007083100002  PEMA  ADD FREEZE STATUS
   354* 011410  CR2009050700003  PEMA  ADD SPP DEALER DIRECT
   355* 030211  CR2010012100001  PEMA  ADD EMAILS FROM RDS
   356* 031811  CR2011012700001  PEMA  ADD ACCT STATUS S - SUSPENDED
   357* 101711  CR2011092000001  PEMA  ADD UNEARNED FACTOR STATE FOR DCC
   358* 021916  CR2014010900001  TANA  ADD NEW STATUS CODE VALUES
   359******************************************************************
   360
   361 01  ACCOUNT-MASTER.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page   8
* SOCK11.cbl
   362     12  AM-RECORD-ID                      PIC XX.
   363         88  VALID-AM-ID                      VALUE 'AM'.
   364
   365     12  AM-CONTROL-PRIMARY.
   366         16  AM-COMPANY-CD                 PIC X.
   367         16  AM-MSTR-CNTRL.
   368             20  AM-CONTROL-A.
   369                 24  AM-CARRIER            PIC X.
   370                 24  AM-GROUPING.
   371                     28 AM-GROUPING-PREFIX PIC XXX.
   372                     28 AM-GROUPING-PRIME  PIC XXX.
   373                 24  AM-STATE              PIC XX.
   374                 24  AM-ACCOUNT.
   375                     28  AM-ACCOUNT-PREFIX PIC X(4).
   376                     28  AM-ACCOUNT-PRIME  PIC X(6).
   377             20  AM-CNTRL-1   REDEFINES   AM-CONTROL-A
   378                                           PIC X(19).
   379             20  AM-CNTRL-B.
   380                 24  AM-EXPIRATION-DT      PIC XX.
   381                 24  FILLER                PIC X(4).
   382             20  AM-CNTRL-2 REDEFINES AM-CNTRL-B.
   383                 24  AM-EXPIRE-DT          PIC 9(11)  COMP-3.
   384
   385     12  AM-CONTROL-BY-VAR-GRP.
   386         16  AM-COMPANY-CD-A1              PIC X.
   387         16  AM-VG-CARRIER                 PIC X.
   388         16  AM-VG-GROUPING                PIC X(6).
   389         16  AM-VG-STATE                   PIC XX.
   390         16  AM-VG-ACCOUNT                 PIC X(10).
   391         16  AM-VG-DATE.
   392             20  AM-VG-EXPIRATION-DT       PIC XX.
   393             20  FILLER                    PIC X(4).
   394         16  AM-VG-EXP-DATE REDEFINES AM-VG-DATE
   395                                           PIC 9(11)      COMP-3.
   396     12  FILLER REDEFINES AM-CONTROL-BY-VAR-GRP.
   397         16  FILLER                        PIC X(10).
   398         16  AM-VG-KEY3.
   399             20  AM-VG3-ACCOUNT            PIC X(10).
   400             20  AM-VG3-EXP-DT             PIC XX.
   401         16  FILLER                        PIC X(4).
   402     12  AM-MAINT-INFORMATION.
   403         16  AM-LAST-MAINT-DT              PIC XX.
   404         16  AM-LAST-MAINT-HHMMSS          PIC S9(7)      COMP-3.
   405         16  AM-LAST-MAINT-USER            PIC X(4).
   406         16  FILLER                        PIC XX.
   407
   408     12  AM-EFFECTIVE-DT                   PIC XX.
   409     12  AM-EFFECT-DT                      PIC 9(11)      COMP-3.
   410
   411     12  AM-PREV-DATES  COMP-3.
   412         16  AM-PREV-EXP-DT                PIC 9(11).
   413         16  AM-PREV-EFF-DT                PIC 9(11).
   414
   415     12  AM-REPORT-CODE-1                  PIC X(10).
   416     12  AM-REPORT-CODE-2                  PIC X(10).
   417
   418     12  AM-CITY-CODE                      PIC X(4).
   419     12  AM-COUNTY-PARISH                  PIC X(6).
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page   9
* SOCK11.cbl
   420
   421     12  AM-NAME                           PIC X(30).
   422     12  AM-PERSON                         PIC X(30).
   423     12  AM-ADDRS                          PIC X(30).
   424     12  AM-CITY.
   425         16  AM-ADDR-CITY                  PIC X(28).
   426         16  AM-ADDR-STATE                 PIC XX.
   427     12  AM-ZIP.
   428         16  AM-ZIP-PRIME.
   429             20  AM-ZIP-PRI-1ST            PIC X.
   430                 88  AM-CANADIAN-POST-CODE    VALUE 'A' THRU 'Z'.
   431             20  FILLER                    PIC X(4).
   432         16  AM-ZIP-PLUS4                  PIC X(4).
   433     12  AM-CANADIAN-POSTAL-CODE  REDEFINES  AM-ZIP.
   434         16  AM-CAN-POSTAL-1               PIC XXX.
   435         16  AM-CAN-POSTAL-2               PIC XXX.
   436         16  FILLER                        PIC XXX.
   437     12  AM-TEL-NO.
   438         16  AM-AREA-CODE                  PIC 999.
   439         16  AM-TEL-PRE                    PIC 999.
   440         16  AM-TEL-NBR                    PIC 9(4).
   441     12  AM-TEL-LOC                        PIC X.
   442         88  AM-TEL-AT-HOME                   VALUE 'H'.
   443         88  AM-TEL-AT-BUSINESS               VALUE 'B'.
   444
   445     12  AM-COMM-STRUCTURE.
   446         16  AM-DEFN-1.
   447             20  AM-AGT-COMMS       OCCURS 10 TIMES.
   448                 24  AM-AGT.
   449                     28  AM-AGT-PREFIX     PIC X(4).
   450                     28  AM-AGT-PRIME      PIC X(6).
   451                 24  AM-COM-TYP            PIC X.
   452                 24  AM-L-COM              PIC SV9(5)     COMP-3.
   453                 24  AM-J-COM              PIC SV9(5)     COMP-3.
   454                 24  AM-A-COM              PIC SV9(5)     COMP-3.
   455                 24  AM-RECALC-LV-INDIC    PIC X.
   456                 24  AM-RETRO-LV-INDIC     PIC X.
   457                 24  AM-GL-CODES           PIC X.
   458                 24  AM-COMM-CHARGEBACK    PIC 9(02).
   459                 24  FILLER                PIC X(01).
   460         16  AM-DEFN-2   REDEFINES   AM-DEFN-1.
   461             20  AM-COM-TBLS        OCCURS 10 TIMES.
   462                 24  FILLER                PIC X(11).
   463                 24  AM-L-COMA             PIC XXX.
   464                 24  AM-J-COMA             PIC XXX.
   465                 24  AM-A-COMA             PIC XXX.
   466                 24  FILLER                PIC X(6).
   467
   468     12  AM-COMM-CHANGE-STATUS             PIC X.
   469         88  AM-COMMISSIONS-CHANGED           VALUE '*'.
   470
   471     12  AM-CSR-CODE                       PIC X(4).
   472
   473     12  AM-BILLING-STATUS                 PIC X.
   474         88  AM-ACCOUNT-BILLED                VALUE 'B'.
   475         88  AM-ACCOUNT-NOT-BILLED            VALUE ' '.
   476     12  AM-AUTO-REFUND-SW                 PIC X.
   477         88  AUTO-REFUNDS-USED                VALUE 'Y'.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  10
* SOCK11.cbl
   478         88  AUTO-REFUNDS-NOT-USED            VALUE 'N' ' '.
   479     12  AM-GPCD                           PIC 99.
   480     12  AM-IG                             PIC X.
   481         88  AM-HAS-INDIVIDUAL                VALUE '1'.
   482         88  AM-HAS-GROUP                     VALUE '2'.
   483     12  AM-STATUS                         PIC X.
   484         88  AM-ACCOUNT-ACTIVE                VALUE '0'.
   485         88  AM-ACCOUNT-INACTIVE              VALUE '1'.
   486         88  AM-ACCOUNT-TRANSFERRED           VALUE '2'.
   487         88  AM-ACCOUNT-CANCELLED             VALUE '3'.
   488         88  AM-ACCOUNT-FROZEN                VALUE '4'.
   489         88  AM-ACCOUNT-SUSPENDED             VALUE '5'.
   490         88  AM-ACCOUNT-DROPPED               VALUE '6'.
   491         88  AM-ACCOUNT-LAPSED                VALUE '7'.
   492         88  AM-ACCOUNT-RUN-OFF               VALUE '8'.
   493         88  AM-ACCOUNT-PENDING               VALUE '9'.
   494     12  AM-REMIT-TO                       PIC 99.
   495     12  AM-ID-NO                          PIC X(11).
   496
   497     12  AM-CAL-TABLE                      PIC XX.
   498     12  AM-LF-DEVIATION                   PIC XXX.
   499     12  AM-AH-DEVIATION                   PIC XXX.
   500     12  AM-LF-DEVIATION-PCT               PIC S9V9(6)    COMP-3.
   501     12  AM-AH-DEVIATION-PCT               PIC S9V9(6)    COMP-3.
   502     12  AM-LF-OB-RATE                     PIC S99V9(5)   COMP-3.
   503     12  AM-AH-OB-RATE                     PIC S99V9(5)   COMP-3.
   504     12  AM-LF-OB-RATE-JNT                 PIC S99V9(5)   COMP-3.
   505     12  AM-AH-OB-RATE-JNT                 PIC S99V9(5)   COMP-3.
   506
   507     12  AM-USER-FIELDS.
   508         16  AM-FLD-1                      PIC XX.
   509         16  AM-FLD-2                      PIC XX.
   510         16  AM-FLD-3                      PIC XX.
   511         16  AM-FLD-4                      PIC XX.
   512         16  AM-FLD-5                      PIC XX.
   513
   514     12  AM-1ST-PROD-DATE.
   515         16  AM-1ST-PROD-YR                PIC XX.
   516         16  AM-1ST-PROD-MO                PIC XX.
   517         16  AM-1ST-PROD-DA                PIC XX.
   518     12  AM-ANNIVERSARY-DATE               PIC 9(11)  COMP-3.
   519     12  AM-CERTS-PURGED-DATE.
   520         16  AM-PUR-YR                     PIC XX.
   521         16  AM-PUR-MO                     PIC XX.
   522         16  AM-PUR-DA                     PIC XX.
   523     12  AM-HI-CERT-DATE                   PIC 9(11)  COMP-3.
   524     12  AM-LO-CERT-DATE                   PIC 9(11)  COMP-3.
   525     12  AM-ENTRY-DATE                     PIC 9(11)  COMP-3.
   526     12  AM-INACTIVE-DATE.
   527         16  AM-INA-MO                     PIC 99.
   528         16  AM-INA-DA                     PIC 99.
   529         16  AM-INA-YR                     PIC 99.
   530     12  AM-AR-HI-CERT-DATE                PIC XX.
   531
   532     12  AM-LF-PSI-FACTOR                  PIC S9V9(6)    COMP-3.
   533     12  AM-AH-PSI-FACTOR                  PIC S9V9(6)    COMP-3.
   534
   535     12  AM-OB-PAYMENT-MODE                PIC X.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  11
* SOCK11.cbl
   536         88  AM-OB-PAID-MONTHLY               VALUE 'M' ' '.
   537         88  AM-OB-PAID-QUARTERLY             VALUE 'Q'.
   538         88  AM-OB-PAID-SEMI-ANNUALLY         VALUE 'S'.
   539         88  AM-OB-PAID-ANNUALLY              VALUE 'A'.
   540
   541     12  AM-AH-ONLY-INDICATOR              PIC X.
   542         88  AM-AH-ONLY-ALLOWED               VALUE 'Y' ' '.
   543         88  AM-NO-AH-ONLY                    VALUE 'N'.
   544
   545     12  AM-EDIT-LOAN-OFC                  PIC X(01).
   546
   547     12  AM-OVER-SHORT.
   548         16 AM-OVR-SHT-AMT                 PIC S999V99    COMP-3.
   549         16 AM-OVR-SHT-PCT                 PIC S9V9(4)    COMP-3.
   550
   551     12  AM-DCC-PRODUCT-CODE               PIC XXX.
   552     12  AM-DCC-CLP-STATE                  PIC XX.
   553
   554     12  AM-RECALC-COMM                    PIC X.
   555     12  AM-RECALC-REIN                    PIC X.
   556
   557     12  AM-REI-TABLE                      PIC XXX.
   558     12  AM-REI-ET-LF                      PIC X.
   559     12  AM-REI-ET-AH                      PIC X.
   560     12  AM-REI-PE-LF                      PIC X.
   561     12  AM-REI-PE-AH                      PIC X.
   562     12  AM-REI-PRT-ST                     PIC X.
   563     12  AM-REI-FEE-LF                     PIC S9V9999    COMP-3.
   564     12  AM-REI-FEE-AH                     PIC S9V9999    COMP-3.
   565     12  AM-REI-LF-TAX                     PIC S9V9999    COMP-3.
   566     12  AM-REI-GROUP-A                    PIC X(6).
   567     12  AM-REI-MORT                       PIC X(4).
   568     12  AM-REI-PRT-OW                     PIC X.
   569     12  AM-REI-PR-PCT                     PIC S9V9999    COMP-3.
   570     12  AM-REI-78-PCT                     PIC S9V9999    COMP-3.
   571     12  AM-REI-AH-TAX                     PIC S9V9999    COMP-3.
   572     12  AM-REI-GROUP-B                    PIC X(6).
   573
   574     12  AM-TRUST-TYPE                     PIC X(2).
   575
   576     12  AM-EMPLOYER-STMT-USED             PIC X.
   577     12  AM-GROUPED-CHECKS-Y-N             PIC X.
   578
   579     12  AM-STD-AH-TYPE                    PIC XX.
   580     12  AM-EARN-METHODS.
   581         16  AM-EARN-METHOD-R              PIC X.
   582             88 AM-REF-RL-R78                 VALUE 'R'.
   583             88 AM-REF-RL-PR                  VALUE 'P'.
   584             88 AM-REF-RL-MEAN                VALUE 'M'.
   585             88 AM-REF-RL-ANTICIPATION        VALUE 'A'.
   586         16  AM-EARN-METHOD-L              PIC X.
   587             88 AM-REF-LL-R78                 VALUE 'R'.
   588             88 AM-REF-LL-PR                  VALUE 'P'.
   589             88 AM-REF-LL-MEAN                VALUE 'M'.
   590             88 AM-REF-LL-ANTICIPATION        VALUE 'A'.
   591         16  AM-EARN-METHOD-A              PIC X.
   592             88 AM-REF-AH-R78                 VALUE 'R'.
   593             88 AM-REF-AH-PR                  VALUE 'P'.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  12
* SOCK11.cbl
   594             88 AM-REF-AH-MEAN                VALUE 'M'.
   595             88 AM-REF-AH-ANTICIPATION        VALUE 'A'.
   596             88 AM-REF-AH-CALIF-SPEC          VALUE 'C'.
   597             88 AM-REF-AH-NET                 VALUE 'N'.
   598
   599     12  AM-TOL-PREM                       PIC S999V99    COMP-3.
   600     12  AM-TOL-REF                        PIC S999V99    COMP-3.
   601     12  AM-TOL-CLM                        PIC S999V99    COMP-3.
   602
   603     12  AM-RET-Y-N                        PIC X.
   604     12  AM-RET-P-E                        PIC X.
   605     12  AM-LF-RET                         PIC S9V9999    COMP-3.
   606     12  AM-AH-RET                         PIC S9V9999    COMP-3.
   607     12  AM-RET-GRP                        PIC X(6).
   608     12  AM-RETRO-POOL  REDEFINES  AM-RET-GRP.
   609         16  AM-POOL-PRIME                 PIC XXX.
   610         16  AM-POOL-SUB                   PIC XXX.
   611     12  AM-RETRO-EARNINGS.
   612         16  AM-RET-EARN-R                 PIC X.
   613         16  AM-RET-EARN-L                 PIC X.
   614         16  AM-RET-EARN-A                 PIC X.
   615     12  AM-RET-ST-TAX-USE                 PIC X.
   616         88  CHARGE-ST-TAXES-ON-RETRO         VALUE 'Y' 'E' 'P'.
   617         88  TAXES-NOT-IN-RETRO               VALUE 'N' ' '.
   618     12  AM-RETRO-BEG-EARNINGS.
   619         16  AM-RET-BEG-EARN-R             PIC X.
   620         16  AM-RET-BEG-EARN-L             PIC X.
   621         16  AM-RET-BEG-EARN-A             PIC X.
   622     12  AM-RET-MIN-LOSS-L                 PIC SV999      COMP-3.
   623     12  AM-RET-MIN-LOSS-A                 PIC SV999      COMP-3.
   624
   625     12  AM-USER-SELECT-OPTIONS.
   626         16  AM-USER-SELECT-1              PIC X(10).
   627         16  AM-USER-SELECT-2              PIC X(10).
   628         16  AM-USER-SELECT-3              PIC X(10).
   629         16  AM-USER-SELECT-4              PIC X(10).
   630         16  AM-USER-SELECT-5              PIC X(10).
   631
   632     12  AM-LF-RPT021-EXP-PCT              PIC S9(3)V9(4) COMP-3.
   633
   634     12  AM-AH-RPT021-EXP-PCT              PIC S9(3)V9(4) COMP-3.
   635
   636     12  AM-RPT045A-SWITCH                 PIC X.
   637         88  RPT045A-OFF                   VALUE 'N'.
   638
   639     12  AM-INSURANCE-LIMITS.
   640         16  AM-MAX-MON-BEN                PIC S9(7)      COMP-3.
   641         16  AM-MAX-TOT-BEN                PIC S9(7)      COMP-3.
   642
   643     12  AM-PROFILE-CHANGE-SWITCH          PIC X.
   644         88  AM-PROFILE-DATA-CHANGED          VALUE '*'.
   645
   646     12  AM-DISMBR-COVERAGE-SW             PIC X.
   647         88  AM-DISMBR-COVERAGE               VALUE 'Y'.
   648         88  AM-NO-DISMBR-COVERAGE            VALUE 'N'.
   649
   650     12  AM-CANCEL-FEE                     PIC S9(3)V9(2) COMP-3.
   651
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  13
* SOCK11.cbl
   652     12  AM-TOL-REF-PCT                    PIC S9V9(4)    COMP-3.
   653     12  AM-CLP-TOL-PCT                    PIC S9V9(4)    COMP-3.
   654     12  AM-SPP-LEASE-COMM                 PIC S9(5)V99   COMP-3.
   655     12  AM-DCC-MAX-MARKETING-FEE          PIC S9(5)      COMP-3.
   656     12  AM-DCC-UEF-STATE                  PIC XX.
   657     12  FILLER                            PIC XXX.
   658     12  AM-REPORT-CODE-3                  PIC X(10).
   659*    12  FILLER                            PIC X(22).
   660
   661     12  AM-RESERVE-DATE.
   662         16  AM-TARGET-LOSS-RATIO          PIC S9V9(4) COMP-3.
   663         16  AM-LIFE-IBNR-PCT              PIC S9V9(4) COMP-3.
   664         16  AM-CRDT-MODIFICATION-PCT      PIC S9V9(4) COMP-3.
   665
   666     12  AM-3RD-PARTY-NOTIF-LEVEL          PIC 99.
   667     12  AM-NOTIFICATION-TYPES.
   668         16  AM-NOTIF-OF-LETTERS           PIC X.
   669         16  AM-NOTIF-OF-PAYMENTS          PIC X.
   670         16  AM-NOTIF-OF-REPORTS           PIC X.
   671         16  AM-NOTIF-OF-STATUS            PIC X.
   672
   673     12  AM-BENEFIT-TABLE-USAGE            PIC X.
   674         88  AM-BENEFIT-TABLE-USED            VALUE 'Y'.
   675         88  AM-USE-DEVIATIONS-ONLY           VALUE 'D'.
   676         88  AM-EDIT-BENEFITS-ONLY            VALUE 'E'.
   677         88  AM-EDITS-NOT-USED                VALUE ' '  'N'.
   678
   679     12  AM-BENEFIT-CONTROLS.
   680         16  AM-ALLOWABLE-BENEFITS  OCCURS  20  TIMES.
   681             20  AM-BENEFIT-CODE           PIC XX.
   682             20  AM-BENEFIT-TYPE           PIC X.
   683             20  AM-BENEFIT-REVISION       PIC XXX.
   684             20  AM-BENEFIT-REM-TERM       PIC X.
   685             20  AM-BENEFIT-RETRO-Y-N      PIC X.
   686             20  FILLER                    PIC XX.
   687         16  FILLER                        PIC X(80).
   688
   689     12  AM-TRANSFER-DATA.
   690         16  AM-TRANSFERRED-FROM.
   691             20  AM-TRNFROM-CARRIER        PIC X.
   692             20  AM-TRNFROM-GROUPING.
   693                 24  AM-TRNFROM-GRP-PREFIX PIC XXX.
   694                 24  AM-TRNFROM-GRP-PRIME  PIC XXX.
   695             20  AM-TRNFROM-STATE          PIC XX.
   696             20  AM-TRNFROM-ACCOUNT.
   697                 24  AM-TRNFROM-ACCT-PREFIX PIC X(4).
   698                 24  AM-TRNFROM-ACCT-PRIME PIC X(6).
   699             20  AM-TRNFROM-DTE            PIC XX.
   700         16  AM-TRANSFERRED-TO.
   701             20  AM-TRNTO-CARRIER          PIC X.
   702             20  AM-TRNTO-GROUPING.
   703                 24  AM-TRNTO-GRP-PREFIX   PIC XXX.
   704                 24  AM-TRNTO-GRP-PRIME    PIC XXX.
   705             20  AM-TRNTO-STATE            PIC XX.
   706             20  AM-TRNTO-ACCOUNT.
   707                 24  AM-TRNTO-ACCT-PREFIX  PIC X(4).
   708                 24  AM-TRNTO-ACCT-PRIME   PIC X(6).
   709             20  AM-TRNTO-DTE              PIC XX.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  14
* SOCK11.cbl
   710         16  FILLER                        PIC X(10).
   711
   712     12  AM-SAVED-REMIT-TO                 PIC 99.
   713
   714     12  AM-COMM-STRUCTURE-SAVED.
   715         16  AM-DEFN-1-SAVED.
   716             20  AM-AGT-COMMS-SAVED    OCCURS 10 TIMES.
   717                 24  AM-AGT-SV             PIC X(10).
   718                 24  AM-COM-TYP-SV         PIC X.
   719                 24  AM-L-COM-SV           PIC SV9(5)     COMP-3.
   720                 24  AM-J-COM-SV           PIC SV9(5)     COMP-3.
   721                 24  AM-A-COM-SV           PIC SV9(5)     COMP-3.
   722                 24  AM-RECALC-LV-INDIC-SV PIC X.
   723                 24  FILLER                PIC X.
   724                 24  AM-GL-CODES-SV        PIC X.
   725                 24  AM-COM-CHARGEBACK-SV  PIC 99.
   726                 24  FILLER                PIC X.
   727         16  AM-DEFN-2-SAVED   REDEFINES   AM-DEFN-1-SAVED.
   728             20  AM-COM-TBLS-SAVED    OCCURS 10 TIMES.
   729                 24  FILLER                PIC X(11).
   730                 24  AM-L-COMA-SV          PIC XXX.
   731                 24  AM-J-COMA-SV          PIC XXX.
   732                 24  AM-A-COMA-SV          PIC XXX.
   733                 24  FILLER                PIC X(6).
   734
   735     12  AM-FLC-NET-PREMIUM-ALLOWANCE.
   736         16 AM-ACCOUNT-ALLOWANCE OCCURS  5 TIMES.
   737            20  AM-ALLOW-BEGIN-RANGE       PIC S9(5)      COMP-3.
   738            20  AM-ALLOW-END-RANGE         PIC S9(5)      COMP-3.
   739            20  AM-ALLOWANCE-AMT           PIC S9(5)V99   COMP-3.
   740
   741     12  AM-ORIG-DEALER-NO                 PIC X(10).
   742     12  FILLER                            PIC X(120).
   743
   744     12  AM-ACCOUNT-EXECUTIVE-DATA.
   745         16  AM-CONTROL-NAME               PIC X(30).
   746         16  AM-EXECUTIVE-ONE.
   747             20  AM-EXEC1-NAME             PIC X(15).
   748             20  AM-EXEC1-DIS-PERCENT      PIC S9(01)V9(04)
   749                                                          COMP-3.
   750             20  AM-EXEC1-LIFE-PERCENT     PIC S9(01)V9(04)
   751                                                          COMP-3.
   752         16  AM-EXECUTIVE-TWO.
   753             20  AM-EXEC2-NAME             PIC X(15).
   754             20  AM-EXEC2-DIS-PERCENT      PIC S9(01)V9(04)
   755                                                          COMP-3.
   756             20  AM-EXEC2-LIFE-PERCENT     PIC S9(01)V9(04)
   757                                                          COMP-3.
   758
   759     12  AM-RETRO-ADDITIONAL-DATA.
   760         16  AM-RETRO-QUALIFY-LIMIT        PIC S9(7)      COMP-3.
   761         16  AM-RETRO-PREM-P-E             PIC X.
   762         16  AM-RETRO-CLMS-P-I             PIC X.
   763         16  AM-RETRO-RET-BRACKET-LF.
   764             20  AM-RETRO-RET-METHOD-LF    PIC X.
   765                 88  AM-RETRO-USE-PCT-LF      VALUE 'P' ' '.
   766                 88  AM-RETRO-USE-SCALE-LF    VALUE 'S'.
   767             20  AM-RETRO-RET-BASIS-LF     PIC X.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  15
* SOCK11.cbl
   768                 88  AM-RETRO-EARN-BASIS-LF   VALUE 'E' ' '.
   769                 88  AM-RETRO-PAID-BASIS-LF   VALUE 'P'.
   770             20  AM-RETRO-BRACKETS-LF  OCCURS  3 TIMES.
   771                 24  AM-RETRO-RET-PCT-LF   PIC S9V9999    COMP-3.
   772                 24  AM-RETRO-RET-THRU-LF  PIC S9(7)      COMP-3.
   773         16  AM-RETRO-RET-BRACKET-AH.
   774             20  AM-RETRO-RET-METHOD-AH    PIC X.
   775                 88  AM-RETRO-USE-PCT-AH      VALUE 'P' ' '.
   776                 88  AM-RETRO-USE-SCALE-AH    VALUE 'S'.
   777                 88  AM-RETRO-USE-LIFE-METHOD VALUE 'L'.
   778             20  AM-RETRO-RET-BASIS-AH     PIC X.
   779                 88  AM-RETRO-EARN-BASIS-AH   VALUE 'E' ' '.
   780                 88  AM-RETRO-PAID-BASIS-AH   VALUE 'P'.
   781             20  AM-RETRO-BRACKETS-AH  OCCURS  3 TIMES.
   782                 24  AM-RETRO-RET-PCT-AH   PIC S9V9999    COMP-3.
   783                 24  AM-RETRO-RET-THRU-AH  PIC S9(7)      COMP-3.
   784
   785     12  AM-COMMENTS.
   786         16  AM-COMMENT-LINE           PIC X(50)   OCCURS 5 TIMES.
   787
   788     12  AM-CLIENT-OVERLAY-FLI   REDEFINES   AM-COMMENTS.
   789         16  AM-FLI-RETRO-SHARE-CODE       PIC X.
   790         16  AM-FLI-BILLING-CODE           PIC X.
   791         16  AM-FLI-ALT-STATE-CODE         PIC XX.
   792         16  AM-FLI-UNITED-IDENT           PIC X.
   793         16  AM-FLI-INTEREST-LOST-DATA.
   794             20  AM-FLI-BANK-NO            PIC X(5).
   795             20  AM-FLI-BANK-BALANCE       PIC S9(9)V99   COMP-3.
   796             20  AM-FLI-BANK-1ST-6-PREM    PIC S9(9)V99   COMP-3.
   797             20  AM-FLI-BANK-CAP-AMT       PIC S9(9)V99   COMP-3.
   798         16  AM-FLI-ALT-AGENT-CODES   OCCURS 10 TIMES.
   799             20  AM-FLI-AGT                PIC X(9).
   800             20  AM-FLI-AGT-COMM-ACC       PIC X.
   801             20  AM-FLI-AGT-SHARE-PCT      PIC S9V99      COMP-3.
   802         16  FILLER                        PIC X(102).
   803
   804     12  AM-CLIENT-OVERLAY-DMD   REDEFINES   AM-COMMENTS.
   805         16  AM-ALLOWABLE-DMD-BENEFITS  OCCURS 30 TIMES.
   806             20  AM-BENEFIT-DMD-CODE         PIC XX.
   807             20  AM-BENEFIT-DMD-TYPE         PIC X.
   808             20  AM-BENEFIT-DMD-REVISION     PIC XXX.
   809             20  AM-BENEFIT-DMD-REM-TERM     PIC X.
   810             20  AM-BENEFIT-DMD-RETRO-Y-N    PIC X.
   811         16  FILLER                          PIC X(10).
   812******************************************************************
   813*                                 copy ERCACNT.
   814******************************************************************
   815*                                                                *
   816*                                                                *
   817*                            ERCACNT.                            *
   818*           COPYBOOK REVIEWED FOR YEAR 2000 COMPLIANCE
   819*                            VMOD=2.002                          *
   820*                                                                *
   821*   FILE DESCRIPTION = NOTE FILE FOR RECORDING OF ACCOUNT NOTES  *
   822*                                                                *
   823*   FILE TYPE = VSAM,KSDS                                        *
   824*   RECORD SIZE = 120   RECFORM = FIXED                          *
   825*                                                                *
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  16
* SOCK11.cbl
   826*   BASE CLUSTER NAME = ERACNT             RKP=2,LEN=23          *
   827*       ALTERNATE INDEX = NONE                                   *
   828*                                                                *
   829*                                                                *
   830*   LOG = YES                                                    *
   831*   SERVREQ = BROWSE, DELETE, UPDATE, NEWREC                     *
   832******************************************************************
   833*                   C H A N G E   L O G
   834*
   835* CHANGES ARE MARKED BY THE CHANGE EFFECTIVE DATE.
   836*-----------------------------------------------------------------
   837*  CHANGE   CHANGE REQUEST PGMR  DESCRIPTION OF CHANGE
   838* EFFECTIVE    NUMBER
   839*-----------------------------------------------------------------
   840* 110706  CR2006071700004  PEMA  ADD BRANCH LOCATIONS
   841*           AND SHIPPING ADDRESS TO ACCOUNT NOTES FILE
   842******************************************************************
   843 01  NOTE-FILE.
   844     12  NT-FILE-ID                  PIC XX.
   845         88  VALID-NOTE-ID              VALUE 'NT'.
   846
   847     12  NT-CONTROL-PRIMARY.
   848         16  NT-COMPANY-CD           PIC X.
   849         16  NT-ACCT-NOTE-KEY.
   850             18  NT-CARRIER              PIC X.
   851             18  NT-GROUPING             PIC X(06).
   852             18  NT-STATE                PIC XX.
   853             18  NT-ACCOUNT              PIC X(10).
   854         16  NT-RECORD-TYPE          PIC X.
   855              88  ACCT-NOTE          VALUE '1'.
   856              88  ACCT-BRANCH-LOC    VALUE '2'.
   857              88  ACCT-SHIPPING-ADDR VALUE '3'.
   858         16  NT-LINE-SEQUENCE        PIC S9(4)     COMP.
   859
   860     12  NT-LAST-MAINT-DT            PIC XX.
   861     12  NT-LAST-MAINT-BY            PIC X(4).
   862     12  NT-LAST-MAINT-HHMMSS        PIC S9(7) COMP-3.
   863
   864*  ALL NOTE LINES ARE RECORD TYPE '1' WITH ALMOST UNLIMITED
   865*     SEQUENCE NUMBERS
   866     12  NT-NOTE-INFORMATION.
   867         16  NT-NOTE-LINE            PIC X(60).
   868         16  FILLER                  PIC X(25).
   869*  BOTH BRANCH LOCATION LINES ARE RECORD TYPE '2' SEQ 1 AND 2
   870     12  NT-LOCATION-INFORMATION REDEFINES
   871                         NT-NOTE-INFORMATION.
   872         16  NT-BRANCH-LOC-LINE      PIC X(60).
   873         16  FILLER                  PIC X(25).
   874* Account special indicator is record type '2', sequence 3
   875     12  filler REDEFINES NT-NOTE-INFORMATION.
   876         16  nt-account-special      PIC X.
   877         16  FILLER                  PIC X(84).
   878*  ALL SHIPPING ADDRESS LINES ARE RECORD TYPE '3'AND
   879*     SEQUENCE NUMBER 1 IS NAME LINE 1
   880*     SEQUENCE NUMBER 2 IS NAME LINE 2
   881*     SEQUENCE NUMBER 3 IS ADDR LINE 1
   882*     SEQUENCE NUMBER 4 IS ADDR LINE 2
   883*     SEQUENCE NUMBER 5 IS ADDR LINE 3
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  17
* SOCK11.cbl
   884*     SEQUENCE NUMBER 6 IS CITY, ST AND ZIP
   885     12  NT-SHIPPING-INFORMATION REDEFINES
   886                         NT-NOTE-INFORMATION.
   887         16  NT-SHIPPING-LINE        PIC X(60).
   888         16  NT-SHIP-STATE           PIC XX.
   889         16  NT-SHIP-ZIP             PIC X(10).
   890         16  FILLER                  PIC X(13).
   891*****************************************************************
   892*                                 COPY ELCFUNDT.
   893*****************************************************************
   894*                                                               *
   895*                            ELCFUNDT.                          *
   896*           COPYBOOK REVIEWED FOR YEAR 2000 COMPLIANCE *
   897*                            VMOD=2.001                         *
   898*                                                               *
   899*           COPYBOOK FOR THE FUNCTION DATE FORMAT               *
   900*                                                               *
   901*****************************************************************
   902
   903
   904 01  FUNCTION-DATE.
   905     05  WS-FN-DATE                PIC 9(8)    VALUE ZEROS.
   906     05  WS-FN-CYMD  REDEFINES  WS-FN-DATE.
   907         10  WS-FN-CCYR            PIC 9(4).
   908         10  WS-FN-CCYY  REDEFINES  WS-FN-CCYR.
   909             15  WS-FN-CC          PIC 99.
   910             15  WS-FN-YR          PIC 99.
   911         10  WS-FN-MO              PIC 99.
   912         10  WS-FN-DA              PIC 99.
   913     05  WS-FN-HOURS               PIC 99      VALUE ZEROS.
   914     05  WS-FN-MINUTES             PIC 99      VALUE ZEROS.
   915     05  WS-FN-SECONDS             PIC 99      VALUE ZEROS.
   916     05  WS-FN-HUNDSECS            PIC 99      VALUE ZEROS.
   917     05  WS-FN-GMT-IND             PIC X       VALUE SPACES.
   918         88  WS-BEHIND-GMT                     VALUE '-'.
   919         88  WS-AFTER-GMT                      VALUE '+'.
   920         88  WS-NO-GMT                         VALUE ZERO.
   921     05  WS-FN-GMT-HOURS           PIC 99      VALUE ZEROS.
   922     05  WS-FN-GMT-MINUTES         PIC 99      VALUE ZEROS.
   923*                                 COPY ELCDATE.
   924******************************************************************
   925*                                                                *
   926*                                                                *
   927*                            ELCDATE.                            *
   928*           COPYBOOK REVIEWED FOR YEAR 2000 COMPLIANCE
   929*                            VMOD=2.003
   930*                                                                *
   931*                                                                *
   932*   DESCRIPTION:  DATA PASSED TO DATE CONVERSION ROUTINE.        *
   933*                 LENGTH = 200                                   *
   934******************************************************************
   935
   936 01  DATE-CONVERSION-DATA.
   937     12  DC-COMM-LENGTH                PIC S9(4) COMP VALUE +200.
   938     12  DC-OPTION-CODE                PIC X.
   939         88  BIN-TO-GREG                VALUE ' '.
   940         88  ELAPSED-BETWEEN-BIN        VALUE '1'.
   941         88  EDIT-GREG-TO-BIN           VALUE '2'.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  18
* SOCK11.cbl
   942         88  YMD-GREG-TO-BIN            VALUE '3'.
   943         88  MDY-GREG-TO-BIN            VALUE '4'.
   944         88  JULIAN-TO-BIN              VALUE '5'.
   945         88  BIN-PLUS-ELAPSED           VALUE '6'.
   946         88  FIND-CENTURY               VALUE '7'.
   947         88  ELAPSED-BETWEEN-BIN-3      VALUE '8'.
   948         88  EDIT-GREG-TO-BIN-3         VALUE '9'.
   949         88  YMD-GREG-TO-BIN-3          VALUE 'A'.
   950         88  MDY-GREG-TO-BIN-3          VALUE 'B'.
   951         88  JULIAN-TO-BIN-3            VALUE 'C'.
   952         88  BIN-PLUS-ELAPSED-3         VALUE 'D'.
   953         88  JULIAN-EXPANDED-TO-BIN     VALUE 'E'.
   954         88  JULIAN-EXPANDED-TO-BIN-3   VALUE 'F'.
   955         88  BIN-TO-JULIAN-EXPANDED     VALUE 'G'.
   956         88  JULIAN-EXPANDED            VALUE 'E', 'F', 'G'.
   957         88  CHECK-LEAP-YEAR            VALUE 'H'.
   958         88  BIN-3-TO-GREG              VALUE 'I'.
   959         88  CYMD-GREG-TO-BIN-3         VALUE 'J'.
   960         88  MDCY-GREG-TO-BIN-3         VALUE 'K'.
   961         88  CYMD-GREG-TO-BIN           VALUE 'L'.
   962         88  MDCY-GREG-TO-BIN           VALUE 'M'.
   963         88  MDY-GREG-TO-JULIAN         VALUE 'N'.
   964         88  MDCY-GREG-TO-JULIAN        VALUE 'O'.
   965         88  YMD-GREG-TO-JULIAN         VALUE 'P'.
   966         88  CYMD-GREG-TO-JULIAN        VALUE 'Q'.
   967         88  THREE-CHARACTER-BIN
   968                  VALUES  '8' '9' 'A' 'B' 'C' 'D' 'I' 'J' 'K'.
   969         88  GREGORIAN-TO-BIN
   970                  VALUES '2' '3' '4' '9' 'A' 'B' 'J' 'K' 'L' 'M'.
   971         88  BIN-TO-GREGORIAN
   972                  VALUES ' ' '1' 'I' '8' 'G'.
   973         88  JULIAN-TO-BINARY
   974                  VALUES '5' 'C' 'E' 'F'.
   975     12  DC-ERROR-CODE                 PIC X.
   976         88  NO-CONVERSION-ERROR        VALUE ' '.
   977         88  DATE-CONVERSION-ERROR
   978                  VALUES '1' '2' '3' '4' '5' '9' 'A' 'B' 'C'.
   979         88  DATE-IS-ZERO               VALUE '1'.
   980         88  DATE-IS-NON-NUMERIC        VALUE '2'.
   981         88  DATE-IS-INVALID            VALUE '3'.
   982         88  DATE1-GREATER-DATE2        VALUE '4'.
   983         88  ELAPSED-PLUS-NEGATIVE      VALUE '5'.
   984         88  DATE-INVALID-OPTION        VALUE '9'.
   985         88  INVALID-CENTURY            VALUE 'A'.
   986         88  ONLY-CENTURY               VALUE 'B'.
   987         88  ONLY-LEAP-YEAR             VALUE 'C'.
   988         88  VALID-CENTURY-LEAP-YEAR    VALUE 'B', 'C'.
   989     12  DC-END-OF-MONTH               PIC X.
   990         88  CALCULATE-END-OF-MONTH     VALUE '1'.
   991     12  DC-CENTURY-ADJUSTMENT         PIC X   VALUE SPACES.
   992         88  USE-NORMAL-PROCESS         VALUE ' '.
   993         88  ADJUST-DOWN-100-YRS        VALUE '1'.
   994         88  ADJUST-UP-100-YRS          VALUE '2'.
   995     12  FILLER                        PIC X.
   996     12  DC-CONVERSION-DATES.
   997         16  DC-BIN-DATE-1             PIC XX.
   998         16  DC-BIN-DATE-2             PIC XX.
   999         16  DC-GREG-DATE-1-EDIT       PIC X(08).
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  19
* SOCK11.cbl
  1000         16  DC-GREG-DATE-1-EDIT-R REDEFINES
  1001                       DC-GREG-DATE-1-EDIT.
  1002             20  DC-EDIT1-MONTH        PIC 99.
  1003             20  SLASH1-1              PIC X.
  1004             20  DC-EDIT1-DAY          PIC 99.
  1005             20  SLASH1-2              PIC X.
  1006             20  DC-EDIT1-YEAR         PIC 99.
  1007         16  DC-GREG-DATE-2-EDIT       PIC X(08).
  1008         16  DC-GREG-DATE-2-EDIT-R REDEFINES
  1009                     DC-GREG-DATE-2-EDIT.
  1010             20  DC-EDIT2-MONTH        PIC 99.
  1011             20  SLASH2-1              PIC X.
  1012             20  DC-EDIT2-DAY          PIC 99.
  1013             20  SLASH2-2              PIC X.
  1014             20  DC-EDIT2-YEAR         PIC 99.
  1015         16  DC-GREG-DATE-1-YMD        PIC 9(06).
  1016         16  DC-GREG-DATE-1-YMD-R  REDEFINES
  1017                     DC-GREG-DATE-1-YMD.
  1018             20  DC-YMD-YEAR           PIC 99.
  1019             20  DC-YMD-MONTH          PIC 99.
  1020             20  DC-YMD-DAY            PIC 99.
  1021         16  DC-GREG-DATE-1-MDY        PIC 9(06).
  1022         16  DC-GREG-DATE-1-MDY-R REDEFINES
  1023                      DC-GREG-DATE-1-MDY.
  1024             20  DC-MDY-MONTH          PIC 99.
  1025             20  DC-MDY-DAY            PIC 99.
  1026             20  DC-MDY-YEAR           PIC 99.
  1027         16  DC-GREG-DATE-1-ALPHA.
  1028             20  DC-ALPHA-MONTH        PIC X(10).
  1029             20  DC-ALPHA-DAY          PIC 99.
  1030             20  FILLER                PIC XX.
  1031             20  DC-ALPHA-CENTURY.
  1032                 24 DC-ALPHA-CEN-N     PIC 99.
  1033             20  DC-ALPHA-YEAR         PIC 99.
  1034         16  DC-ELAPSED-MONTHS         PIC S9(4)     COMP.
  1035         16  DC-ODD-DAYS-OVER          PIC S9(4)     COMP.
  1036         16  DC-ELAPSED-DAYS           PIC S9(4)     COMP.
  1037         16  DC-JULIAN-DATE            PIC 9(05).
  1038         16  DC-JULIAN-YYDDD REDEFINES DC-JULIAN-DATE
  1039                                       PIC 9(05).
  1040         16  DC-JULIAN-DT REDEFINES DC-JULIAN-DATE.
  1041             20  DC-JULIAN-YEAR        PIC 99.
  1042             20  DC-JULIAN-DAYS        PIC 999.
  1043         16  DC-DAYS-IN-MONTH          PIC S9(3)       COMP-3.
  1044         16  DC-DAY-OF-WEEK            PIC S9  VALUE ZERO COMP-3.
  1045         16  DC-DAY-OF-WEEK2           PIC S9  VALUE ZERO COMP-3.
  1046     12  DATE-CONVERSION-VARIBLES.
  1047         16  HOLD-CENTURY-1            PIC 9(11) VALUE 0.
  1048         16  HOLD-CENTURY-1-SPLIT REDEFINES HOLD-CENTURY-1.
  1049             20  FILLER                PIC 9(3).
  1050             20  HOLD-CEN-1-CCYY.
  1051                 24  HOLD-CEN-1-CC     PIC 99.
  1052                 24  HOLD-CEN-1-YY     PIC 99.
  1053             20  HOLD-CEN-1-MO         PIC 99.
  1054             20  HOLD-CEN-1-DA         PIC 99.
  1055         16  HOLD-CENTURY-1-R   REDEFINES HOLD-CENTURY-1.
  1056             20  HOLD-CEN-1-R-MO       PIC 99.
  1057             20  HOLD-CEN-1-R-DA       PIC 99.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  20
* SOCK11.cbl
  1058             20  HOLD-CEN-1-R-CCYY.
  1059                 24  HOLD-CEN-1-R-CC   PIC 99.
  1060                 24  HOLD-CEN-1-R-YY   PIC 99.
  1061             20  FILLER                PIC 9(3).
  1062         16  HOLD-CENTURY-1-X.
  1063             20  FILLER                PIC X(3)  VALUE SPACES.
  1064             20  HOLD-CEN-1-X-CCYY.
  1065                 24  HOLD-CEN-1-X-CC   PIC XX VALUE SPACES.
  1066                 24  HOLD-CEN-1-X-YY   PIC XX VALUE SPACES.
  1067             20  HOLD-CEN-1-X-MO       PIC XX VALUE SPACES.
  1068             20  HOLD-CEN-1-X-DA       PIC XX VALUE SPACES.
  1069         16  HOLD-CENTURY-1-R-X REDEFINES HOLD-CENTURY-1-X.
  1070             20  HOLD-CEN-1-R-X-MO     PIC XX.
  1071             20  HOLD-CEN-1-R-X-DA     PIC XX.
  1072             20  HOLD-CEN-1-R-X-CCYY.
  1073                 24  HOLD-CEN-1-R-X-CC PIC XX.
  1074                 24  HOLD-CEN-1-R-X-YY PIC XX.
  1075             20  FILLER                PIC XXX.
  1076         16  DC-BIN-DATE-EXPAND-1      PIC XXX.
  1077         16  DC-BIN-DATE-EXPAND-2      PIC XXX.
  1078         16  DC-JULIAN-DATE-1          PIC 9(07).
  1079         16  DC-JULIAN-DATE-1-R REDEFINES DC-JULIAN-DATE-1.
  1080             20  DC-JULIAN-1-CCYY.
  1081                 24  DC-JULIAN-1-CC    PIC 99.
  1082                 24  DC-JULIAN-1-YR    PIC 99.
  1083             20  DC-JULIAN-DA-1        PIC 999.
  1084         16  DC-JULIAN-DATE-2          PIC 9(07).
  1085         16  DC-JULIAN-DATE-2-R REDEFINES DC-JULIAN-DATE-2.
  1086             20  DC-JULIAN-2-CCYY.
  1087                 24  DC-JULIAN-2-CC    PIC 99.
  1088                 24  DC-JULIAN-2-YR    PIC 99.
  1089             20  DC-JULIAN-DA-2        PIC 999.
  1090         16  DC-GREG-DATE-A-EDIT.
  1091             20  DC-EDITA-MONTH        PIC 99.
  1092             20  SLASHA-1              PIC X VALUE '/'.
  1093             20  DC-EDITA-DAY          PIC 99.
  1094             20  SLASHA-2              PIC X VALUE '/'.
  1095             20  DC-EDITA-CCYY.
  1096                 24  DC-EDITA-CENT     PIC 99.
  1097                 24  DC-EDITA-YEAR     PIC 99.
  1098         16  DC-GREG-DATE-B-EDIT.
  1099             20  DC-EDITB-MONTH        PIC 99.
  1100             20  SLASHB-1              PIC X VALUE '/'.
  1101             20  DC-EDITB-DAY          PIC 99.
  1102             20  SLASHB-2              PIC X VALUE '/'.
  1103             20  DC-EDITB-CCYY.
  1104                 24  DC-EDITB-CENT     PIC 99.
  1105                 24  DC-EDITB-YEAR     PIC 99.
  1106         16  DC-GREG-DATE-CYMD         PIC 9(08).
  1107         16  DC-GREG-DATE-CYMD-R REDEFINES
  1108                              DC-GREG-DATE-CYMD.
  1109             20  DC-CYMD-CEN           PIC 99.
  1110             20  DC-CYMD-YEAR          PIC 99.
  1111             20  DC-CYMD-MONTH         PIC 99.
  1112             20  DC-CYMD-DAY           PIC 99.
  1113         16  DC-GREG-DATE-MDCY         PIC 9(08).
  1114         16  DC-GREG-DATE-MDCY-R REDEFINES
  1115                              DC-GREG-DATE-MDCY.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  21
* SOCK11.cbl
  1116             20  DC-MDCY-MONTH         PIC 99.
  1117             20  DC-MDCY-DAY           PIC 99.
  1118             20  DC-MDCY-CEN           PIC 99.
  1119             20  DC-MDCY-YEAR          PIC 99.
  1120    12  DC-FORCE-EL310-DATE-SW         PIC X    VALUE SPACE.
  1121        88  DC-FORCE-EL310-DATE                 VALUE 'Y'.
  1122    12  DC-EL310-DATE                  PIC X(21).
  1123    12  FILLER                         PIC X(28).
  1124****************************************************************
  1125*
  1126* Copyright (c) 2007-2013 Dell Inc.
  1127* All rights reserved.
  1128*
  1129****************************************************************
  1130 01  DFHEIV.
  1131   02  DFHEIV0               PIC X(35).
  1132   02  DFHEIV1               PIC X(08).
  1133   02  DFHEIV2               PIC X(08).
  1134   02  DFHEIV3               PIC X(08).
  1135   02  DFHEIV4               PIC X(06).
  1136   02  DFHEIV5               PIC X(04).
  1137   02  DFHEIV6               PIC X(04).
  1138   02  DFHEIV7               PIC X(02).
  1139   02  DFHEIV8               PIC X(02).
  1140   02  DFHEIV9               PIC X(01).
  1141   02  DFHEIV10              PIC S9(7) COMP-3.
  1142   02  DFHEIV11              PIC S9(4) COMP SYNC.
  1143   02  DFHEIV12              PIC S9(4) COMP SYNC.
  1144   02  DFHEIV13              PIC S9(4) COMP SYNC.
  1145   02  DFHEIV14              PIC S9(4) COMP SYNC.
  1146   02  DFHEIV15              PIC S9(4) COMP SYNC.
  1147   02  DFHEIV16              PIC S9(9) COMP SYNC.
  1148   02  DFHEIV17              PIC X(04).
  1149   02  DFHEIV18              PIC X(04).
  1150   02  DFHEIV19              PIC X(04).
  1151   02  DFHEIV20              USAGE IS POINTER.
  1152   02  DFHEIV21              USAGE IS POINTER.
  1153   02  DFHEIV22              USAGE IS POINTER.
  1154   02  DFHEIV23              USAGE IS POINTER.
  1155   02  DFHEIV24              USAGE IS POINTER.
  1156   02  DFHEIV25              PIC S9(9) COMP SYNC.
  1157   02  DFHEIV26              PIC S9(9) COMP SYNC.
  1158   02  DFHEIV27              PIC S9(9) COMP SYNC.
  1159   02  DFHEIV28              PIC S9(9) COMP SYNC.
  1160   02  DFHEIV29              PIC S9(9) COMP SYNC.
  1161   02  DFHEIV30              PIC S9(9) COMP SYNC.
  1162   02  DFHEIV31              PIC S9(9) COMP SYNC.
  1163   02  DFHEIV32              PIC S9(4) COMP SYNC.
  1164   02  DFHEIV33              PIC S9(4) COMP SYNC.
  1165   02  DFHEIV34              PIC S9(4) COMP SYNC.
  1166   02  DFHEIV35              PIC S9(4) COMP SYNC.
  1167   02  DFHEIV97              PIC S9(7) COMP-3 VALUE ZERO.
  1168   02  DFHEIV98              PIC S9(4) COMP SYNC VALUE ZERO.
  1169   02  FILLER                PIC X(02).
  1170   02  DFHEIV99              PIC X(08) VALUE SPACE.
  1171   02  DFHEIVL0              PIC X(48) VALUE SPACE.
  1172   02  DFHEIVL1              PIC X(48) VALUE SPACE.
  1173   02  DFHEIVL2              PIC X(48) VALUE SPACE.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  22
* SOCK11.cbl
  1174   02  DFHEIVL3              PIC X(48) VALUE SPACE.
  1175   02  DFHEIVL4              PIC X(255) VALUE SPACE.
  1176   02  DFHEIVL5              PIC X(255) VALUE SPACE.
  1177 LINKAGE  SECTION.
  1178*****************************************************************
  1179*                                                               *
  1180* Copyright (c) 2007-2013 Dell Inc.                             *
  1181* All rights reserved.                                          *
  1182*                                                               *
  1183*****************************************************************
  1184 01  dfheiblk.
  1185     02  eibtime          pic s9(7) comp-3.
  1186     02  eibdate          pic s9(7) comp-3.
  1187     02  eibtrnid         pic x(4).
  1188     02  eibtaskn         pic s9(7) comp-3.
  1189     02  eibtrmid         pic x(4).
  1190     02  dfheigdi         pic s9(4) comp.
  1191     02  eibcposn         pic s9(4) comp.
  1192     02  eibcalen         pic s9(4) comp.
  1193     02  eibaid           pic x(1).
  1194     02  eibfiller1       pic x(1).
  1195     02  eibfn            pic x(2).
  1196     02  eibfiller2       pic x(2).
  1197     02  eibrcode         pic x(6).
  1198     02  eibfiller3       pic x(2).
  1199     02  eibds            pic x(8).
  1200     02  eibreqid         pic x(8).
  1201     02  eibrsrce         pic x(8).
  1202     02  eibsync          pic x(1).
  1203     02  eibfree          pic x(1).
  1204     02  eibrecv          pic x(1).
  1205     02  eibsend          pic x(1).
  1206     02  eibatt           pic x(1).
  1207     02  eibeoc           pic x(1).
  1208     02  eibfmh           pic x(1).
  1209     02  eibcompl         pic x(1).
  1210     02  eibsig           pic x(1).
  1211     02  eibconf          pic x(1).
  1212     02  eiberr           pic x(1).
  1213     02  eibrldbk         pic x(1).
  1214     02  eiberrcd         pic x(4).
  1215     02  eibsynrb         pic x(1).
  1216     02  eibnodat         pic x(1).
  1217     02  eibfiller5       pic x(2).
  1218     02  eibresp          pic s9(8) comp.
  1219     02  eibresp2         pic s9(8) comp.
  1220     02  dfheigdj         pic s9(4) comp.
  1221     02  dfheigdk         pic s9(4) comp.
  1222 01  DFHCOMMAREA.
  1223   05 GIVE-TAKE-SOCKET         PIC 9(8) COMP.
  1224   05 LSTN-NAME                PIC X(8).
  1225   05 LSTN-SUBNAME             PIC X(8).
  1226****   client-in-data must be 36 characters.  ****
  1227   05 CLIENT-IN-DATA.
  1228      15  CLIENT-KICK-OFF      PIC X(8).
  1229      15  CLIENT-ID            PIC XXX.
  1230      15  FILLER               PIC X(25).
  1231   05 SOCKADDR-IN-PARM.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  23
* SOCK11.cbl
  1232     15 SIN-FAMILY             PIC 9(4) COMP.
  1233     15 SIN-PORT               PIC 9(4) COMP.
  1234     15 SIN-ADDRESS            PIC 9(8) COMP.
  1235     15 SIN-ZERO               PIC X(8).
  1236 01  var  pic x(30).
  1237 PROCEDURE DIVISION USING DFHEIBLK DFHCOMMAREA VAR.
  1238 0000-DFHEXIT SECTION.
  1239     MOVE '9#                    $   ' TO DFHEIV0.
  1240     MOVE 'SOCK11' TO DFHEIV1.
  1241     CALL 'kxdfhei1' USING DFHEIV0 DFH-START DFHEIV DFHEIV1.
  1242     display 'SOCK11:transaction data =', CLIENT-IN-DATA '**'
  1243     display 'SOCK11:socket number    =', GIVE-TAKE-SOCKET.
  1244     display 'SOCK11:socket name      =', lstn-name ' '
  1245        lstn-subname
  1246     perform 0000-init           thru 0000-exit
  1247     perform 0010-init-contact   thru 0010-exit
  1248*    perform 0020-receive        thru 0020-exit
  1249*    if end-of-socket
  1250*       go to 0300-close-socket
  1251*    end-if
  1252     perform 0030-build-array-from-sql
  1253                                 thru 0030-exit
  1254     perform 0040-process-eracct thru 0040-exit
  1255*    display ' acct reads   ' ws-acct-reads
  1256*    display ' acnt reads   ' ws-acnt-reads
  1257*    display ' acnt updates ' ws-acnt-updates
  1258*    display ' acnt deletes ' ws-acnt-deletes
  1259     perform 0070-format-buffer  thru 0070-exit
  1260     perform 0200-send-buffer    thru 0200-exit
  1261     go to 0300-close-socket
  1262     .
  1263 0000-init.
  1264     MOVE FUNCTION CURRENT-DATE  TO FUNCTION-DATE
  1265     move ws-fn-cymd             to dc-greg-date-cymd
  1266     move 'L'                    to dc-option-code
  1267     perform 9700-date-link      thru 9700-exit
  1268     if no-conversion-error
  1269        move dc-bin-date-1       to ws-bin-current-dt
  1270     else
  1271        display ' error current dt invalid ' dc-error-code
  1272     end-if
  1273*          ws-fn-hours ':' ws-fn-minutes ':' ws-fn-seconds
  1274     move spaces                 to sql-table
  1275                                    ws-return-string
  1276     move ';'                    to ws-sc1
  1277                                    ws-sc2
  1278                                    ws-sc3
  1279                                    ws-sc4
  1280                                    ws-sc5
  1281     move zeros                  to ws-return-accts-read
  1282                                    ws-return-acnts-read
  1283                                    ws-return-acnts-updated
  1284                                    ws-return-acnts-deletes
  1285     set P to address of KIXSYS
  1286     CALL "getenv" using by value P returning var-ptr
  1287     if var-ptr = null then
  1288        display ' kixsys not set '
  1289     else
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  24
* SOCK11.cbl
  1290        set address of var to var-ptr
  1291        move 0 to env-var-len
  1292        inspect var tallying env-var-len
  1293          for characters before X'00'
  1294        unstring var (1:env-var-len) delimited by '/'
  1295           into WS-KIX-FIL1 WS-KIX-APPS WS-KIX-ENV WS-KIX-MYENV
  1296              WS-KIX-SYS
  1297        end-unstring
  1298     end-if
  1299     .
  1300 0000-exit.
  1301     exit.
  1302 0010-init-contact.
  1303     if client-kick-off = 'SOCKET11'
  1304        continue
  1305     else
  1306        set batch-job to true
  1307*       move '9999'              to ws-return-error-no
  1308*                                to ws-return-error-mess
  1309*       PERFORM 0200-SEND-BUFFER thru 0200-exit
  1310*       display ' Unknown origin ' client-in-data
  1311*       go to 0300-close-socket
  1312     end-if
  1313     MOVE X'04'                  TO WS-COMP-CD
  1314     MOVE 'CID'                  TO WS-COMP-ID
  1315*    move 'SOCKET11READY'        to ws-send-buf
  1316*    move +25                    to ws-send-msg-size
  1317*
  1318*    display 'SOCK11:sequence number  =', ws-seq-num.
  1319*    display 'SOCK11:send buffer      =', ws-send-buf(1:25)
  1320*
  1321*    call "send" using by value GIVE-TAKE-SOCKET,
  1322*        by reference ws-send-buf,
  1323*        by value ws-send-msg-size,
  1324*        by value ws-flags
  1325*
  1326*    if return-code <= zero
  1327*       display 'SOCK11:send error ' return-code
  1328*       perform 0250-socket-error thru 0250-exit
  1329*       go to 0300-close-socket
  1330*    end-if
  1331     .
  1332 0010-exit.
  1333     exit.
  1334 0020-receive.
  1335     call "recv" using by value GIVE-TAKE-SOCKET
  1336         by reference ws-recv-buf
  1337         by value ws-recv-msg-size
  1338         by value ws-flags.
  1339     if return-code < zero
  1340        display 'SOCK11:recv error ' return-code
  1341        perform 0250-socket-error thru 0250-exit
  1342        set end-of-socket to true
  1343        go to 0010-exit
  1344     end-if
  1345     if return-code = zero
  1346        display 'SOCK11:client disconnected',
  1347        perform 0250-socket-error thru 0250-exit
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  25
* SOCK11.cbl
  1348        set end-of-socket to true
  1349        go to 0010-exit
  1350     end-if
  1351*    display 'SOCK11:return code      = ', return-code
  1352*    display 'SOCK11:receive buffer   = ', ws-recv-buf(1:51)
  1353     move +50                    to ws-send-msg-size
  1354     move ws-recv-buf (1:50)     to soc-client-in-data
  1355     if ws-recv-buf (1:4) = 'DONE' or 'done' or 'Done'
  1356        set end-of-socket to true
  1357     end-if
  1358     .
  1359 0020-exit.
  1360     exit.
  1361 0030-build-array-from-sql.
  1362     if not connected-to-db
  1363        perform 6000-connect-to-db thru 6000-exit
  1364     end-if
  1365     EXEC SQL
  1366        DECLARE
  1367           getSpecInstr cursor for
  1368        SELECT
  1369           ReportCode1,
  1370           ReportCode2,
  1371           ReportCode3,
  1372           UserSelect2,
  1373           UserSelect5,
  1374           Carrier,
  1375           State,
  1376           Account,
  1377           Status
  1378        FROM
  1379           RefSpecHand
  1380     end-exec
  1381     if sqlcode not = 0
  1382        display "Error: cannot declare cursor "
  1383        display ' sql return code ' sqlcode
  1384        display ' sql err mess    ' sqlerrmc
  1385        move sqlcode             to ws-display-response
  1386        move '9999'              to ws-return-error-no
  1387        move 'Could not declare cursor'
  1388                                 to ws-return-error-mess
  1389        PERFORM 0200-SEND-BUFFER thru 0200-exit
  1390        go to 0300-close-socket
  1391     end-if
  1392     EXEC SQL
  1393        open getSpecInstr
  1394     END-EXEC
  1395     if sqlcode not = 0
  1396        display "Error: cannot open cursor "
  1397        display ' sql retrun code ' sqlcode
  1398        display ' sql err mess    ' sqlerrmc
  1399        move '9999'              to ws-return-error-no
  1400        move 'Could not Open cursor'
  1401                                 to ws-return-error-mess
  1402        PERFORM 0200-SEND-BUFFER thru 0200-exit
  1403        go to 0300-close-socket
  1404     end-if
  1405     perform until sqlcode not = 0
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  26
* SOCK11.cbl
  1406        EXEC SQL
  1407           fetch getSpecInstr into
  1408              :tr-report-code1  :nu-report-code1,
  1409              :tr-report-code2  :nu-report-code2,
  1410              :tr-report-code3  :nu-report-code3,
  1411              :tr-user-select2  :nu-user-select2,
  1412              :tr-user-select5  :nu-user-select5,
  1413              :tr-carrier       :nu-carrier,
  1414              :tr-state         :nu-state,
  1415              :tr-account       :nu-account,
  1416              :tr-status        :nu-status
  1417        END-EXEC
  1418*       display ' rpt cd1 ' tr-report-code1 ' ' nu-report-code1
  1419*       display ' rpt cd2 ' tr-report-code2 ' ' nu-report-code2
  1420*       display ' rpt cd3 ' tr-report-code3 ' ' nu-report-code3
  1421*       display ' account ' tr-account ' ' nu-account
  1422        if sqlcode = 0
  1423           add +1 to a1
  1424           if nu-report-code1 = +0
  1425              move tr-report-code1 to a1-report-code1(a1)
  1426           end-if
  1427           if nu-report-code2 = +0
  1428              move tr-report-code2 to a1-report-code2(a1)
  1429           end-if
  1430           if nu-report-code3 = +0
  1431              move tr-report-code3 to a1-report-code3(a1)
  1432           end-if
  1433           if nu-user-select2 = +0
  1434              move tr-user-select2 to a1-user-select2(a1)
  1435           end-if
  1436           if nu-user-select5 = +0
  1437              move tr-user-select5 to a1-user-select5(a1)
  1438           end-if
  1439           if nu-carrier = +0
  1440              move tr-carrier      to a1-carrier(a1)
  1441           end-if
  1442           if nu-state = +0
  1443              move tr-state        to a1-state(a1)
  1444           end-if
  1445           if nu-account = +0
  1446              move tr-account      to a1-account(a1)
  1447           end-if
  1448           if nu-status = +0
  1449              move tr-status       to a1-status(a1)
  1450           end-if
  1451        else
  1452           if sqlcode not = 0 and 100
  1453              display "Error: cannot fetch row " a1
  1454              display ' sql return code ' sqlcode
  1455              display ' sql err mess    ' sqlerrmc
  1456              move '9999'        to ws-return-error-no
  1457              move 'Could not fetch rows'
  1458                                 to ws-return-error-mess
  1459              PERFORM 0200-SEND-BUFFER thru 0200-exit
  1460              go to 0300-close-socket
  1461           end-if
  1462        end-if
  1463     end-perform
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  27
* SOCK11.cbl
  1464     EXEC SQL
  1465         close getSpecInstr
  1466     END-EXEC
  1467     if sqlcode not = 0
  1468        display "Error: cannot close cursor "
  1469        display ' sql retrun code ' sqlcode
  1470        display ' sql err mess    ' sqlerrmc
  1471     end-if
  1472     move a1                     to ma1
  1473     if connected-to-db
  1474        EXEC SQL
  1475            disconnect all
  1476        END-EXEC
  1477        move ' '                 to ws-connect-sw
  1478     end-if
  1479*    perform varying a1 from +1 by +1 until a1 > ma1
  1480*       display ' rpt cd1 ' a1-report-code1(a1)
  1481*       display ' rpt cd2 ' a1-report-code2(a1)
  1482*       display ' rpt cd3 ' a1-report-code3(a1)
  1483*       display '     us2 ' a1-user-select2(a1)
  1484*       display '     us5 ' a1-user-select5(a1)
  1485*       display '   carr  ' a1-carrier(a1)
  1486*       display '  state  ' a1-state(a1)
  1487*       display ' account ' a1-account(a1)
  1488*       display ' status  ' a1-status(a1)
  1489*    end-perform
  1490     .
  1491 0030-exit.
  1492     exit.
  1493 0040-process-eracct.
  1494     move X'04'                  to ws-am-key
  1495
  1496* exec cics startbr
  1497*       dataset       ('ERACCT')
  1498*       ridfld        (ws-am-key)
  1499*       resp          (ws-response)
  1500*       gteq
  1501*    end-exec
  1502     MOVE 'ERACCT' TO DFHEIV1
  1503     MOVE 0
  1504       TO DFHEIV11
  1505*    MOVE '&,         G          &  N#00001406' TO DFHEIV0
  1506     MOVE X'262C20202020202020202047' TO DFHEIV0(1:12)
  1507     MOVE X'202020202020202020202620' TO DFHEIV0(13:12)
  1508     MOVE X'204E233030303031343036' TO DFHEIV0(25:11)
  1509     CALL 'kxdfhei1' USING DFHEIV0,
  1510           DFHEIV1,
  1511           ws-am-key,
  1512           DFHEIV99,
  1513           DFHEIV11,
  1514           DFHEIV99
  1515     MOVE EIBRESP  TO ws-response
  1516     GO TO 9999-DFHEXIT DEPENDING ON DFHEIGDK
  1517     if not resp-normal
  1518        display 'error-eracct-startbr ' ws-response
  1519        go to 0040-exit
  1520     end-if
  1521
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  28
* SOCK11.cbl
  1522* exec cics readnext
  1523*       dataset       ('ERACCT')
  1524*       ridfld        (ws-am-key)
  1525*       into          (account-master)
  1526*       resp          (ws-response)
  1527*    end-exec
  1528     MOVE LENGTH OF
  1529      account-master
  1530       TO DFHEIV12
  1531     MOVE 'ERACCT' TO DFHEIV1
  1532     MOVE 0
  1533       TO DFHEIV11
  1534*    MOVE '&.IL                  )  N#00001416' TO DFHEIV0
  1535     MOVE X'262E494C2020202020202020' TO DFHEIV0(1:12)
  1536     MOVE X'202020202020202020202920' TO DFHEIV0(13:12)
  1537     MOVE X'204E233030303031343136' TO DFHEIV0(25:11)
  1538     CALL 'kxdfhei1' USING DFHEIV0,
  1539           DFHEIV1,
  1540           account-master,
  1541           DFHEIV12,
  1542           ws-am-key,
  1543           DFHEIV99,
  1544           DFHEIV11,
  1545           DFHEIV99,
  1546           DFHEIV99
  1547     MOVE EIBRESP  TO ws-response
  1548     GO TO 9999-DFHEXIT DEPENDING ON DFHEIGDK
  1549     if resp-normal
  1550        move am-control-primary(1:20)
  1551                                 to ws-save-eracct-key
  1552        perform until end-of-eracct
  1553           perform 0050-check-table
  1554                                 thru 0050-exit
  1555*          display ' key b4 readnext ' ws-am-key (2:19)
  1556
  1557* exec cics readnext
  1558*             dataset    ('ERACCT')
  1559*             ridfld     (ws-am-key)
  1560*             into       (account-master)
  1561*             resp       (ws-response)
  1562*          end-exec
  1563     MOVE LENGTH OF
  1564      account-master
  1565       TO DFHEIV12
  1566     MOVE 'ERACCT' TO DFHEIV1
  1567     MOVE 0
  1568       TO DFHEIV11
  1569*    MOVE '&.IL                  )  N#00001429' TO DFHEIV0
  1570     MOVE X'262E494C2020202020202020' TO DFHEIV0(1:12)
  1571     MOVE X'202020202020202020202920' TO DFHEIV0(13:12)
  1572     MOVE X'204E233030303031343239' TO DFHEIV0(25:11)
  1573     CALL 'kxdfhei1' USING DFHEIV0,
  1574           DFHEIV1,
  1575           account-master,
  1576           DFHEIV12,
  1577           ws-am-key,
  1578           DFHEIV99,
  1579           DFHEIV11,
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  29
* SOCK11.cbl
  1580           DFHEIV99,
  1581           DFHEIV99
  1582     MOVE EIBRESP  TO ws-response
  1583     GO TO 9999-DFHEXIT DEPENDING ON DFHEIGDK
  1584           if (not resp-normal)
  1585              or (am-company-cd not = X'04')
  1586              set end-of-eracct to true
  1587           else
  1588              add 1 to ws-acct-reads
  1589           end-if
  1590*          if ws-acct-reads > +400
  1591*             set end-of-eracct to true
  1592*          end-if
  1593        end-perform
  1594        perform 0050-check-table thru 0050-exit
  1595     end-if
  1596     .
  1597 0040-exit.
  1598     exit.
  1599 0050-check-table.
  1600     if am-control-primary(1:20) = ws-save-eracct-key
  1601        move am-report-code-1    to ws-save-report-code-1
  1602        move am-report-code-2    to ws-save-report-code-2
  1603        move am-report-code-3    to ws-save-report-code-3
  1604        move am-user-select-2    to ws-save-user-select-2
  1605        move am-user-select-5    to ws-save-user-select-5
  1606        go to 0050-exit
  1607     end-if
  1608     move ' '                    to ws-match-sw
  1609     perform varying a1 from +1 by +1 until
  1610        (a1 > ma1)
  1611        or (found-match)
  1612**      display ' array values ' sql-table-array(a1) ' ' a1
  1613        if ((a1-report-code1(a1) = spaces)
  1614           or (a1-report-code1(a1) = ws-save-report-code-1))
  1615                      and
  1616           ((a1-report-code2(a1) = spaces)
  1617           or (a1-report-code2(a1) = ws-save-report-code-2))
  1618                      and
  1619           ((a1-report-code3(a1) = spaces)
  1620           or (a1-report-code3(a1) = ws-save-report-code-3))
  1621                      and
  1622           ((a1-user-select2(a1) = spaces)
  1623           or (a1-user-select2(a1) = ws-save-user-select-2))
  1624                      and
  1625           ((a1-user-select5(a1) = spaces)
  1626           or (a1-user-select5(a1) = ws-save-user-select-5))
  1627                      and
  1628           ((a1-carrier(a1) = spaces)
  1629           or (a1-carrier(a1) = ws-save-carrier))
  1630                      and
  1631           ((a1-state(a1) = spaces)
  1632           or (a1-state(a1) = ws-save-state))
  1633                      and
  1634           ((a1-account(a1) = spaces)
  1635           or (a1-account(a1) = ws-save-account))
  1636           perform 0060-update-eracnt
  1637                                 thru 0060-exit
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  30
* SOCK11.cbl
  1638           set found-match to true
  1639*          move high-values      to ws-am-exp-dt
  1640        end-if
  1641     end-perform
  1642     if not found-match  *> may have been a delete
  1643        move ws-save-eracct-key  to ws-nt-key
  1644        move '2'                 to ws-nt-rec-type
  1645        move +3                  to ws-nt-seq-no
  1646        perform 0064-read-eracnt-update
  1647                                 thru 0064-exit
  1648        if resp-normal  *>  found a note
  1649           if nt-account-special <> 'Y'
  1650              perform 0061-unlock-eracnt
  1651                                 thru 0061-exit
  1652           else  *> need to remove setting
  1653              move ' '           to nt-account-special
  1654              perform 0063-rewrite-eracnt
  1655                                 thru 0063-exit
  1656              if not resp-normal
  1657                 display 'error-rewrite-eracnt-D ' ws-response
  1658                    ' ' am-account
  1659              else
  1660                 add 1 to ws-acnt-deletes
  1661*                   am-account
  1662              end-if
  1663           end-if
  1664        end-if
  1665     end-if
  1666     move am-control-primary(1:20)
  1667                                 to ws-save-eracct-key
  1668     move am-report-code-1       to ws-save-report-code-1
  1669     move am-report-code-2       to ws-save-report-code-2
  1670     move am-report-code-3       to ws-save-report-code-3
  1671     move am-user-select-2       to ws-save-user-select-2
  1672     move am-user-select-5       to ws-save-user-select-5
  1673*    move ' '                    to ws-match-sw
  1674*
  1675*    perform varying a1 from +1 by +1 until
  1676*       (a1 > ma1)
  1677*       or (found-match)
  1678**      display ' array values ' sql-table-array(a1) ' ' a1
  1679*
  1680*       if ((a1-report-code1(a1) = spaces)
  1681*          or (a1-report-code1(a1) = am-report-code-1))
  1682*                     and
  1683*          ((a1-report-code2(a1) = spaces)
  1684*          or (a1-report-code2(a1) = am-report-code-2))
  1685*                     and
  1686*          ((a1-report-code3(a1) = spaces)
  1687*          or (a1-report-code3(a1) = am-report-code-3))
  1688*                     and
  1689*          ((a1-user-select2(a1) = spaces)
  1690*          or (a1-user-select2(a1) = am-user-select-2))
  1691*                     and
  1692*          ((a1-user-select5(a1) = spaces)
  1693*          or (a1-user-select5(a1) = am-user-select-5))
  1694*                     and
  1695*          ((a1-carrier(a1) = spaces)
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  31
* SOCK11.cbl
  1696*          or (a1-carrier(a1) = am-carrier))
  1697*                     and
  1698*          ((a1-state(a1) = spaces)
  1699*          or (a1-state(a1) = am-state))
  1700*                     and
  1701*          ((a1-account(a1) = spaces)
  1702*          or (a1-account(a1) = am-account))
  1703*          perform 0060-update-eracnt
  1704*                                thru 0060-exit
  1705*          set found-match to true
  1706*          move high-values      to ws-am-exp-dt
  1707*       end-if
  1708*    end-perform
  1709*
  1710*    if not found-match  *> may have been a delete
  1711*       move ws-am-key(1:20)     to ws-nt-key
  1712*       move '2'                 to ws-nt-rec-type
  1713*       move +3                  to ws-nt-seq-no
  1714*       perform 0064-read-eracnt-update
  1715*                                thru 0064-exit
  1716*       if resp-normal  *>  found a note
  1717*          if nt-account-special <> 'Y'
  1718*             perform 0061-unlock-eracnt
  1719*                                thru 0061-exit
  1720*          else  *> need to remove setting
  1721*             move ' '           to nt-account-special
  1722*             perform 0063-rewrite-eracnt
  1723*                                thru 0063-exit
  1724*             if not resp-normal
  1725*                display 'error-rewrite-eracnt-D ' ws-response
  1726*                   ' ' am-account
  1727*             else
  1728*                add 1 to ws-acnt-deletes
  1729*                   am-account
  1730*             end-if
  1731*          end-if
  1732*       end-if
  1733*    end-if
  1734     .
  1735 0050-exit.
  1736     exit.
  1737 0060-update-eracnt.
  1738     if sql-table-array(a1) = spaces
  1739        display ' bypass 0060, all spaces '
  1740        go to 0060-exit
  1741     end-if
  1742*       ws-save-account
  1743*    move ws-am-key(1:20)        to ws-nt-key
  1744     move ws-save-eracct-key     to ws-nt-key
  1745     move '2'                    to ws-nt-rec-type
  1746     move +3                     to ws-nt-seq-no
  1747     perform 0064-read-eracnt-update
  1748                                 thru 0064-exit
  1749     if resp-normal     *>  Found a note
  1750*       display ' found note ' ws-save-state ' ' ws-save-account
  1751        add 1 to ws-acnt-reads
  1752        if a1-status(a1) = 'A'  *> special instr active
  1753           if nt-account-special = 'Y' *> note already set to Y
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  32
* SOCK11.cbl
  1754                                       *> so go on about ur bus
  1755              perform 0061-unlock-eracnt
  1756                                 thru 0061-exit
  1757           else  *> note not active so set it to active
  1758              move 'Y'           to nt-account-special
  1759              perform 0063-rewrite-eracnt
  1760                                 thru 0063-exit
  1761              if not resp-normal
  1762                 display 'error-rewrite-eracnt-A ' ws-response
  1763                    ' ' ws-save-account
  1764              else
  1765                 add 1 to ws-acnt-updates
  1766*                   ws-save-account ' ' sql-table-array(a1)
  1767              end-if
  1768           end-if
  1769        else  *> special instr inactive
  1770           if nt-account-special <> 'Y' *> note inactive
  1771                                        *> so go on about ur bus
  1772              perform 0061-unlock-eracnt
  1773                                 thru 0061-exit
  1774           else *> note active so set it to inactive
  1775              move ' '           to nt-account-special
  1776              perform 0063-rewrite-eracnt
  1777                                 thru 0063-exit
  1778              if not resp-normal
  1779                 display 'error-rewrite-eracnt-I ' ws-response
  1780                    ' ' ws-save-account
  1781              else
  1782                 add 1 to ws-acnt-updates
  1783*                   ws-save-account ' ' sql-table-array(a1)
  1784              end-if
  1785           end-if
  1786        end-if
  1787     else
  1788        if resp-notfnd  *> no note record
  1789           if a1-status(a1) = 'A'  *> spec instr is active
  1790              move 'NT'             to note-file
  1791              move ws-save-eracct-key
  1792                                 to nt-control-primary
  1793              move '2'           to nt-record-type
  1794              move +3            to nt-line-sequence
  1795              move 'Y'           to nt-account-special
  1796              perform 0062-write-eracnt
  1797                                 thru 0062-exit
  1798              if not resp-normal
  1799                 display 'error-write-eracnt ' ws-response
  1800              else
  1801                 add 1 to ws-acnt-updates
  1802*                   ws-save-account ' ' sql-table-array(a1)
  1803              end-if
  1804           end-if
  1805        end-if
  1806     end-if
  1807     .
  1808 0060-exit.
  1809     exit.
  1810 0061-unlock-eracnt.
  1811
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  33
* SOCK11.cbl
  1812* exec cics unlock
  1813*       dataset   ('ERACNT')
  1814*    end-exec
  1815     MOVE 'ERACNT' TO DFHEIV1
  1816*    MOVE '&*                    #   #00001668' TO DFHEIV0
  1817     MOVE X'262A20202020202020202020' TO DFHEIV0(1:12)
  1818     MOVE X'202020202020202020202320' TO DFHEIV0(13:12)
  1819     MOVE X'2020233030303031363638' TO DFHEIV0(25:11)
  1820     CALL 'kxdfhei1' USING DFHEIV0,
  1821           DFHEIV1,
  1822           DFHEIV99
  1823     GO TO 9999-DFHEXIT DEPENDING ON DFHEIGDK
  1824     .
  1825 0061-exit.
  1826     exit.
  1827 0062-write-eracnt.
  1828
  1829* exec cics write
  1830*       dataset ('ERACNT')
  1831*       from    (note-file)
  1832*       ridfld  (nt-control-primary)
  1833*       resp    (ws-response)
  1834*    end-exec
  1835     MOVE LENGTH OF
  1836      note-file
  1837       TO DFHEIV11
  1838     MOVE 'ERACNT' TO DFHEIV1
  1839*    MOVE '&$ L                  ''  N#00001675' TO DFHEIV0
  1840     MOVE X'2624204C2020202020202020' TO DFHEIV0(1:12)
  1841     MOVE X'202020202020202020202720' TO DFHEIV0(13:12)
  1842     MOVE X'204E233030303031363735' TO DFHEIV0(25:11)
  1843     CALL 'kxdfhei1' USING DFHEIV0,
  1844           DFHEIV1,
  1845           note-file,
  1846           DFHEIV11,
  1847           nt-control-primary,
  1848           DFHEIV99,
  1849           DFHEIV99
  1850     MOVE EIBRESP  TO ws-response
  1851     GO TO 9999-DFHEXIT DEPENDING ON DFHEIGDK
  1852     .
  1853 0062-exit.
  1854     exit.
  1855 0063-rewrite-eracnt.
  1856
  1857* exec cics rewrite
  1858*       dataset    ('ERACNT')
  1859*       from       (note-file)
  1860*       resp       (ws-response)
  1861*    end-exec
  1862     MOVE LENGTH OF
  1863      note-file
  1864       TO DFHEIV11
  1865     MOVE 'ERACNT' TO DFHEIV1
  1866*    MOVE '&& L                  %  N#00001685' TO DFHEIV0
  1867     MOVE X'2626204C2020202020202020' TO DFHEIV0(1:12)
  1868     MOVE X'202020202020202020202520' TO DFHEIV0(13:12)
  1869     MOVE X'204E233030303031363835' TO DFHEIV0(25:11)
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  34
* SOCK11.cbl
  1870     CALL 'kxdfhei1' USING DFHEIV0,
  1871           DFHEIV1,
  1872           note-file,
  1873           DFHEIV11,
  1874           DFHEIV99
  1875     MOVE EIBRESP  TO ws-response
  1876     GO TO 9999-DFHEXIT DEPENDING ON DFHEIGDK
  1877     .
  1878 0063-exit.
  1879     exit.
  1880 0064-read-eracnt-update.
  1881
  1882* exec cics read
  1883*       update
  1884*       dataset  ('ERACNT')
  1885*       RIDFLD   (WS-NT-KEY)
  1886*       into     (note-file)
  1887*       resp     (ws-response)
  1888*    end-exec
  1889     MOVE LENGTH OF
  1890      note-file
  1891       TO DFHEIV11
  1892     MOVE 'ERACNT' TO DFHEIV1
  1893*    MOVE '&"IL       EU         (  N#00001694' TO DFHEIV0
  1894     MOVE X'2622494C2020202020202045' TO DFHEIV0(1:12)
  1895     MOVE X'552020202020202020202820' TO DFHEIV0(13:12)
  1896     MOVE X'204E233030303031363934' TO DFHEIV0(25:11)
  1897     CALL 'kxdfhei1' USING DFHEIV0,
  1898           DFHEIV1,
  1899           note-file,
  1900           DFHEIV11,
  1901           WS-NT-KEY,
  1902           DFHEIV99,
  1903           DFHEIV99,
  1904           DFHEIV99
  1905     MOVE EIBRESP  TO ws-response
  1906     GO TO 9999-DFHEXIT DEPENDING ON DFHEIGDK
  1907     .
  1908 0064-exit.
  1909     exit.
  1910 0070-format-buffer.
  1911     move '0000'                 to ws-return-error-no
  1912     move 'Logic Updated completed successful '
  1913                                 to ws-return-error-mess
  1914     move ws-acct-reads          to ws-return-accts-read
  1915     move ws-acnt-reads          to ws-return-acnts-read
  1916     move ws-acnt-updates        to ws-return-acnts-updated
  1917     move ws-acnt-deletes        to ws-return-acnts-deletes
  1918     .
  1919 0070-exit.
  1920     exit.
  1921 0200-send-buffer.
  1922     if batch-job
  1923        go to 0200-exit
  1924     end-if
  1925     move ws-return-string       to ws-send-buf
  1926     display 'sock11:About to send      ' ws-send-buf
  1927     display 'sock11:sequence number  =', ws-seq-num.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  35
* SOCK11.cbl
  1928     display ' msg size ' ws-send-msg-size
  1929     call "send" using by value GIVE-TAKE-SOCKET,
  1930         by reference ws-send-buf,
  1931         by value ws-send-msg-size,
  1932         by value ws-flags.
  1933     if return-code <= zero
  1934        display 'sock11:send error ',
  1935        perform 0250-socket-error thru 0250-exit
  1936        go to 0300-close-socket
  1937     end-if
  1938     .
  1939 0200-exit.
  1940     exit.
  1941 0250-socket-error.
  1942     display "sock11:did not complete"
  1943     display 'sock11:transaction data =', CLIENT-IN-DATA '**'
  1944     display 'sock11:socket number    =', GIVE-TAKE-SOCKET.
  1945     display 'sock11:socket name      =', lstn-name ' '
  1946        lstn-subname
  1947     display ' return code = ' return-code
  1948     .
  1949 0250-exit.
  1950     exit.
  1951 0300-close-socket.
  1952*    call "close" using by value GIVE-TAKE-SOCKET .
  1953     display 'sock11:done'
  1954
  1955* exec cics return end-exec.
  1956*    MOVE '.(                    ''   #00001748' TO DFHEIV0
  1957     MOVE X'2E2820202020202020202020' TO DFHEIV0(1:12)
  1958     MOVE X'202020202020202020202720' TO DFHEIV0(13:12)
  1959     MOVE X'2020233030303031373438' TO DFHEIV0(25:11)
  1960     CALL 'kxdfhei1' USING DFHEIV0,
  1961           DFHEIV99,
  1962           DFHEIV99,
  1963           DFHEIV99,
  1964           DFHEIV99,
  1965           DFHEIV99,
  1966           DFHEIV99
  1967     GO TO 9999-DFHEXIT DEPENDING ON DFHEIGDK.
  1968
  1969
  1970* goback.
  1971     MOVE '9%                    "   ' TO DFHEIV0
  1972     MOVE 'SOCK11' TO DFHEIV1
  1973     CALL 'kxdfhei1' USING DFHEIV0 DFHEIV1
  1974     goback.
  1975     .
  1976 0300-exit.
  1977     exit.
  1978 6000-CONNECT-TO-DB.
  1979***-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_***
  1980***                                                            ***
  1981***                                                            ***
  1982***_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-***
  1983     MOVE 'NTSQLTST2_PEMA'       TO SVR
  1984     move 'sa'                   to usr
  1985     move 'sql2008r2'            to pass
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  36
* SOCK11.cbl
  1986     if ws-kix-myenv = 'cid1p'
  1987        MOVE 'NTCSO2_Logic'      TO SVR
  1988        move 'sa'                to usr
  1989        move 'ntcso2'            to pass
  1990     end-if
  1991     string
  1992         usr delimited space
  1993         "." delimited size
  1994         pass delimited space into usr-pass
  1995     end-string
  1996*    display ' About to connect to ' svr ' ' usr-pass
  1997     EXEC SQL
  1998        CONNECT TO :svr USER :usr-pass
  1999     END-EXEC
  2000     if sqlcode not = 0
  2001        display "Error: cannot connect to " svr
  2002        display sqlcode
  2003        display sqlerrmc
  2004     else
  2005*       display ' Successful Connect ' sqlcode
  2006        set connected-to-db to true
  2007     end-if
  2008     .
  2009 6000-EXIT.
  2010     EXIT.
  2011 9700-DATE-LINK.
  2012
  2013* EXEC CICS LINK
  2014*         PROGRAM  ('ELDATCV')
  2015*         COMMAREA (DATE-CONVERSION-DATA)
  2016*         LENGTH   (DC-COMM-LENGTH)
  2017*    END-EXEC.
  2018     MOVE 'ELDATCV' TO DFHEIV1
  2019*    MOVE '."C                   (   #00001787' TO DFHEIV0
  2020     MOVE X'2E2243202020202020202020' TO DFHEIV0(1:12)
  2021     MOVE X'202020202020202020202820' TO DFHEIV0(13:12)
  2022     MOVE X'2020233030303031373837' TO DFHEIV0(25:11)
  2023     CALL 'kxdfhei1' USING DFHEIV0,
  2024           DFHEIV1,
  2025           DATE-CONVERSION-DATA,
  2026           DC-COMM-LENGTH,
  2027           DFHEIV99,
  2028           DFHEIV99,
  2029           DFHEIV99,
  2030           DFHEIV99
  2031     GO TO 9999-DFHEXIT DEPENDING ON DFHEIGDK.
  2032
  2033 9700-EXIT.
  2034      EXIT.
  2035
  2036 9999-DFHBACK SECTION.
  2037     MOVE '9%                    "   ' TO DFHEIV0
  2038     MOVE 'SOCK11' TO DFHEIV1
  2039     CALL 'kxdfhei1' USING DFHEIV0 DFHEIV1
  2040     GOBACK.
  2041 9999-DFHEXIT.
  2042     IF DFHEIGDJ EQUAL 0001
  2043         NEXT SENTENCE.
* Micro Focus Server Express         V5.1 revision 000 22-Aug-18 13:17 Page  37
* SOCK11.cbl
  2044     MOVE '9%                    "   ' TO DFHEIV0
  2045     MOVE 'SOCK11' TO DFHEIV1
  2046     CALL 'kxdfhei1' USING DFHEIV0 DFHEIV1
  2047     GOBACK.
* Micro Focus Server Express         V5.1 revision 000 Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
*                                                        REF GNR-008065005AF
* Total Messages:     0
* Data:      330440     Code:        8535
