* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:19 Page   1
* FNB196.cbl
* Options: int("FNB196.int") anim csi verbose NOBOUND PARAMCOUNTCHECK
*          directives(cobopt.bth) endp list("FNB196.lst")
* Setting: NOACCEPTREFRESH NOADV ALIGN"8" ALPHASTART"1" NOALTER NOAMODE ANIM
*          NOANIMPREP ANS85 APOST NOAREACHECK ARITHMETIC"OSVS" ASSIGN
*          "EXTERNAL" NOASSIGN-PRINTER NOAUTOLOCK NOBELL NOBOUND NOBRIEF
*          NOBS2000 BWZSTAR NOBYTEMODEMOVE CALLFH"ebmlsfile" NOCALLMCS
*          NOCALLRECOVERY CALLSORT"EXTSM" CANCEL CANCELLBR NOCHANGEMESSAGE
*          CHARSET"ASCII" NOCHECKDIV NOCHECKREFMOD NOCICS CICS-CPY
*          NOCICSOPTIMIZE NOCMPR2 NOCOBFSTATCONV NOCOBIDY NOCOBOL370 COBOLDIR
*          NOCOMP COMP-5"2" COMP-6"2" NOCOMS85 CONFIRM NOCONVERTRET CONVSPACE
*          COPYEXT",cbl,cpy" NOCOPYLBR COPYLIST COPYLISTCOMMENT"1" CSI
*          CURRENCY-SIGN"36" CURRENT-DATE"MMDDYY" NODATA DATACOMPRESS"0"
*          NODATA-CONTEXT DATE DBCHECK DBCS"2" NODBCSSOSI DBSPACE DE-EDIT"2"
*          DEFAULTBYTE"32" NODEFAULTCALLS DETECTLOCK NODG DIALECT"MF"
*          NODIRECTIVES-IN-COMMENTS NODOSVS NODPCINSUBSCRIPT DYNAM
*          NOEARLY-RELEASE ECHO NOECHOALL NOEDITOR ENSUITE"0" NOENTCOBOL
*          ERRFORMAT"1" ERRLIST"EMBED" NOERRQ FASTSORT NOFCD3 NOFCDREG
*          NOFDCLEAR NOFILESHARE FILETYPE"0" NOFLAG NOFLAGAS NOFLAGCD
*          NOFLAGEUC NOFLAGMIG NOFLAGQ FLAGSINEDIT NOFLAGSTD NOFOLDCALLNAME
*          NOFOLDCOPYNAME FORM"60" NOFP-ROUNDING NOHOSTARITHMETIC
*          NOHOSTCONTZERO NOHOST-NUMCOMPARE NOHOST-NUMMOVE NOHOSTFD NOHOSTRW
*          NOIBM-MS IBMCOMP IDXFORMAT"0" NOILGEN IMPLICITSCOPE NOINDD
*          INFORETURN"0" NOINITCALL INITPTR INT"FNB196.int" INTDATE"ANSI"
*          INTLEVEL"2" IOCONV NOISO2002 NOIXNLSKEY NOIXNUMKEY KEEP-INT
*          KEYCHECK KEYCOMPRESS"0" LIBRARIAN"2" NOLINE-COUNT LIST"FNB196.lst"
*          LISTPATH"" LISTWIDTH"80" LITVAL-SIZE"4" LOCKTYPE"0" NOMAPNAME
*          NOMAXERROR METHODDEFAULT"REFERENCE" MF"15" MFCOMMENT NOMOVELENCHECK
*          NOMS NOMVS NATIVE"ASCII" NONATIVEFLOATINGPOINT NONCHAR
*          NONEWBASENAME NONLS NSYMBOL"DBCS" NOODOOSVS NOODOSLIDE
*          NOOLDBLANKLINE NOOLDCOPY NOOLDINDEX NOOLDNEXTSENTENCE NOOLDREADINTO
*          NOOLDSTRMIX OOCTRL"-C-E-G-P+Q+R-S+W" OPTIONAL-FILE NOOS390 OSEXT""
*          NOOSVS NOOUTDD NOP64 NOPANVALET PERFORM-TYPE"OSVS" NOPREPLIST
*          NOPREPROCESS NOPRINT-EXT NOPROFILE NOPROGID-COMMENT
*          NOPROGID-INT-NAME NOPROTECT-LINKAGE PROTOTYPE"RELAXED" QUAL
*          QUALPROC NOQUERY NOQUOTE NORAWLIST NORDW RECMODE"F" NOREENTRANT
*          NOREF NOREFNO REMAINDER"1" REPORT-LINE"256" RESEQ NORETRYLOCK
*          REWRITE-LS NORM RTNCODE-SIZE"4" NORWHARDPAGE NOSAA SEG NOSEQCHK
*          SEQUENTIAL"RECORD" NOSERIAL SETTING"LINE" NOSHAREOUTDD NOSHOW-DIR
*          SIGN"ASCII" NOSIGNDISCARD NOSIGNFIXUP SORTTYPE"DFSORT" SOURCEFORMAT
*          "FIXED" SOURCETABSTOP"8" NOSPZERO NOSSRANGE STDERR NOSTICKY-LINKAGE
*          NOSTICKY-PERFORM SUPFF SWITCHTYPE"1" SYMBSTART"1" SYSPUNCH"132"
*          TERMPAGE TIME NOTRACE NOTRUNC NOTRUNCCALLNAME NOTRUNCCOPY TRUNCINC
*          "10" UNICODE"NATIVE" VERBOSE VSC2"2" WARNING"1" NOWB NOWB2 NOWB3
*          WEBSERVER"CGI" NOWRITELOCK NOWRITETHRU NOXOPEN NOXREF
*          NOZEROLENGTHFALSE NOZEROSEQ NOZWB
     1 IDENTIFICATION DIVISION.
     2 PROGRAM-ID.    FNB196.
     3
     4*:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
     5*                                                                        :
     6*  DESCRIPTION:                                                          :
     7*    CONVERT PAYROLL TAPE RECEIVED FROM ADP INTO GENERAL JOURNAL         :
     8*    TRANSACTIONS TO BE DOWNLOADED TO THE FREEDOM GENERAL LEDGER         :
     9*    SYSTEM.                                                             :
    10*:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
    11*    DATE    BY  MODIFICATION                                            :
    12* ========== === ========================================================:
    13* 02/03/2003 DJN CR2003020300003 CONVERT FROM MAINFRAME.                 :
* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:19 Page   2
* FNB196.cbl
    14* 08/16/2006 AJR CR2006081600000 REMOVE FROM CLAIMS SYSTEM               :
    15*:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
    16
    17 ENVIRONMENT DIVISION.
    18 INPUT-OUTPUT SECTION.
    19 FILE-CONTROL.
    20
    21     SELECT ADP-PAYROLL  ASSIGN TO EXTERNAL SYS010
    22                         ORGANIZATION IS LINE SEQUENTIAL
    23                         FILE STATUS IS SYS010-STATUS.
    24
    25     SELECT LEDGER-TRANS ASSIGN TO EXTERNAL SYS011
    26                         ORGANIZATION IS LINE SEQUENTIAL.
    27
    28 DATA DIVISION.
    29 FILE SECTION.
    30
    31 FD  ADP-PAYROLL
    32     LABEL RECORDS ARE STANDARD
    33     RECORDING MODE IS F
    34     RECORD CONTAINS 100 CHARACTERS
    35     BLOCK CONTAINS 0 RECORDS.
    36 01  ADP-RECORD             PIC X(200).
    37
    38 FD  LEDGER-TRANS
    39     LABEL RECORDS ARE STANDARD
    40     RECORDING MODE IS F
    41     RECORD CONTAINS 151 CHARACTERS
    42     BLOCK CONTAINS 0 RECORDS.
    43 01  LEDGER-RECORD.
*   44     COPY FNC019.
    45*****************************************************************
    46*                                                               *
    47*      FREEDOM GENERAL LEDGER JOURNAL TRANSACTION - CSO         *
    48*                                                               *
    49************************************************V5.50 12/21/98***
    50*
    51     05  GL-ACCOUNT-NO.
    52         10  GL-MAJ-ACCT       PIC X(10).
    53         10  GL-DIV            PIC X(2).
    54         10  GL-CENTER         PIC X(4).
    55         10  GL-PRODUCT        PIC X(6).
    56         10  GL-STATE          PIC X(2).
    57     05  GL-JOURNAL-DATE       PIC X(8).
    58     05  GL-POSTING-DATE       PIC X(8).
    59     05  GL-AMOUNT             PIC S9(10)V99
    60                               SIGN TRAILING SEPARATE.
    61     05  GL-REFERENCE          PIC X(10).
    62     05  GL-DESCRIPTION        PIC X(30).
    63     05  GL-SOURCE             PIC X(6).
    64     05  GL-SUNDRY             PIC X(30).
    65     05  GL-REVERSE-FLAG       PIC X.
    66     05  GL-SUSPENSE           PIC X(15).
    67     05  GL-ALLOC-CODE         PIC X(6).
    68
    69
    70 WORKING-STORAGE SECTION.
    71
* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:19 Page   3
* FNB196.cbl
    72 01 RC                       PIC S9(9)   COMP-5 VALUE 0.
    73 01 LIST-REC                 PIC X(132).
    74
    75 01  FILLER                  COMP-3.
    76     05  WS-DR-AMT           PIC S9(9)V99   VALUE +0.
    77     05  WS-CR-AMT           PIC S9(9)V99   VALUE +0.
    78     05  WS-IN-COUNT         PIC S9(7)      VALUE +0.
    79     05  WS-COUNT            PIC S9(7)      VALUE +0.
    80
    81 01  FILLER.
    82     05  SYS010-STATUS       PIC XX     VALUE '00'.
    83         88  EOF                        VALUE '10'.
    84     05  ED-AMT              PIC ZZZ,ZZZ,ZZZ.99-.
    85     05  ED-CNT              PIC ZZ,ZZ9-.
    86     05  WS-POSTING-DATE.
    87         10  WS-POST-MO      PIC XX.
    88         10  WS-POST-DAY     PIC XX.
    89         10  WS-POST-YYY     PIC XXX.
    90         10  WS-POST-YR      PIC X.
    91     05  SYSTEM-DATE         PIC 9(8).
    92     05  WS-CENTER.
    93         10  FILLER          PIC X(5).
    94         10  WS-CENTER-6     PIC X.
    95
    96 01  WORK-ADP-RECORD.
    97     05  ADP-FIRST-FIELD.
    98         10  FILLER         PIC X.
    99         10  ADP-CO-CODE    PIC X(5).
   100     05  ADP-ACCOUNT-NO.
   101         10  ADP-ACCT-TYPE  PIC X.
   102         10  FILLER         PIC X(9).
   103         10  ADP-CENTER     PIC X(6).
   104     05  ADP-PR-CODE        PIC X(2).
   105     05  ADP-PAY-DATE.
   106         10  ADP-PAY-MO     PIC XX.
   107         10  ADP-PAY-DAY    PIC XX.
   108         10  ADP-PAY-YR     PIC X.
   109     05  ADP-AMOUNTX        PIC X(15).
   110     05  ADP-AMOUNT         PIC S9(9)V99.
   111     05  ADP-REFERENCE-1    PIC X(6).
   112     05  ADP-DESCR          PIC X(45).
   113     05  ADP-REFERENCE-2    PIC X(6).
   114     05  ADP-REFERENCE-3    PIC X(6).
   115
   116 01  WORK-DATE.
   117     05  WRK-YR    PIC 9999.
   118     05  WRK-MO    PIC 99.
   119     05  WRK-DAY   PIC 99.
   120
   121 01  SYS-DATE.
   122     05  SYS-MO    PIC 99.
   123     05  SYS-DAY   PIC 99.
   124     05  SYS-YR    PIC 9999.
   125
   126 PROCEDURE DIVISION.
   127
   128     CALL 'FNBLIST' USING 'O' LIST-REC
   129     OPEN INPUT ADP-PAYROLL
* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:19 Page   4
* FNB196.cbl
   130     IF SYS010-STATUS NOT = '00'
   131       DISPLAY '*** OPEN ERROR ' SYS010-STATUS ' ON SYS010'
   132               UPON SYSERR
   133       MOVE SPACES TO LIST-REC
   134       STRING  '*** OPEN ERROR ' SYS010-STATUS ' ON SYS010'
   135         DELIMITED BY SIZE INTO LIST-REC
   136       CALL 'FNBLIST' USING 'W' LIST-REC
   137       CALL 'FNBLIST' USING 'C' LIST-REC
   138       MOVE 16 TO RC
   139*      GOBACK GIVING RC
   140       STOP RUN GIVING RC
   141     END-IF
   142
   143     OPEN OUTPUT LEDGER-TRANS
   144
   145     ACCEPT WORK-DATE FROM DATE YYYYMMDD
   146     MOVE WRK-YR  TO SYS-YR
   147     MOVE WRK-MO  TO SYS-MO
   148     MOVE WRK-DAY TO SYS-DAY
   149
   150     MOVE SYS-DATE TO SYSTEM-DATE
   151*    CALL 'SYSDATE' USING SYSTEM-DATE
   152
   153     PERFORM UNTIL EXIT
   154       READ ADP-PAYROLL
   155         AT END
   156           EXIT PERFORM
   157       END-READ
   158       PERFORM 1000-PROCESS-PAYROLL
   159     END-PERFORM
   160
   161     CLOSE ADP-PAYROLL
   162           LEDGER-TRANS
   163
   164     MOVE WS-IN-COUNT TO ED-CNT
   165     DISPLAY 'RECORDS IN:  ' ED-CNT UPON SYSERR
   166     MOVE SPACES TO LIST-REC
   167     STRING  'RECORDS IN:  ' ED-CNT
   168       DELIMITED BY SIZE INTO LIST-REC
   169     CALL 'FNBLIST' USING 'W' LIST-REC
   170     MOVE WS-COUNT TO ED-CNT
   171     DISPLAY 'RECORDS OUT: ' ED-CNT UPON SYSERR
   172     MOVE SPACES TO LIST-REC
   173     STRING  'RECORDS OUT: ' ED-CNT
   174       DELIMITED BY SIZE INTO LIST-REC
   175     CALL 'FNBLIST' USING 'W' LIST-REC
   176     MOVE WS-DR-AMT TO ED-AMT
   177     DISPLAY '  DR AMOUNT: ' ED-AMT UPON SYSERR
   178     MOVE SPACES TO LIST-REC
   179     STRING  '  DR AMOUNT: ' ED-AMT
   180       DELIMITED BY SIZE INTO LIST-REC
   181     CALL 'FNBLIST' USING 'W' LIST-REC
   182     MOVE WS-CR-AMT TO ED-AMT
   183     DISPLAY '  CR AMOUNT: ' ED-AMT UPON SYSERR
   184     MOVE SPACES TO LIST-REC
   185     STRING  '  CR AMOUNT: ' ED-AMT
   186       DELIMITED BY SIZE INTO LIST-REC
   187     CALL 'FNBLIST' USING 'W' LIST-REC
* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:19 Page   5
* FNB196.cbl
   188     CALL 'FNBLIST' USING 'C' LIST-REC
   189
   190*    GOBACK GIVING RC.
   191     STOP RUN GIVING RC.
   192
   193 1000-PROCESS-PAYROLL.
   194
   195     ADD +1 TO WS-IN-COUNT
   196
   197     MOVE SPACES TO WORK-ADP-RECORD
   198
   199     UNSTRING ADP-RECORD DELIMITED BY '","'
   200         INTO ADP-FIRST-FIELD, ADP-ACCOUNT-NO,  ADP-PR-CODE,
   201              ADP-PAY-DATE,    ADP-AMOUNTX,     ADP-REFERENCE-1,
   202              ADP-DESCR,       ADP-REFERENCE-2, ADP-REFERENCE-3
   203     END-UNSTRING
   204
   205     IF ADP-ACCOUNT-NO = '9999999999999991'
   206       MOVE '2717000112000000' TO ADP-ACCOUNT-NO
   207     END-IF
   208
   209     MOVE FUNCTION NUMVAL (ADP-AMOUNTX) TO ADP-AMOUNT
   210
   211     IF ADP-CO-CODE NOT = 'MFN01'
   212*      FOR SOME REASON THE FIRST RECORD IS EMPTY
   213       IF WS-IN-COUNT = 1
   214         EXIT PARAGRAPH
   215       END-IF
   216       DISPLAY '*** WRONG INPUT TAPE - JOB CANCELLED ***'
   217               UPON SYSERR
   218       MOVE    '*** WRONG INPUT TAPE - JOB CANCELLED ***'
   219               TO LIST-REC
   220       CALL 'FNBLIST' USING 'W' LIST-REC
   221       CALL 'FNBLIST' USING 'C' LIST-REC
   222       MOVE 16 TO RC
   223*      GOBACK GIVING RC
   224       STOP RUN GIVING RC
   225     END-IF
   226
   227     MOVE ADP-PAY-MO  TO WS-POST-MO
   228     MOVE ADP-PAY-DAY TO WS-POST-DAY
   229     MOVE ADP-PAY-YR  TO WS-POST-YR
   230*    MOVE ADP-HDR-YEAR(1:3) TO WS-POST-YYY
   231     MOVE SYSTEM-DATE(5:3)  TO WS-POST-YYY
   232     IF WS-POSTING-DATE IS NOT NUMERIC
   233       DISPLAY '*** INVALID DATE IN RECORD: ' WS-POSTING-DATE
   234               UPON SYSERR
   235       MOVE SPACES TO LIST-REC
   236       STRING  '*** INVALID DATE IN RECORD: ' WS-POSTING-DATE
   237         DELIMITED BY SIZE INTO LIST-REC
   238       CALL 'FNBLIST' USING 'W' LIST-REC
   239       CALL 'FNBLIST' USING 'C' LIST-REC
   240       MOVE 16 TO RC
   241*      GOBACK GIVING RC
   242       STOP RUN GIVING RC
   243     END-IF
   244
   245     MOVE ADP-ACCOUNT-NO  TO GL-MAJ-ACCT
* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:19 Page   6
* FNB196.cbl
   246***  MOVE ZEROS           TO GL-DIV
   247***  MOVE ADP-CENTER      TO GL-CENTER
   248     MOVE ZEROS           TO GL-PRODUCT
   249     MOVE ZEROS           TO GL-STATE
   250
   251     MOVE '0'             TO GL-DIV(1:1)
   252     MOVE ADP-CENTER(2:1) TO GL-DIV(2:1)
   253     MOVE ADP-CENTER(3:4) TO GL-CENTER
   254
   255     MOVE SYSTEM-DATE     TO GL-JOURNAL-DATE
   256     MOVE WS-POSTING-DATE TO GL-POSTING-DATE
   257     MOVE ADP-AMOUNT      TO GL-AMOUNT
   258     MOVE SPACES          TO GL-REFERENCE
   259     MOVE ADP-DESCR       TO GL-DESCRIPTION
   260     MOVE 'PAYROL'        TO GL-SOURCE
   261     MOVE SPACES          TO GL-SUNDRY
   262     MOVE SPACES          TO GL-REVERSE-FLAG
   263     MOVE SPACES          TO GL-SUSPENSE
   264     MOVE SPACES          TO GL-ALLOC-CODE
   265     WRITE LEDGER-RECORD
   266     ADD +1 TO WS-COUNT
   267     IF ADP-AMOUNT IS NEGATIVE
   268       ADD ADP-AMOUNT TO WS-CR-AMT
   269     ELSE
   270       ADD ADP-AMOUNT TO WS-DR-AMT
   271     END-IF.
* Micro Focus Server Express         V5.1 revision 000 Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
*                                                        REF GNR-008065005AF
* Total Messages:     0
* Data:        2120     Code:        1826
