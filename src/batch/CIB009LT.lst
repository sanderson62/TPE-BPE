* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:18 Page   1
* CIB009LT.cbl
* Options: int("CIB009LT.int") anim csi verbose NOBOUND PARAMCOUNTCHECK
*          directives(cobopt.bth) endp list("CIB009LT.lst")
* Setting: NOACCEPTREFRESH NOADV ALIGN"8" ALPHASTART"1" NOALTER NOAMODE ANIM
*          NOANIMPREP ANS85 APOST NOAREACHECK ARITHMETIC"OSVS" ASSIGN
*          "EXTERNAL" NOASSIGN-PRINTER NOAUTOLOCK NOBELL NOBOUND NOBRIEF
*          NOBS2000 BWZSTAR NOBYTEMODEMOVE CALLFH"ebmlsfile" NOCALLMCS
*          NOCALLRECOVERY CALLSORT"EXTSM" CANCEL CANCELLBR NOCHANGEMESSAGE
*          CHARSET"ASCII" NOCHECKDIV NOCHECKREFMOD NOCICS CICS-CPY
*          NOCICSOPTIMIZE NOCMPR2 NOCOBFSTATCONV NOCOBIDY NOCOBOL370 COBOLDIR
*          NOCOMP COMP-5"2" COMP-6"2" NOCOMS85 CONFIRM NOCONVERTRET CONVSPACE
*          COPYEXT",cbl,cpy" NOCOPYLBR COPYLIST COPYLISTCOMMENT"1" CSI
*          CURRENCY-SIGN"36" CURRENT-DATE"MMDDYY" NODATA DATACOMPRESS"0"
*          NODATA-CONTEXT DATE DBCHECK DBCS"2" NODBCSSOSI DBSPACE DE-EDIT"2"
*          DEFAULTBYTE"32" NODEFAULTCALLS DETECTLOCK NODG DIALECT"MF"
*          NODIRECTIVES-IN-COMMENTS NODOSVS NODPCINSUBSCRIPT DYNAM
*          NOEARLY-RELEASE ECHO NOECHOALL NOEDITOR ENSUITE"0" NOENTCOBOL
*          ERRFORMAT"1" ERRLIST"EMBED" NOERRQ FASTSORT NOFCD3 NOFCDREG
*          NOFDCLEAR NOFILESHARE FILETYPE"0" NOFLAG NOFLAGAS NOFLAGCD
*          NOFLAGEUC NOFLAGMIG NOFLAGQ FLAGSINEDIT NOFLAGSTD NOFOLDCALLNAME
*          NOFOLDCOPYNAME FORM"60" NOFP-ROUNDING NOHOSTARITHMETIC
*          NOHOSTCONTZERO NOHOST-NUMCOMPARE NOHOST-NUMMOVE NOHOSTFD NOHOSTRW
*          NOIBM-MS IBMCOMP IDXFORMAT"0" NOILGEN IMPLICITSCOPE NOINDD
*          INFORETURN"0" NOINITCALL INITPTR INT"CIB009LT.int" INTDATE"ANSI"
*          INTLEVEL"2" IOCONV NOISO2002 NOIXNLSKEY NOIXNUMKEY KEEP-INT
*          KEYCHECK KEYCOMPRESS"0" LIBRARIAN"2" NOLINE-COUNT LIST
*          "CIB009LT.lst" LISTPATH"" LISTWIDTH"80" LITVAL-SIZE"4" LOCKTYPE"0"
*          NOMAPNAME NOMAXERROR METHODDEFAULT"REFERENCE" MF"15" MFCOMMENT
*          NOMOVELENCHECK NOMS NOMVS NATIVE"ASCII" NONATIVEFLOATINGPOINT
*          NONCHAR NONEWBASENAME NONLS NSYMBOL"DBCS" NOODOOSVS NOODOSLIDE
*          NOOLDBLANKLINE NOOLDCOPY NOOLDINDEX NOOLDNEXTSENTENCE NOOLDREADINTO
*          NOOLDSTRMIX OOCTRL"-C-E-G-P+Q+R-S+W" OPTIONAL-FILE NOOS390 OSEXT""
*          NOOSVS NOOUTDD NOP64 NOPANVALET PERFORM-TYPE"OSVS" NOPREPLIST
*          NOPREPROCESS NOPRINT-EXT NOPROFILE NOPROGID-COMMENT
*          NOPROGID-INT-NAME NOPROTECT-LINKAGE PROTOTYPE"RELAXED" QUAL
*          QUALPROC NOQUERY NOQUOTE NORAWLIST NORDW RECMODE"F" NOREENTRANT
*          NOREF NOREFNO REMAINDER"1" REPORT-LINE"256" RESEQ NORETRYLOCK
*          REWRITE-LS NORM RTNCODE-SIZE"4" NORWHARDPAGE NOSAA SEG NOSEQCHK
*          SEQUENTIAL"RECORD" NOSERIAL SETTING"LINE" NOSHAREOUTDD NOSHOW-DIR
*          SIGN"ASCII" NOSIGNDISCARD NOSIGNFIXUP SORTTYPE"DFSORT" SOURCEFORMAT
*          "FIXED" SOURCETABSTOP"8" NOSPZERO NOSSRANGE STDERR NOSTICKY-LINKAGE
*          NOSTICKY-PERFORM SUPFF SWITCHTYPE"1" SYMBSTART"1" SYSPUNCH"132"
*          TERMPAGE TIME NOTRACE NOTRUNC NOTRUNCCALLNAME NOTRUNCCOPY TRUNCINC
*          "10" UNICODE"NATIVE" VERBOSE VSC2"2" WARNING"1" NOWB NOWB2 NOWB3
*          WEBSERVER"CGI" NOWRITELOCK NOWRITETHRU NOXOPEN NOXREF
*          NOZEROLENGTHFALSE NOZEROSEQ NOZWB
     1 IDENTIFICATION DIVISION.
     2 PROGRAM-ID. CIB009l.
     3 AUTHOR.     DAN DRYDEN.
     4
     5*****************************************************************
     6*                                                               *
     7*  THIS PROGRAM SEARCHES THE FIRST 10 LINES OF A REPORT LOOKING *
     8*  FOR THE VALUE IN THE PARAMETER.  IF THE PARM IS FOUND, THE   *
     9*  ENTIRE PAGE IS PRINTED.                                      *
    10*                                                               *
    11*  THE PROGRAM ALSO INSERTS BLANK LINES INSTEAD OF PRINTER      *
    12*  CARRIAGE CONTROL CHARACTERS.                                 *
    13*                                                               *
* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:18 Page   2
* CIB009LT.cbl
    14*****************************************************************
    15
    16 ENVIRONMENT DIVISION.
    17 INPUT-OUTPUT SECTION.
    18 FILE-CONTROL.
    19
    20     SELECT OPTIONAL FICHE-FILE
    21         ASSIGN TO SYS010
    22         FILE STATUS IS SYS010-STATUS.
    23
    24     SELECT REPORT-FILE
    25         ASSIGN TO SYS011
    26         organization is line sequential
    27         FILE STATUS IS SYS011-STATUS.
    28
    29
    30 DATA DIVISION.
    31 FILE SECTION.
    32
    33 FD  FICHE-FILE
    34     LABEL RECORDS ARE STANDARD
    35     RECORDING MODE IS F
    36     BLOCK CONTAINS 0 RECORDS.
    37 01  FICHE-REC.
    38     05  PRINT-CONTROL    PIC X.
    39     05  FICHE-RECORD     PIC X(132).
    40
    41 FD  REPORT-FILE
    42     LABEL RECORDS ARE STANDARD
    43     RECORDING MODE IS F
    44     BLOCK CONTAINS 0 RECORDS.
    45 01  REPORT-RECORD    PIC X(132).
    46
    47
    48 WORKING-STORAGE SECTION.
    49
    50 01  BINARY.
    51     05  SUB         PIC S9(4)  VALUE +0.
    52     05  STRT        PIC S9(4)  VALUE +0.
    53     05  END-LINE    PIC S9(4)  VALUE +0.
    54     05  M-SUB       PIC S9(4)  VALUE +0.
    55
    56 01  FILLER.
    57     05  BLANK-LINE      PIC X     VALUE SPACE.
    58     05  S0C7            PIC X     VALUE SPACE.
    59     05  FORCE-DUMP REDEFINES S0C7 PIC S9 COMP-3.
    60     05  SYS010-STATUS   PIC XX    VALUE ZERO.
    61         88  EOF                   VALUE '10'.
    62     05  SYS011-STATUS   PIC XX    VALUE ZERO.
    63     05  IN-CNT          PIC S9(9) COMP-3 VALUE +0.
    64     05  OUT-CNT         PIC S9(9) COMP-3 VALUE +0.
    65     05  PRINT-SW        PIC X(3)  VALUE SPACE.
    66     05  WORKAREA.
    67         10  SAVE-REC OCCURS 10 TIMES PIC X(133).
    68
    69
* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:18 Page   3
* CIB009LT.cbl
    71*
    72 LINKAGE SECTION.
    73
    74 01  PARM.
    75     05  PARM-LENGTH BINARY  PICTURE IS S9(4).
    76     05  PARM-VALUE  DISPLAY PICTURE IS X(100).
    77
    78
    79
* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:18 Page   4
* CIB009LT.cbl
    81*
    82 PROCEDURE DIVISION USING PARM.
    83*
    84     PERFORM 000-INIT THRU 000-EXIT
    85     PERFORM 100-PROCESS THRU 100-EXIT
    86         UNTIL EOF
    87     PERFORM 900-END-PROGRAM THRU 900-EXIT
    88     STOP RUN.
    89
    90
* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:18 Page   5
* CIB009LT.cbl
    91/
    92 000-INIT.
    93*
    94     OPEN INPUT FICHE-FILE
    95     IF SYS010-STATUS NOT = '00'
    96        DISPLAY 'OPEN ERROR ' SYS010-STATUS ' ON SYS010'
    97        MOVE '10' TO SYS010-STATUS
    98     END-IF
    99
   100     OPEN OUTPUT REPORT-FILE
   101
   102     COMPUTE END-LINE = LENGTH OF WORKAREA - PARM-LENGTH
   103     if parm-length > +0
   104        inspect parm-value replacing
   105           all '-' by ' '
   106     end-if
   107
   108     .
   109 000-EXIT.
   110     EXIT.
   111
   112
* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:18 Page   6
* CIB009LT.cbl
   113/
   114 100-PROCESS.
   115*
   116     READ FICHE-FILE
   117          AT END GO TO 100-EXIT.
   118     ADD +1 TO IN-CNT
   119
   120     IF PRINT-CONTROL = '1'
   121        PERFORM 200-NEW-PAGE THRU 200-EXIT.
   122
   123     IF (PRINT-SW = 'YES')
   124        AND (NOT EOF)
   125        EVALUATE PRINT-CONTROL
   126           WHEN '0' WRITE REPORT-RECORD FROM BLANK-LINE
   127                    ADD +1 TO OUT-CNT
   128           WHEN '-' WRITE REPORT-RECORD FROM BLANK-LINE
   129                    WRITE REPORT-RECORD FROM BLANK-LINE
   130                    ADD +2 TO OUT-CNT
   131        END-EVALUATE
   132        WRITE REPORT-RECORD FROM FICHE-RECORD
   133        ADD +1 TO OUT-CNT
   134     END-IF
   135     .
   136 100-EXIT.
   137     EXIT.
   138
   139
* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:18 Page   7
* CIB009LT.cbl
   140/
   141 200-NEW-PAGE.
   142*
   143     IF PARM-LENGTH = +0
   144        MOVE 'YES' TO PRINT-SW
   145        GO TO 200-EXIT.
   146
   147     IF PARM-VALUE(1:PARM-LENGTH) = 'ALL'
   148        MOVE 'YES' TO PRINT-SW
   149        GO TO 200-EXIT.
   150
   151     MOVE 'NO' TO PRINT-SW
   152
   153     MOVE SPACES     TO WORKAREA
   154     MOVE FICHE-REC  TO SAVE-REC(1)
   155     PERFORM VARYING SUB FROM 2 BY 1
   156       UNTIL SUB > 10 OR EOF
   157        READ FICHE-FILE INTO SAVE-REC(SUB)
   158     END-PERFORM
   159     MOVE SUB             TO M-SUB
   160     PERFORM VARYING STRT FROM 1 BY 1
   161       UNTIL PRINT-SW = 'YES' OR STRT > END-LINE
   162          IF WORKAREA(STRT:PARM-LENGTH) =
   163             PARM-VALUE(1:PARM-LENGTH)
   164                MOVE 'YES' TO PRINT-SW
   165          END-IF
   166     END-PERFORM
   167
   168     IF PRINT-SW = 'YES'
   169        PERFORM VARYING SUB FROM 1 BY 1 UNTIL
   170         (SUB > 9)
   171           OR (SUB > M-SUB)
   172          EVALUATE SAVE-REC(SUB)(1:1)
   173            WHEN '0' WRITE REPORT-RECORD FROM BLANK-LINE
   174                     ADD +1 TO OUT-CNT
   175            WHEN '-' WRITE REPORT-RECORD FROM BLANK-LINE
   176                     WRITE REPORT-RECORD FROM BLANK-LINE
   177                     ADD +2 TO OUT-CNT
   178          END-EVALUATE
   179          WRITE REPORT-RECORD FROM SAVE-REC(SUB)(2:132)
   180          ADD +1 TO OUT-CNT
   181        END-PERFORM
   182     END-IF
   183     .
   184 200-EXIT.
   185     EXIT.
   186
   187
* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:18 Page   8
* CIB009LT.cbl
   188/
   189 900-END-PROGRAM.
   190*
   191     CLOSE REPORT-FILE
   192     DISPLAY 'RECORDS IN....' IN-CNT
   193     DISPLAY 'RECORDS OUT...' OUT-CNT
   194     .
   195 900-EXIT.
   196     EXIT.
   197
* Micro Focus Server Express         V5.1 revision 000 Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
*                                                        REF GNR-008065005AF
* Total Messages:     0
* Data:        3028     Code:        1299
