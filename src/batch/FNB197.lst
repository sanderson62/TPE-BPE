* Micro Focus Server Express         V5.1 revision 000 06-Oct-15 17:19 Page   1
* FNB197.cbl
* Options: int("FNB197.int") anim csi verbose NOBOUND PARAMCOUNTCHECK
*          directives(cobopt.bth) endp list("FNB197.lst")
* Setting: NOACCEPTREFRESH NOADV ALIGN"8" ALPHASTART"1" NOALTER NOAMODE ANIM
*          NOANIMPREP ANS85 APOST NOAREACHECK ARITHMETIC"OSVS" ASSIGN
*          "EXTERNAL" NOASSIGN-PRINTER NOAUTOLOCK NOBELL NOBOUND NOBRIEF
*          NOBS2000 BWZSTAR NOBYTEMODEMOVE CALLFH"ebmlsfile" NOCALLMCS
*          NOCALLRECOVERY CALLSORT"EXTSM" CANCEL CANCELLBR NOCHANGEMESSAGE
*          CHARSET"ASCII" NOCHECKDIV NOCHECKREFMOD NOCICS CICS-CPY
*          NOCICSOPTIMIZE NOCMPR2 NOCOBFSTATCONV NOCOBIDY NOCOBOL370 COBOLDIR
*          NOCOMP COMP-5"2" COMP-6"2" NOCOMS85 CONFIRM NOCONVERTRET CONVSPACE
*          COPYEXT",cbl,cpy" NOCOPYLBR COPYLIST COPYLISTCOMMENT"1" CSI
*          CURRENCY-SIGN"36" CURRENT-DATE"MMDDYY" NODATA DATACOMPRESS"0"
*          NODATA-CONTEXT DATE DBCHECK DBCS"2" NODBCSSOSI DBSPACE DE-EDIT"2"
*          DEFAULTBYTE"32" NODEFAULTCALLS DETECTLOCK NODG DIALECT"MF"
*          NODIRECTIVES-IN-COMMENTS NODOSVS NODPCINSUBSCRIPT DYNAM
*          NOEARLY-RELEASE ECHO NOECHOALL NOEDITOR ENSUITE"0" NOENTCOBOL
*          ERRFORMAT"1" ERRLIST"EMBED" NOERRQ FASTSORT NOFCD3 NOFCDREG
*          NOFDCLEAR NOFILESHARE FILETYPE"0" NOFLAG NOFLAGAS NOFLAGCD
*          NOFLAGEUC NOFLAGMIG NOFLAGQ FLAGSINEDIT NOFLAGSTD NOFOLDCALLNAME
*          NOFOLDCOPYNAME FORM"60" NOFP-ROUNDING NOHOSTARITHMETIC
*          NOHOSTCONTZERO NOHOST-NUMCOMPARE NOHOST-NUMMOVE NOHOSTFD NOHOSTRW
*          NOIBM-MS IBMCOMP IDXFORMAT"0" NOILGEN IMPLICITSCOPE NOINDD
*          INFORETURN"0" NOINITCALL INITPTR INT"FNB197.int" INTDATE"ANSI"
*          INTLEVEL"2" IOCONV NOISO2002 NOIXNLSKEY NOIXNUMKEY KEEP-INT
*          KEYCHECK KEYCOMPRESS"0" LIBRARIAN"2" NOLINE-COUNT LIST"FNB197.lst"
*          LISTPATH"" LISTWIDTH"80" LITVAL-SIZE"4" LOCKTYPE"0" NOMAPNAME
*          NOMAXERROR METHODDEFAULT"REFERENCE" MF"15" MFCOMMENT NOMOVELENCHECK
*          NOMS NOMVS NATIVE"ASCII" NONATIVEFLOATINGPOINT NONCHAR
*          NONEWBASENAME NONLS NSYMBOL"DBCS" NOODOOSVS NOODOSLIDE
*          NOOLDBLANKLINE NOOLDCOPY NOOLDINDEX NOOLDNEXTSENTENCE NOOLDREADINTO
*          NOOLDSTRMIX OOCTRL"-C-E-G-P+Q+R-S+W" OPTIONAL-FILE NOOS390 OSEXT""
*          NOOSVS NOOUTDD NOP64 NOPANVALET PERFORM-TYPE"OSVS" NOPREPLIST
*          NOPREPROCESS NOPRINT-EXT NOPROFILE NOPROGID-COMMENT
*          NOPROGID-INT-NAME NOPROTECT-LINKAGE PROTOTYPE"RELAXED" QUAL
*          QUALPROC NOQUERY NOQUOTE NORAWLIST NORDW RECMODE"F" NOREENTRANT
*          NOREF NOREFNO REMAINDER"1" REPORT-LINE"256" RESEQ NORETRYLOCK
*          REWRITE-LS NORM RTNCODE-SIZE"4" NORWHARDPAGE NOSAA SEG NOSEQCHK
*          SEQUENTIAL"RECORD" NOSERIAL SETTING"LINE" NOSHAREOUTDD NOSHOW-DIR
*          SIGN"ASCII" NOSIGNDISCARD NOSIGNFIXUP SORTTYPE"DFSORT" SOURCEFORMAT
*          "FIXED" SOURCETABSTOP"8" NOSPZERO NOSSRANGE STDERR NOSTICKY-LINKAGE
*          NOSTICKY-PERFORM SUPFF SWITCHTYPE"1" SYMBSTART"1" SYSPUNCH"132"
*          TERMPAGE TIME NOTRACE NOTRUNC NOTRUNCCALLNAME NOTRUNCCOPY TRUNCINC
*          "10" UNICODE"NATIVE" VERBOSE VSC2"2" WARNING"1" NOWB NOWB2 NOWB3
*          WEBSERVER"CGI" NOWRITELOCK NOWRITETHRU NOXOPEN NOXREF
*          NOZEROLENGTHFALSE NOZEROSEQ NOZWB
* GENERAL LEDGER SUSPENSE FILE UPDATE                  06-Oct-15 17:19 Page   2
* FNB197.cbl
     2
     3 IDENTIFICATION DIVISION.
     4 PROGRAM-ID.    FNB197.
     5 AUTHOR.        DAN DRYDEN.
     6 DATE-WRITTEN.  JANUARY, 1999.
     7
     8*****************************************************************
     9*                         H I S T O R Y                         *
    10*****************************************************************
    11* NAME    DATE    DESCRIPTION                                   *
    12* ---- ---------- --------------------------------------------- *
    13* DANA 01/__/1999 TO PRODUCTION                                 *
    14* DJNA 02/24/2003 CONVERT FROM MAINFRAME TO MICROFOCUS COBOL.   *
    15* AJRA 08/25/2006 REMOVE FROM THE CLAIMS SYSTEM                 *
    16*****************************************************************
    17
    18 ENVIRONMENT DIVISION.
    19 INPUT-OUTPUT SECTION.
    20 FILE-CONTROL.
    21
    22     SELECT GLSUSP-IN
    23         ASSIGN TO EXTERNAL SYS010
    24         ORGANIZATION IS LINE SEQUENTIAL
    25         FILE STATUS IS SYS010-STATUS.
    26
    27     SELECT GLSUSP-OUT
    28         ORGANIZATION IS LINE SEQUENTIAL
    29         ASSIGN TO EXTERNAL SYS011.
    30
    31     SELECT GLSUSP-DELETED
    32         ORGANIZATION IS LINE SEQUENTIAL
    33         ASSIGN TO EXTERNAL SYS012.
    34
    35 DATA DIVISION.
    36 FILE SECTION.
    37
    38 FD  GLSUSP-IN
    39     LABEL RECORDS ARE STANDARD
    40     RECORDING MODE IS F
    41     RECORD CONTAINS 120 CHARACTERS
    42     BLOCK CONTAINS 0 RECORDS.
    43 01  GLSUSP-INPUT-RECORD.
    44     05  GLI-KEY                   PIC X(39).
    45     05  FILLER                    PIC X(16).
    46     05  GLI-TRANS-AMOUNT          PIC S9(12)V99
    47                                   SIGN TRAILING SEPARATE.
    48     05  FILLER                    PIC X(50).
    49
    50 FD  GLSUSP-OUT
    51     LABEL RECORDS ARE STANDARD
    52     RECORDING MODE IS F
    53     RECORD CONTAINS 120 CHARACTERS
    54     BLOCK CONTAINS 0 RECORDS.
    55 01  GLSUSP-OUTPUT-RECORD.
    56     05  FILLER                    PIC X(55).
    57     05  GLO-TRANS-AMOUNT          PIC S9(12)V99
    58                                   SIGN TRAILING SEPARATE.
    59     05  FILLER                    PIC X(50).
* GENERAL LEDGER SUSPENSE FILE UPDATE                  06-Oct-15 17:19 Page   3
* FNB197.cbl
    60
    61 FD  GLSUSP-DELETED
    62     LABEL RECORDS ARE STANDARD
    63     RECORDING MODE IS F
    64     RECORD CONTAINS 120 CHARACTERS
    65     BLOCK CONTAINS 0 RECORDS.
    66 01  GLSUSP-DELETED-RECORD.
    67     05  FILLER                    PIC X(55).
    68     05  GLD-TRANS-AMOUNT          PIC S9(12)V99
    69                                   SIGN TRAILING SEPARATE.
    70     05  FILLER                    PIC X(50).
    71
    72 WORKING-STORAGE SECTION.
    73
    74 01 RC                       PIC S9(9)   COMP-5 VALUE 0.
    75 01 LIST-REC                 PIC X(132).
    76
    77 01  FILLER                  COMP-3.
    78     05  WS-TRANS-AMT        PIC S9(11)V99  VALUE +0.
    79     05  INPUT-CNT           PIC S9(9)      VALUE +0.
    80         88  FIRST-RECORD                   VALUE +1.
    81     05  INPUT-DR-AMT        PIC S9(11)V99  VALUE +0.
    82     05  INPUT-CR-AMT        PIC S9(11)V99  VALUE +0.
    83     05  DELETED-CNT         PIC S9(9)      VALUE +0.
    84     05  DELETED-DR-AMT      PIC S9(11)V99  VALUE +0.
    85     05  DELETED-CR-AMT      PIC S9(11)V99  VALUE +0.
    86     05  OUTPUT-CNT          PIC S9(9)      VALUE +0.
    87     05  OUTPUT-DR-AMT       PIC S9(11)V99  VALUE +0.
    88     05  OUTPUT-CR-AMT       PIC S9(11)V99  VALUE +0.
    89
    90 01  FILLER.
    91     05  SYS010-STATUS       PIC XX     VALUE '00'.
    92         88  EOF                        VALUE '10'.
    93     05  PREV-KEY            PIC X(39)  VALUE LOW-VALUE.
    94     05  SYS-DATE            PIC 9(8).
    95     05  WS-DATE             PIC XX/XX/XXXX.
    96
    97 01  WORK-DATE.
    98     05  WRK-YR    PIC 9999.
    99     05  WRK-MO    PIC 99.
   100     05  WRK-DAY   PIC 99.
   101
   102 01  SYSTEM-DATE.
   103     05  SYS-MO    PIC 99.
   104     05  SYS-DAY   PIC 99.
   105     05  SYS-YR    PIC 9999.
   106
   107
   108 01  EOJ-LINE.
   109     05  EOJ-MSG             PIC X(16).
   110     05  EOJ-CNT             PIC ZZZ,ZZZ,ZZ9.
   111     05  EOJ-DR-AMT          PIC ZZZ,ZZZ,ZZZ,ZZZ.99.
   112     05  FILLER              PIC XXX    VALUE ' DR'.
   113     05  EOJ-CR-AMT          PIC ZZZ,ZZZ,ZZZ,ZZZ.99.
   114     05  FILLER              PIC XXX    VALUE ' CR'.
   115
   116 01  TRANS-RECORD-HOLD-AREA.
   117     05  END-OF-TABLE INDEX.
* GENERAL LEDGER SUSPENSE FILE UPDATE                  06-Oct-15 17:19 Page   4
* FNB197.cbl
   118     05  TABLE-MAX  VALUE +15000 PIC S9(8) BINARY.
   119     05  TRANS-HOLD OCCURS 15000 TIMES INDEXED BY TRANS-INDX.
   120         10  FILLER            PIC X(55).
   121         10  TRANS-AMOUNT      PIC S9(12)V99
   122                               SIGN TRAILING SEPARATE.
   123         10  FILLER            PIC X(50).
   124
   125 01  ED-MAX                    PIC ZZZZZZ,ZZ9.
   126
   127 PROCEDURE DIVISION.
   128
   129     CALL 'FNBLIST' USING 'O' LIST-REC
   130     OPEN INPUT GLSUSP-IN
   131     IF SYS010-STATUS NOT = '00'
   132       DISPLAY '*** OPEN ERROR ' SYS010-STATUS ' ON SYS010'
   133               UPON SYSERR
   134       MOVE SPACES TO LIST-REC
   135       STRING  '*** OPEN ERROR ' SYS010-STATUS ' ON SYS010'
   136         DELIMITED BY SIZE INTO LIST-REC
   137       CALL 'FNBLIST' USING 'W' LIST-REC
   138       CALL 'FNBLIST' USING 'C' LIST-REC
   139       MOVE 16 TO RC
   140*      GOBACK GIVING RC
   141       STOP RUN GIVING RC
   142     END-IF
   143
   144     OPEN OUTPUT GLSUSP-DELETED
   145     OPEN OUTPUT GLSUSP-OUT
   146     SET TRANS-INDX TO +1
   147
   148     PERFORM 1000-UPDATE UNTIL EOF
   149
   150     PERFORM 1100-PROCESS-ENTRIES
   151
   152     CLOSE GLSUSP-IN
   153           GLSUSP-DELETED
   154           GLSUSP-OUT
   155
   156     ACCEPT WORK-DATE FROM DATE YYYYMMDD
   157     MOVE WRK-YR  TO SYS-YR
   158     MOVE WRK-MO  TO SYS-MO
   159     MOVE WRK-DAY TO SYS-DAY
   160
   161     MOVE SYSTEM-DATE TO SYS-DATE
   162*    CALL 'SYSDATE' USING SYS-DATE
   163     MOVE SYS-DATE TO WS-DATE
   164     DISPLAY 'SUSPENSE REPORTING FILE UPDATE ' WS-DATE UPON SYSERR
   165     DISPLAY ' '                                       UPON SYSERR
   166     MOVE SPACES TO LIST-REC
   167     STRING  'SUSPENSE REPORTING FILE UPDATE ' WS-DATE
   168       DELIMITED BY SIZE INTO LIST-REC
   169     CALL 'FNBLIST' USING 'W' LIST-REC
   170     MOVE SPACES TO LIST-REC
   171     CALL 'FNBLIST' USING 'W' LIST-REC
   172
   173     MOVE 'INPUT RECORDS: ' TO EOJ-MSG
   174     MOVE INPUT-CNT         TO EOJ-CNT
   175     MOVE INPUT-DR-AMT      TO EOJ-DR-AMT
* GENERAL LEDGER SUSPENSE FILE UPDATE                  06-Oct-15 17:19 Page   5
* FNB197.cbl
   176     MOVE INPUT-CR-AMT      TO EOJ-CR-AMT
   177     DISPLAY EOJ-LINE UPON SYSERR
   178     MOVE EOJ-LINE TO LIST-REC
   179     CALL 'FNBLIST' USING 'W' LIST-REC
   180
   181     MOVE 'DELETED RECORDS:' TO EOJ-MSG
   182     MOVE DELETED-CNT       TO EOJ-CNT
   183     MOVE DELETED-DR-AMT    TO EOJ-DR-AMT
   184     MOVE DELETED-CR-AMT    TO EOJ-CR-AMT
   185     DISPLAY EOJ-LINE UPON SYSERR
   186     MOVE EOJ-LINE TO LIST-REC
   187     CALL 'FNBLIST' USING 'W' LIST-REC
   188
   189     MOVE 'OUTPUT RECORDS:' TO EOJ-MSG
   190     MOVE OUTPUT-CNT        TO EOJ-CNT
   191     MOVE OUTPUT-DR-AMT     TO EOJ-DR-AMT
   192     MOVE OUTPUT-CR-AMT     TO EOJ-CR-AMT
   193     DISPLAY EOJ-LINE UPON SYSERR
   194     MOVE EOJ-LINE TO LIST-REC
   195     CALL 'FNBLIST' USING 'W' LIST-REC
   196     CALL 'FNBLIST' USING 'C' LIST-REC
   197
   198*    GOBACK GIVING RC.
   199     STOP RUN GIVING RC.
   200
   201 1000-UPDATE.
   202
   203     READ GLSUSP-IN
   204       AT END EXIT PARAGRAPH
   205     END-READ
   206
   207     ADD +1 TO INPUT-CNT
   208     IF GLI-TRANS-AMOUNT IS NEGATIVE
   209       ADD GLI-TRANS-AMOUNT TO INPUT-CR-AMT
   210     ELSE
   211       ADD GLI-TRANS-AMOUNT TO INPUT-DR-AMT
   212     END-IF
   213
   214     IF FIRST-RECORD
   215       MOVE GLI-KEY TO PREV-KEY
   216     END-IF
   217
   218     IF GLI-KEY = PREV-KEY
   219       CONTINUE
   220     ELSE
   221       IF GLI-KEY > PREV-KEY
   222         PERFORM 1100-PROCESS-ENTRIES
   223       ELSE
   224         DISPLAY 'INPUT FILE IS OUT OF SEQUENCE' UPON SYSERR
   225         DISPLAY '>> JOB CANCELLED <<'           UPON SYSERR
   226         MOVE    'INPUT FILE IS OUT OF SEQUENCE' TO LIST-REC
   227         CALL 'FNBLIST' USING 'W' LIST-REC
   228         MOVE    '>> JOB CANCELLED <<'           TO LIST-REC
   229         CALL 'FNBLIST' USING 'W' LIST-REC
   230         MOVE 16 TO RC
   231*        GOBACK GIVING RC
   232         STOP RUN GIVING RC
   233       END-IF
* GENERAL LEDGER SUSPENSE FILE UPDATE                  06-Oct-15 17:19 Page   6
* FNB197.cbl
   234     END-IF
   235
   236     MOVE GLSUSP-INPUT-RECORD TO TRANS-HOLD (TRANS-INDX)
   237     SET TRANS-INDX UP BY +1
   238     IF TRANS-INDX > TABLE-MAX
   239       MOVE TABLE-MAX TO ED-MAX
   240       DISPLAY 'TABLE OVERFLOW IN ROUTINE 1000-UPDATE' UPON SYSERR
   241       DISPLAY 'INPUT RECORD KEY ' GLI-KEY             UPON SYSERR
   242       DISPLAY 'HAS MORE THAN ' ED-MAX ' RECORDS'      UPON SYSERR
   243       MOVE    'TABLE OVERFLOW IN ROUTINE 1000-UPDATE' TO LIST-REC
   244       CALL 'FNBLIST' USING 'W' LIST-REC
   245       MOVE SPACES TO LIST-REC
   246       STRING  'INPUT RECORD KEY ' GLI-KEY
   247         DELIMITED BY SIZE INTO LIST-REC
   248       CALL 'FNBLIST' USING 'W' LIST-REC
   249       MOVE SPACES TO LIST-REC
   250       STRING  'HAS MORE THAN ' ED-MAX ' RECORDS'
   251         DELIMITED BY SIZE INTO LIST-REC
   252       CALL 'FNBLIST' USING 'W' LIST-REC
   253       MOVE 16 TO RC
   254*      GOBACK GIVING RC
   255       STOP RUN GIVING RC
   256     END-IF
   257
   258     MOVE GLI-KEY TO PREV-KEY.
   259
   260 1100-PROCESS-ENTRIES.
   261
   262     SET END-OF-TABLE TO TRANS-INDX
   263     MOVE +0 TO WS-TRANS-AMT
   264
   265     PERFORM VARYING TRANS-INDX FROM 1 BY 1
   266       UNTIL TRANS-INDX = END-OF-TABLE
   267       ADD TRANS-AMOUNT (TRANS-INDX) TO WS-TRANS-AMT
   268     END-PERFORM
   269
   270*** IF THE NET TRANSACTION AMOUNT = ZERO, IT MEANS THE
   271*** THE TRANSACTION HAS "CLEARED".  THE CLEARED TRANSACTIONS
   272*** ARE WRITTEN TO THE DELETED FILE WHICH WILL BE MERGED INTO
   273*** AN INCEPTION-TO-DATE FILE OF DELETED TRANSACTIONS.
   274
   275     IF WS-TRANS-AMT = ZERO
   276       PERFORM VARYING TRANS-INDX FROM 1 BY 1
   277         UNTIL TRANS-INDX = END-OF-TABLE
   278         MOVE TRANS-HOLD (TRANS-INDX) TO GLSUSP-DELETED-RECORD
   279         ADD +1 TO DELETED-CNT
   280         IF GLD-TRANS-AMOUNT IS NEGATIVE
   281           ADD GLD-TRANS-AMOUNT TO DELETED-CR-AMT
   282         ELSE
   283           ADD GLD-TRANS-AMOUNT TO DELETED-DR-AMT
   284         END-IF
   285         WRITE GLSUSP-DELETED-RECORD
   286       END-PERFORM
   287     ELSE
   288       PERFORM VARYING TRANS-INDX FROM 1 BY 1
   289         UNTIL TRANS-INDX = END-OF-TABLE
   290         MOVE TRANS-HOLD (TRANS-INDX) TO GLSUSP-OUTPUT-RECORD
   291         ADD +1 TO OUTPUT-CNT
* GENERAL LEDGER SUSPENSE FILE UPDATE                  06-Oct-15 17:19 Page   7
* FNB197.cbl
   292         IF GLO-TRANS-AMOUNT IS NEGATIVE
   293           ADD GLO-TRANS-AMOUNT TO OUTPUT-CR-AMT
   294         ELSE
   295           ADD GLO-TRANS-AMOUNT TO OUTPUT-DR-AMT
   296         END-IF
   297         WRITE GLSUSP-OUTPUT-RECORD
   298       END-PERFORM
   299     END-IF
   300
   301     SET TRANS-INDX TO +1.
* Micro Focus Server Express         V5.1 revision 000 Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
*                                                        REF GNR-008065005AF
* Total Messages:     0
* Data:     1802576     Code:        2221
